CREATE OR REPLACE PROCEDURE CptUseLogUse_Insert2 (capitalid_1 	integer, usedate_2 	char, usedeptid_3 	integer, useresourceid_4 	integer, usecount_5 	number,userequest_6 	integer, maintaincompany_8 	varchar2, fee_9 	decimal, usestatus_10 	varchar, remark_11 	varchar2, useaddress_12 varchar2, sptcount_1	char, flag out integer , msg out varchar2, thecursor IN OUT cursor_define.weavercursor)  AS num_1 number; num_count integer; 
begin if sptcount_1 <> '1' then select count(capitalnum) INTO num_count from CptCapital where id = capitalid_1; if(num_count > 0) then  select capitalnum INTO num_1 from CptCapital where id = capitalid_1; if num_1 < usecount_5 then open thecursor for select -1 from dual; return; else num_1 := num_1-usecount_5; end if; end if; end if;  INSERT INTO CptUseLog ( capitalid, usedate, usedeptid, useresourceid, usecount,userequest, maintaincompany, fee, usestatus, remark, useaddress, olddeptid)  VALUES ( capitalid_1, usedate_2, usedeptid_3, useresourceid_4, usecount_5,userequest_6, maintaincompany_8, fee_9, '2', remark_11, useaddress_12, 0);
if sptcount_1 = '1' then Update CptCapital Set olddepartment=departmentid where id = capitalid_1; Update CptCapital Set departmentid = usedeptid_3, resourceid   = useresourceid_4, stateid = usestatus_10 where id = capitalid_1; insert INTO HrmCapitalUse (capitalid,hrmid,cptnum) values(capitalid_1,useresourceid_4,1); 
else Update CptCapital Set capitalnum = num_1 where id = capitalid_1; insert INTO HrmCapitalUse (capitalid,hrmid,cptnum) values(capitalid_1,useresourceid_4,usecount_5); open thecursor for select 1 from dual; end if; end;
/
CREATE OR REPLACE PROCEDURE Capital_Adjust2 ( capitalid_1 integer, usedate_1 varchar2, usedeptid_1 integer, useresourceid_1 integer,userequest_1 integer, usecount_1 integer, useaddress_1 varchar2, usestatus_1 varchar2, remark_1 varchar2, olddeptid_1 integer, flag out 	integer	, msg out	varchar2, thecursor IN OUT cursor_define.weavercursor ) as begin insert INTO CptUseLog ( capitalid, usedate, usedeptid, useresourceid,userequest, usecount, useaddress, usestatus, remark, olddeptid) values ( capitalid_1  , usedate_1  , usedeptid_1  , useresourceid_1  ,userequest_1  , usecount_1  , useaddress_1  , usestatus_1  , remark_1  , olddeptid_1  );  update CptCapital set departmentid = usedeptid_1  , resourceid = useresourceid_1 WHERE id=capitalid_1; end;
/