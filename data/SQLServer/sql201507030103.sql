ALTER TABLE Prj_TaskInfo ADD begintime VARCHAR(10)
GO
ALTER TABLE Prj_TaskInfo ADD endtime VARCHAR(10)
GO
ALTER TABLE Prj_TaskInfo ADD actualbegintime VARCHAR(10)
GO
ALTER TABLE Prj_TaskInfo ADD actualendtime VARCHAR(10)
GO
UPDATE Prj_TaskInfo SET begintime ='00:00',endtime='23:59',actualbegintime='00:00',actualendtime='23:59' 
GO
ALTER procedure Prj_Plan_SaveFromProcess (@prjid 	[int], @version	[int],@creater	[int],@createdate	varchar(4000),@createtime	varchar(4000), @flag integer output, @msg varchar(4000) output  ) AS declare @taskid 	[int], @wbscoding 	varchar(4000), @subject 	varchar(4000), @begindate 	varchar(4000), @enddate 	varchar(4000), @workday        [decimal] (10,1), @content 	varchar(4000), @fixedcost	[decimal](10,2), @parentid	[int], @parentids	varchar(4000), @parenthrmids	varchar(4000), @level_n		[tinyint], @hrmid		[int],@taskindex int , @realManDays decimal(6,1),@actualBeginDate varchar(10),@actualEndDate varchar(10),@finish int, @islandmark char(1) , @begintime 	varchar(20), @endtime 	varchar(20),@actualBegintime varchar(20),@actualEndtime varchar(20),@all_cursor	cursor SET @all_cursor = CURSOR FORWARD_ONLY STATIC FOR select  id , wbscoding, subject , begindate, enddate, workday, content, fixedcost, parentid, parentids, parenthrmids, level_n, hrmid,taskindex ,realManDays,actualBeginDate,actualEndDate,finish,islandmark,begintime,endtime,actualbegintime,actualendtime from [Prj_TaskProcess] where prjid = @prjid OPEN @all_cursor FETCH NEXT FROM @all_cursor INTO @taskid,@wbscoding,@subject,@begindate,@enddate, @workday,@content,@fixedcost,@parentid,@parentids,@parenthrmids,@level_n,@hrmid,@taskindex ,@realManDays,@actualBeginDate,@actualEndDate,@finish,@islandmark,@begintime,@endtime,@actualbegintime,@actualendtime WHILE @@FETCH_STATUS = 0 begin INSERT INTO [Prj_TaskInfo] ( prjid, taskid , wbscoding, subject ,begindate, enddate, workday, content, fixedcost, parentid, parentids, parenthrmids, level_n, hrmid,taskindex ,realManDays,actualBeginDate,actualEndDate,finish,islandmark, isactived, version,creater,createdate,createtime,begintime,endtime,actualbegintime,actualendtime)  VALUES (  @prjid, @taskid , @wbscoding, @subject , @begindate, @enddate, @workday, @content, @fixedcost, @parentid, @parentids, @parenthrmids, @level_n, @hrmid,@taskindex ,@realManDays,@actualBeginDate,@actualEndDate,@finish,@islandmark,'1',@version,@creater,@createdate,@createtime,@begintime,@endtime,@actualbegintime,@actualendtime) FETCH NEXT FROM @all_cursor INTO @taskid,@wbscoding,@subject,@begindate,@enddate, @workday,@content,@fixedcost,@parentid,@parentids,@parenthrmids,@level_n,@hrmid,@taskindex ,@realManDays,@actualBeginDate,@actualEndDate,@finish,@islandmark,@begintime,@endtime,@actualbegintime,@actualendtime end CLOSE @all_cursor DEALLOCATE @all_cursor
GO
