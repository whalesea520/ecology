/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._workflow._search;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import weaver.general.Util;
import java.util.*;
import java.lang.*;
import java.sql.Timestamp;
import weaver.systeminfo.menuconfig.LeftMenuInfoHandler;
import weaver.systeminfo.menuconfig.LeftMenuInfo;
import weaver.search.*;
import weaver.workflow.workflow.*;
import weaver.conn.*;
import weaver.workflow.workflow.WorkflowVersion;
import java.net.*;
import weaver.hrm.*;
import weaver.systeminfo.*;
import weaver.general.*;
import ln.LN;
import weaver.hrm.settings.ChgPasswdReminder;
import weaver.hrm.settings.HrmSettingsComInfo;
import weaver.hrm.settings.RemindSettings;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import weaver.workflow.workflow.TestWorkflowCheck;
import weaver.systeminfo.template.UserTemplate;
import weaver.systeminfo.setting.*;
import weaver.login.LicenseCheckLogin;
import weaver.hrm.online.IPUtil;
import java.util.Map;

public class _wfsearchtemp__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;

  
  private String getCurrWuiConfig(HttpSession session, User user, String keyword) throws Exception {
  	
  	if (keyword == null || "".equals(keyword)) {
  		return "";
  	}
  	
  	String curTheme = "";
  	String curskin = "";
  
  	
  		String[] rtnValue = getHrmUserSetting(user);
  		
  		curTheme = rtnValue[0];
  		curskin = rtnValue[1];
  		if(curTheme.equals("")||curskin.equals("")){
  			String templatetype = getCurrE8TemplateType(user);
  			if("".equals(templatetype)){
  				curTheme = "ecologyBasic";
  				curskin = "default";
  			}else if("ecology7".equals(templatetype)){
  				curTheme ="ecology7";
  				curskin = getCurrE8SkinInfo(user);
  			}else{
  				curTheme ="ecology8";
  				curskin = "default";
  			}
  			
  			
  			
  			
  		}else{
  			curTheme = rtnValue[0];
  			curskin = rtnValue[1];
  		}
  		
  		if(curTheme.equals("custom")){
  			curTheme ="ecology8";
  		}
  		
  		session.setAttribute("SESSION_CURRENT_THEME", curTheme);
  		session.setAttribute("SESSION_CURRENT_SKIN", curskin);
  	
  	if ("THEME".equals(keyword.toUpperCase())) {
  		return curTheme;
  	}
  	
  	if ("SKIN".equals(keyword.toUpperCase())) {
  		return curskin;
  	}
  	return "";
  }
  
  
  
  private String getCurrSkinFolder(User user) throws Exception {
  	String pslSkinfolder = "";
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  
  	int userid = user.getUID();
  
  	rs.executeSql("select skin from HrmUserSetting where resourceId=" + userid);
  	
  	if (rs.next()) {
  		pslSkinfolder = rs.getString("skin");
  	}
  
  	if (pslSkinfolder == null || "".equals(pslSkinfolder)) {
  	    pslSkinfolder = "default";
  	}
  	return pslSkinfolder;
  }
  
  private String getCurrE8TemplateType(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	String skin =  userTemplate.getTemplatetype();
  	
  	
  	return skin;
  	
  }
  
  private String getCurrE8SkinInfo(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	String skin =  userTemplate.getSkin();
  	
  	
  	return skin;
  	
  }
  
  private int getCurrTemplateId(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	int id =  userTemplate.getTemplateId();
  	
  	
  	return id;
  	
  }
  
  private String getCurrTemplateLogo(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	String logo =  userTemplate.getLogo();
  	
  	
  	return logo;
  	
  }
  
  private String[] getHrmUserSetting(User user) throws Exception {
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  
  	String[] result = new String[2];
  	String theme = "";
  	String skin = "";
  	
  	String sql="select templateid from SystemTemplateSubComp where subcompanyid="+user.getUserSubCompany1();
  	rs.executeSql(sql);
  	if(rs.next()){	
  	
  		String curUserCanUse = rs.getString("templateid");
  		sql = "SELECT a.* FROM HrmUserSetting a, SystemTemplate  b WHERE a.resourceId="+user.getUID()+" AND a.templateId=b.id  and  b.id="+curUserCanUse;
  		rs.execute(sql);
  		if(rs.next()){
  			theme = rs.getString("theme");
  			skin = rs.getString("skin");
  			if("ecology8".equals(theme)){
  				skin = "default";
  			}
  			result[0] = theme;
  			result[1] = skin;
  			return result;
  		}
  	}
  	
  	
  
  	
  	int userid = user.getUID();
  	rs.executeSql("select theme, skin from HrmUserSetting where resourceId=" + userid);
  	
  	if (rs.next()) {
  		theme = rs.getString("theme");
  		skin = rs.getString("skin");
  	}
  	
  	//rs.executeSql("select * from extandHpThemeItem where extandHpThemeId=" + sqltemplateid1 + " and isopen=1 and theme='" + theme + "' and skin='" + skin + "'");
  	result[0] = theme;
  	result[1] = skin;
  	
  	
  	
  	//System.out.println("result"+result[0]+result[1]);
  	return result;
  }
  
  
  private java.util.Map getPageConfigInfo(HttpSession session, User user) throws Exception{
  	
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	java.util.Map pageConfigkv = new java.util.HashMap();
  	
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	pageConfigkv.put("logoTop",userTemplate.getLogo());
  	pageConfigkv.put("logoBottom", userTemplate.getLogo());
  	pageConfigkv.put("isopen", userTemplate.getIsopen());
  	//pageConfigkv.put("islock", rs.getString("islock"));
  	
  	int extendtempletvalueid = userTemplate.getExtendtempletvalueid();
  	rs.executeSql("select * from extandHpThemeItem where extandHpThemeId=" + extendtempletvalueid + " and isopen=1 and theme='" + getCurrWuiConfig(session, user, "THEME") + "' and skin='" + getCurrWuiConfig(session, user, "SKIN") + "'");
  	
  	if (rs.next()) {
  	
  		
  		/**
  		 * ecologybasic\u4e3b\u9898\u7528\u8bbe\u7f6e\u9879
  		 */
  		pageConfigkv.put("bodyBg", rs.getString("bodyBg"));
  		pageConfigkv.put("topBgImage", rs.getString("topBgImage"));
  		pageConfigkv.put("toolbarBgColor", rs.getString("toolbarBgColor"));
  		pageConfigkv.put("menuborderColor", rs.getString("menuborderColor"));
  
  		pageConfigkv.put("leftbarBgImage", rs.getString("leftbarBgImage"));
  		pageConfigkv.put("leftbarBgImageH", rs.getString("leftbarBgImageH"));
  
  		pageConfigkv.put("leftbarborderColor", rs.getString("leftbarborderColor"));
  		pageConfigkv.put("leftbarFontColor", rs.getString("leftbarFontColor"));
  
  		pageConfigkv.put("topleftbarBgImage_left", rs.getString("topleftbarBgImage_left"));
  		pageConfigkv.put("topleftbarBgImage_center", rs.getString("topleftbarBgImage_center"));
  		pageConfigkv.put("topleftbarBgImage_right", rs.getString("topleftbarBgImage_right"));
  
  		pageConfigkv.put("bottomleftbarBgImage_left", rs.getString("bottomleftbarBgImage_left"));
  		pageConfigkv.put("bottomleftbarBgImage_center", rs.getString("bottomleftbarBgImage_center"));
  		pageConfigkv.put("bottomleftbarBgImage_right", rs.getString("bottomleftbarBgImage_right"));
  
  	}
  	
  	return pageConfigkv;
  	
  }


  
  
  private String null2String(String s){
  	if(s==null){
  		return "";
  	}
  	return s;
  }
  
  //add by bpf on 2013-11-13
  private void sendRedirect(JspWriter out,HttpServletRequest request,HttpServletResponse response,String url){
  	//viewScope\u8868\u793a\u5f53\u524d\u67e5\u770b\u7684\u662f\u4ec0\u4e48\u6837\u7684\u6d41\u7a0b\uff0c\u5171\u6709\u56db\u79cd\u72b6\u6001\uff1a
  	//complete:\u5f52\u6863\u7684
  
  
  
  
  	//done:\u5df2\u529e
  	//mine:\u6211\u7684\u8bf7\u6c42
  	//doing:\u5f85\u529e
  	String viewScope=request.getParameter("viewScope");
  	String numberType=request.getParameter("numberType");
  	viewScope=null2String(viewScope);
  	numberType=null2String(numberType);
  	url+="&viewScope="+viewScope+"&numberType="+numberType;
  	
  	String reforward=request.getParameter("reforward");
  	
  	try{
  		if(request.getParameter("getCount")!=null && Boolean.valueOf(request.getParameter("getCount"))==true){
  			out.print(getCount(request,response));
  			request.getSession().setAttribute("SearchClause",request.getSession().getAttribute("orientSearchClause"));
  			request.getSession().removeAttribute("orientSearchClause");
  			return;
  		}
  		
  		if(Boolean.valueOf(reforward)==true){
  			request.getRequestDispatcher(url).forward(request, response);
  		}else{
  			Enumeration<String> e=request.getParameterNames();
  			while(e.hasMoreElements()){
  				String paramenterName=e.nextElement();
  				String value=request.getParameter(paramenterName);
  				url+="&"+paramenterName+"="+value;
  			}
  			
  			response.sendRedirect(url);
  		}
  	}catch(Exception e){
  		
  	}
  }
  


  
  	private String getLike(HttpServletRequest request,String parameter){
  		parameter=request.getParameter(parameter);
  		if(parameter==null){
  			parameter="'%'";
  		}else{
  			parameter="'%"+parameter+"%'";
  		}
  		return parameter;
  	}


  
  	private String getCount(HttpServletRequest request,HttpServletResponse response){
  		String flowTitle=getLike(request,"flowTitle");//\u6d41\u7a0b\u540d\u79f0
  		String workflowid = "";
  		String nodetype = "";
  		String fromdate = "";
  		String todate = "";
  		String creatertype = "";
  		String createrid = "";
  		String requestlevel = "";
  		String fromdate2 = "";
  		String todate2 = "";
  		String workcode = "";
  		String querys = Util.null2String(request.getParameter("query"));
  		String fromself = Util.null2String(request.getParameter("fromself"));
  		String fromselfSql = Util.null2String(request.getParameter("fromselfSql"));
  		String isfirst = Util.null2String(request.getParameter("isfirst"));
  		String docids = Util.null2String(request.getParameter("docids"));
  		String flag = Util.null2String(request.getParameter("flag"));
  		String branchid = "";
  		String cdepartmentid = "";
  		WorkflowComInfo WorkflowComInfo=null;
  		try{
  			WorkflowComInfo=new WorkflowComInfo();
  		}catch(Exception e){
  			
  		}
  		
  		RecordSet RecordSet=new RecordSet();
  		User user = HrmUserVarify.getUser (request , response) ;
  		int usertype = 0;
  		int date2during = Util.getIntValue(Util.null2String(request.getParameter("date2during")), 0);
  		try {
  			branchid = Util.null2String((String) request.getSession().getAttribute("branchid"));
  		} catch (Exception e) {
  			branchid = "";
  		}
  		BaseBean baseBean = new BaseBean();
  		SearchClause SearchClause=(SearchClause)request.getSession().getAttribute("SearchClause");
  		int isovertime = Util.getIntValue(request.getParameter("isovertime"), 0);
  		
  
  
  		workflowid = SearchClause.getWorkflowId();
  		nodetype = SearchClause.getNodeType();
  		fromdate = SearchClause.getFromDate();
  		todate = SearchClause.getToDate();
  		creatertype = SearchClause.getCreaterType();
  		createrid = SearchClause.getCreaterId();
  		requestlevel = SearchClause.getRequestLevel();
  		fromdate2 = SearchClause.getFromDate2();
  		todate2 = SearchClause.getToDate2();
  		cdepartmentid = SearchClause.getDepartmentid();
  		
  		String newsql = "";
  		if (!workflowid.equals("") && !workflowid.equals("0"))
  			newsql += " and t1.workflowid in(" + workflowid + ")";
  		if (date2during > 0 && date2during < 37)
  			newsql += WorkflowComInfo.getDateDuringSql(date2during);
  		if (fromself.equals("1")) {
  
  			if (!nodetype.equals(""))
  				newsql += " and t1.currentnodetype='" + nodetype + "'";
  
  			if (!fromdate.equals(""))
  				newsql += " and t1.createdate>='" + fromdate + "'";
  
  			if (!todate.equals(""))
  				newsql += " and t1.createdate<='" + todate + "'";
  
  			if (!fromdate2.equals(""))
  				newsql += " and t2.receivedate>='" + fromdate2 + "'";
  
  			if (!todate2.equals(""))
  				newsql += " and t2.receivedate<='" + todate2 + "'";
  
  			if (!workcode.equals(""))
  				newsql += " and t1.creatertype= '0' and t1.creater in(select id from hrmresource where workcode like '%" + workcode + "%')";
  
  			if (!createrid.equals("")) {
  				newsql += " and t1.creater='" + createrid + "'";
  				newsql += " and t1.creatertype= '" + creatertype + "' ";
  			}
  			if (!cdepartmentid.equals("")) {
  				String tempWhere = "";
  				ArrayList tempArr = Util.TokenizerString(cdepartmentid, ",");
  				for (int i = 0; i < tempArr.size(); i++) {
  					String tempcdepartmentid = (String) tempArr.get(i);
  					if (tempWhere.equals(""))
  						tempWhere += "departmentid=" + tempcdepartmentid;
  					else
  						tempWhere += " or departmentid=" + tempcdepartmentid;
  				}
  				if (!tempWhere.equals(""))
  					newsql += " and exists(select 1 from hrmresource where t1.creater=id and t1.creatertype='0' and (" + tempWhere + "))";
  			}
  
  			if (!requestlevel.equals("")) {
  				newsql += " and t1.requestlevel=" + requestlevel;
  			}
  
  			if (!querys.equals("1")) {
  				if (!fromselfSql.equals(""))
  					newsql += " and " + fromselfSql;
  			} else {
  				if (fromself.equals("1"))
  					newsql += " and  islasttimes=1 ";
  			}
  
  		}
  		String resourceid = Util.null2String(request.getParameter("resourceid"));
  		String CurrentUser = "".equals(resourceid) ? Util.null2String((String) request.getSession().getAttribute("RequestViewResource")) : resourceid;
  		String userID = String.valueOf(user.getUID());
  		int userid=user.getUID();
  		String belongtoshow = "";				
  								RecordSet.executeSql("select * from HrmUserSetting where resourceId = "+userID);
  								if(RecordSet.next()){
  									belongtoshow = RecordSet.getString("belongtoshow");
  								}
  		String userIDAll = String.valueOf(user.getUID());
  		
  String Belongtoids =user.getBelongtoids();
  int Belongtoid=0;
  String[] arr2 = null;
  ArrayList<String> userlist = new ArrayList();
  userlist.add(userid + "");
  if(!"".equals(Belongtoids)){
  userIDAll = userID+","+Belongtoids;
  arr2 = Belongtoids.split(",");
  for(int i=0;i<arr2.length;i++){
  Belongtoid = Util.getIntValue(arr2[i]);
  userlist.add(Belongtoid + "");
  }
  }
  		String logintype = "" + user.getLogintype();
  		if (logintype.equals("2"))
  			usertype = 1;
  		if (CurrentUser.equals("")) {
  			CurrentUser = "" + user.getUID();
  		}
  		boolean superior = false; //\u662f\u5426\u4e3a\u88ab\u67e5\u770b\u8005\u4e0a\u7ea7\u6216\u8005\u672c\u8eab
  
  
  
  
  		if (userID.equals(CurrentUser)) {
  			superior = true;
  		} else {
  			RecordSet.executeSql("SELECT * FROM HrmResource WHERE ID = " + CurrentUser + " AND managerStr LIKE '%," + userID + ",%'");
  
  			if (RecordSet.next()) {
  				superior = true;
  			}
  		}
  
  		String sqlwhere = "";
  		if("1".equals(belongtoshow)){
  		if (isovertime == 1) {
  			sqlwhere = "where t1.requestname like "+flowTitle+" and  (t1.deleted <> 1 or t1.deleted is null or t1.deleted='') and t1.requestid = t2.requestid and t2.id in (Select max(z1.id) from workflow_currentoperator z1 where exists(select 1 from SysPoppupRemindInfonew z2 where  z1.requestid=z2.requestid and z2.type=10 and z2.userid in ("
  					+ userIDAll
  					+ ") and z2.usertype='"
  					+ (Util.getIntValue(logintype, 1) - 1)
  					+ "' and exists (select 1 from workflow_currentoperator z3 where z2.requestid=z3.requestid and ((z3.isremark='0' and (z3.isprocessed='2' or z3.isprocessed='3' or z3.isprocessed is null))  or z3.isremark='5') and z3.islasttimes=1)) group by z1.requestid)";
  		} else {
  			if (superior && !flag.equals(""))
  				CurrentUser = userID;
  			sqlwhere = "where  t1.requestname like "+flowTitle+" and   (t1.deleted <> 1 or t1.deleted is null or t1.deleted='') and t1.requestid = t2.requestid and t2.userid in (" + userIDAll + ") and t2.usertype=" + usertype;
  			if (!Util.null2String(SearchClause.getWhereClause()).equals("")) {
  				sqlwhere += " and " + SearchClause.getWhereClause();
  				//out.print("sql***********"+SearchClause.getWhereClause());
  			}
  		}
  
  		if (RecordSet.getDBType().equals("oracle")) {
  			sqlwhere += " and (nvl(t1.currentstatus,-1) = -1 or (nvl(t1.currentstatus,-1)=0 and t1.creater in (" + userIDAll + "))) ";
  		} else {
  			sqlwhere += " and (isnull(t1.currentstatus,-1) = -1 or (isnull(t1.currentstatus,-1)=0 and t1.creater (" + userIDAll + "))) ";
  		}
  		}else{
  			if (isovertime == 1) {
  			sqlwhere = "where t1.requestname like "+flowTitle+" and  (t1.deleted <> 1 or t1.deleted is null or t1.deleted='') and t1.requestid = t2.requestid and t2.id in (Select max(z1.id) from workflow_currentoperator z1 where exists(select 1 from SysPoppupRemindInfonew z2 where  z1.requestid=z2.requestid and z2.type=10 and z2.userid in ("
  					+ user.getUID()
  					+ ") and z2.usertype='"
  					+ (Util.getIntValue(logintype, 1) - 1)
  					+ "' and exists (select 1 from workflow_currentoperator z3 where z2.requestid=z3.requestid and ((z3.isremark='0' and (z3.isprocessed='2' or z3.isprocessed='3' or z3.isprocessed is null))  or z3.isremark='5') and z3.islasttimes=1)) group by z1.requestid)";
  		} else {
  			if (superior && !flag.equals(""))
  				CurrentUser = userID;
  			sqlwhere = "where  t1.requestname like "+flowTitle+" and   (t1.deleted <> 1 or t1.deleted is null or t1.deleted='') and t1.requestid = t2.requestid and t2.userid = " + CurrentUser + " and t2.usertype=" + usertype;
  			if (!Util.null2String(SearchClause.getWhereClause()).equals("")) {
  				sqlwhere += " and " + SearchClause.getWhereClause();
  				//out.print("sql***********"+SearchClause.getWhereClause());
  			}
  		}
  
  		if (RecordSet.getDBType().equals("oracle")) {
  			sqlwhere += " and (nvl(t1.currentstatus,-1) = -1 or (nvl(t1.currentstatus,-1)=0 and t1.creater=" + user.getUID() + ")) ";
  		} else {
  			sqlwhere += " and (isnull(t1.currentstatus,-1) = -1 or (isnull(t1.currentstatus,-1)=0 and t1.creater=" + user.getUID() + ")) ";
  		}
  		}
  		String orderby = "";
  		sqlwhere += " " + newsql;
  		orderby = SearchClause.getOrderClause();
  		if (orderby.equals("")) {
  			orderby = "t2.receivedate ,t2.receivetime";
  		}
  		String strworkflowid = "";
  		int startIndex = 0;
  
  		String fromhp = Util.null2String(request.getParameter("fromhp"));
  		if (fromhp.equals("1")) {
  			String eid = Util.null2String(request.getParameter("eid"));
  			String tabid = Util.null2String(request.getParameter("tabid"));
  			RecordSet.execute("select count(content) as count from workflowcentersettingdetail where  type = 'flowid' and eid=" + eid + "and tabId = '" + tabid + "'");
  			if (RecordSet.next()) {
  				if (RecordSet.getInt("count") > 0) {
  					strworkflowid = " in (select content from workflowcentersettingdetail where  type = 'flowid' and eid=" + eid + "and tabId = '" + tabid + "' )";
  				}
  			}
  		} else {
  
  			if (!Util.null2String(SearchClause.getWhereClause()).equals("")) {
  				String tempstr = SearchClause.getWhereClause();
  				if (tempstr.indexOf("t1.workflowid") != -1) {
  					startIndex = tempstr.indexOf("t1.workflowid") + 13;//added by xwj for td2045 on 2005-05-26
  					if (tempstr.indexOf("and") != -1) {
  						if (tempstr.indexOf("(t1.deleted=0") != -1) {
  							int startIndex1 = tempstr.indexOf("and");
  							int startIndex2 = tempstr.indexOf("and", startIndex1 + 1);
  							strworkflowid = tempstr.substring(startIndex, startIndex2);
  						} else {
  							strworkflowid = tempstr.substring(startIndex, tempstr.indexOf("and"));
  						}
  						if (strworkflowid.indexOf("(") != -1 && strworkflowid.indexOf(")") == -1)
  							strworkflowid += ")";
  					} else
  						strworkflowid = tempstr.substring(startIndex, tempstr.indexOf(")") + 1);
  					if (strworkflowid.indexOf("(") != -1 && strworkflowid.indexOf(")") == -1)
  						strworkflowid += ")";
  				}
  			} else {
  				if (!workflowid.equals(""))
  					strworkflowid = " in (" + workflowid + ")";
  			}
  		}
  			
  		String tableString = "";
  	
  		String backfields = " t1.requestid, t1.createdate, t1.createtime,t1.creater, t1.creatertype, t1.workflowid, t1.requestname, t1.status,t1.requestlevel,t1.currentnodeid,t2.viewtype,t2.receivedate,t2.receivetime,t2.isremark,t2.nodeid,t2.agentorbyagentid,t2.agenttype,t2.isprocessed ";
  		String fromSql = " from workflow_requestbase t1,workflow_currentoperator t2 ";//xxxxx
  		String sqlWhere = sqlwhere;
  		if (sqlWhere.indexOf("in (select id from workflow_base where isvalid=") < 0) {
  			sqlWhere += " and t1.workflowid in (select id from workflow_base where (isvalid='1' or isvalid='3') )";
  		}
  		String para2 = "column:requestid+column:workflowid+column:viewtype+" + isovertime + "+" + user.getLanguage() + "+column:nodeid+column:isremark+" + userID
  				+ "+column:agentorbyagentid+column:agenttype+column:isprocessed";
  		if (!docids.equals("")) {
  			fromSql = fromSql + ",workflow_form t4 ";
  			sqlWhere = sqlWhere + " and t1.requestid=t4.requestid ";
  		}
  	
  		if (!superior) {
  if("1".equals(belongtoshow)){
  			sqlWhere += " AND EXISTS (SELECT 1 FROM workFlow_CurrentOperator workFlowCurrentOperator WHERE t2.workflowid = workFlowCurrentOperator.workflowid AND t2.requestid = workFlowCurrentOperator.requestid AND workFlowCurrentOperator.userid in ("
  					+ userIDAll + ") and workFlowCurrentOperator.usertype = " + usertype + ") ";
  }else{
  			sqlWhere += " AND EXISTS (SELECT 1 FROM workFlow_CurrentOperator workFlowCurrentOperator WHERE t2.workflowid = workFlowCurrentOperator.workflowid AND t2.requestid = workFlowCurrentOperator.requestid AND workFlowCurrentOperator.userid in ("
  					+ userID + ") and workFlowCurrentOperator.usertype = " + usertype + ") ";
  }
  		}
  	
  		if (!branchid.equals("")) {
  			sqlWhere += " AND t1.creater in (select id from hrmresource where subcompanyid1=" + branchid + ")  ";
  		}
  		
  		//add by bpf on 2013-11-14
  		String countSql="select count(1) as wfCount "+fromSql+sqlWhere;
  		try{
  			response.getWriter().print(countSql);
  			response.getWriter().print("                     ");
  		}catch(Exception e){
  			
  		}
  		
  		RecordSet.executeSql(countSql);
  		String wfCount="0";
  	       while(RecordSet.next()){
  	       	wfCount=RecordSet.getString("wfCount");
  	       }
  	       return wfCount;
  	       
  }
  		
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      
	try{
		response.setBufferSize(1*1024*1024);
	}catch(Exception e){}

      out.write(_jsp_string1, 0, _jsp_string1.length);
      
// \u589e\u52a0\u53c2\u6570\u5224\u65ad\u7f13\u5b58
int isIncludeToptitle = 0;
response.setHeader("cache-control", "no-cache");
response.setHeader("pragma", "no-cache");
response.setHeader("expires", "Mon 1 Jan 1990 00:00:00 GMT");

      out.write(_jsp_string2, 0, _jsp_string2.length);
      
//
User user = HrmUserVarify.getUser (request , response) ;
LicenseCheckLogin licenseCheckLogin = new LicenseCheckLogin();
licenseCheckLogin.setOutLineDate(user.getUID(),IPUtil.getIp(request));

//\u95ee\u98981
TestWorkflowCheck twc=new TestWorkflowCheck();
if(twc.checkURI(session,request.getRequestURI(),request.getQueryString())){
    /*
    response.sendRedirect("/login/Logout.jsp");
    */
    String forwardurl = twc.reLoginMrg(request, response, request.getRequestURI());
    if (!"".equals(forwardurl)) { 
        response.sendRedirect(forwardurl);
        return;
    }
}
String userOffline = Util.null2String((String)session.getAttribute("userOffline"));	
if(userOffline.equals("1")){
	//\u5f3a\u5236\u4e0b\u7ebf
	String loginfile = Util.getCookie(request , "loginfileweaver") ;
	Map userSessions = (Map) application.getAttribute("userSessions");
	if (userSessions != null) {
		Map logmessages = (Map) application.getAttribute("logmessages");
		if (logmessages != null)logmessages.remove("" + user.getUID());
		session.removeValue("moniter");
		session.removeValue("WeaverMailSet");
		userSessions.remove(user.getUID());
		//session.invalidate();
	}
      out.write(_jsp_string3, 0, _jsp_string3.length);
      out.print((SystemEnv.getErrorMsgName(175,user.getLanguage())));
      out.write(_jsp_string4, 0, _jsp_string4.length);
      out.print(("/Refresh.jsp?loginfile="+loginfile+"&message=175"));
      out.write(_jsp_string5, 0, _jsp_string5.length);
      
  return;
}
if(user == null)  return ;
String isIE = (String)session.getAttribute("browser_isie");
if (isIE == null || "".equals(isIE)) {
	isIE = "true";
	session.setAttribute("browser_isie", "true");
}
String agentT = request.getHeader("user-agent");
//if(!"true".equals(isIE)){
//if((agentT.contains("Firefox")||agentT.contains(" Chrome")||agentT.contains("Safari") )&& !agentT.contains("Edge")){
if(agentT.contains("Firefox")||agentT.contains(" Chrome")||agentT.contains("Safari") || agentT.contains("Edge")){	
    isIE = "false";	
}
else{
    isIE = "true";	
}
//}

Log logger= LogFactory.getLog(this.getClass());



//************************************************
//\u8d85\u65f6\u6216\u8005\u91cd\u542fresin\u670d\u52a1\u65f6\uff0c\u5f39\u51fa\u767b\u9646\u5c0f\u7a97\u53e3(TD 2227)
//hubo,050707

//************************************************

String pagepath = request.getServletPath();
if(pagepath.indexOf("HrmResourceOperation.jsp")<0&&pagepath.indexOf("RemindLogin.jsp")<0&&pagepath.indexOf("HrmResourcePassword.jsp")<0){
	String changepwd = (String)request.getSession().getAttribute("changepwd");
	if("n".equals(changepwd)){
		request.getSession().removeAttribute("changepwd");
		response.sendRedirect("/login/Login.jsp");
		return;
	}else if("y".equals(changepwd)){
		request.getSession().removeAttribute("changepwd");
	}
}



//licence\u4fe1\u606f
String companyNametools="";
LN Licenseinit_1 = new LN();
try{
	Licenseinit_1.CkHrmnum();
}catch(Exception e){
	e.printStackTrace();
	out.println("<script type='text/javascript'> top.location.href='/system/InLicense.jsp?message=6&code=';</script>");
	return;
}
companyNametools = Licenseinit_1.getCompanyname();

//\u7248\u672c\u4fe1\u606f
StaticObj staticobj = null;
staticobj = StaticObj.getInstance();
String software = (String)staticobj.getObject("software") ;
if(software == null) software="ALL";
String portal = (String)staticobj.getObject("portal") ;
if(portal == null) portal="n";
boolean isPortalOK = false;
if(portal.equals("y")) isPortalOK = true;
String multilanguage = (String)staticobj.getObject("multilanguage") ;
if(multilanguage == null) multilanguage="n";
boolean isMultilanguageOK = false;
if(multilanguage.equals("y")) isMultilanguageOK = true;


      out.write(_jsp_string2, 0, _jsp_string2.length);
      
  String fromlogin=(String)session.getAttribute("fromlogin");
  session.removeAttribute("fromlogin");
  if(fromlogin==null) fromlogin="no";

  ChgPasswdReminder reminder0 = new ChgPasswdReminder();
  RemindSettings settings0=reminder0.getRemindSettings();
  String firmcode0=settings0.getFirmcode();
  String usercode0=settings0.getUsercode();

  int needusb0=user.getNeedusb();
  String usbtype0 = settings0.getUsbType();
  String serial0=user.getSerial();

//\u9650\u5236\u6bcf\u4e2a\u7528\u6237\u53ea\u80fd\u6709\u4e00\u4e2a\u767b\u5165\u7684\u7a97\u53e3
String frommain = Util.null2String(request.getParameter("frommain")) ;

Map logmessages=(Map)application.getAttribute("logmessages");
String a_logmessage="";
if(logmessages!=null)
	a_logmessage=Util.null2String((String)logmessages.get(""+user.getUID()));

String s_logmessage=Util.null2String((String)session.getAttribute("logmessage"));


//TD2125 by mackjoe \u89e3\u51b3\u6570\u636e\u4e2d\u5fc3\u767b\u9646\u4e0d\u4e86\u95ee\u9898
if(s_logmessage==null)  s_logmessage="";

String relogin0=Util.null2String(settings0.getRelogin());

String changepwd = (String)session.getAttribute("changepwd");

if(!relogin0.equals("1")&&"yes".equals(changepwd)){
logmessages=(Map)application.getAttribute("logmessages");
logmessages.put(""+user.getUID(),s_logmessage);
if(logmessages!=null)
	a_logmessage=Util.null2String((String)logmessages.get(""+user.getUID()));
}

String layoutStyle = (String)request.getSession(true).getAttribute("layoutStyle");
if(layoutStyle==null) layoutStyle ="";

String rtxFromLogintmp = (String)session.getAttribute("RtxFromLogin");


if("1".equals(user.getLogintype())&&!relogin0.equals("1")&&!fromlogin.equals("yes")&&!frommain.equals("yes")&&!s_logmessage.equals(a_logmessage) && !"true".equals(rtxFromLogintmp)){
	if(layoutStyle.equals("") || !layoutStyle.equals("1")){	//\u5982\u679c\u662f\u5c0f\u7a97\u53e3\u767b\u5f55\uff0c\u5219\u4e0d\u5224\u65ad\u662f\u5426\u4e3a\u5f53\u524d\u5de5\u4f5c\u7a97\u53e3


      out.write(_jsp_string6, 0, _jsp_string6.length);
      out.print((SystemEnv.getHtmlLabelName(23274,user.getLanguage())));
      out.write(_jsp_string7, 0, _jsp_string7.length);
      return;}}
      out.write(_jsp_string2, 0, _jsp_string2.length);
      
//\u6d41\u7a0b\u7684\u4e09\u4e2a\u9875\u9762\u9700\u8981\u4f7f\u7528\u9ad8\u7248\u672c\u7684jQuery
if (request.getRequestURI().indexOf("/workflow/request/") != -1 &&
        (request.getRequestURI().indexOf("/workflow/request/ManageRequestNoForm") != -1 
                || request.getRequestURI().indexOf("/workflow/request/ViewRequestIframe.jsp") != -1
                || request.getRequestURI().indexOf("/workflow/request/RemarkFrame.jsp") != -1)) {

      out.write(_jsp_string8, 0, _jsp_string8.length);
      
} else {

      out.write(_jsp_string9, 0, _jsp_string9.length);
      
}

      out.write(_jsp_string10, 0, _jsp_string10.length);
      
//\u6a21\u677f\u6a21\u5f0f\u5bfc\u5165
if ((request.getRequestURI().indexOf("/workflow/") != -1 && request.getRequestURI().indexOf("mode") != -1)
        || request.getRequestURI().indexOf("/workflow/request/AddRequest") != -1) {
        
      out.write(_jsp_string11, 0, _jsp_string11.length);
      
}

      out.write(_jsp_string12, 0, _jsp_string12.length);
      out.print((user.getLanguage()));
      out.write(_jsp_string13, 0, _jsp_string13.length);
      out.print((request.getSession().getId()));
      out.write(_jsp_string14, 0, _jsp_string14.length);
      out.print((SystemEnv.getHtmlLabelName(21403,user.getLanguage())));
      out.write(_jsp_string15, 0, _jsp_string15.length);
      out.print((SystemEnv.getHtmlLabelName(21791,user.getLanguage())));
      out.write(_jsp_string16, 0, _jsp_string16.length);
      out.print((SystemEnv.getHtmlLabelNames("17480",user.getLanguage())));
      out.write(_jsp_string17, 0, _jsp_string17.length);
      out.print((SystemEnv.getHtmlLabelNames("25484,83",user.getLanguage())));
      out.write(_jsp_string18, 0, _jsp_string18.length);
      out.print((user.getUID()));
      out.write(_jsp_string19, 0, _jsp_string19.length);
      out.print((user.getUID()));
      out.write(_jsp_string20, 0, _jsp_string20.length);
      out.print((user.getType()));
      out.write(_jsp_string21, 0, _jsp_string21.length);
      out.print((SystemEnv.getHtmlLabelName(26263,user.getLanguage())));
      out.write(_jsp_string22, 0, _jsp_string22.length);
      out.print((URLEncoder.encode(user.getLoginid())));
      out.write(_jsp_string23, 0, _jsp_string23.length);
      out.print((SystemEnv.getHtmlLabelName(21403,user.getLanguage())));
      out.write(_jsp_string24, 0, _jsp_string24.length);
      out.print((SystemEnv.getHtmlLabelName(23670,user.getLanguage())));
      out.write(_jsp_string25, 0, _jsp_string25.length);
      out.print((SystemEnv.getHtmlLabelName(21791,user.getLanguage())));
      out.write(_jsp_string26, 0, _jsp_string26.length);
      if(new weaver.conn.RecordSet().getDBType().equals("oracle")){
      out.write(_jsp_string27, 0, _jsp_string27.length);
      out.print((SystemEnv.getHtmlLabelName(524,user.getLanguage())));
      out.print((SystemEnv.getHtmlLabelName(698,user.getLanguage())));
      out.write(_jsp_string28, 0, _jsp_string28.length);
      out.print((SystemEnv.getHtmlLabelName(20246,user.getLanguage())));
      out.write(_jsp_string28, 0, _jsp_string28.length);
      out.print((SystemEnv.getHtmlLabelName(124962,user.getLanguage())));
      out.write(_jsp_string29, 0, _jsp_string29.length);
      }
      out.write(_jsp_string30, 0, _jsp_string30.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string31, 0, _jsp_string31.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string32, 0, _jsp_string32.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string33, 0, _jsp_string33.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string34, 0, _jsp_string34.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string33, 0, _jsp_string33.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string35, 0, _jsp_string35.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string36, 0, _jsp_string36.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string37, 0, _jsp_string37.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string38, 0, _jsp_string38.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string39, 0, _jsp_string39.length);
      out.print((SystemEnv.getHtmlLabelName(15097,user.getLanguage())));
      out.write(_jsp_string40, 0, _jsp_string40.length);
      out.print((SystemEnv.getHtmlLabelName(22161,user.getLanguage())));
      out.write(_jsp_string41, 0, _jsp_string41.length);
      out.print((companyNametools));
      out.write(_jsp_string42, 0, _jsp_string42.length);
      out.print((SystemEnv.getHtmlLabelName(23714,user.getLanguage())));
      out.write(_jsp_string43, 0, _jsp_string43.length);
      
  if(!fromlogin.equals("yes")&&needusb0==1&&"1".equals(usbtype0)){

      out.write(_jsp_string44, 0, _jsp_string44.length);
      out.print((firmcode0));
      out.write(_jsp_string45, 0, _jsp_string45.length);
      out.print((usercode0));
      out.write(_jsp_string46, 0, _jsp_string46.length);
      out.print((serial0));
      out.write(_jsp_string47, 0, _jsp_string47.length);
      out.print((user.getLanguage()));
      out.write(_jsp_string48, 0, _jsp_string48.length);
      }
      out.write(_jsp_string49, 0, _jsp_string49.length);
      weaver.workflow.workflow.TestWorkflowCheck TestWorkflowCheckInitWui;
      TestWorkflowCheckInitWui = (weaver.workflow.workflow.TestWorkflowCheck) pageContext.getAttribute("TestWorkflowCheckInitWui");
      if (TestWorkflowCheckInitWui == null) {
        TestWorkflowCheckInitWui = new weaver.workflow.workflow.TestWorkflowCheck();
        pageContext.setAttribute("TestWorkflowCheckInitWui", TestWorkflowCheckInitWui);
      }
      out.write(_jsp_string50, 0, _jsp_string50.length);
      out.println(TestWorkflowCheckInitWui.ReloadByDialogClose(request));
      out.write(_jsp_string51, 0, _jsp_string51.length);
      
    if(TestWorkflowCheckInitWui.checkURI(session,request.getRequestURI(),request.getQueryString())){
        response.sendRedirect("/login/Login.jsp");
        return;
    }

      out.write(_jsp_string52, 0, _jsp_string52.length);
      

String curTheme = "ecology7";
//\u5f53\u524d\u76ae\u80a4
String curskin = "";
String cutoverWay = "";
String transitionTime = "";
String transitionWay = "";

HrmUserSettingComInfo instance = new HrmUserSettingComInfo();

String huscifId = String.valueOf(instance.getId(String.valueOf(user.getUID())));

curTheme = getCurrWuiConfig(session, user, "theme");
curskin = getCurrWuiConfig(session, user, "skin");

cutoverWay = instance.getCutoverWay(huscifId);
transitionTime = instance.getTransitionTime(huscifId);
transitionWay = instance.getTransitionWays(huscifId);

      out.write(_jsp_string53, 0, _jsp_string53.length);
      
String ely6flg = "";
if ("ecology6".equals(curTheme.toLowerCase())) {
	curTheme = "ecology7";
	ely6flg = "ecology6";
}

      out.write(_jsp_string54, 0, _jsp_string54.length);
      out.print((curTheme ));
      out.write(_jsp_string55, 0, _jsp_string55.length);
      out.print((curskin ));
      out.write(_jsp_string56, 0, _jsp_string56.length);
      
curTheme = "ecology8";//\u540e\u53f0\u914d\u7f6e\u9875\u9762\u5747\u4e3aE8\u4e3b\u9898\uff0c\u5982\u4f7f\u7528\u5176\u4ed6\u4e3b\u9898\u65f6\uff0c\u4f1a\u5bfc\u81f4\u6837\u5f0f\u6df7\u4e71\u3002\u6240\u4ee5\u6b64\u5904\u4e3b\u9898\u5f3a\u5236\u8d4b\u503cecology8
if("ecology8".equals(curTheme)) curskin="default";
session.setAttribute("SESSION_TEMP_CURRENT_THEME", curTheme);
session.setAttribute("SESSION_TEMP_CURRENT_SKIN", curskin);

      out.write(_jsp_string57, 0, _jsp_string57.length);
      
    if (transitionTime != null && !transitionTime.equals("") && !transitionTime.equals("0")) {

      out.write(_jsp_string58, 0, _jsp_string58.length);
      out.print((cutoverWay ));
      out.write(_jsp_string59, 0, _jsp_string59.length);
      out.print((transitionTime ));
      out.write(_jsp_string60, 0, _jsp_string60.length);
      out.print((transitionWay ));
      out.write(_jsp_string61, 0, _jsp_string61.length);
      
    }

      out.write(_jsp_string62, 0, _jsp_string62.length);
      out.print((curTheme ));
      out.write(_jsp_string63, 0, _jsp_string63.length);
      out.print((curskin ));
      out.write(_jsp_string64, 0, _jsp_string64.length);
      if(!"1".equals(session.getAttribute("istest"))){//\u6d41\u7a0b\u6d4b\u8bd5
      out.write(_jsp_string53, 0, _jsp_string53.length);
      pageContext.include("/synergy/showSynergy.jsp", "requestid=" + com.caucho.el.Expr.toString(Util.getIntValue(request.getParameter("requestid"),-1), null), false);
      out.write(_jsp_string53, 0, _jsp_string53.length);
      }
      out.write(_jsp_string2, 0, _jsp_string2.length);
      weaver.search.SearchClause SearchClause;
      synchronized (pageContext.getSession()) {
        SearchClause = (weaver.search.SearchClause) pageContext.getSession().getAttribute("SearchClause");
        if (SearchClause == null) {
          SearchClause = new weaver.search.SearchClause();
          pageContext.getSession().setAttribute("SearchClause", SearchClause);
        }
      }
      out.write(_jsp_string53, 0, _jsp_string53.length);
      weaver.conn.RecordSet RecordSet;
      RecordSet = (weaver.conn.RecordSet) pageContext.getAttribute("RecordSet");
      if (RecordSet == null) {
        RecordSet = new weaver.conn.RecordSet();
        pageContext.setAttribute("RecordSet", RecordSet);
      }
      out.write(_jsp_string53, 0, _jsp_string53.length);
      weaver.workflow.workflow.WorkflowComInfo WorkflowComInfo;
      WorkflowComInfo = (weaver.workflow.workflow.WorkflowComInfo) pageContext.getAttribute("WorkflowComInfo");
      if (WorkflowComInfo == null) {
        WorkflowComInfo = new weaver.workflow.workflow.WorkflowComInfo();
        pageContext.setAttribute("WorkflowComInfo", WorkflowComInfo);
      }
      out.write(_jsp_string53, 0, _jsp_string53.length);
      weaver.workflow.request.todo.RequestUtil requestutil;
      requestutil = (weaver.workflow.request.todo.RequestUtil) pageContext.getAttribute("requestutil");
      if (requestutil == null) {
        requestutil = new weaver.workflow.request.todo.RequestUtil();
        pageContext.setAttribute("requestutil", requestutil);
      }
      out.write(_jsp_string65, 0, _jsp_string65.length);
      
session.removeAttribute("branchid");
session.setAttribute("orientSearchClause",SearchClause);
String whereclause="";
String whereclause2 = "";
String orderclause="";
String orderclause2="";

String resourceid = Util.null2String(request.getParameter("resourceid"));
String userid = "".equals(resourceid) ? Util.null2String((String)session.getAttribute("RequestViewResource")) : resourceid ;
resourceid = userid;
boolean isoracle = (RecordSet.getDBType()).equals("oracle") ;
boolean isdb2 = (RecordSet.getDBType()).equals("db2") ;
String logintype = ""+user.getLogintype();
String offical = Util.null2String(request.getParameter("offical"));
int officalType = Util.getIntValue(request.getParameter("officalType"),-1);
int usertype = 0;

if(userid.equals("")) {
	userid = ""+user.getUID();
	if(logintype.equals("2")) usertype= 1;
}

String belongtoshow = "";				
		RecordSet.executeSql("select * from HrmUserSetting where resourceId = "+userid);
		if(RecordSet.next()){
			belongtoshow = RecordSet.getString("belongtoshow");
		}
		//QC235172,\u5982\u679c\u4e0d\u662f\u67e5\u770b\u81ea\u5df1\u7684\u4ee3\u529e\uff0c\u4e3b\u4ece\u8d26\u53f7\u7edf\u4e00\u663e\u793a\u4e0d\u9700\u8981\u5224\u65ad

		if(!"".equals(resourceid) && !userid.equals(resourceid)) belongtoshow = "";
		
		String userIDAll = String.valueOf(userid);	
String Belongtoids =user.getBelongtoids();
int Belongtoid=0;
String[] arr2 = null;
ArrayList<String> userlist = new ArrayList();
userlist.add(userid + "");
if(!"".equals(Belongtoids)){
userIDAll = userid+","+Belongtoids;
arr2 = Belongtoids.split(",");
for(int i=0;i<arr2.length;i++){
Belongtoid = Util.getIntValue(arr2[i]);
userlist.add(Belongtoid + "");
}
}

SearchClause.resetClause();
String method=Util.null2String(request.getParameter("method"));
String overtime=Util.null2String(request.getParameter("overtime"));
String fromPDA = Util.null2String((String)session.getAttribute("loginPAD"));   //\u4ecePDA\u767b\u5f55
String complete1=Util.null2String(request.getParameter("complete"));
String workflowidtemp=Util.null2String(request.getParameter("workflowid"));
String wftypetemp=Util.null2String(request.getParameter("wftype"));
String cdepartmentid=Util.null2String(request.getParameter("cdepartmentid"));
int date2during=Util.getIntValue(Util.null2String(request.getParameter("date2during")),0);
int viewType=Util.getIntValue(Util.null2String(request.getParameter("viewType")),0);
int isajaxfresh = Util.getIntValue(Util.null2String(request.getParameter("isajaxfresh")),-1);
int viewcondition = Util.getIntValue(request.getParameter("viewcondition"),0);
//\u8df3\u8f6c\u5230wfserachResult\u540e\u662f\u5426\u9700\u8981\u5934
boolean needHeader = "true".equals(Util.null2String(request.getParameter("needHeader")));
boolean isopenofs = requestutil.getOfsSetting().getIsuse()==1;
boolean showdone = requestutil.getOfsSetting().getShowdone().equals("1");
if (fromPDA.equals("1"))
{
	sendRedirect(out,request,response,"WFSearchResultPDA.jsp?offical="+offical+"&officalType="+officalType+"&workflowid="+workflowidtemp+"&wftype="+wftypetemp+"&complete="+complete1+"&viewType="+viewType);
	return;}

if(overtime.equals("1")){
	sendRedirect(out,request,response,"WFTabForOverTime.jsp?isovertime=1"+"&viewType="+viewType+"&isFromMessage=1");
	return;
}
whereclause = " (t1.deleted=0 or t1.deleted is null)  ";
if(method.equals("viewhrm")){
	//String resourceid=Util.null2String(request.getParameter("resourceid"));
	
    if( isoracle ) {
	    whereclause+=" and (',' + TO_CHAR(t1.hrmids) + ',' LIKE '%,"+resourceid+",%') ";
    }else  if( isdb2 ) {
	    whereclause+=" and (',' + VARCHAR(t1.hrmids) + ',' LIKE '%,"+resourceid+",%') ";
	}
    else {
        whereclause+=" and (',' + CONVERT(varchar,t1.hrmids) + ',' LIKE '%,"+resourceid+",%') ";
    }

	SearchClause.setWhereClause(whereclause);
	sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&offical="+offical+"&officalType="+officalType+"&start=1"+"&viewType="+viewType);
	return;
}
String processing = "";
if(method.equals("all")){
	String complete=Util.null2String(request.getParameter("complete"));
	if(complete.equals("0")){
	    
		if(viewcondition == 3){
	    	whereclause += " and (t2.isremark = '5' or (t2.isremark = '0' and isprocessed is not null ))  and (t1.currentnodetype <> '3' or  (t2.isremark in ('1', '8', '9') and t1.currentnodetype = '3'))  and (t1.deleted=0 or t1.deleted is null) and t2.islasttimes=1" ;
		}else if(viewcondition == 1 || viewcondition == 2 || viewcondition == 4){
		    whereclause += " and (((t2.isremark='0' and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7'))  or (t2.isremark = '0' and t2.isprocessed is null)) and (t1.deleted=0 or t1.deleted is null) and t2.islasttimes=1" ;
		}else{
		    whereclause += " and ((t2.isremark='0' and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7'))  and (t1.deleted=0 or t1.deleted is null) and t2.islasttimes=1" ;
		}
		//whereclause += " and (t2.isremark in('1','5','8','9','7') or (t2.isremark = '0' and (t2.isprocessed is null or (t2.isprocessed <> '2' and t2.isprocessed <> '3')))) and (t1.deleted=0 or t1.deleted is null) and t2.islasttimes=1" ;
	    
	    // \u5206\u9875\u63a7\u4ef6\u4e0a\u65b9\u7684\u63a7\u4ef6  1:\u672a\u8bfb\uff1b2\uff1a\u53cd\u9988\uff1b3\uff1a\u8d85\u65f6\uff1b  	add by Dracula @2014-1-10
	    if(viewcondition == 1)
	    	whereclause += " and t2.viewtype = '0' and t2.isremark != '5' and (t1.currentnodetype <> '3' or  (t2.isremark in ('1', '8', '9') and t1.currentnodetype = '3'))  and t2.isprocessed is null ";
	    else if(viewcondition == 2)
	    	whereclause += " and t2.viewtype = '-1'";
	    //else if(viewcondition == 3)
	    //	whereclause += " and t2.isremark = '5'";
	    else if(viewcondition == 4)
	    	whereclause += " and t2.requestid in (select requestid from workflow_requestlog where logtype='s')";
	    processing = "0";	//\u5f85\u529e

        if(isopenofs){
            if(viewcondition==0){//\u5168\u90e8
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark='0' ";
            }else if(viewcondition==1){//\u672a\u8bfb
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark='0' and viewtype=0 ";
            }else{
                whereclause2 += " and 1=2 ";
            }
        }
	}else if(complete.equals("1")){
    //modify by xhheng @20030525 for TD1725
		whereclause += " and (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and(t1.deleted=0 or t1.deleted is null) and t1.currentnodetype = '3'  and t2.islasttimes=1";
		processing = "1";  	//\u539f\u529e\u7ed3\uff0c\u529e\u7ed3\u548c\u5df2\u529e\u5df2\u5408\u5e76
	}else if(complete.equals("2")){
    //modify by xhheng @20030525 for TD1725
		whereclause += " and (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and (t1.deleted=0 or t1.deleted is null) and t2.islasttimes=1";
		processing = "2";	//\u539f\u5df2\u529e\uff0c\u529e\u7ed3\u548c\u5df2\u529e\u5df2\u5408\u5e76
		//\u5df2\u529e/\u529e\u7ed3:
        //viewcondition=1\u8868\u793a\u672a\u5f52\u6863




        if(viewcondition == 1)
        	whereclause += " and (t2.isremark ='2' or (t2.isremark=0 and t2.takisremark =-2)) and t2.iscomplete=0 ";
        //viewcondition=2\u8868\u793a\u5df2\u5f52\u6863




        else if(viewcondition == 2)
        	whereclause += " and t2.iscomplete=1 and t1.currentnodetype = 3 ";
        //viewcondition=4\u8868\u793a\u672a\u8bfb
        else if(viewcondition == 4)
        	whereclause += " and t2.viewtype=0  and (agentType <> '1' or agentType is null) "+WorkflowComInfo.getDateDuringSql(date2during);
        //viewcondition=3\u8868\u793a\u53cd\u9988
        else if(viewcondition == 3)
        	whereclause += " and t2.viewtype=-1 ";

        if(isopenofs&&showdone){
            if(viewcondition==0){//\u5168\u90e8
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark in ('2','4') ";
            }else if(viewcondition==1){//\u672a\u5f52\u6863
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark='2' and iscomplete=0 ";
            }else if(viewcondition==2){//\u5df2\u5f52\u6863
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark in ('2','4') and iscomplete=1";
            }else{
                whereclause2 += " and 1=2 ";
            }
        }else{
        	whereclause2 += " and 1=2 ";
        }
	}
	SearchClause.setWhereClause(whereclause);
    SearchClause.setWhereclauseOs(whereclause2);//\u7edf\u4e00\u5f85\u529e\u6761\u4ef6
    //System.out.println("whereclause2 = "+whereclause2);
	if(complete.equals("0")){
        orderclause="t2.receivedate ,t2.receivetime ";
        orderclause2=orderclause;
    }else if(complete.equals("1") ||complete.equals("2")){
        //orderclause="t2.receivedate ,t2.receivetime ";
        orderclause="operatedate, operatetime ";
        orderclause2=orderclause;
    }
	SearchClause.setOrderClause(orderclause);
	SearchClause.setOrderClause2(orderclause2);
    SearchClause.setOrderclauseOs(" operatedate, operatetime ");
	if(isajaxfresh != -1)
	{
		return;
	}
	//TD10848 complete=4\uff0c\u8868\u793a\u5f85\u529e\u9ec4\u8272\u56fe\u6807\u6d41\u7a0b




	//modified by cyril on 2008-07-15 for td:8939 complete=3\u8868\u793a\u65b0\u5230\u6d41\u7a0b
	
	if(complete.equals("0") || complete.equals("3") || complete.equals("4")){
	 sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&viewcondition="+viewcondition+"&offical="+offical+"&officalType="+officalType+"&start=1&iswaitdo=1"+"&viewType="+viewType+"&processing="+processing);
	} else {
	  sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&viewcondition="+viewcondition+"&offical="+offical+"&officalType="+officalType+"&start=1&date2during="+date2during+"&viewType="+viewType+"&processing"+processing);
	}
	return;
}
if(method.equals("myall")){
	//String complete=Util.null2String(request.getParameter("complete"));
	
	//whereclause +=" t1.creater = "+userid+" and t1.creatertype = " + usertype;
	if("1".equals(belongtoshow)){
	whereclause +=" and t1.creater in ("+userIDAll+") and t1.creatertype = " + usertype;
	}else{
	whereclause +=" and t1.creater in ("+userid+") and t1.creatertype = " + usertype;
	}
    whereclause2 += requestutil.getSqlWhere("3",userid,"");
	if(viewcondition == 1){ //\u672a\u5f52\u6863




		whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype <> '3' and t2.islasttimes=1 ";
        whereclause2 += " and  iscomplete=0 ";
	}
	else if(viewcondition == 2){	//\u5df2\u5f52\u6863\u7684
		whereclause += " and (t2.isremark in('1', '2','4','5','8','9') or (t2.isremark=0 and t2.takisremark =-2)) and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype = '3'  and t2.islasttimes=1";
		whereclause2 += " and iscomplete=1 ";
	}else if(viewcondition == 0){	//\u672a\u5f52\u6863+\u5df2\u5f52\u6863\u7684\u603b\u6570\uff0c\u5982\u679c\u4e0d\u52a0\u8fd9\u4e2a\u6761\u4ef6\uff0c\u6709\u95ee\u9898\uff0c\u53ef\u4ee5\u770b\u5230t2.isremark in (2,4)
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and ((t1.currentnodetype <> '3') or (t2.isremark in('1', '2','4','5','8','9') and t1.currentnodetype = '3' )) and t2.islasttimes=1 ";
	}else if(viewcondition == 3){ //\u53cd\u9988
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and ((t1.currentnodetype <> '3') or (t2.isremark in('1', '2','4','5','8','9') and t1.currentnodetype = '3' )) and t2.islasttimes=1  and t2.viewtype=-1";
		whereclause2 += " and 1=2 ";
    }else if(viewcondition == 4) //\u672a\u8bfb

	{
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and ((t1.currentnodetype <> '3') or (t2.isremark in('1', '2','4','5','8','9') and t1.currentnodetype = '3' )) and t2.islasttimes=1 and t2.viewtype=0 ";
        whereclause2 += " and 1=2 ";
	}else if(viewcondition == 5) //\u8d85\u65f6
	{
		//whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype = '3'  and t2.isremark=5 ";
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype = '3'  and (t2.isremark=5 or (t2.isremark = '0' and isprocessed <> '1' ))  and t1.currentnodetype <> 3 ";
        whereclause2 += " and 1=2 ";
	}
	SearchClause.setWhereClause(whereclause);
    SearchClause.setWhereclauseOs(whereclause2);
	//\u6211\u7684\u8bf7\u6c42\uff0c\u6309\u7167\u521b\u5efa\u65f6\u95f4\u6392\u5e8f



    orderclause="t1.createdate, t1.createtime ";
    orderclause2=orderclause;
    
    SearchClause.setOrderClause(orderclause);
    SearchClause.setOrderClause2(orderclause2);
    SearchClause.setOrderclauseOs("createdate,createtime");

    sendRedirect(out, request, response, "WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader + "&start=1&date2during=" + date2during + "&viewType=" + viewType + "&myrequest="+method);
	return;
}
if(method.equals("myreqeustbywftype")){
	String wftype=Util.null2String(request.getParameter("wftype"));
	String complete=Util.null2String(request.getParameter("complete"));
	//System.out.println(complete);
    /* edited by wdl 2006-06-14 left menu advanced menu */
    int fromAdvancedMenu = Util.getIntValue(request.getParameter("fromadvancedmenu"),0);
    String selectedContent = Util.null2String(request.getParameter("selectedContent"));
    int infoId = Util.getIntValue(request.getParameter("infoId"),0);
	whereclause2 += requestutil.getSqlWhere("3",userid,"");
    String selectedworkflow = "";
    String inSelectedWorkflowStr = "";
    if(fromAdvancedMenu==1){
	    LeftMenuInfoHandler infoHandler = new LeftMenuInfoHandler();
	    LeftMenuInfo info = infoHandler.getLeftMenuInfo(infoId);
	    if(info!=null){
	    	selectedworkflow = info.getSelectedContent();
	    }
	    if(!"".equals(selectedContent))
	    {
	    	selectedworkflow = selectedContent;
	    }
	    List selectedWorkflowIdList = Util.TokenizerString(selectedworkflow,"|");
	    for(Iterator it=selectedWorkflowIdList.iterator();it.hasNext();){
	    	String tmpstr = (String)it.next();
	    	if(tmpstr.indexOf("W")>-1)
	    		inSelectedWorkflowStr += "," + tmpstr.substring(1);
	    }
	    if(inSelectedWorkflowStr.substring(0,1).equals(",")) inSelectedWorkflowStr=inSelectedWorkflowStr.substring(1);
	    if(!whereclause.equals("")) whereclause += " and ";
	    whereclause += " t1.workflowid in (" + WorkflowVersion.getAllVersionStringByWFIDs(inSelectedWorkflowStr) + ") ";
    }
    /* edited end */    

	if(isopenofs){
        whereclause2 += " and workflowid in (select workflowid from ofs_workflow where sysid="+wftype+" and cancel=0 )";
    }
	
	if(whereclause.equals("")) {
		whereclause +=" t1.workflowid in( select id from workflow_base   where workflowtype = "+wftype+" and (isvalid='1' or isvalid='3') ) ";
	}
	else {
		whereclause +=" and t1.workflowid in( select id from workflow_base   where workflowtype = "+wftype+" and (isvalid='1' or isvalid='3')) ";
	}
		if("1".equals(belongtoshow)){
	whereclause +=" and t1.creater in ("+userIDAll+") and t1.creatertype = " + usertype;
	}else{
	whereclause +=" and t1.creater in ("+userid+") and t1.creatertype = " + usertype;
	}
	if(viewcondition == 1){	//\u672a\u5f52\u6863


		whereclause2 += " and iscomplete=0 ";
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype <> '3' and t2.islasttimes=1 ";
	}
	else if(viewcondition == 2){//\u5df2\u5f52\u6863


		whereclause2 += " and iscomplete=1 ";
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype = '3'  and t2.islasttimes=1";
	}else if(viewcondition == 0)//\u5168\u90e8
	{
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and t2.islasttimes=1 ";
	}else if(viewcondition == 3){//\u53cd\u9988
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and ((t1.currentnodetype <> '3') or (t2.isremark in('2','4') and t1.currentnodetype = '3' )) and t2.islasttimes=1  and t2.viewtype=-1";
		whereclause2 += " and 1=2 ";
	}else if(viewcondition == 4) //\u672a\u8bfb
	{
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and ((t1.currentnodetype <> '3') or (t2.isremark in('2','4') and t1.currentnodetype = '3' )) and t2.islasttimes=1  and t2.viewtype=0 ";
	}else if(viewcondition == 5) //\u8d85\u65f6
	{
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype = '3'  and (t2.isremark=5 or (t2.isremark = '0' and isprocessed <> '1' ))  and t1.currentnodetype <> 3 ";
		//whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype = '3'  and t2.isremark=5 ";
		whereclause2 += " and 1=2 ";
	}
	SearchClause.setWhereClause(whereclause);
	SearchClause.setWhereclauseOs(whereclause2);
	sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&date2during="+date2during+"&viewType="+viewType+"&myrequest="+method);
	return;
}
if(method.equals("myreqeustbywfid")){
	String workflowid=Util.null2String(request.getParameter("workflowid"));
	String complete=Util.null2String(request.getParameter("complete"));
	
	if(whereclause.equals("")) {
			if("1".equals(belongtoshow)){
	whereclause +=" and t1.creater in ("+userIDAll+") and t1.creatertype = " + usertype;
	}else{
	whereclause +=" and t1.creater in ("+userid+") and t1.creatertype = " + usertype;
	}
	}
	else {
	if("1".equals(belongtoshow)){
	whereclause +=" and t1.creater in ("+userIDAll+") and t1.creatertype = " + usertype;
	}else{
	whereclause +=" and t1.creater in ("+userid+") and t1.creatertype = " + usertype;
	}
	}
	whereclause2 += requestutil.getSqlWhere("3",userid,"");
	whereclause2 += " and workflowid="+workflowid ;
	if(viewcondition == 1){//\u672a\u5f52\u6863




		whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype <> '3' and t2.islasttimes=1 ";
		whereclause2 +=" and iscomplete=0 ";
	}
	else if(viewcondition == 2){//\u5df2\u5f52\u6863




		whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype = '3'  and t2.islasttimes=1";
		whereclause2 +=" and iscomplete=1 ";
	}else if(viewcondition == 0){//\u5168\u90e8
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and t2.islasttimes=1 ";
	}else if(viewcondition == 3)
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and ((t1.currentnodetype <> '3') or (t2.isremark in('2','4') and t1.currentnodetype = '3' )) and t2.islasttimes=1 and t2.viewtype=-1";
	else if(viewcondition == 4) //\u672a\u8bfb
	{
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and ((t1.currentnodetype <> '3') or (t2.isremark in('2','4') and t1.currentnodetype = '3' )) and t2.islasttimes=1 and t2.viewtype=0 ";
		whereclause2 +=" and viewtype=0 ";
	}else if(viewcondition == 5) //\u8d85\u65f6
	{
		//whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype = '3'  and t2.isremark=5 ";
		whereclause += " and (t1.deleted=0 or t1.deleted is null) and t1.currentnodetype = '3'  and (t2.isremark=5 or (t2.isremark = '0' and isprocessed <> '1' ))  and t1.currentnodetype <> 3 ";
		whereclause2 +=" and 1=2 ";
	}
	SearchClause.setWhereClause(whereclause);
	SearchClause.setWhereclauseOs(whereclause2);
    SearchClause.setWorkflowId(workflowid);
	sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&date2during="+date2during+"&viewType="+viewType+"&myrequest="+method);
	return;
}

if(method.equals("reqeustbywftype")){
	String wftype=Util.null2String(request.getParameter("wftype"));
	String complete=Util.null2String(request.getParameter("complete"));
	
    /* edited by wdl 2006-06-14 left menu advanced menu */
    int fromAdvancedMenu = Util.getIntValue(request.getParameter("fromadvancedmenu"),0);
    String selectedContent = Util.null2String(request.getParameter("selectedContent"));
    int infoId = Util.getIntValue(request.getParameter("infoId"),0);

    String selectedworkflow = "";
    String inSelectedWorkflowStr = "";
    if(fromAdvancedMenu==1){
	    LeftMenuInfoHandler infoHandler = new LeftMenuInfoHandler();
	    LeftMenuInfo info = infoHandler.getLeftMenuInfo(infoId);
	    if(info!=null){
	    	selectedworkflow = info.getSelectedContent();
	    }
	    if(!"".equals(selectedContent))
	    {
	    	selectedworkflow = selectedContent;
	    }
	    List selectedWorkflowIdList = Util.TokenizerString(selectedworkflow,"|");
	    for(Iterator it=selectedWorkflowIdList.iterator();it.hasNext();){
	    	String tmpstr = (String)it.next();
	    	if(tmpstr.indexOf("W")>-1)
	    		inSelectedWorkflowStr += "," + tmpstr.substring(1);
	    }
	    if(inSelectedWorkflowStr.substring(0,1).equals(",")) inSelectedWorkflowStr=inSelectedWorkflowStr.substring(1);
	    if(!whereclause.equals("")) whereclause += " and ";
        if(wftype.indexOf("-")!=-1){
            whereclause += " t1.workflowid in (0) ";
        }else {
            whereclause += " t1.workflowid in (" + WorkflowVersion.getAllVersionStringByWFIDs(inSelectedWorkflowStr) + ") ";
        }
    }
    /* edited end */    
	
	if(whereclause.equals("")) {
		whereclause +=" t1.workflowid in( select id from workflow_base   where workflowtype = "+wftype+") and (t1.deleted=0 or t1.deleted is null) ";
	}
	else {
		whereclause +=" and t1.workflowid in( select id from workflow_base   where workflowtype = "+wftype+") and (t1.deleted=0 or t1.deleted is null) ";
	}
    whereclause2 +=" and workflowid in ( select workflowid from ofs_workflow   where sysid = "+wftype+" and (cancel=0 or cancel is null) ) ";
	if(complete.equals("0")){
		whereclause +="  and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and t2.islasttimes=1";
		//whereclause += " and (t1.currentnodetype <> '3' or  (t2.isremark ='1' and t1.currentnodetype = '3') ) and t2.islasttimes=1";
	}
	else if(complete.equals("1")){
		whereclause += " and (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and t1.currentnodetype = '3' and iscomplete=1 and islasttimes=1";
	}
    //complete=2\u8868\u793a\u5df2\u529e/\u529e\u7ed3\u4e8b\u5b9c
	else if(complete.equals("2")){
		whereclause += " and (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2))  and  t2.islasttimes=1";
		//\u5df2\u529e/\u529e\u7ed3:
        //viewcondition=1\u8868\u793a\u672a\u5f52\u6863




        if(viewcondition == 1)
        	whereclause += " and t2.isremark ='2' and t2.iscomplete=0 ";
        //viewcondition=2\u8868\u793a\u5df2\u5f52\u6863




        else if(viewcondition == 2)
        	whereclause += " and t2.iscomplete=1 and t1.currentnodetype = 3 ";
        //viewcondition=4\u8868\u793a\u672a\u8bfb
        else if(viewcondition == 4)
        	whereclause += " and t2.viewtype=0  and (agentType <> '1' or agentType is null) "+WorkflowComInfo.getDateDuringSql(date2during);
        //viewcondition=3\u8868\u793a\u53cd\u9988
        else if(viewcondition == 3)
        	whereclause += " and t2.viewtype=-1 ";

        if(isopenofs&&showdone){
            if(viewcondition==0){//\u5168\u90e8
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark in ('2','4') ";
            }else if(viewcondition==1){//\u5df2\u529e
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark=2 and iscomplete=0";
            }else if(viewcondition==2){//\u529e\u7ed3
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark in ('2','4') and iscomplete=1";
            }else{
                whereclause2 += " and 1=2 ";
            }
        }else{
        	whereclause2 += " and 1=2 ";
        }
	}
	//complete=50\u8868\u793a\u5df2\u529e\u4e8b\u5b9c\uff0c\u7ea2\u8272new\u6807\u8bb0
	else if(complete.equals("50")){
        if(whereclause.equals("")) {
            whereclause += " and ((t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) or (t2.isremark=0 and t2.takisremark =-2)) and t2.islasttimes=1 and t2.viewtype=0 and (agentType<>'1' or agentType is null) ";
        }else{
		    whereclause += " and (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) or (t2.isremark=0 and t2.takisremark =-2)) and t2.islasttimes=1 and t2.viewtype=0 and (agentType<>'1' or agentType is null) ";
        }
	}
	SearchClause.setWhereClause(whereclause);
    SearchClause.setWhereclauseOs(whereclause2);
    if(complete.equals("0")){
        orderclause="t2.receivedate ,t2.receivetime ";
        orderclause2=orderclause;
    }else if(complete.equals("1") ||complete.equals("2")){
        //orderclause="t2.receivedate ,t2.receivetime ";
        orderclause="operatedate, operatetime ";
        orderclause2=orderclause;
    }
    SearchClause.setOrderClause(orderclause);
    SearchClause.setOrderClause2(orderclause2);
  if(complete.equals("0") || complete.equals("3") || complete.equals("4"))//modified by cyril on 2008-07-15 for td:8939 complete=3\u8868\u793a\u65b0\u5230\u6d41\u7a0b
	  sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&iswaitdo=1&date2during="+date2during+"&viewType="+viewType);
  else
    sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&date2during="+date2during+"&viewType="+viewType);
	return;
}
//TD8778 \u891a\u4fca \u6839\u636e\u6d41\u7a0b\u7c7b\u578b\u8fdb\u5165\u6d41\u7a0b\u5217\u8868\u9875\u9762\uff0c\u7cbe\u786e\u5230\u6d41\u7a0b\u8282\u70b9
if(method.equals("reqeustbywftypeNode")){
	String wftype=Util.null2String(request.getParameter("wftype"));
	String complete=Util.null2String(request.getParameter("complete"));
	
    /* edited by wdl 2006-06-14 left menu advanced menu */
    int fromAdvancedMenu = Util.getIntValue(request.getParameter("fromadvancedmenu"),0);
    int infoId = Util.getIntValue(request.getParameter("infoId"),0);
	String workFlowIDsRequest=Util.null2String(request.getParameter("workFlowIDsRequest"));
	String workFlowNodeIDsRequest=Util.null2String(request.getParameter("workFlowNodeIDsRequest"));
    String selectedworkflow = "";
    String inSelectedStr = "";
	List selectedWorkflowIdList = Util.TokenizerString(workFlowIDsRequest,",");
    if(fromAdvancedMenu==1){
		for(int i=0; i<selectedWorkflowIdList.size(); i++){
			String wfID = (String)selectedWorkflowIdList.get(i);
			if(!"".equals(workFlowNodeIDsRequest)){
				inSelectedStr += "or ( t1.workflowid = "+wfID+" and t1.currentnodeid in ("+WorkflowVersion.getAllRelationNodeStringByNodeIDs(workFlowNodeIDsRequest)+") ) ";
			}else{
				inSelectedStr += "or ( t1.workflowid = "+wfID+" ) ";
			}
		}
		if(!"".equals(inSelectedStr)){
			inSelectedStr = inSelectedStr.substring(2);
			if(!"".equals(whereclause)){
				whereclause = whereclause + " and ";
			}
			whereclause += " ( " + inSelectedStr + " ) ";
		}
    }
    /* edited end */    
	
	if(whereclause.equals("")) {
		whereclause +=" t1.workflowid in( select id from workflow_base   where workflowtype = "+wftype+") ";
	}
	else {
		whereclause +=" and t1.workflowid in( select id from workflow_base   where workflowtype = "+wftype+") ";
	}
	
	if(complete.equals("0")){
		whereclause +=" ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and t2.islasttimes=1";
		//whereclause += " and (t1.currentnodetype <> '3' or  (t2.isremark ='1' and t1.currentnodetype = '3') ) and t2.islasttimes=1";
	}
	else if(complete.equals("1")){
		whereclause += " and  ((t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) or (t2.isremark=0 and t2.takisremark =-2)) and t1.currentnodetype = '3' and iscomplete=1 and islasttimes=1";
	}
    //complete=2\u8868\u793a\u5df2\u529e\u4e8b\u5b9c
	else if(complete.equals("2")){
		whereclause += " and t2.isremark ='2' and t2.iscomplete=0  and  t2.islasttimes=1";
	}
	SearchClause.setWhereClause(whereclause);
    if(complete.equals("0")){
        orderclause="t2.receivedate ,t2.receivetime ";
        orderclause2=orderclause;
    }else if(complete.equals("1") ||complete.equals("2")){
        //orderclause="t2.receivedate ,t2.receivetime ";
        orderclause="operatedate, operatetime ";
        orderclause2=orderclause;
    }
    SearchClause.setOrderClause(orderclause);
    SearchClause.setOrderClause2(orderclause2);
  if(complete.equals("0") || complete.equals("3") || complete.equals("4"))//modified by cyril on 2008-07-15 for td:8939 complete=3\u8868\u793a\u65b0\u5230\u6d41\u7a0b
	  sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&iswaitdo=1&date2during="+date2during+"&viewType="+viewType);
  else
    sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&date2during="+date2during+"&viewType="+viewType);
	return;
}
//add by ben\u6839\u636e\u5355\u636e\u53f7\u5f97\u5230\u6d41\u7a0b 
if(method.equals("reqeustbybill")){
	String billid=Util.null2String(request.getParameter("billid"));
	String complete=Util.null2String(request.getParameter("complete"));
	
	if ("163".equals(billid)) {
		if(whereclause.equals("")) {
			whereclause +=" t1.workflowid in(select id from workflow_base where (formid = "+billid+" or formid in (select formid from carbasic where isuse=1)) and id not in (select workflowid from carbasic where isuse=0) and isbill='1') ";
		}
		else {
			whereclause +=" and t1.workflowid in(select id from workflow_base where (formid = "+billid+" or formid in (select formid from carbasic where isuse=1)) and id not in (select workflowid from carbasic where isuse=0) and isbill='1') ";
		}
	} else {
		if(whereclause.equals("")) {
			whereclause +=" t1.workflowid in( select id from workflow_base   where formid = "+billid+" and isbill='1') ";
		}
		else {
			whereclause +=" and t1.workflowid in( select id from workflow_base   where formid = "+billid+" and isbill='1') ";
		}
	}
	
	
	if(complete.equals("0")){  //\u672a\u5ba1\u6279




		whereclause +=" and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and t2.islasttimes=1 ";
		//whereclause += " and (t1.currentnodetype <> '3' or ((t2.isremark ='1' or t2.isremark ='8' or t2.isremark ='9') and t1.currentnodetype = '3') ) and t2.islasttimes=1";
	}
	else if(complete.equals("1")){ 
		whereclause += " and (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and t1.currentnodetype = '3' and iscomplete=1 and islasttimes=1";
	}
    //complete=2\u8868\u793a\u5df2\u529e\u4e8b\u5b9c
	else if(complete.equals("2")){  //\u5df2\u5ba1\u6279 \uff08\u628a\u529e\u7ed3\u548c\u5df2\u529e\u4e00\u8d77\u663e\u793a\uff09
		whereclause += "   and ((t2.isremark ='2' and t1.currentnodetype <> 3 and t2.iscomplete=0) or  (t1.currentnodetype = '3')) and  t2.islasttimes=1";
	}
	SearchClause.setWhereClause(whereclause);
    if(complete.equals("0")){
        orderclause="t2.receivedate ,t2.receivetime ";
        orderclause2=orderclause;
    }else if(complete.equals("1") ||complete.equals("2")){
        //orderclause="t2.receivedate ,t2.receivetime ";
        orderclause="operatedate, operatetime ";
        orderclause2=orderclause;
    }
    SearchClause.setOrderClause(orderclause);
    SearchClause.setOrderClause2(orderclause2);
  if(complete.equals("0") || complete.equals("3") || complete.equals("4"))//modified by cyril on 2008-07-15 for td:8939 complete=3\u8868\u793a\u65b0\u5230\u6d41\u7a0b
	  sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&iswaitdo=1&date2during="+date2during+"&viewType="+viewType);
  else
    sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&date2during="+date2during+"&viewType="+viewType);
	return;
}
if(method.equals("reqeustbywfid")){
	String workflowid=Util.null2String(request.getParameter("workflowid"));
	String complete=Util.null2String(request.getParameter("complete"));
	//System.out.println();
	//complete=0\u8868\u793a\u5df2\u529e\u4e8b\u5b9c
	if(complete.equals("0")){
        if(whereclause.equals("")) {
            whereclause +=" ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and t2.islasttimes=1";
        }else{
		    whereclause +=" and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and t2.islasttimes=1";
        }
		//modify by mackjoe at 2005-09-29 td1772 \u8f6c\u53d1\u7279\u6b8a\u5904\u7406\uff0c\u8f6c\u53d1\u4fe1\u606f\u672c\u4eba\u672a\u5904\u7406\u4e00\u76f4\u90fd\u5728\u5f85\u529e\u4e8b\u5b9c\u4e2d\u663e\u793a
        //whereclause += " and (t1.currentnodetype <> '3' or  (t2.isremark in ('1', '8', '9') and t1.currentnodetype = '3')) and t2.islasttimes=1";
	    whereclause2 += " and isremark='0' ";
	}
    //complete=1\u8868\u793a\u529e\u7ed3\u4e8b\u5b9c
	else if(complete.equals("1")){
        if(whereclause.equals("")) {
            whereclause += " (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and t1.currentnodetype = '3' and iscomplete=1 and islasttimes=1";
        }else{
		    whereclause += " and (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and t1.currentnodetype = '3' and iscomplete=1 and islasttimes=1";
        }
        whereclause2 += " and isremark in ('2','4') and iscomplete = 1 ";
	}
    //complete=2\u8868\u793a\u5df2\u529e/\u529e\u7ed3\u4e8b\u5b9c
	else if(complete.equals("2")){
        if(whereclause.equals("")) {
            whereclause += " (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and t2.islasttimes=1 ";
        }else{
		    whereclause += " and (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2))  and t2.islasttimes=1 ";
        }
        //\u5df2\u529e/\u529e\u7ed3:
        //viewcondition=1\u8868\u793a\u672a\u5f52\u6863

        //whereclause2 += " and isremark in ('2','4') ";

        if(viewcondition == 1) {
            whereclause += " and t2.isremark ='2' and t2.iscomplete=0 ";
            //viewcondition=2\u8868\u793a\u5df2\u5f52\u6863

            //whereclause2 += " and iscomplete = 1 ";

        }else if(viewcondition == 2) {
            whereclause += " and t2.iscomplete=1 and t1.currentnodetype = 3 ";
            //whereclause2 += " and iscomplete = 1 ";
            //viewcondition=4\u8868\u793a\u672a\u8bfb
        }else if(viewcondition == 4) {
            whereclause += " and t2.viewtype=0  and (agentType <> '1' or agentType is null) " + WorkflowComInfo.getDateDuringSql(date2during);
            whereclause2 += " and 1=2 ";
            //viewcondition=3\u8868\u793a\u53cd\u9988
        }else if(viewcondition == 3) {
            whereclause += " and t2.viewtype=-1 ";
            whereclause2 += " and 1=2 ";
        }
        if(isopenofs&&showdone){
            if(viewcondition==0){//\u5168\u90e8
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark in (2,4) ";
            }else if(viewcondition==1){//\u672a\u8bfb
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark=2 and iscomplete=0";
            }else if(viewcondition==2){//\u672a\u8bfb
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark=4 and iscomplete=1";
            }else{
                whereclause2 += " and 1=2 ";
            }
        }else{
        	whereclause2 += " and 1=2 ";
        }
	}
    //complete=3\u8868\u793a\u5f85\u529e\u4e8b\u5b9c\uff0c\u7ea2\u8272new\u6807\u8bb0
	else if(complete.equals("3")){
        if(whereclause.equals("")) {
            whereclause +=" ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=0 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }else{
		    whereclause +=" and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=0 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }
        whereclause2 += " and 1=2 ";
	}
    //complete=4\u8868\u793a\u5f85\u529e\u4e8b\u5b9c\uff0c\u7070\u8272new\u6807\u8bb0
	else if(complete.equals("4")){
        if(whereclause.equals("")) {
            whereclause +=" ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=-1 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }else{
		    whereclause +=" and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=-1 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }
        whereclause2 += " and 1=2 ";
	}
    //complete=5\u8868\u793a\u5df2\u529e\u4e8b\u5b9c\uff0c\u7070\u8272new\u6807\u8bb0
	else if(complete.equals("5")){
        if(whereclause.equals("")) {
            whereclause += " t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=-1";
        }else{
		    whereclause += " and t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=-1";
        }
        whereclause2 += " and 1=2 ";
	}
    //complete=50\u8868\u793a\u5df2\u529e\u4e8b\u5b9c\uff0c\u7ea2\u8272new\u6807\u8bb0
	else if(complete.equals("50")){
        if(whereclause.equals("")) {
            whereclause += " t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=0 and (agentType<>'1' or agentType is null) ";
        }else{
		    whereclause += " and t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=0 and (agentType<>'1' or agentType is null) ";
        }
        whereclause2 += " and 1=2 ";
	}

    //complete=6\u8868\u793a\u529e\u7ed3\u4e8b\u5b9c\uff0c\u7ea2\u8272new\u6807\u8bb0
	else if(complete.equals("6")){
        if(whereclause.equals("")) {
            whereclause += " t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=0";
        }else{
            whereclause += " and t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=0";
        }
        whereclause2 += " and 1=2 ";
	}
    //complete=7\u8868\u793a\u529e\u7ed3\u4e8b\u5b9c\uff0c\u7070\u8272new\u6807\u8bb0
	else if(complete.equals("7")){
        if(whereclause.equals("")) {
            whereclause += " t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=-1";
        }else{
            whereclause += " and t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=-1";
        }
        whereclause2 += " and 1=2 ";
	}
    //complete=8\u8868\u793a\u8d85\u65f6\u4e8b\u5b9c\uff0c




	else if(complete.equals("8")){
        if(whereclause.equals("")) {
            whereclause +=" ((t2.isremark='0' and (t2.isprocessed='2' or t2.isprocessed='3'))  or t2.isremark='5') and t1.currentnodetype <> 3 ";
        }else{
            whereclause +=" and ((t2.isremark='0' and (t2.isprocessed='2' or t2.isprocessed='3'))  or t2.isremark='5') and t1.currentnodetype <> 3 ";
        }
        whereclause2 += " and 1=2 ";
	}

    whereclause2 += " and workflowid="+workflowid ;
    SearchClause.setWhereClause(whereclause);
    SearchClause.setWhereclauseOs(whereclause2);

    if(complete.equals("0")||complete.equals("3")||complete.equals("4")){
        orderclause="t2.receivedate ,t2.receivetime ";
        orderclause2=orderclause;
    }else if(complete.equals("1") ||complete.equals("2")||complete.equals("5")||complete.equals("6")||complete.equals("7")||complete.equals("8")){
        //orderclause="t2.receivedate ,t2.receivetime ";
        orderclause="operatedate, operatetime ";
        orderclause2=orderclause;
    }
    SearchClause.setOrderClause(orderclause);
    SearchClause.setOrderClause2(orderclause2);
    SearchClause.setWorkflowId(workflowid);
   
  if(complete.equals("0") || complete.equals("3") || complete.equals("4"))//modified by cyril on 2008-07-15 for td:8939 complete=3\u8868\u793a\u65b0\u5230\u6d41\u7a0b
	  sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&iswaitdo=1&date2during="+date2during+"&viewType="+viewType);
  else
    sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&date2during="+date2during+"&viewType="+viewType);
	return;
}
if(method.equals("reqeustbywfidNode")){
	String workflowid=Util.null2String(request.getParameter("workflowid"));
	String complete=Util.null2String(request.getParameter("complete"));
	String nodeids = Util.null2String(request.getParameter("nodeids"));
	if(!"".equals(workflowid)){
        String tempwfids = WorkflowVersion.getAllVersionStringByWFIDs(workflowid) ;
        if(workflowid.indexOf("-")!=-1) tempwfids=workflowid ;
        if(whereclause.equals("")) {
            whereclause +=" t1.workflowid in ("+tempwfids+") ";
        }else{
		    whereclause +=" and t1.workflowid in ("+tempwfids+") ";
        }
        whereclause2 += " and workflowid="+workflowid ;
	}
	if(!"".equals(nodeids)){
        if(whereclause.equals("")) {
            whereclause +=" t1.currentnodeid in ("+WorkflowVersion.getAllRelationNodeStringByNodeIDs(nodeids)+") ";
        }else{
		    whereclause +=" and t1.currentnodeid in ("+WorkflowVersion.getAllRelationNodeStringByNodeIDs(nodeids)+") ";
        }
        whereclause2 += " and 1=2 ";
	}
	//complete=0\u8868\u793a\u5f85\u529e\u4e8b\u5b9c
	if(complete.equals("0")){
        if(whereclause.equals("")) {
            whereclause +=" ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and t2.islasttimes=1";
        }else{
		    whereclause +=" and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and t2.islasttimes=1";
        }
		//modify by mackjoe at 2005-09-29 td1772 \u8f6c\u53d1\u7279\u6b8a\u5904\u7406\uff0c\u8f6c\u53d1\u4fe1\u606f\u672c\u4eba\u672a\u5904\u7406\u4e00\u76f4\u90fd\u5728\u5f85\u529e\u4e8b\u5b9c\u4e2d\u663e\u793a
        //whereclause += " and (t1.currentnodetype <> '3' or  (t2.isremark in ('1', '8', '9') and t1.currentnodetype = '3')) and t2.islasttimes=1";
		// \u5206\u9875\u63a7\u4ef6\u4e0a\u65b9\u7684\u63a7\u4ef6  1:\u672a\u8bfb\uff1b2\uff1a\u53cd\u9988\uff1b3\uff1a\u8d85\u65f6\uff1b  	add by Dracula @2014-1-10
	    if(viewcondition == 1)
	    	whereclause += " and t2.viewtype = '0' and (t1.currentnodetype <> '3' or  (t2.isremark in ('1', '8', '9') and t1.currentnodetype = '3'))  and t2.isprocessed is null and t2.isremark <> '5'";
	    else if(viewcondition == 2)
	    	whereclause += " and t2.viewtype = '-1' and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
	    else if(viewcondition == 3)
	    	whereclause += " and ((t2.isremark='0' and (t2.isprocessed='2' or t2.isprocessed='3'))  or t2.isremark='5') and t1.currentnodetype <> 3  ";
	    else if(viewcondition == 4)
	    	whereclause += " and t2.requestid in (select requestid from workflow_requestlog where logtype='s') ";
	    processing = "0";	//\u5f85\u529e

        if(isopenofs){
            if(viewcondition==0){//\u5168\u90e8
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark=0 ";
            }else if(viewcondition==1){//\u672a\u8bfb
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark=0 and viewtype=0 ";
            }else{
                whereclause2 += " and 1=2 ";
            }
        }
	}
    //complete=1\u8868\u793a\u529e\u7ed3\u4e8b\u5b9c
	else if(complete.equals("1")){
        if(whereclause.equals("")) {
            whereclause += " (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and t1.currentnodetype = '3' and iscomplete=1 and islasttimes=1";
        }else{
		    whereclause += " and (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and t1.currentnodetype = '3' and iscomplete=1 and islasttimes=1";
        }
	}
    //complete=2\u8868\u793a\u5df2\u529e\u4e8b\u5b9c
	else if(complete.equals("2")){
        if(whereclause.equals("")) {
            whereclause += " t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 ";
        }else{
		    whereclause += " and t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 ";
        }
	}
    //complete=3\u8868\u793a\u5f85\u529e\u4e8b\u5b9c\uff0c\u7ea2\u8272new\u6807\u8bb0
	else if(complete.equals("3")){
        if(whereclause.equals("")) {
            whereclause +=" ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=0 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }else{
		    whereclause +=" and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=0 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }
	}
    //complete=4\u8868\u793a\u5f85\u529e\u4e8b\u5b9c\uff0c\u7070\u8272new\u6807\u8bb0(\u53cd\u9988)
	else if(complete.equals("4")){
        if(whereclause.equals("")) {
            whereclause +=" ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=-1 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }else{
		    whereclause +=" and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=-1 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }
	}
    //complete=5\u8868\u793a\u5df2\u529e\u4e8b\u5b9c\uff0c\u7070\u8272new\u6807\u8bb0
	else if(complete.equals("5")){
        if(whereclause.equals("")) {
            whereclause += " t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=-1";
        }else{
		    whereclause += " and t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=-1";
        }
	}
    //complete=50\u8868\u793a\u5df2\u529e\u4e8b\u5b9c\uff0c\u7ea2\u8272new\u6807\u8bb0
	else if(complete.equals("50")){
        if(whereclause.equals("")) {
            whereclause += " t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=0 and (agentType<>'1' or agentType is null) ";
        }else{
		    whereclause += " and t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=0 and (agentType<>'1' or agentType is null) ";
        }
	}
    //complete=6\u8868\u793a\u529e\u7ed3\u4e8b\u5b9c\uff0c\u7ea2\u8272new\u6807\u8bb0
	else if(complete.equals("6")){
        if(whereclause.equals("")) {
            whereclause += " t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=0";
        }else{
            whereclause += " and t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=0";
        }
	}
    //complete=7\u8868\u793a\u529e\u7ed3\u4e8b\u5b9c\uff0c\u7070\u8272new\u6807\u8bb0
	else if(complete.equals("7")){
        if(whereclause.equals("")) {
            whereclause += " t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=-1";
        }else{
            whereclause += " and t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=-1";
        }
	}
    //complete=8\u8868\u793a\u8d85\u65f6\u4e8b\u5b9c\uff0c




	else if(complete.equals("8")){
        if(whereclause.equals("")) {
            whereclause +=" and ((t2.isremark='0' and (t2.isprocessed='2' or t2.isprocessed='3'))  or t2.isremark='5') and t1.currentnodetype <> 3 ";
        }else{
            whereclause +=" and ((t2.isremark='0' and (t2.isprocessed='2' or t2.isprocessed='3'))  or t2.isremark='5') and t1.currentnodetype <> 3 ";
        }
	}
    SearchClause.setWhereClause(whereclause);
    SearchClause.setWhereclauseOs(whereclause2);

    if(complete.equals("0")||complete.equals("3")||complete.equals("4")){
        orderclause="t2.receivedate ,t2.receivetime ";
        orderclause2=orderclause;
    }else if(complete.equals("1") ||complete.equals("2")||complete.equals("5")||complete.equals("6")||complete.equals("7")||complete.equals("8")){
        //orderclause="t2.receivedate ,t2.receivetime ";
        orderclause="operatedate, operatetime ";
        orderclause2=orderclause;
    }
    SearchClause.setOrderClause(orderclause);
    SearchClause.setOrderClause2(orderclause2);
    SearchClause.setWorkflowId(workflowid);
   
  if(complete.equals("0") || complete.equals("3") || complete.equals("4"))//modified by cyril on 2008-07-15 for td:8939 complete=3\u8868\u793a\u65b0\u5230\u6d41\u7a0b
	  sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&iswaitdo=1&date2during="+date2during+"&viewType="+viewType+"&processing="+processing);
  else
    sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&date2during="+date2during+"&viewType="+viewType+"&processing="+processing);
	return;
}



//add by bpf on 2013-11-13
//\u65b0\u7684\u6d41\u7a0b\u9875\u9762\u4e2d\u5e26\u6570\u5b57\u7684\u7684\u5de6\u4fa7\u83dc\u5355\u7684\u4e00\u7ea7\u83dc\u5355\uff08\u6d41\u7a0b\u5927\u7c7b\u522b\uff09\u70b9\u51fb\u4e4b\u540e\u7684\u8df3\u8f6c




//\u5b9e\u73b0\u7684\u65b9\u5f0f\u4e3areqeustByWfType\u548creqeustbywfidNode\u4e24\u4e2a\u5206\u652f\u7684\u4ee3\u7801\u7ec4\u5408\u4e86\u4e00\u4e0b




if(method.equals("reqeustByWfTypeAndComplete")){
	String wftype=Util.null2String(request.getParameter("wftype"));
	String complete=Util.null2String(request.getParameter("complete"));
	
    int fromAdvancedMenu = Util.getIntValue(request.getParameter("fromadvancedmenu"),0);
    String selectedContent = Util.null2String(request.getParameter("selectedContent"));
    int infoId = Util.getIntValue(request.getParameter("infoId"),0);

    String selectedworkflow = "";
    String inSelectedWorkflowStr = "";
    if(fromAdvancedMenu==1){
	    LeftMenuInfoHandler infoHandler = new LeftMenuInfoHandler();
	    LeftMenuInfo info = infoHandler.getLeftMenuInfo(infoId);
	    if(info!=null){
	    	selectedworkflow = info.getSelectedContent();
	    }
	    if(!"".equals(selectedContent))
	    {
	    	selectedworkflow = selectedContent;
	    }
	    List selectedWorkflowIdList = Util.TokenizerString(selectedworkflow,"|");
	    for(Iterator it=selectedWorkflowIdList.iterator();it.hasNext();){
	    	String tmpstr = (String)it.next();
	    	if(tmpstr.indexOf("W")>-1)
	    		inSelectedWorkflowStr += "," + tmpstr.substring(1);
	    }
	    if(inSelectedWorkflowStr.substring(0,1).equals(",")) inSelectedWorkflowStr=inSelectedWorkflowStr.substring(1);
	    if(!whereclause.equals("")) whereclause += " and ";
	    whereclause += " t1.workflowid in (" +WorkflowVersion.getAllVersionStringByWFIDs(inSelectedWorkflowStr) + ") ";
	    whereclause += " and ";
    }
	if(whereclause.equals("")) {
		whereclause +=" t1.workflowid in( select id from workflow_base   where workflowtype = "+wftype+") and (t1.deleted=0 or t1.deleted is null) ";
	}
	else {
		whereclause +=" and t1.workflowid in( select id from workflow_base   where workflowtype = "+wftype+") and (t1.deleted=0 or t1.deleted is null) ";
	}

    if(isopenofs){
        whereclause2 += " and workflowid in (select workflowid from ofs_workflow where sysid="+wftype+" and cancel=0 )";
    }
	String nodeids = Util.null2String(request.getParameter("nodeids"));

	if(!"".equals(nodeids)){
        if(whereclause.equals("")) {
            whereclause +=" t1.currentnodeid in ("+WorkflowVersion.getAllRelationNodeStringByNodeIDs(nodeids)+") ";
        }else{
		    whereclause +=" and t1.currentnodeid in ("+WorkflowVersion.getAllRelationNodeStringByNodeIDs(nodeids)+") ";
        }

        whereclause2 += " and 1=2 ";
	}
	//complete=0\u8868\u793a\u5f85\u529e\u4e8b\u5b9c
	if(complete.equals("0")){
        if(whereclause.equals("")) {
        	if(viewcondition == 3){
            	whereclause +=" ((t2.isremark='0' and (t2.isprocessed='2' or t2.isprocessed='3'))  or t2.isremark='5') and (t1.currentnodetype <> '3' or  (t2.isremark in ('1', '8', '9') and t1.currentnodetype = '3'))  and t2.islasttimes=1";
        	}else{
            	whereclause +=" ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and t2.islasttimes=1";
        	}
        }else{
        	if(viewcondition == 3){
        		whereclause +=" and ((t2.isremark='0' and (t2.isprocessed='2' or t2.isprocessed='3'))  or t2.isremark='5') and (t1.currentnodetype <> '3' or  (t2.isremark in ('1', '8', '9') and t1.currentnodetype = '3'))  and t2.islasttimes=1";
        	}else{
        		whereclause +=" and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and t2.islasttimes=1";
        	}
        }
		//modify by mackjoe at 2005-09-29 td1772 \u8f6c\u53d1\u7279\u6b8a\u5904\u7406\uff0c\u8f6c\u53d1\u4fe1\u606f\u672c\u4eba\u672a\u5904\u7406\u4e00\u76f4\u90fd\u5728\u5f85\u529e\u4e8b\u5b9c\u4e2d\u663e\u793a
        //whereclause += " and (t1.currentnodetype <> '3' or  (t2.isremark in ('1', '8', '9') and t1.currentnodetype = '3')) and t2.islasttimes=1";
		// \u5206\u9875\u63a7\u4ef6\u4e0a\u65b9\u7684\u63a7\u4ef6  1:\u672a\u8bfb\uff1b2\uff1a\u53cd\u9988\uff1b3\uff1a\u8d85\u65f6\uff1b  	add by Dracula @2014-1-10
	    if(viewcondition == 1)
	    	whereclause += " and t2.viewtype = '0' and t2.isremark != '5' and t2.isprocessed is null ";
	    else if(viewcondition == 2)
	    	whereclause += " and t2.viewtype = '-1'";
	    //else if(viewcondition == 3)
	    	//whereclause += " and t2.isremark = '5'";
	    else if(viewcondition == 4)
	    	whereclause += " and t2.requestid in (select requestid from workflow_requestlog where logtype='s')";
	    processing = "0";	//\u5f85\u529e

        if(isopenofs){
            if(viewcondition==0){//\u5168\u90e8
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark=0 ";
            }else if(viewcondition==1){//\u672a\u8bfb
                whereclause2 += " and userid="+user.getUID()+" and islasttimes=1 and isremark=0 and viewtype=0 ";
            }else{
                whereclause2 += " and 1=2 ";
            }
        }
	}
    //complete=1\u8868\u793a\u529e\u7ed3\u4e8b\u5b9c
	else if(complete.equals("1")){
        if(whereclause.equals("")) {
            whereclause += " (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and t1.currentnodetype = '3' and iscomplete=1 and islasttimes=1";
        }else{
		    whereclause += " and (t2.isremark in('2','4') or (t2.isremark=0 and t2.takisremark =-2)) and t1.currentnodetype = '3' and iscomplete=1 and islasttimes=1";
        }
	}
    //complete=2\u8868\u793a\u5df2\u529e\u4e8b\u5b9c
	else if(complete.equals("2")){
        if(whereclause.equals("")) {
            whereclause += " t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 ";
        }else{
		    whereclause += " and t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 ";
        }
	}
    //complete=3\u8868\u793a\u5f85\u529e\u4e8b\u5b9c\uff0c\u7ea2\u8272new\u6807\u8bb0
	else if(complete.equals("3")){
		
        if(whereclause.equals("")) {
            whereclause +=" ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=0 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }else{
		    whereclause +=" and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=0 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }
	}
    //complete=4\u8868\u793a\u5f85\u529e\u4e8b\u5b9c\uff0c\u7070\u8272new\u6807\u8bb0
	else if(complete.equals("4")){
        if(whereclause.equals("")) {
            whereclause +=" ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=-1 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }else{
		    whereclause +=" and ((t2.isremark=0 and (t2.takisremark is null or t2.takisremark=0 )) or t2.isremark in('1','5','8','9','7')) and  t2.viewtype=-1 and t2.islasttimes=1 and ((t2.isremark='0' and (t2.isprocessed is null or (t2.isprocessed<>'2' and t2.isprocessed<>'3'))) or t2.isremark='1' or t2.isremark='8' or t2.isremark='9' or t2.isremark='5' or t2.isremark='7') ";
        }
	}
    //complete=5\u8868\u793a\u5df2\u529e\u4e8b\u5b9c\uff0c\u7070\u8272new\u6807\u8bb0
	else if(complete.equals("5")){
        if(whereclause.equals("")) {
            whereclause += " t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=-1";
        }else{
		    whereclause += " and t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=-1";
        }
	}
    //complete=50\u8868\u793a\u5df2\u529e\u4e8b\u5b9c\uff0c\u7ea2\u8272new\u6807\u8bb0
	else if(complete.equals("50")){
        if(whereclause.equals("")) {
            whereclause += " t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=0 and (agentType<>'1' or agentType is null) ";
        }else{
		    whereclause += " and t2.isremark ='2'  and t2.iscomplete=0 and t2.islasttimes=1 and t2.viewtype=0 and (agentType<>'1' or agentType is null) ";
        }
	}
    //complete=6\u8868\u793a\u529e\u7ed3\u4e8b\u5b9c\uff0c\u7ea2\u8272new\u6807\u8bb0
	else if(complete.equals("6")){
        if(whereclause.equals("")) {
            whereclause += " t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=0";
        }else{
            whereclause += " and t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=0";
        }
	}
    //complete=7\u8868\u793a\u529e\u7ed3\u4e8b\u5b9c\uff0c\u7070\u8272new\u6807\u8bb0
	else if(complete.equals("7")){
        if(whereclause.equals("")) {
            whereclause += " t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=-1";
        }else{
            whereclause += " and t1.currentnodetype = 3 and islasttimes=1 and t2.viewtype=-1";
        }
	}
    //complete=8\u8868\u793a\u8d85\u65f6\u4e8b\u5b9c\uff0c




	else if(complete.equals("8")){
        if(whereclause.equals("")) {
            whereclause +=" and ((t2.isremark='0' and (t2.isprocessed='2' or t2.isprocessed='3'))  or t2.isremark='5') and t1.currentnodetype <> 3 ";
        }else{
            whereclause +=" and ((t2.isremark='0' and (t2.isprocessed='2' or t2.isprocessed='3'))  or t2.isremark='5') and t1.currentnodetype <> 3 ";
        }
	}
    SearchClause.setWhereClause(whereclause);
    SearchClause.setWhereclauseOs(whereclause2);
    if(complete.equals("0")||complete.equals("3")||complete.equals("4")){
        orderclause="t2.receivedate ,t2.receivetime ";
        orderclause2=orderclause;
    }else if(complete.equals("1") ||complete.equals("2")||complete.equals("5")||complete.equals("6")||complete.equals("7")||complete.equals("8")){
        //orderclause="t2.receivedate ,t2.receivetime ";
        orderclause="operatedate, operatetime ";
        orderclause2=orderclause;
    }
    SearchClause.setOrderClause(orderclause);
    SearchClause.setOrderClause2(orderclause2);
  if(complete.equals("0") || complete.equals("3") || complete.equals("4"))//modified by cyril on 2008-07-15 for td:8939 complete=3\u8868\u793a\u65b0\u5230\u6d41\u7a0b
	  sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&iswaitdo=1&date2during="+date2during+"&viewType="+viewType+"&processing="+processing);
  else
    sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&start=1&date2during="+date2during+"&viewType="+viewType+"&processing"+processing);
	return;
}














String createrid=Util.null2String(request.getParameter("createrid"));
String docids=Util.null2String(request.getParameter("docids"));
String crmids=Util.null2String(request.getParameter("crmids"));
String hrmids=Util.null2String(request.getParameter("hrmids"));
String prjids=Util.null2String(request.getParameter("prjids"));
String creatertype=Util.null2String(request.getParameter("creatertype"));
String workflowid=Util.null2String(request.getParameter("workflowid"));
String nodetype=Util.null2String(request.getParameter("nodetype"));
String fromdate=Util.null2String(request.getParameter("fromdate"));
String todate=Util.null2String(request.getParameter("todate"));
String lastfromdate=Util.null2String(request.getParameter("lastfromdate"));
String lasttodate=Util.null2String(request.getParameter("lasttodate"));
String requestmark=Util.null2String(request.getParameter("requestmark"));
String branchid=Util.null2String(request.getParameter("branchid"));
if (!branchid.equals("")) session.setAttribute("branchid",branchid);
int during=Util.getIntValue(request.getParameter("during"),0);
int order=Util.getIntValue(request.getParameter("order"),0);
int isdeleted=Util.getIntValue(request.getParameter("isdeleted"),0);
String requestname=Util.fromScreen2(request.getParameter("requestname"),user.getLanguage());
requestname=requestname.trim();
int subday1=Util.getIntValue(request.getParameter("subday1"),0);
int subday2=Util.getIntValue(request.getParameter("subday2"),0);
int maxday=Util.getIntValue(request.getParameter("maxday"),0);
int state=Util.getIntValue(request.getParameter("state"),0);
String requestlevel=Util.fromScreen(request.getParameter("requestlevel"),user.getLanguage());
//add by xhheng @20050414 for TD 1545
int iswaitdo= Util.getIntValue(request.getParameter("iswaitdo"),0) ;

Calendar now = Calendar.getInstance();
String today=Util.add0(now.get(Calendar.YEAR), 4) +"-"+
	Util.add0(now.get(Calendar.MONTH) + 1, 2) +"-"+
        Util.add0(now.get(Calendar.DAY_OF_MONTH), 2) ;
int year=now.get(Calendar.YEAR);
int month=now.get(Calendar.MONTH);
int day=now.get(Calendar.DAY_OF_MONTH);

Date newdate = new Date() ;
long datetime = newdate.getTime() ;
Timestamp timestamp = new Timestamp(datetime) ;
String CurrentTime = (timestamp.toString()).substring(11,13) + ":" + (timestamp.toString()).substring(14,16) + ":" +(timestamp.toString()).substring(17,19);


if(!createrid.equals("")){
	if(whereclause.equals("")) {whereclause+=" t1.creater='"+createrid+"'";}
	else {whereclause+=" and t1.creater='"+createrid+"'";}
	if(!creatertype.equals("")){
		if(whereclause.equals("")) {whereclause+=" t1.creatertype='"+creatertype+"'";}
		else {whereclause+=" and t1.creatertype='"+creatertype+"'";}
	}
}

//\u6dfb\u52a0\u9644\u4ef6\u4e0a\u4f20\u6587\u6863\u7684\u67e5\u8be2




if(!docids.equals("")){
    RecordSet.executeSql("select fieldname from workflow_formdict where fieldhtmltype=6 ");
}

if( isoracle ) {
    if(!docids.equals("")){
        if(whereclause.equals("")) {whereclause+=" ((concat(concat(',' , To_char(t1.docids)) , ',') LIKE '%,"+docids+",%') ";}
        else {whereclause+=" and ((concat(concat(',' , To_char(t1.docids)) , ',') LIKE '%,"+docids+",%') ";}
        while(RecordSet.next()){
            String fieldname=RecordSet.getString("fieldname");
            whereclause+=" or (concat(concat(',' , To_char(t4."+fieldname+")) , ',') LIKE '%,"+docids+",%') ";
        }
        whereclause+=") ";
    }
    if(!crmids.equals("")){
        if(whereclause.equals("")) {whereclause+=" (concat(concat(',' , To_char(t1.crmids)) , ',') LIKE '%,"+crmids+",%') ";}
        else {whereclause+=" and (concat(concat(',' , To_char(t1.crmids)) , ',') LIKE '%,"+crmids+",%') ";}
    }
    if(!hrmids.equals("")){
        if(whereclause.equals("")) {whereclause+=" (concat(concat(',' , To_char(t1.hrmids)) , ',') LIKE '%,"+hrmids+",%') ";}
        else {whereclause+=" and (concat(concat(',' , To_char(t1.hrmids)) , ',') LIKE '%,"+hrmids+",%') ";}
    }
    if(!prjids.equals("")){
        if(whereclause.equals("")) {whereclause+=" (concat(concat(',' , To_char(t1.prjids)) , ',') LIKE '%,"+prjids+",%') ";}
        else {whereclause+=" and (concat(concat(',' , To_char(t1.prjids)) , ',') LIKE '%,"+prjids+",%') ";}
    }
}else if( isdb2 ) {
    if(!docids.equals("")){
        if(whereclause.equals("")) {whereclause+=" ((concat(concat(',' , varchar(t1.docids)) , ',') LIKE '%,"+docids+",%') ";}
        else {whereclause+=" and ((concat(concat(',' , varchar(t1.docids)) , ',') LIKE '%,"+docids+",%') ";}
        while(RecordSet.next()){
            String fieldname=RecordSet.getString("fieldname");
            whereclause+=" or (concat(concat(',' , varchar(t4."+fieldname+")) , ',') LIKE '%,"+docids+",%') ";
        }
        whereclause+=") ";
    }
    if(!crmids.equals("")){
        if(whereclause.equals("")) {whereclause+=" (concat(concat(',' , varchar(t1.crmids)) , ',') LIKE '%,"+crmids+",%') ";}
        else {whereclause+=" and (concat(concat(',' , varchar(t1.crmids)) , ',') LIKE '%,"+crmids+",%') ";}
    }
    if(!hrmids.equals("")){
        if(whereclause.equals("")) {whereclause+=" (concat(concat(',' , varchar(t1.hrmids)) , ',') LIKE '%,"+hrmids+",%') ";}
        else {whereclause+=" and (concat(concat(',' , varchar(t1.hrmids)) , ',') LIKE '%,"+hrmids+",%') ";}
    }
    if(!prjids.equals("")){
        if(whereclause.equals("")) {whereclause+=" (concat(concat(',' , varchar(t1.prjids)) , ',') LIKE '%,"+prjids+",%') ";}
        else {whereclause+=" and (concat(concat(',' , varchar(t1.prjids)) , ',') LIKE '%,"+prjids+",%') ";}
    }
}
else {
    if(!docids.equals("")){
        if(whereclause.equals("")) {whereclause+=" ((',' + CONVERT(varchar,t1.docids) + ',' LIKE '%,"+docids+",%') ";}
        else {whereclause+=" and ((',' + CONVERT(varchar,t1.docids) + ',' LIKE '%,"+docids+",%') ";}
        while(RecordSet.next()){
            String fieldname=RecordSet.getString("fieldname");
            whereclause+=" or (',' + CONVERT(varchar,t4."+fieldname+") + ',' LIKE '%,"+docids+",%') ";
        }
        whereclause+=") ";
    }
    if(!crmids.equals("")){
        if(whereclause.equals("")) {whereclause+=" (',' + CONVERT(varchar,t1.crmids) + ',' LIKE '%,"+crmids+",%') ";}
        else {whereclause+=" and (',' + CONVERT(varchar,t1.crmids) + ',' LIKE '%,"+crmids+",%') ";}
    }
    if(!hrmids.equals("")){
        if(whereclause.equals("")) {whereclause+=" (',' + CONVERT(varchar,t1.hrmids) + ',' LIKE '%,"+hrmids+",%') ";}
        else {whereclause+=" and (',' + CONVERT(varchar,t1.hrmids) + ',' LIKE '%,"+hrmids+",%') ";}
    }
    if(!prjids.equals("")){
        if(whereclause.equals("")) {whereclause+=" (',' + CONVERT(varchar,t1.prjids) + ',' LIKE '%,"+prjids+",%') ";}
        else {whereclause+=" and (',' + CONVERT(varchar,t1.prjids) + ',' LIKE '%,"+prjids+",%') ";}
    }
}
if(!workflowid.equals("")){
	if(whereclause.equals("")) 
	{whereclause+=" t1.workflowid in("+ WorkflowVersion.getAllVersionStringByWFIDs(workflowid) +")";}
	else 
	{
	 /*--xwj for td2045 on 2005-05-26 --\u67e5\u8be2\u6d41\u7a0b\u65f6, \u540c\u65f6\u9009\u62e9\u6d41\u7a0b\u7c7b\u578b\u548c\u521b\u5efa\u4eba\u65f6\u51fa\u9519*/
	 //whereclause+=" and t1.workflowid in("+workflowid+")";
	 whereclause = "t1.workflowid in("+ WorkflowVersion.getAllVersionStringByWFIDs(workflowid) + ") and " + whereclause; 
	}
}
if(!cdepartmentid.equals("")){
    String tempWhere = "";
    ArrayList tempArr = Util.TokenizerString(cdepartmentid,",");
    for(int i=0;i<tempArr.size();i++){
        String tempcdepartmentid = (String)tempArr.get(i);
        if(tempWhere.equals("")) tempWhere += "departmentid="+tempcdepartmentid;
        else tempWhere += " or departmentid="+tempcdepartmentid;
    }
    if(!tempWhere.equals("")){
        if(whereclause.equals("")) {whereclause+=" exists(select 1 from hrmresource where t1.creater=id and t1.creatertype='0' and ("+tempWhere+"))";}
        else {whereclause+=" and exists(select 1 from hrmresource where t1.creater=id and t1.creatertype='0' and ("+tempWhere+"))";}
    }
}
whereclause += WorkflowComInfo.getDateDuringSql(date2during);
if(!requestname.equals("")){
	if(whereclause.equals("")) {whereclause+=" t1.requestname like '%"+requestname+"%'";}
	else {whereclause+=" and t1.requestname like '%"+requestname+"%'";}
}
if(!nodetype.equals("")){
	if(whereclause.equals("")) {whereclause+=" t1.currentnodetype='"+nodetype+"'";}
	else {whereclause+=" and t1.currentnodetype='"+nodetype+"'";}
}
if(!requestmark.equals("")){
	if(whereclause.equals("")) {whereclause+=" t1.requestmark like '%"+requestmark+"%'";}
	else {whereclause+=" and t1.requestmark like '%"+requestmark+"%'";}
}

if(!lastfromdate.equals("")){
	if(whereclause.equals("")) {whereclause+=" t1.lastoperatedate>='"+lastfromdate+"'";}
	else {whereclause+=" and t1.lastoperatedate>='"+lastfromdate+"'";}
}
if(!lasttodate.equals("")){
	if(whereclause.equals("")) {whereclause+=" t1.lastoperatedate<='"+lasttodate+"'";}
	else {whereclause+=" and t1.lastoperatedate<='"+lasttodate+"'";}
}
if(during==0){
	if(!fromdate.equals("")){
		if(whereclause.equals("")){whereclause+=" t1.createdate>='"+fromdate+"'";}
		else {whereclause+=" and t1.createdate>='"+fromdate+"'";}
	}
	if(!todate.equals("")){
		if(whereclause.equals("")){whereclause+=" t1.createdate<='"+todate+"'";}
		else {whereclause+=" and t1.createdate<='"+todate+"'";}
	}
}
else{
	if(during==1){
		if(whereclause.equals(""))	whereclause+=" t1.createdate='"+today+"'";
		else  whereclause+=" and t1.createdate='"+today+"'";
	}
	if(during==2){
		Calendar tempday = Calendar.getInstance();
		tempday.clear();
		tempday.set(year,month,day-1);
		String lastday=Util.add0(tempday.get(Calendar.YEAR), 4) +"-"+
			Util.add0(tempday.get(Calendar.MONTH) + 1, 2) +"-"+
        		Util.add0(tempday.get(Calendar.DAY_OF_MONTH), 2) ;
        /* \u5218\u715c 2004\uff0d05\uff0d08 \u4fee\u6539\uff0c\u539f\u6765or \u4e4b\u95f4\u6ca1\u6709\u62ec\u53f7\uff0c\u9020\u6210\u7cfb\u7edf\u6b7b\u673a */
		if(whereclause.equals(""))	
			whereclause+=" ((t1.createdate='"+today+"' and t1.createtime<='"+CurrentTime+"')"+
			 " or (t1.createdate='"+lastday+"' and t1.createtime>='"+CurrentTime+"')) ";
		else  
			whereclause+=" and ((t1.createdate='"+today+"' and t1.createtime<='"+CurrentTime+"')"+
			 " or (t1.createdate='"+lastday+"' and t1.createtime>='"+CurrentTime+"')) ";
	}
	if(during==3){
		int days=now.getTime().getDay();
		Calendar tempday = Calendar.getInstance();
		tempday.clear();
		tempday.set(year,month,day-days);
		String lastday=Util.add0(tempday.get(Calendar.YEAR), 4) +"-"+
			Util.add0(tempday.get(Calendar.MONTH) + 1, 2) +"-"+
        		Util.add0(tempday.get(Calendar.DAY_OF_MONTH), 2) ;
        	if(whereclause.equals(""))
        		whereclause+=" t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
        	else
        		whereclause+=" and t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
	}
	if(during==4){
		Calendar tempday = Calendar.getInstance();
		tempday.clear();
		tempday.set(year,month,day-7);
		String lastday=Util.add0(tempday.get(Calendar.YEAR), 4) +"-"+
			Util.add0(tempday.get(Calendar.MONTH) + 1, 2) +"-"+
        		Util.add0(tempday.get(Calendar.DAY_OF_MONTH), 2) ;
        	if(whereclause.equals(""))
        		whereclause+=" t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
        	else
        		whereclause+=" and t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
	}
	if(during==5){
		Calendar tempday = Calendar.getInstance();
		tempday.clear();
		tempday.set(year,month,1);
		String lastday=Util.add0(tempday.get(Calendar.YEAR), 4) +"-"+
			Util.add0(tempday.get(Calendar.MONTH) + 1, 2) +"-"+
        		Util.add0(tempday.get(Calendar.DAY_OF_MONTH), 2) ;
        	if(whereclause.equals(""))
        		whereclause+=" t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
        	else
        		whereclause+=" and t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
	}
	if(during==6){
		Calendar tempday = Calendar.getInstance();
		tempday.clear();
		tempday.set(year,month,day-30);
		String lastday=Util.add0(tempday.get(Calendar.YEAR), 4) +"-"+
			Util.add0(tempday.get(Calendar.MONTH) + 1, 2) +"-"+
        		Util.add0(tempday.get(Calendar.DAY_OF_MONTH), 2) ;
        	if(whereclause.equals(""))
        		whereclause+=" t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
        	else
        		whereclause+=" and t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
	}
	if(during==7){
		Calendar tempday = Calendar.getInstance();
		tempday.clear();
		tempday.set(year,0,1);
		String lastday=Util.add0(tempday.get(Calendar.YEAR), 4) +"-"+
			Util.add0(tempday.get(Calendar.MONTH) + 1, 2) +"-"+
        		Util.add0(tempday.get(Calendar.DAY_OF_MONTH), 2) ;
        	if(whereclause.equals(""))
        		whereclause+=" t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
        	else
        		whereclause+=" and t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
	}
	if(during==8){
		Calendar tempday = Calendar.getInstance();
		tempday.clear();
		tempday.set(year,month,day-365);
		String lastday=Util.add0(tempday.get(Calendar.YEAR), 4) +"-"+
			Util.add0(tempday.get(Calendar.MONTH) + 1, 2) +"-"+
        		Util.add0(tempday.get(Calendar.DAY_OF_MONTH), 2) ;
        	if(whereclause.equals(""))
        		whereclause+=" t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
        	else
        		whereclause+=" and t1.createdate<='"+today+"' and t1.createdate>='"+lastday+"'";
	}
		
}

if( isoracle ) {
    if(subday1!=0){
        if(whereclause.equals(""))	
            whereclause+="  (to_date(t1.lastoperatedate,'YYYY-MM-DD')-to_date(t1.createdate,'YYYY-MM-DD'))>"+subday1;
        else
            whereclause+=" and (to_date(t1.lastoperatedate,'YYYY-MM-DD')-to_date(t1.createdate,'YYYY-MM-DD'))>"+subday1;
    }

    if(subday2!=0){
        if(whereclause.equals(""))	
            whereclause+="  (to_date(t1.lastoperatedate,'YYYY-MM-DD')-to_date(t1.createdate,'YYYY-MM-DD'))<="+subday2;
        else
            whereclause+=" and (to_date(t1.lastoperatedate,'YYYY-MM-DD')-to_date(t1.createdate,'YYYY-MM-DD'))<="+subday2;
    }

    if(maxday!=0){
        if(whereclause.equals(""))	
            whereclause+="  (to_date(t1.lastoperatedate,'YYYY-MM-DD')-to_date(t1.createdate,'YYYY-MM-DD'))="+maxday;
        else
            whereclause+=" and (to_date(t1.lastoperatedate,'YYYY-MM-DD')-to_date(t1.createdate,'YYYY-MM-DD'))="+maxday;
    }
}else if( isdb2 ) {
    if(subday1!=0){
        if(whereclause.equals(""))	
            whereclause+="  (date(t1.lastoperatedate,'YYYY-MM-DD')-date(t1.createdate,'YYYY-MM-DD'))>"+subday1;
        else
            whereclause+=" and (date(t1.lastoperatedate,'YYYY-MM-DD')-date(t1.createdate,'YYYY-MM-DD'))>"+subday1;
    }

    if(subday2!=0){
        if(whereclause.equals(""))	
            whereclause+="  (date(t1.lastoperatedate,'YYYY-MM-DD')-date(t1.createdate,'YYYY-MM-DD'))<="+subday2;
        else
            whereclause+=" and (date(t1.lastoperatedate,'YYYY-MM-DD')-date(t1.createdate,'YYYY-MM-DD'))<="+subday2;
    }

    if(maxday!=0){
        if(whereclause.equals(""))	
            whereclause+="  (date(t1.lastoperatedate,'YYYY-MM-DD')-date(t1.createdate,'YYYY-MM-DD'))="+maxday;
        else
            whereclause+=" and (date(t1.lastoperatedate,'YYYY-MM-DD')-date(t1.createdate,'YYYY-MM-DD'))="+maxday;
    }
}
else {
    if(subday1!=0){
        if(whereclause.equals(""))	
            whereclause+="  (convert(datetime,t1.lastoperatedate)-convert(datetime,t1.createdate))>"+subday1;
        else
            whereclause+=" and (convert(datetime,t1.lastoperatedate)-convert(datetime,t1.createdate))>"+subday1;
    }

    if(subday2!=0){
        if(whereclause.equals(""))	
            whereclause+="  (convert(datetime,t1.lastoperatedate)-convert(datetime,t1.createdate))<="+subday2;
        else
            whereclause+=" and (convert(datetime,t1.lastoperatedate)-convert(datetime,t1.createdate))<="+subday2;
    }

    if(maxday!=0){
        if(whereclause.equals(""))	
            whereclause+=" (convert(datetime,t1.lastoperatedate)-convert(datetime,t1.createdate))="+maxday;
        else
            whereclause+=" and (convert(datetime,t1.lastoperatedate)-convert(datetime,t1.createdate))="+maxday;
    }
}

if(state==1){
	if(whereclause.equals("")) {whereclause+=" t1.currentnodetype='3'";}
	else {whereclause+=" and t1.currentnodetype='3'";}
}
if(state==2){
	if(whereclause.equals("")) {whereclause+=" t1.currentnodetype<>'3'";}
	else {whereclause+=" and t1.currentnodetype<>'3'";}
}

if(isdeleted!=2){
	if(whereclause.equals(""))	{
        if(isdeleted == 0) whereclause+=" (exists (select 1 from workflow_base where (isvalid=1 or isvalid=3) and workflow_base.id=t2.workflowid)) ";
        else whereclause += " exists (select 1 from workflow_base where (isvalid=0  or isvalid is null) and workflow_base.id=t2.workflowid) ";
    }
	else {
        if(isdeleted == 0) whereclause+=" and (exists (select 1 from workflow_base where (isvalid=1 or isvalid=3) and workflow_base.id=t2.workflowid)) ";
        else whereclause+=" and exists (select 1 from workflow_base where (isvalid=0  or isvalid is null) and workflow_base.id=t2.workflowid) ";
    }
}

if(!requestlevel.equals("")){
	if(whereclause.equals(""))	whereclause+=" t1.requestlevel="+requestlevel;
	else	whereclause+=" and t1.requestlevel="+requestlevel;
}


if(whereclause.equals("")) whereclause+="  islasttimes=1 ";
else whereclause+=" and islasttimes=1 ";

orderclause="t2.receivedate ,t2.receivetime";
orderclause2="t2.receivedate ,t2.receivetime";

SearchClause.setOrderClause(orderclause);
SearchClause.setOrderClause2(orderclause2);
SearchClause.setWhereClause(whereclause);

SearchClause.setWorkflowId(workflowid);
SearchClause.setNodeType(nodetype);
SearchClause.setFromDate(fromdate);
SearchClause.setToDate(todate);
SearchClause.setCreaterType(creatertype);
SearchClause.setCreaterId(createrid);
SearchClause.setRequestLevel(requestlevel);
SearchClause.setDepartmentid(cdepartmentid);
sendRedirect(out,request,response,"WFSearchResult.jsp?resourceid=" + resourceid + "&needHeader=" + needHeader  + "&query=1&pagenum=1&iswaitdo="+iswaitdo+"&docids="+docids+"&date2during="+date2during+"&viewType="+viewType);



      out.write(_jsp_string66, 0, _jsp_string66.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("workflow/search/WFSearchTemp.jsp"), -170679023836158228L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("systeminfo/init_wev8.jsp"), 2425449460466103212L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("wui/common/page/initWui.jsp"), 3390533274175540290L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string20;
  private final static char []_jsp_string21;
  private final static char []_jsp_string63;
  private final static char []_jsp_string8;
  private final static char []_jsp_string32;
  private final static char []_jsp_string48;
  private final static char []_jsp_string38;
  private final static char []_jsp_string43;
  private final static char []_jsp_string54;
  private final static char []_jsp_string19;
  private final static char []_jsp_string16;
  private final static char []_jsp_string18;
  private final static char []_jsp_string12;
  private final static char []_jsp_string56;
  private final static char []_jsp_string17;
  private final static char []_jsp_string61;
  private final static char []_jsp_string44;
  private final static char []_jsp_string6;
  private final static char []_jsp_string46;
  private final static char []_jsp_string5;
  private final static char []_jsp_string51;
  private final static char []_jsp_string14;
  private final static char []_jsp_string27;
  private final static char []_jsp_string57;
  private final static char []_jsp_string64;
  private final static char []_jsp_string34;
  private final static char []_jsp_string11;
  private final static char []_jsp_string0;
  private final static char []_jsp_string25;
  private final static char []_jsp_string9;
  private final static char []_jsp_string42;
  private final static char []_jsp_string7;
  private final static char []_jsp_string33;
  private final static char []_jsp_string65;
  private final static char []_jsp_string45;
  private final static char []_jsp_string30;
  private final static char []_jsp_string3;
  private final static char []_jsp_string31;
  private final static char []_jsp_string36;
  private final static char []_jsp_string66;
  private final static char []_jsp_string26;
  private final static char []_jsp_string52;
  private final static char []_jsp_string47;
  private final static char []_jsp_string55;
  private final static char []_jsp_string37;
  private final static char []_jsp_string15;
  private final static char []_jsp_string62;
  private final static char []_jsp_string41;
  private final static char []_jsp_string1;
  private final static char []_jsp_string13;
  private final static char []_jsp_string35;
  private final static char []_jsp_string4;
  private final static char []_jsp_string50;
  private final static char []_jsp_string23;
  private final static char []_jsp_string53;
  private final static char []_jsp_string10;
  private final static char []_jsp_string49;
  private final static char []_jsp_string40;
  private final static char []_jsp_string22;
  private final static char []_jsp_string29;
  private final static char []_jsp_string58;
  private final static char []_jsp_string60;
  private final static char []_jsp_string59;
  private final static char []_jsp_string28;
  private final static char []_jsp_string24;
  private final static char []_jsp_string39;
  private final static char []_jsp_string2;
  static {
    _jsp_string20 = "&f_weaver_belongto_usertype=".toCharArray();
    _jsp_string21 = "\";\r\n	    xmlhttp.open(\"GET\",URL, false);\r\n	    xmlhttp.send(null);\r\n	    var result = xmlhttp.status;\r\n	    if(result==200) {\r\n		    isconn = true;\r\n	    	var response_flag = xmlhttp.responseText;\r\n	    	if(response_flag!='0') {\r\n	    		var flag_msg = '';\r\n	    		if(response_flag=='1') {\r\n	    			var diag = new Dialog();\r\n					diag.Width = 300;\r\n					diag.Height = 180;\r\n					diag.ShowCloseButton=false;\r\n					diag.Title = \"".toCharArray();
    _jsp_string63 = "\";\r\n//\u5f53\u524d\u4e3b\u9898\u4f7f\u7528\u7684\u76ae\u80a4\r\nvar GLOBAL_SKINS_FOLDER = \"".toCharArray();
    _jsp_string8 = "\r\n<script type=\"text/javascript\" src=\"/js/select/script/jquery-1.8.3.min_wev8.js\"></script>	    \r\n".toCharArray();
    _jsp_string32 = "\", function () {\r\n						    formElementFocus(tempElement);						\r\n							});\r\n						}\r\n						return false;\r\n					}else{\r\n						if(window.__oriAlert__){\r\n							try{\r\n								window.top.Dialog.alert(\"".toCharArray();
    _jsp_string48 = "\";\r\ndoCheckusb();\r\n</script>\r\n".toCharArray();
    _jsp_string38 = "\");\r\n						}else{\r\n							window.top.Dialog.alert(\"".toCharArray();
    _jsp_string43 = "\";\r\n\r\n  if(companyname.length >0 ){\r\n  	window.status = str1+companyname;\r\n  }\r\n</script>\r\n<!-- \u5220\u9664 -->\r\n</head></html>\r\n\r\n<!--USB \u9a8c\u8bc1 -->\r\n".toCharArray();
    _jsp_string54 = "\r\n<!--For wui-->\r\n<link type='text/css' rel='stylesheet'  href='/wui/theme/".toCharArray();
    _jsp_string19 = "&time=\"+new Date()+\"&f_weaver_belongto_userid=".toCharArray();
    _jsp_string16 = "');\r\n}\r\n\r\nfunction _onViewLog(operateitem,sqlwhere,id){\r\n	if(!sqlwhere)sqlwhere = \"\";\r\n	var dialog = new window.top.Dialog();\r\n	dialog.currentWindow = window;\r\n	dialog.Title = \"".toCharArray();
    _jsp_string18 = "\";\r\n		}\r\n	}\r\n	dialog.Width = jQuery(window).width();\r\n	dialog.Height = 610;\r\n	dialog.Drag = true;\r\n	dialog.checkDataChange = false;\r\n	dialog.maxiumnable = true;\r\n	dialog.URL = url;\r\n	dialog.show();\r\n}\r\n\r\n\r\nfunction check_form(thiswins,items)\r\n{\r\n	/* added by cyril on 2008-08-14 for td:8521 */\r\n	var isconn = false;\r\n	try {\r\n		var xmlhttp;\r\n	    if (window.XMLHttpRequest) {\r\n	    	xmlhttp = new XMLHttpRequest();\r\n	    }  \r\n	    else if (window.ActiveXObject) {\r\n	    	xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\");  \r\n	    }\r\n	    var URL = \"/systeminfo/CheckConn.jsp?userid=".toCharArray();
    _jsp_string12 = "\r\n<!-- js \u6574\u5408\u5230 init_wev8.js -->\r\n<script type=\"text/javascript\" src=\"/js/jquery.table_wev8.js\"></script>\r\n<script language=\"javascript\" type=\"text/javascript\" src=\"/js/init_wev8.js\"></script>\r\n<script language=\"javascript\"  src=\"/js/wbusb_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/jquery/plugins/client/jquery.client_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/ecology8/jNice/jNice/jquery.jNice_wev8.js\"></script>\r\n<script type='text/javascript' src='/js/jquery-autocomplete/jquery.autocomplete_wev8.js'></script>\r\n<script type='text/javascript' src='/js/jquery-autocomplete/browser_wev8.js'></script>\r\n<script language=javascript src=\"/wui/theme/ecology8/jquery/js/zDialog_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/ecology8/request/hoverBtn_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/ecology8/lang/weaver_lang_".toCharArray();
    _jsp_string56 = "/wui_wev8.css'/>\r\n".toCharArray();
    _jsp_string17 = "\";\r\n	var url = \"/docs/tabs/DocCommonTab.jsp?_fromURL=3&operateitem=\"+operateitem+\"&sqlwhere=\"+sqlwhere;\r\n	if(id){\r\n		url = \"/docs/tabs/DocCommonTab.jsp?_fromURL=3&relatedid=\"+id+\"&operateitem=\"+operateitem+\"&sqlwhere=\"+sqlwhere;\r\n		if(operateitem==418||operateitem==419||operateitem==420){\r\n			dialog.Title = \"".toCharArray();
    _jsp_string61 = ")\">\r\n".toCharArray();
    _jsp_string44 = "\r\n<script language=javascript>\r\nubsfirmcode0 = ".toCharArray();
    _jsp_string6 = "\r\n\r\n\r\n<script language=javascript>;\r\ntop.Dialog.alert(\"".toCharArray();
    _jsp_string46 = ";\r\nusbserial0 = \"".toCharArray();
    _jsp_string5 = "\";\r\n		});		\r\n	</script>\r\n	".toCharArray();
    _jsp_string51 = "\r\n}\r\n\r\nfunction doScannerEscape(ev, obj){\r\n	IMCarousel.doScannerEscape(ev, obj);\r\n}\r\n\r\nfunction scaleImg(obj, tag){\r\n	IMCarousel.scaleImg(obj, tag);\r\n}\r\n\r\nfunction rotateImg(obj){\r\n	IMCarousel.rotateImg(obj);\r\n}\r\n\r\nfunction downloadImg(obj){\r\n	IMCarousel.downloadImg(obj);\r\n}\r\n\r\nfunction slideImg(obj, direction){\r\n	IMCarousel.slideImg(obj, direction);\r\n}\r\n\r\nfunction showImgScanner(ev, isShow, id){\r\n	IMCarousel.showImgScanner(ev, isShow, id);\r\n}\r\n\r\nfunction downloads(id){\r\n	document.location.href=\"/weaver/weaver.file.FileDownload?fileid=\"+id+\"&download=1\";\r\n}\r\n</script>\r\n".toCharArray();
    _jsp_string14 = "\";\r\nfunction check_conn() {\r\n	return confirm('".toCharArray();
    _jsp_string27 = "\r\n	    try {\r\n		    var lenck = true;\r\n		    var tempfieldvlaue = document.getElementById(\"htmlfieldids\").value;\r\n		    while(true) {\r\n			    var tempfield = tempfieldvlaue.substring(0, tempfieldvlaue.indexOf(\",\"));\r\n			    tempfieldvlaue = tempfieldvlaue.substring(tempfieldvlaue.indexOf(\",\")+1);\r\n			    var fieldid = tempfield.substring(0, tempfield.indexOf(\";\"));\r\n			    var fieldname = tempfield.substring(tempfield.indexOf(\";\")+1);\r\n			    if(fieldname=='') break;\r\n			    if(!checkLengthOnly(fieldid,'4000',fieldname,'".toCharArray();
    _jsp_string57 = "\r\n\r\n\r\n<!-- \u5b57\u4f53\u8bbe\u7f6e\uff0cwin7\u3001vista\u7cfb\u7edf\u4f7f\u7528\u96c5\u9ed1\u5b57\u4f53,\u5176\u4ed6\u7cfb\u7edf\u4f7f\u7528\u5b8b\u4f53 Start -->\r\n<!--\r\n\u6dfb\u52a0\u81f3init_wev8.css \r\n<link type='text/css' rel='stylesheet'  href='/wui/common/css/w7OVFont_wev8.css' id=\"FONT2SYSTEMF\">\r\n -->\r\n<script language=\"javascript\"> \r\n/*\r\nif (jQuery.client.version< 6) {\r\n	document.getElementById('FONT2SYSTEMF').href = \"/wui/common/css/notW7AVFont_wev8.css\";\r\n}\r\n*/\r\n</script> \r\n<!-- \u5b57\u4f53\u8bbe\u7f6e\uff0cwin7\u3001vista\u7cfb\u7edf\u4f7f\u7528\u96c5\u9ed1\u5b57\u4f53,\u5176\u4ed6\u7cfb\u7edf\u4f7f\u7528\u5b8b\u4f53 End -->\r\n\r\n<!-- \u9875\u9762\u5207\u6362\u6548\u679cStart -->\r\n".toCharArray();
    _jsp_string64 = "\";\r\n</script>\r\n\r\n<!--For wuiForm-->\r\n<script type=\"text/javascript\" src=\"/wui/common/jquery/plugin/wuiform/jquery.wuiform_wev8.js\"></script>\r\n<script language=\"javascript\">\r\njQuery(document).ready(function(){\r\n	wuiform.init();\r\n});\r\n</script>\r\n".toCharArray();
    _jsp_string34 = "\");\r\n							}\r\n						}else{\r\n							try{\r\n								window.top.Dialog.alert(\"".toCharArray();
    _jsp_string11 = "\r\n<!-- IE\u4e0b\u4e13\u7528vbs\uff08\u4e34\u65f6\uff09 -->\r\n<script language=\"vbs\" src=\"/js/string2VbArray.vbs\"></script>        \r\n        ".toCharArray();
    _jsp_string0 = "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string25 = "';\r\n	   \r\n	    			return false;\r\n	    		}\r\n	    		flag_msg += '\\r\\n\\r\\n".toCharArray();
    _jsp_string9 = "\r\n<script type=\"text/javascript\" src=\"/wui/common/jquery/jquery.min_wev8.js\"></script>\r\n".toCharArray();
    _jsp_string42 = "\";\r\n  var str1 = \"".toCharArray();
    _jsp_string7 = "\",function(){\r\n	window.top.location=\"/login/Login.jsp\";\r\n});\r\n</script>\r\n".toCharArray();
    _jsp_string33 = "\");\r\n							}catch(e){\r\n								Dialog.alert(\"".toCharArray();
    _jsp_string65 = "\r\n\r\n\r\n".toCharArray();
    _jsp_string45 = ";\r\nusbusercode0 = ".toCharArray();
    _jsp_string30 = "\r\n	}\r\n	catch(e) {\r\n		return check_conn();\r\n	}\r\n	if(!isconn)\r\n		return check_conn();\r\n    /* end by cyril on 2008-08-14 for td:8521 */\r\n	\r\n	thiswin = thiswins\r\n	items = \",\"+items + \",\";\r\n	\r\n	var tempfieldvlaue1 = \"\";\r\n	try{\r\n		tempfieldvlaue1 = document.getElementById(\"htmlfieldids\").value;\r\n	}catch (e) {\r\n	}\r\n\r\n	for(i=1;i<=thiswin.length;i++){\r\n		tmpname = thiswin.elements[i-1].name;\r\n		tmpvalue = thiswin.elements[i-1].value;\r\n	    if(tmpvalue==null){\r\n	        continue;\r\n	    }\r\n\r\n		if(tmpname!=\"\" && items.indexOf(\",\"+tmpname+\",\")!=-1){		\r\n			var __fieldhtmltype = jQuery(\"input[name=\" + tmpname + \"]\").attr(\"__fieldhtmltype\");\r\n		    if (__fieldhtmltype == '9') {\r\n		        continue;\r\n		    }\r\n		\r\n			var href = location.href;\r\n			if(href && href.indexOf(\"Ext.jsp\")!=-1){\r\n				window.__oriAlert__ = true;\r\n			}\r\n			if(tempfieldvlaue1.indexOf(tmpname+\";\") == -1){\r\n				while(tmpvalue.indexOf(\" \") >= 0){\r\n					tmpvalue = tmpvalue.replace(\" \", \"\");\r\n				}\r\n				while(tmpvalue.indexOf(\"\\r\\n\") >= 0){\r\n					tmpvalue = tmpvalue.replace(\"\\r\\n\", \"\");\r\n				}\r\n\r\n				if(tmpvalue == \"\"){\r\n					if(thiswin.elements[i-1].getAttribute(\"temptitle\")!=null && thiswin.elements[i-1].getAttribute(\"temptitle\")!=\"\"){\r\n						if(window.__oriAlert__){\r\n							window.top.Dialog.alert(\"\\\"\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"\\\"\"+\"".toCharArray();
    _jsp_string3 = "\r\n	<script language=\"javascript\">\r\n		window.top.Dialog.alert(\"".toCharArray();
    _jsp_string31 = "\");\r\n						}else{\r\n							var tempElement = thiswin.elements[i-1];\r\n							//ueditor\u5fc5\u586b\u9a8c\u8bc1\r\n							if (checkueditorContent(tempElement)) {\r\n								continue;\r\n							}\r\n							\r\n							window.top.Dialog.alert(\"&quot;\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"&quot;\"+\"".toCharArray();
    _jsp_string36 = "\");\r\n						}else{\r\n							var tempElement = thiswin.elements[i-1];\r\n							\r\n							//ueditor\u5fc5\u586b\u9a8c\u8bc1\r\n							if (checkueditorContent(tempElement)) {\r\n								continue;\r\n							}\r\n							\r\n							window.top.Dialog.alert(\"&quot;\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"&quot;\"+\"".toCharArray();
    _jsp_string66 = "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n	\r\n".toCharArray();
    _jsp_string26 = "';\r\n	        	//alert(xmlhttp.responseText);\r\n	        	return confirm(flag_msg);\r\n	        }\r\n	    }\r\n	    xmlhttp = null;\r\n\r\n	  	//\u68c0\u67e5\u591a\u884c\u6587\u672c\u6846 oracle\u4e0b\u68c0\u67e5HTML\u4e0d\u80fd\u8d85\u8fc74000\u4e2a\u5b57\u7b26\r\n	    ".toCharArray();
    _jsp_string52 = "\r\n\r\n\r\n<!--For wui-->\r\n".toCharArray();
    _jsp_string47 = "\";\r\nusblanguage = \"".toCharArray();
    _jsp_string55 = "/skins/".toCharArray();
    _jsp_string37 = "\", function () {\r\n								formElementFocus(tempElement);\r\n							});\r\n							\r\n						}\r\n						return false;\r\n					}else{\r\n						if(window.__oriAlert__){\r\n							window.top.Dialog.alert(\"".toCharArray();
    _jsp_string15 = "\\r\\n\\r\\n".toCharArray();
    _jsp_string62 = "\r\n<!-- \u9875\u9762\u5207\u6362\u6548\u679cEnd -->\r\n\r\n\r\n<script language=\"javascript\">\r\n\r\n//------------------------------\r\n// the folder of current skins \r\n//------------------------------\r\n//\u5f53\u524d\u4f7f\u7528\u7684\u4e3b\u9898\r\nvar GLOBAL_CURRENT_THEME = \"".toCharArray();
    _jsp_string41 = "\";\r\n   if(!confirm(str)){\r\n       return false;\r\n   }\r\n       return true;\r\n   } \r\n\r\n///*\u6d41\u7a0b\u91cc\u9762\u4f7f\u7528\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u6d41\u7a0b\u5185\u5bb9\u653e\u5230iframe\u91cc\u9762\uff0c\u901a\u8fc7response\u8fd4\u56de\u7684\u65f6\u5019\uff0c\u8981\u8fd4\u56de\u7684\u5230\u5176\u7236\u7a97\u53e3*/\r\nfunction wfforward(wfurl){\r\n	parent.location.href = wfurl;\r\n}\r\n\r\nfunction myescapecode(str)\r\n{\r\n	return encodeURIComponent(str);\r\n}\r\n</script>\r\n\r\n\r\n\r\n<meta http-equiv=Content-Type content=\"text/html; charset=UTF-8\">\r\n<script language=JavaScript> \r\n  var companyname = \"".toCharArray();
    _jsp_string1 = "\r\n<!DOCTYPE HTML>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<html>\r\n<head>\r\n<!-- \r\n\u6dfb\u52a0\u81f3init.css\r\n<style type=\"text/css\">\r\n	html{height:100%;}\r\n</style>\r\n -->\r\n".toCharArray();
    _jsp_string13 = "_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/messagejs/highslide/highslide-full_wev8.js\"></script>\r\n<script type=\"text/javascript\">\r\n    hs.graphicsDir = '/js/messagejs/highslide/graphics/';\r\n    hs.align = 'center';\r\n    hs.transitions = ['expand', 'crossfade'];\r\n    hs.outlineType = 'rounded-white';\r\n    hs.fadeInOut = true;\r\n</script>\r\n<!-- init.css, \u6240\u6709css\u6587\u4ef6\u90fd\u5728\u6b64\u6587\u4ef6\u4e2d\u5f15\u5165 -->\r\n<link rel=\"stylesheet\" href=\"/css/init_wev8.css\" type=\"text/css\" />\r\n\r\n\r\n<script language=javascript>\r\nwindow[\"_jsessionid\"] = \"".toCharArray();
    _jsp_string35 = "\");\r\n							}\r\n						}\r\n						return false;\r\n					}\r\n				}\r\n			} else {\r\n				var divttt=document.createElement(\"div\");\r\n				divttt.innerHTML = tmpvalue;\r\n				var tmpvaluettt = jQuery.trim(jQuery(divttt).text());\r\n				if(tmpvaluettt == \"\"){\r\n					if(thiswin.elements[i-1].getAttribute(\"temptitle\")!=null && thiswin.elements[i-1].getAttribute(\"temptitle\")!=\"\"){\r\n						if(window.__oriAlert__){\r\n							window.top.Dialog.alert(\"\\\";\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"\\\"\"+\"".toCharArray();
    _jsp_string4 = "\",function(){\r\n			window.top.location=\"".toCharArray();
    _jsp_string50 = "\r\n<LINK href=\"/js/jquery/jquery_dialog_wev8.css\" type=text/css rel=STYLESHEET>\r\n<script type=\"text/javascript\" src=\"/wui/common/jquery/jquery.min_wev8.js\"></script>\r\n<script type=\"text/javascript\" language=\"javascript\" src=\"/js/jquery/jquery_dialog_wev8.js\"></script>\r\n\r\n<script src=\"/social/js/drageasy/drageasy.js\"></script>\r\n<script type=\"text/javascript\" src=\"/social/js/bootstrap/js/bootstrap.js\"></script>\r\n<script type=\"text/javascript\" src=\"/social/im/js/IMUtil_wev8.js\"></script>\r\n\r\n<script type=\"text/javascript\" src=\"/social/js/imcarousel/imcarousel.js\"></script>\r\n<script type=\"text/javascript\" language=\"javascript\">\r\nfunction ReloadOpenerByDialogClose() {\r\n    ".toCharArray();
    _jsp_string23 = "\";\r\n					diag.show();\r\n			        return false;\r\n	    		}\r\n	    		else if(response_flag=='2') {\r\n	    			flag_msg = '".toCharArray();
    _jsp_string53 = "\r\n".toCharArray();
    _jsp_string10 = "\r\n<script language=\"javascript\" type=\"text/javascript\" src=\"/FCKEditor/swfobject_wev8.js\"></script>\r\n\r\n".toCharArray();
    _jsp_string49 = "\r\n\r\n<!--WUI -->\r\n".toCharArray();
    _jsp_string40 = "\";\r\n   if(!confirm(str)){\r\n       return false;\r\n   }\r\n       return true;\r\n } \r\n\r\nfunction issubmit(){\r\n	var str = \"".toCharArray();
    _jsp_string22 = "\";\r\n					//diag.InvokeElementId=\"pageOverlay\"\r\n					diag.URL = \"/wui/theme/ecology7/page/loginSmall.jsp?username=".toCharArray();
    _jsp_string29 = "')) {\r\n				    lenck = false;\r\n				    break;\r\n			    }\r\n		    }\r\n		    if(lenck==false) return false;\r\n	    }\r\n	    catch(e) {}\r\n	    ".toCharArray();
    _jsp_string58 = "\r\n<meta http-equiv=\"".toCharArray();
    _jsp_string60 = ",transition=".toCharArray();
    _jsp_string59 = "\" content=\"revealTrans(duration=".toCharArray();
    _jsp_string28 = "','".toCharArray();
    _jsp_string24 = "';\r\n	    		}\r\n	    		//\u4e3b\u4ece\u5e10\u6237\u7279\u6b8a\u5904\u7406 by alan for TD10156\r\n	    		if(response_flag=='3') {\r\n	    			flag_msg = '".toCharArray();
    _jsp_string39 = "\");\r\n						}\r\n						return false;\r\n					}\r\n				}\r\n			}\r\n		}\r\n	}\r\n	return true;\r\n}\r\n\r\nfunction isdel(){\r\n	var str = \"".toCharArray();
    _jsp_string2 = "\r\n\r\n".toCharArray();
  }
}
