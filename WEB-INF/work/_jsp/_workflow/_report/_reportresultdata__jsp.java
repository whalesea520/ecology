/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._workflow._report;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import weaver.workflow.workflow.WorkflowVersion;
import weaver.formmode.tree.CustomTreeUtil;
import java.util.*;
import java.net.*;
import weaver.hrm.*;
import weaver.systeminfo.*;
import weaver.general.*;
import ln.LN;
import weaver.hrm.settings.ChgPasswdReminder;
import weaver.hrm.settings.HrmSettingsComInfo;
import weaver.hrm.settings.RemindSettings;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import weaver.workflow.workflow.TestWorkflowCheck;
import weaver.systeminfo.template.UserTemplate;
import weaver.systeminfo.setting.*;
import weaver.login.LicenseCheckLogin;
import weaver.hrm.online.IPUtil;
import java.util.Map;
import weaver.file.*;
import java.math.BigDecimal;
import weaver.workflow.report.ReportCompositorOrderBean;
import weaver.workflow.report.ReportCompositorListBean;
import weaver.workflow.report.ReportUtilComparator;
import org.apache.commons.lang.StringEscapeUtils;
import weaver.fna.budget.BudgetHandler;
import weaver.general.LocateUtil;
import weaver.general.StaticObj;
import weaver.interfaces.workflow.browser.Browser;
import weaver.interfaces.workflow.browser.BrowserBean;
import weaver.workflow.request.WorkflowJspBean;
import weaver.workflow.mode.FieldInfo;
import weaver.fna.general.FnaCommon;
import weaver.fna.maintenance.FnaCostCenter;

public class _reportresultdata__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;

  
  private String getCurrWuiConfig(HttpSession session, User user, String keyword) throws Exception {
  	
  	if (keyword == null || "".equals(keyword)) {
  		return "";
  	}
  	
  	String curTheme = "";
  	String curskin = "";
  
  	
  		String[] rtnValue = getHrmUserSetting(user);
  		
  		curTheme = rtnValue[0];
  		curskin = rtnValue[1];
  		if(curTheme.equals("")||curskin.equals("")){
  			String templatetype = getCurrE8TemplateType(user);
  			if("".equals(templatetype)){
  				curTheme = "ecologyBasic";
  				curskin = "default";
  			}else if("ecology7".equals(templatetype)){
  				curTheme ="ecology7";
  				curskin = getCurrE8SkinInfo(user);
  			}else{
  				curTheme ="ecology8";
  				curskin = "default";
  			}
  			
  			
  			
  			
  		}else{
  			curTheme = rtnValue[0];
  			curskin = rtnValue[1];
  		}
  		
  		if(curTheme.equals("custom")){
  			curTheme ="ecology8";
  		}
  		
  		session.setAttribute("SESSION_CURRENT_THEME", curTheme);
  		session.setAttribute("SESSION_CURRENT_SKIN", curskin);
  	
  	if ("THEME".equals(keyword.toUpperCase())) {
  		return curTheme;
  	}
  	
  	if ("SKIN".equals(keyword.toUpperCase())) {
  		return curskin;
  	}
  	return "";
  }
  
  
  
  private String getCurrSkinFolder(User user) throws Exception {
  	String pslSkinfolder = "";
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  
  	int userid = user.getUID();
  
  	rs.executeSql("select skin from HrmUserSetting where resourceId=" + userid);
  	
  	if (rs.next()) {
  		pslSkinfolder = rs.getString("skin");
  	}
  
  	if (pslSkinfolder == null || "".equals(pslSkinfolder)) {
  	    pslSkinfolder = "default";
  	}
  	return pslSkinfolder;
  }
  
  private String getCurrE8TemplateType(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	String skin =  userTemplate.getTemplatetype();
  	
  	
  	return skin;
  	
  }
  
  private String getCurrE8SkinInfo(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	String skin =  userTemplate.getSkin();
  	
  	
  	return skin;
  	
  }
  
  private int getCurrTemplateId(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	int id =  userTemplate.getTemplateId();
  	
  	
  	return id;
  	
  }
  
  private String getCurrTemplateLogo(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	String logo =  userTemplate.getLogo();
  	
  	
  	return logo;
  	
  }
  
  private String[] getHrmUserSetting(User user) throws Exception {
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  
  	String[] result = new String[2];
  	String theme = "";
  	String skin = "";
  	
  	String sql="select templateid from SystemTemplateSubComp where subcompanyid="+user.getUserSubCompany1();
  	rs.executeSql(sql);
  	if(rs.next()){	
  	
  		String curUserCanUse = rs.getString("templateid");
  		sql = "SELECT a.* FROM HrmUserSetting a, SystemTemplate  b WHERE a.resourceId="+user.getUID()+" AND a.templateId=b.id  and  b.id="+curUserCanUse;
  		rs.execute(sql);
  		if(rs.next()){
  			theme = rs.getString("theme");
  			skin = rs.getString("skin");
  			if("ecology8".equals(theme)){
  				skin = "default";
  			}
  			result[0] = theme;
  			result[1] = skin;
  			return result;
  		}
  	}
  	
  	
  
  	
  	int userid = user.getUID();
  	rs.executeSql("select theme, skin from HrmUserSetting where resourceId=" + userid);
  	
  	if (rs.next()) {
  		theme = rs.getString("theme");
  		skin = rs.getString("skin");
  	}
  	
  	//rs.executeSql("select * from extandHpThemeItem where extandHpThemeId=" + sqltemplateid1 + " and isopen=1 and theme='" + theme + "' and skin='" + skin + "'");
  	result[0] = theme;
  	result[1] = skin;
  	
  	
  	
  	//System.out.println("result"+result[0]+result[1]);
  	return result;
  }
  
  
  private java.util.Map getPageConfigInfo(HttpSession session, User user) throws Exception{
  	
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	java.util.Map pageConfigkv = new java.util.HashMap();
  	
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	pageConfigkv.put("logoTop",userTemplate.getLogo());
  	pageConfigkv.put("logoBottom", userTemplate.getLogo());
  	pageConfigkv.put("isopen", userTemplate.getIsopen());
  	//pageConfigkv.put("islock", rs.getString("islock"));
  	
  	int extendtempletvalueid = userTemplate.getExtendtempletvalueid();
  	rs.executeSql("select * from extandHpThemeItem where extandHpThemeId=" + extendtempletvalueid + " and isopen=1 and theme='" + getCurrWuiConfig(session, user, "THEME") + "' and skin='" + getCurrWuiConfig(session, user, "SKIN") + "'");
  	
  	if (rs.next()) {
  	
  		
  		/**
  		 * ecologybasic\u4e3b\u9898\u7528\u8bbe\u7f6e\u9879
  		 */
  		pageConfigkv.put("bodyBg", rs.getString("bodyBg"));
  		pageConfigkv.put("topBgImage", rs.getString("topBgImage"));
  		pageConfigkv.put("toolbarBgColor", rs.getString("toolbarBgColor"));
  		pageConfigkv.put("menuborderColor", rs.getString("menuborderColor"));
  
  		pageConfigkv.put("leftbarBgImage", rs.getString("leftbarBgImage"));
  		pageConfigkv.put("leftbarBgImageH", rs.getString("leftbarBgImageH"));
  
  		pageConfigkv.put("leftbarborderColor", rs.getString("leftbarborderColor"));
  		pageConfigkv.put("leftbarFontColor", rs.getString("leftbarFontColor"));
  
  		pageConfigkv.put("topleftbarBgImage_left", rs.getString("topleftbarBgImage_left"));
  		pageConfigkv.put("topleftbarBgImage_center", rs.getString("topleftbarBgImage_center"));
  		pageConfigkv.put("topleftbarBgImage_right", rs.getString("topleftbarBgImage_right"));
  
  		pageConfigkv.put("bottomleftbarBgImage_left", rs.getString("bottomleftbarBgImage_left"));
  		pageConfigkv.put("bottomleftbarBgImage_center", rs.getString("bottomleftbarBgImage_center"));
  		pageConfigkv.put("bottomleftbarBgImage_right", rs.getString("bottomleftbarBgImage_right"));
  
  	}
  	
  	return pageConfigkv;
  	
  }


  
      private String formatData(String inData){
          if(inData==null||inData.equals("")){
              return "";
          }
          try{
              return new BigDecimal(  Util.null2String(inData).equals("")?"0":Util.null2String(inData) ).toString();
          }catch(Exception e){
              return inData;
          }
      }
      private String formatDataTotal(String inData){
          if(inData==null||inData.equals("")){
              return "";
          }
          try{
              return new BigDecimal(  Util.null2String(inData).equals("")?"0":Util.null2String(inData) ).setScale(4,BigDecimal.ROUND_HALF_UP).toString();
          }catch(Exception e){
              return inData;
          }
      }
  Map<String,String> selectMap = new HashMap<String,String>();


   
  /*
   private String getSplitPageString(int pageSize, int currentPage, int rowcount, int pageCount, String position) {
      String sbf = "";
      int z_index = currentPage - 2;
      int y_num = currentPage + 2;
      String tempCent = "";
      String tempLeft = "";
      String tempRight = "";
      if (z_index > 1) {
          tempLeft += "<a style=\"position:relative;cursor:hand;TEXT-DECORATION:none;height:21px;border:1px solid #6ec8ff;margin-right:5px;padding:0 5px 0 5px;\" _jumpTo=\"1\" onClick=\"jumpTo(1)\">" + 1 + "</a>";
      }
      if (z_index > 2) {
          tempLeft += "<span style=\"height:21px;padding-top:1px;text-align:center;\">&nbsp;...&nbsp;</span>";
      }
      
      if (y_num < (pageCount - 1)) {
          tempRight += "<span style=\"height:21px;padding-top:1px;text-align:center;\">&nbsp;...&nbsp;</span>";
      }
      
      if (y_num < pageCount) {
          tempRight += "<a style=\"position:relative;cursor:hand;TEXT-DECORATION:none;height:21px;border:1px solid #6ec8ff;margin-right:5px;padding:0 5px 0 5px;\" _jumpTo=\"1\" onClick=\"jumpTo(" + pageCount + ")\">" + pageCount + "</a>";
      }
      
      for(;z_index<=y_num; z_index++) {
          if (z_index>0 && z_index<=pageCount) {
              if (z_index == currentPage) {
                  tempCent +="<a style=\"position:relative;TEXT-DECORATION:none;height:21px;border:1px solid #6ec8ff;margin-right:5px;padding:0 5px 0 5px;\" _jumpTo=\"" + z_index + "\" class=\"weaverTableCurrentPageBg\" >" + z_index + "</a>";                
              } else {
                  tempCent +="<a style=\"position:relative;cursor:hand;TEXT-DECORATION:none;height:21px;border:1px solid #6ec8ff;margin-right:5px;padding:0 5px 0 5px;\" _jumpTo=\"" + z_index + "\" onClick=\"jumpTo(" + z_index + ")\">" + z_index + "</a>";
              }
          }
      }
      
      sbf = tempLeft + tempCent + tempRight;
      
      String str = "";
      if(currentPage > 1){
          str +="<a class=\"weaverTablePrevPage\" style=\"position:relative;top:0px;bottom:0;cursor:hand;TEXT-DECORATION:none;height:21px;width:21px;margin-right:5px;font-size:11px;\" id=\"" + position + "-pre\" onClick=\"jumpTo(" + (currentPage - 1) + ")\" onmouseover=\"pmouseover(this, true)\" onmouseout=\"pmouseover(this, false)\">&nbsp;</a>";  
      }else{
          str += "<span class=\"weaverTablePrevPageOfDisabled\" style=\"position:relative;top:0px;TEXT-DECORATION:none;height:21px;width:21px;margin-right:5px;color:#c6c6c6;font-size:11px;display:inline-block;\">&nbsp;</span>";
      }
      str += sbf;
      if(currentPage<pageCount){
          str +="<a class=\"weaverTableNextPage\" style=\"position:relative;top:0px;cursor:hand;TEXT-DECORATION:none;height:21px;width:21px;margin-right:10px;font-size:11px;\" id=\"" + position + "-next\" onClick=\"jumpTo(" + (currentPage + 1) + ")\" onmouseover=\"pmouseover(this, true)\" onmouseout=\"pmouseover(this, false)\">&nbsp;</a>"; 
      }else{
          str += "<span class=\"weaverTableNextPageOfDisabled\" style=\"position:relative;top:0px;TEXT-DECORATION:none;height:21px;width:21px;margin-right:10px;font-size:11px;display:inline-block;\">&nbsp;</span>";
      }
      
      String result = "";
      result += "<span style=\"TEXT-DECORATION:none;height:21px;padding-top:1px;\">"+SystemEnv.getHtmlLabelName(15323, user.getLanguage())+"&nbsp;</span>";
      
      result += "<input id=\"jumpTo" + position + "\" type=\"text\" value=\""+ currentPage +"\" size=\"3\" class=\"text\" onMouseOver=\"this.select()\" style=\"text-align:right;height:20px;widht:30px;border:1px solid #6ec8ff;background:none;position:relative;margin-right:5px;padding-right:2px;\"/>";
      result += "<span style=\"TEXT-DECORATION:none;height:21px;padding-top:1px;\">"+SystemEnv.getHtmlLabelName(23161, user.getLanguage())+"</span>";
      //\u8df3\u8f6c \u6309\u94ae\u5728\u706b\u72d0\u4e2d\u6298\u884c \u7684\u95ee\u9898\u662f width:38px\u503c\u592a\u5c0f \u2014\u2014 \u8981\u6539\u4e3awidth:50px;
      result += "&nbsp;<button id=\"jumpTo-goPage\" onClick=\"jumpTo(document.getElementById('jumpTo" + position + "').value, document.getElementById('jumpTo" + position + "'))\" style=\"cursor:hand;background:url(/wui/theme/ecology7/skins/default/table/jump_wev8.png) no-repeat;height:21px;width:50px;margin-right:5px;text-align:left;border:none;\">"+SystemEnv.getHtmlLabelName(30911, user.getLanguage())+"</button>";
      
      str += result;
       return str;
   }
   */
   private String getSplitPageStringnew(int pageSize, int currentPage, int rowcount, int pageCount, String position,User user) {
          String sbf = "";
          int z_index = currentPage - 2;
          int y_num = currentPage + 2;
          int left_index = currentPage - 1;
          int right_index = currentPage + 1;
          String left = "";
          String right = "";
          String tempCent = "";
          String tempLeft = "";
          String tempRight = "";
          
          left = "<span class=\"e8_pageinfo\"><span class=\"e8_numberspan weaverTablePrevPageOfDisabled weaverTablePage\"  ";
          if(left_index > 0){
              left += " onClick=\"jumpTo(" + left_index + ")\" onmouseover=\"pmouseover(this, true)\" onmouseout=\"pmouseover(this, false)\" ";
          }
          left += ">&lt;</span>";
          if (z_index > 1) {
              tempLeft += "<span _jumpTo=\"1\" onClick=\"jumpTo(1)\" class=\"e8_numberspan\">" + 1 + "</span>";
          }
          if (z_index > 2) {
              tempLeft += "<span class=\"e8_numberspan\">&nbsp;...&nbsp;</span>";
          }
          
          if (y_num < (pageCount - 1)) {
              tempRight += "<span class=\"e8_numberspan\">&nbsp;...&nbsp;</span>";
          }
          
          if (y_num < pageCount) {
              tempRight += "<span class=\"e8_numberspan\" _jumpTo=\"1\" onClick=\"jumpTo(" + pageCount + ")\" >" + pageCount + "</span>";
          }
          right = "<span class=\"e8_numberspan weaverTablePage weaverTableNextPage\" ";
          if(right_index <= pageCount){
              right += " onClick=\"jumpTo(" + right_index + ")\" onmouseover=\"pmouseover(this, true)\" onmouseout=\"pmouseover(this, false)\" ";
          }
          right += ">&gt;</span>";
          
          
          for(;z_index<=y_num; z_index++) {
              if (z_index>0 && z_index<=pageCount) {
                  if (z_index == currentPage) {
                      tempCent +="<span _jumpTo=\"" + z_index + "\"  class=\"e8_numberspan weaverTableCurrentPageBg\">" + z_index + "</span>";                
                  } else {
                      tempCent +="<span class=\"e8_numberspan\" _jumpTo=\"" + z_index + "\" onClick=\"jumpTo(" + z_index + "," + z_index + ")\">" + z_index + "</span>";
                  }
              }
          }
          
          sbf = left + tempLeft + tempCent + tempRight + right;
          
          //String str = "";
          //if(currentPage > 1){
          //  str +="<a class=\"weaverTablePrevPage\" style=\"position:relative;top:0px;bottom:0;cursor:hand;TEXT-DECORATION:none;height:21px;width:21px;margin-right:5px;font-size:11px;\" id=\"" + position + "-pre\" onClick=\"jumpTo(" + (currentPage - 1) + ")\" onmouseover=\"pmouseover(this, true)\" onmouseout=\"pmouseover(this, false)\">&nbsp;</a>";  
          //}else{
          //  str += "<span class=\"weaverTablePrevPageOfDisabled\" style=\"position:relative;top:0px;TEXT-DECORATION:none;height:21px;width:21px;margin-right:5px;color:#c6c6c6;font-size:11px;display:inline-block;\">&nbsp;</span>";
          //}
          //str += sbf;
          //if(currentPage<pageCount){
          //  str +="<a class=\"weaverTableNextPage\" style=\"position:relative;top:0px;cursor:hand;TEXT-DECORATION:none;height:21px;width:21px;margin-right:10px;font-size:11px;\" id=\"" + position + "-next\" onClick=\"jumpTo(" + (currentPage + 1) + ")\" onmouseover=\"pmouseover(this, true)\" onmouseout=\"pmouseover(this, false)\">&nbsp;</a>"; 
          //}else{
          //  str += "<span class=\"weaverTableNextPageOfDisabled\" style=\"position:relative;top:0px;TEXT-DECORATION:none;height:21px;width:21px;margin-right:10px;font-size:11px;display:inline-block;\">&nbsp;</span>";
          //}
          
          String pageString = "";
          pageString += "<div class=\"K13_select\" style=\"width: 40px; z-index: 10000;\">";
          pageString += "    <div class=\"K13_select_checked\" >";
          pageString += "    <input class=\"_pageSizeInput\" onclick=\"clickShow()\" onmouseout=\"hiddenO2()\" maxlength=\"3\" style=\"width:40px;background:transparent;text-align:center;border:1px solid transparent;color:#fff;height:26px;vertical-align:top;\" type=\"text\" value=\""+pageSize+"\" name=\"pageSizeSel1inputText\" id=\"pageSizeSel1inputText\">";
          pageString += "    </div>";
          pageString += "    <div class=\"K13_select_list\" onmouseover=\"showOl()\" onmouseout=\"hiddenOl()\" style=\"padding-bottom: 1px; top: -125px; display: none;\">";
          pageString += "     <ol>";
          pageString += "         <li class=\"\" onclick=\"changepageSizeSel1(10)\">10</li>";
          pageString += "         <li class=\"\" onclick=\"changepageSizeSel1(20)\">20</li>";
          pageString += "         <li class=\"\" onclick=\"changepageSizeSel1(50)\">50</li>";
          pageString += "         <li class=\"\" onclick=\"changepageSizeSel1(100)\">100</li>";
          pageString += "     </ol>";
          pageString += "    </div>";
          pageString += "    <select class=\"_pageSize\" id=\"pageSizeSel1\" name=\"pageSizeSel1\" style=\"background-color: transparent; border: none; width: 50px; text-align: center; text-decoration: none; height: 20px; padding-right: 2px; margin-left: 5px; margin-right: 5px; line-height: 20px; display: none; background-position: initial initial; background-repeat: initial initial;\">";
          pageString += "     <option value=\"10\">10</option>";
          pageString += "     <option value=\"20\">20</option>";
          pageString += "     <option value=\"50\">50</option>";
          pageString += "     <option value=\"100\">100</option>";
          pageString += "    </select>";
          pageString += "</div>";
          
          String result = "";
          result += "<span style=\"float:left;TEXT-DECORATION:none;height:30px;line-height:30px;color:#666666;\">"+SystemEnv.getHtmlLabelName(15323,user.getLanguage())+"</span>";
          result += "<span  id=\"jumpTo" + position + "_go_page_wrap\" style=\"float:left;display:inline-block;width:30px;height:20px;border:1px solid #FFF;margin:0px 1px;padding:0px;position:relative;left:0px;top:5px;\">";
          result += "<span  id=\"jumpTo" + position + "-goPage\" onClick=\"jumpTo(document.getElementById('jumpTo" + position + "').value, document.getElementById('jumpTo" + position + "'))\" style=\"float:left;cursor:pointer;width: 44px; height: 22px; line-height: 20px; padding: 0px; text-align: center; border: 0px; background-color: rgb(0, 99, 220); color: rgb(255, 255, 255); position: absolute; left: 0px; top: -1px; display: none;z-index:10000\">"+SystemEnv.getHtmlLabelName(30911,user.getLanguage())+"</span>";
          result += "<input id=\"jumpTo" + position + "\" type=\"text\" onfocus=\"focus_goPage(this)\" value=\""+ currentPage +"\"  onblur=\"blur_goPage(this)\" size=\"3\" onmouseover=\"if(jQuery('#jumpTobottom-goPage').css('display')=='none'){jQuery(this).css('border','1px solid #DDDDDD');}\" onmouseout=\"jQuery(this).css('border','1px solid transparent')\" style=\"color: rgb(102, 102, 102); width: 30px; height: 18px; line-height: 18px; float: left; text-align: center; position: absolute; left: 0px; top: 0px; outline: none; border: 1px solid transparent;\"></span>";
          
          result += "<span style=\"float:left;TEXT-DECORATION:none;height:30px;line-height:30px;color:#666666;padding-right:10px;\">"+SystemEnv.getHtmlLabelName(23161,user.getLanguage())+"</span>";
          //\u8df3\u8f6c \u6309\u94ae\u5728\u706b\u72d0\u4e2d\u6298\u884c \u7684\u95ee\u9898\u662f width:38px\u503c\u592a\u5c0f \u2014\u2014 \u8981\u6539\u4e3awidth:50px;
          result += "<span class=\"e8_splitpageinfo\">";
          result += "<span style=\"position:relative;TEXT-DECORATION:none;height:21px;padding-top:2px;\">"+pageString+SystemEnv.getHtmlLabelName(18256,user.getLanguage())+"/"+SystemEnv.getHtmlLabelName(23161,user.getLanguage())+"&nbsp;|&nbsp;"+SystemEnv.getHtmlLabelName(83698,user.getLanguage())+rowcount+SystemEnv.getHtmlLabelName(18256,user.getLanguage());
          result += "</span>";
          result += "</span>";
          result += "</span>";
          
          //result += "&nbsp;<button id=\"jumpTo-goPage\" onClick=\"jumpTo(document.getElementById('jumpTo" + position + "').value, document.getElementById('jumpTo" + position + "'))\" style=\"cursor:hand;background:url(/wui/theme/ecology7/skins/default/table/jump_wev8.png) no-repeat;height:21px;width:50px;margin-right:5px;text-align:left;border:none;\">\u8df3\u8f6c</button>";
          
          sbf += result;
           return sbf;
       }
  
  	 FieldInfo fieldinfo = new FieldInfo();
  	 
   private String delHtml(final String inputString) {
       String htmlStr = fieldinfo.toExcel(inputString); // \u542bhtml\u6807\u7b7e\u7684\u5b57\u7b26\u4e32
       htmlStr = Util.StringReplace(htmlStr, "&dt;&at;", "<br>");
       htmlStr = Util.StringReplace(htmlStr, "<script>initFlashVideo();</script>", "");
       String textStr = "";
       java.util.regex.Pattern p_script;
       java.util.regex.Matcher m_script;
       java.util.regex.Pattern p_html;
       java.util.regex.Matcher m_html;
  
       try {
           String regEx_html = "<[^>]+>"; // \u5b9a\u4e49HTML\u6807\u7b7e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f
           String regEx_script = "<[/s]*?script[^>]*?>[/s/S]*?<[/s]*?//[/s]*?script[/s]*?>"; // \u5b9a\u4e49script\u7684\u6b63\u5219\u8868\u8fbe\u5f0f{\u6216<script[^>]*?>[/s/S]*?<//script>
  
           p_script = java.util.regex.Pattern.compile(regEx_script, java.util.regex.Pattern.CASE_INSENSITIVE);
           m_script = p_script.matcher(htmlStr);
           htmlStr = m_script.replaceAll(""); // \u8fc7\u6ee4script\u6807\u7b7e
  
           p_html = java.util.regex.Pattern.compile(regEx_html, java.util.regex.Pattern.CASE_INSENSITIVE);
           m_html = p_html.matcher(htmlStr);
           htmlStr = m_html.replaceAll(""); // \u8fc7\u6ee4html\u6807\u7b7e
  
           textStr = htmlStr;
  
       } catch (Exception e) {
           //System.err.println("Html2Text: " + e.getMessage());
       }
       
       return Util.HTMLtoTxt(textStr).replaceAll("%nbsp;", " ").replaceAll("%nbsp", " ").trim();// \u8fd4\u56de\u6587\u672c\u5b57\u7b26\u4e32,\u66ff\u6362\u7a7a\u683c
  
  
  
   }
   
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      
request.setCharacterEncoding("UTF-8");

      out.write(_jsp_string1, 0, _jsp_string1.length);
      
	try{
		response.setBufferSize(1*1024*1024);
	}catch(Exception e){}

      out.write(_jsp_string2, 0, _jsp_string2.length);
      
// \u589e\u52a0\u53c2\u6570\u5224\u65ad\u7f13\u5b58
int isIncludeToptitle = 0;
response.setHeader("cache-control", "no-cache");
response.setHeader("pragma", "no-cache");
response.setHeader("expires", "Mon 1 Jan 1990 00:00:00 GMT");

      out.write(_jsp_string3, 0, _jsp_string3.length);
      
//
User user = HrmUserVarify.getUser (request , response) ;
LicenseCheckLogin licenseCheckLogin = new LicenseCheckLogin();
licenseCheckLogin.setOutLineDate(user.getUID(),IPUtil.getIp(request));

//\u95ee\u98981
TestWorkflowCheck twc=new TestWorkflowCheck();
if(twc.checkURI(session,request.getRequestURI(),request.getQueryString())){
    /*
    response.sendRedirect("/login/Logout.jsp");
    */
    String forwardurl = twc.reLoginMrg(request, response, request.getRequestURI());
    if (!"".equals(forwardurl)) { 
        response.sendRedirect(forwardurl);
        return;
    }
}
String userOffline = Util.null2String((String)session.getAttribute("userOffline"));	
if(userOffline.equals("1")){
	//\u5f3a\u5236\u4e0b\u7ebf
	String loginfile = Util.getCookie(request , "loginfileweaver") ;
	Map userSessions = (Map) application.getAttribute("userSessions");
	if (userSessions != null) {
		Map logmessages = (Map) application.getAttribute("logmessages");
		if (logmessages != null)logmessages.remove("" + user.getUID());
		session.removeValue("moniter");
		session.removeValue("WeaverMailSet");
		userSessions.remove(user.getUID());
		//session.invalidate();
	}
      out.write(_jsp_string4, 0, _jsp_string4.length);
      out.print((SystemEnv.getErrorMsgName(175,user.getLanguage())));
      out.write(_jsp_string5, 0, _jsp_string5.length);
      out.print(("/Refresh.jsp?loginfile="+loginfile+"&message=175"));
      out.write(_jsp_string6, 0, _jsp_string6.length);
      
  return;
}
if(user == null)  return ;
String isIE = (String)session.getAttribute("browser_isie");
if (isIE == null || "".equals(isIE)) {
	isIE = "true";
	session.setAttribute("browser_isie", "true");
}
String agentT = request.getHeader("user-agent");
//if(!"true".equals(isIE)){
//if((agentT.contains("Firefox")||agentT.contains(" Chrome")||agentT.contains("Safari") )&& !agentT.contains("Edge")){
if(agentT.contains("Firefox")||agentT.contains(" Chrome")||agentT.contains("Safari") || agentT.contains("Edge")){	
    isIE = "false";	
}
else{
    isIE = "true";	
}
//}

Log logger= LogFactory.getLog(this.getClass());



//************************************************
//\u8d85\u65f6\u6216\u8005\u91cd\u542fresin\u670d\u52a1\u65f6\uff0c\u5f39\u51fa\u767b\u9646\u5c0f\u7a97\u53e3(TD 2227)
//hubo,050707

//************************************************

String pagepath = request.getServletPath();
if(pagepath.indexOf("HrmResourceOperation.jsp")<0&&pagepath.indexOf("RemindLogin.jsp")<0&&pagepath.indexOf("HrmResourcePassword.jsp")<0){
	String changepwd = (String)request.getSession().getAttribute("changepwd");
	if("n".equals(changepwd)){
		request.getSession().removeAttribute("changepwd");
		response.sendRedirect("/login/Login.jsp");
		return;
	}else if("y".equals(changepwd)){
		request.getSession().removeAttribute("changepwd");
	}
}



//licence\u4fe1\u606f
String companyNametools="";
LN Licenseinit_1 = new LN();
try{
	Licenseinit_1.CkHrmnum();
}catch(Exception e){
	e.printStackTrace();
	out.println("<script type='text/javascript'> top.location.href='/system/InLicense.jsp?message=6&code=';</script>");
	return;
}
companyNametools = Licenseinit_1.getCompanyname();

//\u7248\u672c\u4fe1\u606f
StaticObj staticobj = null;
staticobj = StaticObj.getInstance();
String software = (String)staticobj.getObject("software") ;
if(software == null) software="ALL";
String portal = (String)staticobj.getObject("portal") ;
if(portal == null) portal="n";
boolean isPortalOK = false;
if(portal.equals("y")) isPortalOK = true;
String multilanguage = (String)staticobj.getObject("multilanguage") ;
if(multilanguage == null) multilanguage="n";
boolean isMultilanguageOK = false;
if(multilanguage.equals("y")) isMultilanguageOK = true;


      out.write(_jsp_string3, 0, _jsp_string3.length);
      
  String fromlogin=(String)session.getAttribute("fromlogin");
  session.removeAttribute("fromlogin");
  if(fromlogin==null) fromlogin="no";

  ChgPasswdReminder reminder0 = new ChgPasswdReminder();
  RemindSettings settings0=reminder0.getRemindSettings();
  String firmcode0=settings0.getFirmcode();
  String usercode0=settings0.getUsercode();

  int needusb0=user.getNeedusb();
  String usbtype0 = settings0.getUsbType();
  String serial0=user.getSerial();

//\u9650\u5236\u6bcf\u4e2a\u7528\u6237\u53ea\u80fd\u6709\u4e00\u4e2a\u767b\u5165\u7684\u7a97\u53e3
String frommain = Util.null2String(request.getParameter("frommain")) ;

Map logmessages=(Map)application.getAttribute("logmessages");
String a_logmessage="";
if(logmessages!=null)
	a_logmessage=Util.null2String((String)logmessages.get(""+user.getUID()));

String s_logmessage=Util.null2String((String)session.getAttribute("logmessage"));


//TD2125 by mackjoe \u89e3\u51b3\u6570\u636e\u4e2d\u5fc3\u767b\u9646\u4e0d\u4e86\u95ee\u9898
if(s_logmessage==null)  s_logmessage="";

String relogin0=Util.null2String(settings0.getRelogin());

String changepwd = (String)session.getAttribute("changepwd");

if(!relogin0.equals("1")&&"yes".equals(changepwd)){
logmessages=(Map)application.getAttribute("logmessages");
logmessages.put(""+user.getUID(),s_logmessage);
if(logmessages!=null)
	a_logmessage=Util.null2String((String)logmessages.get(""+user.getUID()));
}

String layoutStyle = (String)request.getSession(true).getAttribute("layoutStyle");
if(layoutStyle==null) layoutStyle ="";

String rtxFromLogintmp = (String)session.getAttribute("RtxFromLogin");


if("1".equals(user.getLogintype())&&!relogin0.equals("1")&&!fromlogin.equals("yes")&&!frommain.equals("yes")&&!s_logmessage.equals(a_logmessage) && !"true".equals(rtxFromLogintmp)){
	if(layoutStyle.equals("") || !layoutStyle.equals("1")){	//\u5982\u679c\u662f\u5c0f\u7a97\u53e3\u767b\u5f55\uff0c\u5219\u4e0d\u5224\u65ad\u662f\u5426\u4e3a\u5f53\u524d\u5de5\u4f5c\u7a97\u53e3


      out.write(_jsp_string7, 0, _jsp_string7.length);
      out.print((SystemEnv.getHtmlLabelName(23274,user.getLanguage())));
      out.write(_jsp_string8, 0, _jsp_string8.length);
      return;}}
      out.write(_jsp_string3, 0, _jsp_string3.length);
      
//\u6d41\u7a0b\u7684\u4e09\u4e2a\u9875\u9762\u9700\u8981\u4f7f\u7528\u9ad8\u7248\u672c\u7684jQuery
if (request.getRequestURI().indexOf("/workflow/request/") != -1 &&
        (request.getRequestURI().indexOf("/workflow/request/ManageRequestNoForm") != -1 
                || request.getRequestURI().indexOf("/workflow/request/ViewRequestIframe.jsp") != -1
                || request.getRequestURI().indexOf("/workflow/request/RemarkFrame.jsp") != -1)) {

      out.write(_jsp_string9, 0, _jsp_string9.length);
      
} else {

      out.write(_jsp_string10, 0, _jsp_string10.length);
      
}

      out.write(_jsp_string11, 0, _jsp_string11.length);
      
//\u6a21\u677f\u6a21\u5f0f\u5bfc\u5165
if ((request.getRequestURI().indexOf("/workflow/") != -1 && request.getRequestURI().indexOf("mode") != -1)
        || request.getRequestURI().indexOf("/workflow/request/AddRequest") != -1) {
        
      out.write(_jsp_string12, 0, _jsp_string12.length);
      
}

      out.write(_jsp_string13, 0, _jsp_string13.length);
      out.print((user.getLanguage()));
      out.write(_jsp_string14, 0, _jsp_string14.length);
      out.print((request.getSession().getId()));
      out.write(_jsp_string15, 0, _jsp_string15.length);
      out.print((SystemEnv.getHtmlLabelName(21403,user.getLanguage())));
      out.write(_jsp_string16, 0, _jsp_string16.length);
      out.print((SystemEnv.getHtmlLabelName(21791,user.getLanguage())));
      out.write(_jsp_string17, 0, _jsp_string17.length);
      out.print((SystemEnv.getHtmlLabelNames("17480",user.getLanguage())));
      out.write(_jsp_string18, 0, _jsp_string18.length);
      out.print((SystemEnv.getHtmlLabelNames("25484,83",user.getLanguage())));
      out.write(_jsp_string19, 0, _jsp_string19.length);
      out.print((user.getUID()));
      out.write(_jsp_string20, 0, _jsp_string20.length);
      out.print((user.getUID()));
      out.write(_jsp_string21, 0, _jsp_string21.length);
      out.print((user.getType()));
      out.write(_jsp_string22, 0, _jsp_string22.length);
      out.print((SystemEnv.getHtmlLabelName(26263,user.getLanguage())));
      out.write(_jsp_string23, 0, _jsp_string23.length);
      out.print((URLEncoder.encode(user.getLoginid())));
      out.write(_jsp_string24, 0, _jsp_string24.length);
      out.print((SystemEnv.getHtmlLabelName(21403,user.getLanguage())));
      out.write(_jsp_string25, 0, _jsp_string25.length);
      out.print((SystemEnv.getHtmlLabelName(23670,user.getLanguage())));
      out.write(_jsp_string26, 0, _jsp_string26.length);
      out.print((SystemEnv.getHtmlLabelName(21791,user.getLanguage())));
      out.write(_jsp_string27, 0, _jsp_string27.length);
      if(new weaver.conn.RecordSet().getDBType().equals("oracle")){
      out.write(_jsp_string28, 0, _jsp_string28.length);
      out.print((SystemEnv.getHtmlLabelName(524,user.getLanguage())));
      out.print((SystemEnv.getHtmlLabelName(698,user.getLanguage())));
      out.write(_jsp_string29, 0, _jsp_string29.length);
      out.print((SystemEnv.getHtmlLabelName(20246,user.getLanguage())));
      out.write(_jsp_string29, 0, _jsp_string29.length);
      out.print((SystemEnv.getHtmlLabelName(124962,user.getLanguage())));
      out.write(_jsp_string30, 0, _jsp_string30.length);
      }
      out.write(_jsp_string31, 0, _jsp_string31.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string32, 0, _jsp_string32.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string33, 0, _jsp_string33.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string34, 0, _jsp_string34.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string35, 0, _jsp_string35.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string34, 0, _jsp_string34.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string36, 0, _jsp_string36.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string37, 0, _jsp_string37.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string38, 0, _jsp_string38.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string39, 0, _jsp_string39.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string40, 0, _jsp_string40.length);
      out.print((SystemEnv.getHtmlLabelName(15097,user.getLanguage())));
      out.write(_jsp_string41, 0, _jsp_string41.length);
      out.print((SystemEnv.getHtmlLabelName(22161,user.getLanguage())));
      out.write(_jsp_string42, 0, _jsp_string42.length);
      out.print((companyNametools));
      out.write(_jsp_string43, 0, _jsp_string43.length);
      out.print((SystemEnv.getHtmlLabelName(23714,user.getLanguage())));
      out.write(_jsp_string44, 0, _jsp_string44.length);
      
  if(!fromlogin.equals("yes")&&needusb0==1&&"1".equals(usbtype0)){

      out.write(_jsp_string45, 0, _jsp_string45.length);
      out.print((firmcode0));
      out.write(_jsp_string46, 0, _jsp_string46.length);
      out.print((usercode0));
      out.write(_jsp_string47, 0, _jsp_string47.length);
      out.print((serial0));
      out.write(_jsp_string48, 0, _jsp_string48.length);
      out.print((user.getLanguage()));
      out.write(_jsp_string49, 0, _jsp_string49.length);
      }
      out.write(_jsp_string50, 0, _jsp_string50.length);
      weaver.workflow.workflow.TestWorkflowCheck TestWorkflowCheckInitWui;
      TestWorkflowCheckInitWui = (weaver.workflow.workflow.TestWorkflowCheck) pageContext.getAttribute("TestWorkflowCheckInitWui");
      if (TestWorkflowCheckInitWui == null) {
        TestWorkflowCheckInitWui = new weaver.workflow.workflow.TestWorkflowCheck();
        pageContext.setAttribute("TestWorkflowCheckInitWui", TestWorkflowCheckInitWui);
      }
      out.write(_jsp_string51, 0, _jsp_string51.length);
      out.println(TestWorkflowCheckInitWui.ReloadByDialogClose(request));
      out.write(_jsp_string52, 0, _jsp_string52.length);
      
    if(TestWorkflowCheckInitWui.checkURI(session,request.getRequestURI(),request.getQueryString())){
        response.sendRedirect("/login/Login.jsp");
        return;
    }

      out.write(_jsp_string53, 0, _jsp_string53.length);
      

String curTheme = "ecology7";
//\u5f53\u524d\u76ae\u80a4
String curskin = "";
String cutoverWay = "";
String transitionTime = "";
String transitionWay = "";

HrmUserSettingComInfo instance = new HrmUserSettingComInfo();

String huscifId = String.valueOf(instance.getId(String.valueOf(user.getUID())));

curTheme = getCurrWuiConfig(session, user, "theme");
curskin = getCurrWuiConfig(session, user, "skin");

cutoverWay = instance.getCutoverWay(huscifId);
transitionTime = instance.getTransitionTime(huscifId);
transitionWay = instance.getTransitionWays(huscifId);

      out.write(_jsp_string1, 0, _jsp_string1.length);
      
String ely6flg = "";
if ("ecology6".equals(curTheme.toLowerCase())) {
	curTheme = "ecology7";
	ely6flg = "ecology6";
}

      out.write(_jsp_string54, 0, _jsp_string54.length);
      out.print((curTheme ));
      out.write(_jsp_string55, 0, _jsp_string55.length);
      out.print((curskin ));
      out.write(_jsp_string56, 0, _jsp_string56.length);
      
curTheme = "ecology8";//\u540e\u53f0\u914d\u7f6e\u9875\u9762\u5747\u4e3aE8\u4e3b\u9898\uff0c\u5982\u4f7f\u7528\u5176\u4ed6\u4e3b\u9898\u65f6\uff0c\u4f1a\u5bfc\u81f4\u6837\u5f0f\u6df7\u4e71\u3002\u6240\u4ee5\u6b64\u5904\u4e3b\u9898\u5f3a\u5236\u8d4b\u503cecology8
if("ecology8".equals(curTheme)) curskin="default";
session.setAttribute("SESSION_TEMP_CURRENT_THEME", curTheme);
session.setAttribute("SESSION_TEMP_CURRENT_SKIN", curskin);

      out.write(_jsp_string57, 0, _jsp_string57.length);
      
if (transitionTime != null && !transitionTime.equals("") && !transitionTime.equals("0")) {

      out.write(_jsp_string58, 0, _jsp_string58.length);
      out.print((cutoverWay ));
      out.write(_jsp_string59, 0, _jsp_string59.length);
      out.print((transitionTime ));
      out.write(_jsp_string60, 0, _jsp_string60.length);
      out.print((transitionWay ));
      out.write(_jsp_string61, 0, _jsp_string61.length);
      
}

      out.write(_jsp_string62, 0, _jsp_string62.length);
      out.print((curTheme ));
      out.write(_jsp_string63, 0, _jsp_string63.length);
      out.print((curskin ));
      out.write(_jsp_string64, 0, _jsp_string64.length);
      if(!"1".equals(session.getAttribute("istest"))){//\u6d41\u7a0b\u6d4b\u8bd5
      out.write(_jsp_string1, 0, _jsp_string1.length);
      pageContext.include("/synergy/showSynergy.jsp", "requestid=" + com.caucho.el.Expr.toString(Util.getIntValue(request.getParameter("requestid"),-1), null), false);
      out.write(_jsp_string1, 0, _jsp_string1.length);
      }
      out.write(_jsp_string65, 0, _jsp_string65.length);
      weaver.filter.XssUtil xssUtil;
      xssUtil = (weaver.filter.XssUtil) pageContext.getAttribute("xssUtil");
      if (xssUtil == null) {
        xssUtil = new weaver.filter.XssUtil();
        pageContext.setAttribute("xssUtil", xssUtil);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet rs1;
      rs1 = (weaver.conn.RecordSet) pageContext.getAttribute("rs1");
      if (rs1 == null) {
        rs1 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs1", rs1);
      }
      out.write(_jsp_string66, 0, _jsp_string66.length);
      weaver.conn.RecordSet rs2;
      rs2 = (weaver.conn.RecordSet) pageContext.getAttribute("rs2");
      if (rs2 == null) {
        rs2 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs2", rs2);
      }
      out.write(_jsp_string66, 0, _jsp_string66.length);
      weaver.conn.RecordSet rs3;
      rs3 = (weaver.conn.RecordSet) pageContext.getAttribute("rs3");
      if (rs3 == null) {
        rs3 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs3", rs3);
      }
      out.write(_jsp_string66, 0, _jsp_string66.length);
      weaver.conn.RecordSet RecordSet;
      RecordSet = (weaver.conn.RecordSet) pageContext.getAttribute("RecordSet");
      if (RecordSet == null) {
        RecordSet = new weaver.conn.RecordSet();
        pageContext.setAttribute("RecordSet", RecordSet);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet rs;
      rs = (weaver.conn.RecordSet) pageContext.getAttribute("rs");
      if (rs == null) {
        rs = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs", rs);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.workflow.field.BrowserComInfo BrowserComInfo;
      BrowserComInfo = (weaver.workflow.field.BrowserComInfo) pageContext.getAttribute("BrowserComInfo");
      if (BrowserComInfo == null) {
        BrowserComInfo = new weaver.workflow.field.BrowserComInfo();
        pageContext.setAttribute("BrowserComInfo", BrowserComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.company.DepartmentComInfo DepartmentComInfo;
      DepartmentComInfo = (weaver.hrm.company.DepartmentComInfo) pageContext.getAttribute("DepartmentComInfo");
      if (DepartmentComInfo == null) {
        DepartmentComInfo = new weaver.hrm.company.DepartmentComInfo();
        pageContext.setAttribute("DepartmentComInfo", DepartmentComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.companyvirtual.DepartmentVirtualComInfo deptvcominfo;
      deptvcominfo = (weaver.hrm.companyvirtual.DepartmentVirtualComInfo) pageContext.getAttribute("deptvcominfo");
      if (deptvcominfo == null) {
        deptvcominfo = new weaver.hrm.companyvirtual.DepartmentVirtualComInfo();
        pageContext.setAttribute("deptvcominfo", deptvcominfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.resource.ResourceComInfo ResourceComInfo;
      ResourceComInfo = (weaver.hrm.resource.ResourceComInfo) pageContext.getAttribute("ResourceComInfo");
      if (ResourceComInfo == null) {
        ResourceComInfo = new weaver.hrm.resource.ResourceComInfo();
        pageContext.setAttribute("ResourceComInfo", ResourceComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.general.WorkFlowTransMethod WorkFlowTransMethod;
      WorkFlowTransMethod = (weaver.general.WorkFlowTransMethod) pageContext.getAttribute("WorkFlowTransMethod");
      if (WorkFlowTransMethod == null) {
        WorkFlowTransMethod = new weaver.general.WorkFlowTransMethod();
        pageContext.setAttribute("WorkFlowTransMethod", WorkFlowTransMethod);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.workflow.workflow.WorkflowComInfo WorkflowComInfo;
      WorkflowComInfo = (weaver.workflow.workflow.WorkflowComInfo) pageContext.getAttribute("WorkflowComInfo");
      if (WorkflowComInfo == null) {
        WorkflowComInfo = new weaver.workflow.workflow.WorkflowComInfo();
        pageContext.setAttribute("WorkflowComInfo", WorkflowComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.hrm.company.CostCenterComInfo CostcenterComInfo;
      CostcenterComInfo = (weaver.hrm.company.CostCenterComInfo) pageContext.getAttribute("CostcenterComInfo");
      if (CostcenterComInfo == null) {
        CostcenterComInfo = new weaver.hrm.company.CostCenterComInfo();
        pageContext.setAttribute("CostcenterComInfo", CostcenterComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.job.JobTitlesComInfo JobTitlesComInfo;
      JobTitlesComInfo = (weaver.hrm.job.JobTitlesComInfo) pageContext.getAttribute("JobTitlesComInfo");
      if (JobTitlesComInfo == null) {
        JobTitlesComInfo = new weaver.hrm.job.JobTitlesComInfo();
        pageContext.setAttribute("JobTitlesComInfo", JobTitlesComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.docs.docs.DocComInfo DocComInfo;
      DocComInfo = (weaver.docs.docs.DocComInfo) pageContext.getAttribute("DocComInfo");
      if (DocComInfo == null) {
        DocComInfo = new weaver.docs.docs.DocComInfo();
        pageContext.setAttribute("DocComInfo", DocComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.cpt.maintenance.CapitalAssortmentComInfo CapitalAssortmentComInfo;
      CapitalAssortmentComInfo = (weaver.cpt.maintenance.CapitalAssortmentComInfo) pageContext.getAttribute("CapitalAssortmentComInfo");
      if (CapitalAssortmentComInfo == null) {
        CapitalAssortmentComInfo = new weaver.cpt.maintenance.CapitalAssortmentComInfo();
        pageContext.setAttribute("CapitalAssortmentComInfo", CapitalAssortmentComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.cpt.capital.CapitalComInfo CapitalComInfo;
      CapitalComInfo = (weaver.cpt.capital.CapitalComInfo) pageContext.getAttribute("CapitalComInfo");
      if (CapitalComInfo == null) {
        CapitalComInfo = new weaver.cpt.capital.CapitalComInfo();
        pageContext.setAttribute("CapitalComInfo", CapitalComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.crm.Maint.CustomerInfoComInfo CustomerInfoComInfo;
      CustomerInfoComInfo = (weaver.crm.Maint.CustomerInfoComInfo) pageContext.getAttribute("CustomerInfoComInfo");
      if (CustomerInfoComInfo == null) {
        CustomerInfoComInfo = new weaver.crm.Maint.CustomerInfoComInfo();
        pageContext.setAttribute("CustomerInfoComInfo", CustomerInfoComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.proj.Maint.ProjectInfoComInfo ProjectInfoComInfo;
      ProjectInfoComInfo = (weaver.proj.Maint.ProjectInfoComInfo) pageContext.getAttribute("ProjectInfoComInfo");
      if (ProjectInfoComInfo == null) {
        ProjectInfoComInfo = new weaver.proj.Maint.ProjectInfoComInfo();
        pageContext.setAttribute("ProjectInfoComInfo", ProjectInfoComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.workflow.request.RequestComInfo RequestComInfo;
      RequestComInfo = (weaver.workflow.request.RequestComInfo) pageContext.getAttribute("RequestComInfo");
      if (RequestComInfo == null) {
        RequestComInfo = new weaver.workflow.request.RequestComInfo();
        pageContext.setAttribute("RequestComInfo", RequestComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.workflow.report.ReportComInfo ReportComInfo;
      ReportComInfo = (weaver.workflow.report.ReportComInfo) pageContext.getAttribute("ReportComInfo");
      if (ReportComInfo == null) {
        ReportComInfo = new weaver.workflow.report.ReportComInfo();
        pageContext.setAttribute("ReportComInfo", ReportComInfo);
      }
      out.write(_jsp_string67, 0, _jsp_string67.length);
      weaver.fna.maintenance.CurrencyComInfo CurrencyComInfo;
      CurrencyComInfo = (weaver.fna.maintenance.CurrencyComInfo) pageContext.getAttribute("CurrencyComInfo");
      if (CurrencyComInfo == null) {
        CurrencyComInfo = new weaver.fna.maintenance.CurrencyComInfo();
        pageContext.setAttribute("CurrencyComInfo", CurrencyComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.fna.maintenance.LedgerComInfo LedgerComInfo;
      LedgerComInfo = (weaver.fna.maintenance.LedgerComInfo) pageContext.getAttribute("LedgerComInfo");
      if (LedgerComInfo == null) {
        LedgerComInfo = new weaver.fna.maintenance.LedgerComInfo();
        pageContext.setAttribute("LedgerComInfo", LedgerComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.fna.maintenance.ExpensefeeTypeComInfo ExpensefeeTypeComInfo;
      ExpensefeeTypeComInfo = (weaver.fna.maintenance.ExpensefeeTypeComInfo) pageContext.getAttribute("ExpensefeeTypeComInfo");
      if (ExpensefeeTypeComInfo == null) {
        ExpensefeeTypeComInfo = new weaver.fna.maintenance.ExpensefeeTypeComInfo();
        pageContext.setAttribute("ExpensefeeTypeComInfo", ExpensefeeTypeComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.workflow.report.ReportShare MDCompanyNameInfo;
      MDCompanyNameInfo = (weaver.workflow.report.ReportShare) pageContext.getAttribute("MDCompanyNameInfo");
      if (MDCompanyNameInfo == null) {
        MDCompanyNameInfo = new weaver.workflow.report.ReportShare();
        pageContext.setAttribute("MDCompanyNameInfo", MDCompanyNameInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.file.ExcelFile ExcelFile;
      synchronized (pageContext.getSession()) {
        ExcelFile = (weaver.file.ExcelFile) pageContext.getSession().getAttribute("ExcelFile");
        if (ExcelFile == null) {
          ExcelFile = new weaver.file.ExcelFile();
          pageContext.getSession().setAttribute("ExcelFile", ExcelFile);
        }
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.workflow.request.ResourceConditionManager resourceConditionManager;
      resourceConditionManager = (weaver.workflow.request.ResourceConditionManager) pageContext.getAttribute("resourceConditionManager");
      if (resourceConditionManager == null) {
        resourceConditionManager = new weaver.workflow.request.ResourceConditionManager();
        pageContext.setAttribute("resourceConditionManager", resourceConditionManager);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.docs.senddoc.DocReceiveUnitComInfo DocReceiveUnitComInfo;
      DocReceiveUnitComInfo = (weaver.docs.senddoc.DocReceiveUnitComInfo) pageContext.getAttribute("DocReceiveUnitComInfo");
      if (DocReceiveUnitComInfo == null) {
        DocReceiveUnitComInfo = new weaver.docs.senddoc.DocReceiveUnitComInfo();
        pageContext.setAttribute("DocReceiveUnitComInfo", DocReceiveUnitComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.docs.category.DocTreeDocFieldComInfo DocTreeDocFieldComInfo;
      DocTreeDocFieldComInfo = (weaver.docs.category.DocTreeDocFieldComInfo) pageContext.getAttribute("DocTreeDocFieldComInfo");
      if (DocTreeDocFieldComInfo == null) {
        DocTreeDocFieldComInfo = new weaver.docs.category.DocTreeDocFieldComInfo();
        pageContext.setAttribute("DocTreeDocFieldComInfo", DocTreeDocFieldComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.company.SubCompanyComInfo SubCompanyComInfo;
      SubCompanyComInfo = (weaver.hrm.company.SubCompanyComInfo) pageContext.getAttribute("SubCompanyComInfo");
      if (SubCompanyComInfo == null) {
        SubCompanyComInfo = new weaver.hrm.company.SubCompanyComInfo();
        pageContext.setAttribute("SubCompanyComInfo", SubCompanyComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.companyvirtual.SubCompanyVirtualComInfo subCompVirComInfo;
      subCompVirComInfo = (weaver.hrm.companyvirtual.SubCompanyVirtualComInfo) pageContext.getAttribute("subCompVirComInfo");
      if (subCompVirComInfo == null) {
        subCompVirComInfo = new weaver.hrm.companyvirtual.SubCompanyVirtualComInfo();
        pageContext.setAttribute("subCompVirComInfo", subCompVirComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.workflow.request.WorkflowJspBean WorkflowJspBean;
      WorkflowJspBean = (weaver.workflow.request.WorkflowJspBean) pageContext.getAttribute("WorkflowJspBean");
      if (WorkflowJspBean == null) {
        WorkflowJspBean = new weaver.workflow.request.WorkflowJspBean();
        pageContext.setAttribute("WorkflowJspBean", WorkflowJspBean);
      }
      out.write(_jsp_string68, 0, _jsp_string68.length);
      weaver.workflow.mode.FieldInfo FieldInfo;
      FieldInfo = (weaver.workflow.mode.FieldInfo) pageContext.getAttribute("FieldInfo");
      if (FieldInfo == null) {
        FieldInfo = new weaver.workflow.mode.FieldInfo();
        pageContext.setAttribute("FieldInfo", FieldInfo);
      }
      out.write(_jsp_string69, 0, _jsp_string69.length);
      
String guid1 = Util.null2String(request.getParameter("guid1"));
HashMap<String, String> colNameAliasNameHm = (HashMap<String, String>)request.getSession().getAttribute(guid1+"_colNameAliasNameHm");
if(colNameAliasNameHm==null){
    colNameAliasNameHm = new HashMap<String, String>();
}
HashMap<String, String> fnaFeeWfInfo_fieldId_hm = new HashMap<String, String>();
HashMap<String, String> fnaFeeWfInfo_fieldName_hm = new HashMap<String, String>();
HashMap<String, String> fnaFeeWfInfo_fieldIsDtl_hm = new HashMap<String, String>();
String sqlFna1 = "select b.workflowid, b.formid, b.fieldType, b.fieldId, b.isDtl, b.showAllType, b.dtlNumber, c.fieldname  \n" +
    " from fnaFeeWfInfo a \n" +
    " join fnaFeeWfInfoField b on a.id = b.mainid \n" +
    " join workflow_billfield c on b.fieldId = c.id \n" +
	" where (1=2 "+
	" 	or ((b.fieldType in (2,3) and b.dtlNumber = 1) and a.fnaWfType = 'fnaFeeWf') "+
	" 	or ((b.fieldType in (2,3,11,12) and b.dtlNumber = 1) and a.fnaWfType = 'change') "+
	" 	or ((b.fieldType in (2,3,11,12) and b.dtlNumber = 1) and a.fnaWfType = 'share') "+
	" ) ";
RecordSet.executeSql(sqlFna1);
while(RecordSet.next()){
    String _wfId = Util.null2String(RecordSet.getString("workflowid")).trim();
    String _fmId = Util.null2String(RecordSet.getString("formid")).trim();
    String _fieldType = Util.null2String(RecordSet.getString("fieldType")).trim();
    String _fieldId = Util.null2String(RecordSet.getString("fieldId")).trim();
    String _fieldname = Util.null2String(RecordSet.getString("fieldname")).trim();
    String _isDtl = Util.null2String(RecordSet.getString("isDtl")).trim();
    String _key = _wfId+"_"+_fieldType;
    fnaFeeWfInfo_fieldId_hm.put(_key, _fieldId);
    fnaFeeWfInfo_fieldName_hm.put(_key, _fieldname);
    fnaFeeWfInfo_fieldIsDtl_hm.put(_key, _isDtl);
}

//\u62a5\u8868id
String reportid = Util.null2String(request.getParameter("reportid")) ;
String outputExcel = Util.null2String(request.getParameter("outputExcel")) ;
double totleWidth = 0;
int totleindex = 0;
if(reportid.equals("")){
    reportid="0";
}

//\u6a21\u677fid
int mouldId = Util.getIntValue(request.getParameter("mouldId"),0);

//\u662f\u5426\u6839\u636e\u6a21\u677fid\u67e5\u8be2  1:\u6839\u636e\u6a21\u677f\u67e5\u8be2  \u5176\u4ed6\uff1a\u4e0d\u6839\u636e\u6a21\u677f\u67e5\u8be2
String searchByMould = Util.null2String(request.getParameter("searchByMould")) ;

//modify by xhheng @20050126 for TD 1614
int sharelevel_1 = -1 ;    //\u6807\u8bb0\u539f\u6709\u5171\u4eab\u8303\u56f4"\u540c\u90e8\u95e8"\u3001"\u540c\u5206\u90e8"\u3001"\u603b\u90e8"
int sharelevel_2 = -1 ;    //\u6807\u8bb0\u65b0\u5171\u4eab\u8303\u56f4"\u540c\u90e8\u95e8\u4e0b\u7ea7\u90e8\u95e8"
int sharelevel_3 = -1;     //\u6807\u8bb0\u65b0\u5171\u4eab\u8303\u56f4"\u591a\u90e8\u95e8"
String mutidepartmentids="";
RecordSet.executeSql("select sharelevel,mutidepartmentid from WorkflowReportShareDetail where userid="+user.getUID()+" and usertype=1 and reportid="+reportid+" order by sharelevel");
while(RecordSet.next()) {
    int sharelevel_tmp = Util.getIntValue(RecordSet.getString("sharelevel"),0) ;
    if(sharelevel_tmp==9){
        sharelevel_3=sharelevel_tmp;
        mutidepartmentids=Util.null2String(RecordSet.getString("mutidepartmentid"));
        if(mutidepartmentids.length()>1) mutidepartmentids=mutidepartmentids.substring(1,mutidepartmentids.length());
    }else{
        if(sharelevel_tmp==3){
            sharelevel_2=sharelevel_tmp;
        }else{
            sharelevel_1=sharelevel_tmp;
        }
    }
}
//if(sharelevel_1 == -1 && sharelevel_2 == -1 && sharelevel_3==-1) {
//    response.sendRedirect("/notice/noright.jsp");
//    return;
//}

String hasrightdeps = "" ;
if(sharelevel_1 == 0) {
    hasrightdeps = ""+ new Integer(user.getUserDepartment()).toString();
}
if(sharelevel_1 == 1) {
    while(DepartmentComInfo.next()){
        String cursubcompanyid = DepartmentComInfo.getSubcompanyid1();
        if(!(""+user.getUserSubCompany1()).equals(cursubcompanyid)) continue;
        String tempdepartment = ""+DepartmentComInfo.getDepartmentid() ;
        if(hasrightdeps.equals("")) hasrightdeps = tempdepartment ;
        else hasrightdeps += ","+ tempdepartment ;
    }
}
//add by xhheng @20050126 for TD 1614
if(sharelevel_2 == 3) {
    String curdepartmentid=new Integer(user.getUserDepartment()).toString();
    List childdeptlist= MDCompanyNameInfo.GetChildDepartment(curdepartmentid);
    for(int i=0;i<childdeptlist.size();i++){
        String tempdept=(String)childdeptlist.get(i);
        if(Util.getIntValue(tempdept)>0){
        if(hasrightdeps.equals("")) hasrightdeps = tempdept ;
        else {
            String tempdeps=","+hasrightdeps;
            if(tempdeps.indexOf(","+tempdept+",")<0) hasrightdeps+=","+tempdept;
        }
        }
    }
    //hasrightdeps = hasrightdeps.substring(0,hasrightdeps.length()-1);
}
if(sharelevel_3==9){
    if(hasrightdeps.equals("")) hasrightdeps = mutidepartmentids;
    else hasrightdeps+=","+mutidepartmentids;
}
//String[] checkcons = request.getParameterValues("check_con");//\u62a5\u8868\u6761\u4ef6
String[] checkcons =null;//\u62a5\u8868\u6761\u4ef6
String[] isShowArray = null;//\u62a5\u8868\u5217



List isShowList=new ArrayList();//\u663e\u793a\u7684\u5217\u7684\u5b57\u6bb5id

//String formid = Util.null2String(request.getParameter("formid")) ;
//String isbill = Util.null2String(request.getParameter("isbill")) ;
String formid="";
String isbill="";
String reportwfid = "";
rs2.executeSql("select reportname,formId,isBill,reportwfid from workflow_report where id = " + reportid);
String titlename1 = "";
if(rs2.next()){
    titlename1 = rs2.getString("reportname") ;
    formid = rs2.getString("formId") ;
    isbill = rs2.getString("isBill") ;
    reportwfid = rs2.getString("reportwfid") ;
}
boolean isNewBill = false;
if(isbill.equals("1")){
    rs2.executeSql("select id, tablename from workflow_bill where id="+formid);
    if(rs2.next()){
        int tempid = rs2.getInt("id");
        String temptablename = rs2.getString("tablename");
        if(temptablename.equals("formtable_main_"+tempid*(-1)) || temptablename.startsWith("uf_")) isNewBill=true;
    }
}

if("85".equals(formid)){

	
	isNewBill=true;

}


String sql = "" ;
List fieldids = new ArrayList() ;
List fields = new ArrayList() ;
List fieldnames = new ArrayList() ;

List htmltypes = new ArrayList() ;
List types = new ArrayList() ;
List isstats = new ArrayList() ;
List statvalues = new ArrayList() ;
List tempstatvalues = new ArrayList() ;
List isdetails = new ArrayList() ;//add by wang jinyong
String requestid = ""; //add by wang jinyong
boolean isnew = true; //add by wang jinyong
List isdborders = new ArrayList() ;

ArrayList compositorOrderList = new ArrayList() ;//addsed by xwj for td2099 on 2005-06-08
ArrayList compositorColList = new ArrayList() ;//addsed by xwj for td2451 on 2005-11-14
ArrayList compositorColList2 = new ArrayList() ;//addsed by xwj for td2451 on 2005-11-14

List ids = new ArrayList();
List isMains = new ArrayList();
List isShows = new ArrayList();
List isCheckConds = new ArrayList();
List colnames = new ArrayList();
List htmlTypes = new ArrayList();
List typeTemps = new ArrayList();
List opts = new ArrayList();
List values = new ArrayList();
List names = new ArrayList();
List opt1s = new ArrayList();
List value1s = new ArrayList();
//\u5217\u5bbd
List fieldwidths = new ArrayList();


if(searchByMould!=null&&searchByMould.equals("1")){//\u6839\u636e\u6a21\u677fid\u67e5\u8be2\u65f6




    RecordSet.execute("select fieldId,isMain,isShow,isCheckCond,colName,htmlType,type,optionFirst,valueFirst,nameFirst,optionSecond,valueSecond from WorkflowRptCondMouldDetail where mouldId="+mouldId) ;

    while(RecordSet.next()){
        ids.add(Util.null2String(RecordSet.getString("fieldId")));
        isMains.add(Util.null2String(RecordSet.getString("isMain")));
        isShows.add(Util.null2String(RecordSet.getString("isShow")));
        isCheckConds.add(Util.null2String(RecordSet.getString("isCheckCond")));
        colnames.add(Util.null2String(RecordSet.getString("colName")));
        htmlTypes.add(Util.null2String(RecordSet.getString("htmlType")));
        typeTemps.add(Util.null2String(RecordSet.getString("type")));
        opts.add(Util.null2String(RecordSet.getString("optionFirst")));
        values.add(Util.null2String(RecordSet.getString("valueFirst")));
        names.add(Util.null2String(RecordSet.getString("nameFirst")));
        opt1s.add(Util.null2String(RecordSet.getString("optionSecond")));
        value1s.add(Util.null2String(RecordSet.getString("valueSecond")));
    }

    List isCheckCondList=new ArrayList();

    String fieldId="";
    String isShow="";
    String isCheckCond="";

    for(int i=0;i<ids.size();i++){
        fieldId=(String)ids.get(i);
        isShow=(String)isShows.get(i);
        isCheckCond=(String)isCheckConds.get(i);

        if(isShow!=null&&isShow.equals("1")){
            isShowList.add(fieldId);
        }

        if(isCheckCond!=null&&isCheckCond.equals("1")){
            isCheckCondList.add(fieldId);
        }


    }

    int isCheckCondListCount = isCheckCondList.size();
    checkcons = new String[isCheckCondListCount];
    for (int i = 0; i < isCheckCondListCount; i++) {
        checkcons[i] = (String) isCheckCondList.get(i);
    }


}else{

    checkcons = request.getParameterValues("check_con");//\u62a5\u8868\u6761\u4ef6
    isShowArray = request.getParameterValues("isShow");//\u62a5\u8868\u5217




    if(isShowArray!=null){
        for(int i=0;i<isShowArray.length;i++){
            isShowList.add(isShowArray[i]);
        }
    }

    String requestNameIsShow = request.getParameter("requestNameIsShow");
    String requestLevelIsShow = request.getParameter("requestLevelIsShow");
    
    /**2014add**/
    String createmanIsShow = request.getParameter("createmanIsShow");
    String createdateIsShow = request.getParameter("createdateIsShow");
    String workflowtoIsShow = request.getParameter("workflowtoIsShow");
    String currentnodeIsShow = request.getParameter("currentnodeIsShow");
    String nooperatorIsShow = request.getParameter("nooperatorIsShow");
    String requestStatusIsShow = request.getParameter("requeststatusIsShow");
    String filingdateIsShow = request.getParameter("filingdateIsShow");

    if(requestNameIsShow!=null&&requestNameIsShow.equals("1")){
        isShowList.add("-1");
    }
    if(requestLevelIsShow!=null&&requestLevelIsShow.equals("1")){
        isShowList.add("-2");
    }
    //----add------
    if(createmanIsShow!=null&&createmanIsShow.equals("1")){
        isShowList.add("-10");
    }
    if(createdateIsShow!=null&&createdateIsShow.equals("1")){
        isShowList.add("-11");
    }
    if(workflowtoIsShow!=null&&workflowtoIsShow.equals("1")){
        isShowList.add("-12");
    }
    if(currentnodeIsShow!=null&&currentnodeIsShow.equals("1")){
        isShowList.add("-13");
    }
    if(nooperatorIsShow!=null&&nooperatorIsShow.equals("1")){
        isShowList.add("-14");
    }
    if(requestStatusIsShow!=null&&requestStatusIsShow.equals("1")){
        isShowList.add("-15");
    }
    if(filingdateIsShow!=null&&filingdateIsShow.equals("1")){
        isShowList.add("-16");
    }

}
//\u4f20\u9012\u8fc7\u6765\u7684LIST\u503c



String showListStr = Util.StringReplace(Util.StringReplace(Util.StringReplace(Util.null2String(request.getParameter("isShowList")),"[",","),"]",",")," ","");
isShowList = Util.TokenizerString(showListStr, ",");

String sqlrightwhere = "";
String temOwner = "";


String tablename = "workflow_form" ;
String detailtablename = "" ;
String detailkeyfield = "" ;
int maincount = 0 ;
int detailcount = 0 ;
int ordercount = 0 ;
int statcount = 0 ;
String fieldname = "" ;
String orderbystr = "" ;
ReportCompositorOrderBean reportCompositorOrderBean = new ReportCompositorOrderBean(); //added by xwj for td2099 on 2005-06-08
ReportCompositorListBean rcListBean = new ReportCompositorListBean();//added by xwj for td2451 20051114
ReportCompositorListBean rcColListBean = new ReportCompositorListBean();//added by xwj for td2451 20051114

/*-----  xwj for td2974 20051026   B E G I N  ---*/
 //deleted xwj for td2451 20051114
if(isbill.equals("0")) {


   //\u53ea\u6709\u663e\u793a\u8bf7\u6c42\u8bf4\u660e\u65f6\u624d\u6267\u884c\u4e0b\u9762\u7684\u64cd\u4f5c



  if(isShowList.indexOf("-1")!=-1){     
   
    //deleted xwj for td2451 20051114
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -1");
    
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("requestname");//xwj for td2451 20051114
        rcListBean.setFieldId("-1");//xwj for td2451 20051114
        rcListBean.setHtmlType("-1");
        rcListBean.setTypes("-1");
        rcListBean.setIsDetail("0");
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(1334,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("requestname");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
            reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
            reportCompositorOrderBean.setFieldName("requestname");
            reportCompositorOrderBean.setSqlFlag("c");
            compositorOrderList.add(reportCompositorOrderBean);
        }
    }
  }
   //\u53ea\u6709\u663e\u793a\u7d27\u6025\u7a0b\u5ea6\u65f6\u624d\u6267\u884c\u4e0b\u9762\u7684\u64cd\u4f5c
  if(isShowList.indexOf("-2")!=-1){     
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -2");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("requestlevel");//xwj for td2451 20051114
        rcListBean.setFieldId("-2");//xwj for td2451 20051114
        rcListBean.setHtmlType("-2");
        rcListBean.setTypes("-2");
        rcListBean.setIsDetail("0");
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(15534,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("requestlevel");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
            reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
            reportCompositorOrderBean.setFieldName("requestlevel");
            reportCompositorOrderBean.setSqlFlag("c");
            compositorOrderList.add(reportCompositorOrderBean);
        }
    }
  }
   
  //\u521b\u5efa\u4eba



 if(isShowList.indexOf("-10")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -10");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("creater");//xwj for td2451 20051114
        rcListBean.setFieldId("-10");//xwj for td2451 20051114
       rcListBean.setHtmlType("-10");
        rcListBean.setTypes("-10");
        rcListBean.setIsDetail("0");
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(882,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("creater");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
           reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
           reportCompositorOrderBean.setFieldName("creater");
           reportCompositorOrderBean.setSqlFlag("c");
           compositorOrderList.add(reportCompositorOrderBean);
        }
    }
 }
  
 //
if(isShowList.indexOf("-11")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -11");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("createdate");//xwj for td2451 20051114
        rcListBean.setFieldId("-11");//xwj for td2451 20051114
      rcListBean.setHtmlType("-11");
        rcListBean.setTypes("-11");
        rcListBean.setIsDetail("0");
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(722,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("createdate");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
          reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
          reportCompositorOrderBean.setFieldName("createdate");
          reportCompositorOrderBean.setSqlFlag("c");
          compositorOrderList.add(reportCompositorOrderBean);
        }
    }
}
//
if(isShowList.indexOf("-12")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -12");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("workflowid");//xwj for td2451 20051114
        rcListBean.setFieldId("-12");//xwj for td2451 20051114
     rcListBean.setHtmlType("-12");
        rcListBean.setTypes("-12");
        rcListBean.setIsDetail("0");
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(26361,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("workflowid");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
         reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
         reportCompositorOrderBean.setFieldName("workflowid");
         reportCompositorOrderBean.setSqlFlag("c");
         compositorOrderList.add(reportCompositorOrderBean);
        }
    }
}
//
if(isShowList.indexOf("-13")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -13");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("currentnodeid");//xwj for td2451 20051114
        rcListBean.setFieldId("-13");//xwj for td2451 20051114
     rcListBean.setHtmlType("-13");
        rcListBean.setTypes("-13");
        rcListBean.setIsDetail("0");
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(18564,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("currentnodeid");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
         reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
         reportCompositorOrderBean.setFieldName("currentnodeid");
         reportCompositorOrderBean.setSqlFlag("c");
         compositorOrderList.add(reportCompositorOrderBean);
        }
    }
}

if(isShowList.indexOf("-14")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -14");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("requestid");//xwj for td2451 20051114
        rcListBean.setFieldId("-14");//xwj for td2451 20051114
      rcListBean.setHtmlType("-14");
        rcListBean.setTypes("-14");
        rcListBean.setIsDetail("0");
       String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(16354,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("requestid");
       if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
          totleWidth += Double.parseDouble(fieldwidth);
          totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
          reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
          reportCompositorOrderBean.setFieldName("requestid");
          reportCompositorOrderBean.setSqlFlag("c");
          compositorOrderList.add(reportCompositorOrderBean);
        }
    }
 }
//-15
 
 if(isShowList.indexOf("-15")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -15");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("currentnodetype");//xwj for td2451 20051114
        rcListBean.setFieldId("-15");//xwj for td2451 20051114
        rcListBean.setHtmlType("-15");
        rcListBean.setTypes("-15");
        rcListBean.setIsDetail("0");
       String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(31485,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("currentnodetype");
       if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
          totleWidth += Double.parseDouble(fieldwidth);
         totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
          reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
          reportCompositorOrderBean.setFieldName("currentnodetype");
          reportCompositorOrderBean.setSqlFlag("c");
          compositorOrderList.add(reportCompositorOrderBean);
        }
    }
 }
//-16
 
 if(isShowList.indexOf("-16")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -16");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("lastoperatedate");//xwj for td2451 20051114
        rcListBean.setFieldId("-16");//xwj for td2451 20051114
      rcListBean.setHtmlType("-16");
        rcListBean.setTypes("-16");
        rcListBean.setIsDetail("0");
       String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(3000,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("lastoperatedate");
       if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
          totleWidth += Double.parseDouble(fieldwidth);
         totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
          reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
          reportCompositorOrderBean.setFieldName("lastoperatedate");
          reportCompositorOrderBean.setSqlFlag("c");
          compositorOrderList.add(reportCompositorOrderBean);
        }
    }
 }
   
   
    /*-----  xwj for td2974 20051026   E N D ----*/
    
    //modify by xhheng @ 20041206 for TDID 1426 start
    
    // this sql id modified by xwj for td2099 on 2005-06-08 
   sql = " (select a.fieldname as col1, (select distinct c.fieldlable  from  workflow_fieldlable c  where  c.fieldid = b.fieldid and e.formid = c.formid and c.langurageid = "+user.getLanguage()+") as col2, a.fieldhtmltype as col3, a.type as col4, b.isstat as col5, b.dborder as col6, a.id as col7, b.dsporder as col8, f.isdetail as col9,  b.dbordertype as col10, b.compositororder as col11 ,b.fieldwidth AS col12 from workflow_formdict a, Workflow_ReportDspField b ,  Workflow_Report e , workflow_formfield f " +
          " where a.id=f.fieldid   and e.formid=f.formid and b.fieldid = a.id  and e.id = b.reportid and b.reportid = " + reportid + 
          " and (f.isdetail!='1' or f.isdetail is null) union "+
          " select a.fieldname as col1,(select distinct c.fieldlable  from  workflow_fieldlable c  where  c.fieldid = b.fieldid and e.formid = c.formid and c.langurageid = "+user.getLanguage()+") as col2, a.fieldhtmltype as col3, a.type as col4, b.isstat as col5, b.dborder as col6, a.id as col7, b.dsporder as col8, f.isdetail as col9,  b.dbordertype as col10, b.compositororder as col11 ,b.fieldwidth AS col12 from workflow_formdictdetail a, Workflow_ReportDspField b , Workflow_Report e , workflow_formfield f " +
          " where a.id=f.fieldid  and f.formid=e.formid  and b.fieldid = a.id  and e.id = b.reportid and b.reportid = " + reportid +"   and (f.isdetail='1' )) order by col8" ;
    
     //System.out.println("^^^^^^^^^^sql = "+sql);
    //by ben 2006-03-27 for td3595
    //out.print(sql) ;
    //modify by xhheng @ 20041206 for TDID 1426 end
    RecordSet.execute(sql) ;
    //out.println("sql2 = " + sql);
    String owner = "";
    while(RecordSet.next()) {
        if(isShowList.indexOf(Util.null2String(RecordSet.getString(7)))==-1){
            continue;
        }

        //modify by xhheng @ 20041210 for TDID 1426 end
        if(RecordSet.getString("col9").equals("1")){
            owner = "d";
            detailcount++;
           
        }else{
            owner = "a";
        }
        /*-----  xwj for td2974 20051026   B E G I N  ---*/
        
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(RecordSet.getDouble(8));//xwj for td2451 20051114
          rcListBean.setSqlFlag(owner);//xwj for td2451 20051114
          rcListBean.setFieldName(Util.null2String(RecordSet.getString(1)));//xwj for td2451 20051114
          rcListBean.setFieldId(Util.null2String(RecordSet.getString(7)));//xwj for td2451 20051114
          rcListBean.setColName(Util.toScreen(RecordSet.getString(2),user.getLanguage()));//xwj for td2451 20051114
          rcListBean.setHtmlType(Util.null2String(RecordSet.getString(3)));
          rcListBean.setTypes(Util.null2String(RecordSet.getString(4)));
          rcListBean.setIsDetail(Util.null2String(RecordSet.getString(9)));
          //----2014add-----------------
          String fieldwidth = Util.null2String(RecordSet.getString(12));
          rcListBean.setFieldWidth(fieldwidth);
          if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
              totleWidth += Double.parseDouble(fieldwidth);
              totleindex++;
          }
          //rcListBean.setFieldWidth(Util.null2String(RecordSet.getString(12)));

          rcListBean.setDbOrder(Util.null2String(RecordSet.getString(6)));
          rcListBean.setIsstat(Util.null2String(RecordSet.getString(5)));
          compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add(Util.null2String(RecordSet.getString(1))) ;
        /*-----  xwj for td2974 20051026   E N D  ---*/
        
        // deleted by xwj for td2974 20051026
        //add by wang jinyong end

        if(Util.null2String(RecordSet.getString(6)).equals("1")) {
            /* ---deleted and added by xwj for td2099 on 2005-06-08      B E G I N ---*/
            //orderbystr = " order by " + Util.null2String(RecordSet.getString(1)) ;  
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(RecordSet.getInt(11));
            reportCompositorOrderBean.setOrderType(Util.null2String(RecordSet.getString(10)));
            reportCompositorOrderBean.setFieldName(Util.null2String(RecordSet.getString(1)));
            reportCompositorOrderBean.setSqlFlag(owner);
            compositorOrderList.add(reportCompositorOrderBean);
             /* ---deleted and added by xwj for td2099 on 2005-06-08      E N D ---*/
           // deleted by xwj for td2974 20051026
        }
        //deleted by xwj for td2974 20051026
        //delete by xhheng @20050127 for TD 1621
    }
    
     /*-----  xwj for td2974 20051026   B E G I N  ---*/
      
      /*-----  xwj for td2451 on 2005-11-14  B E G I N  ---*/
    compositorColList2 = ReportComInfo.getCompositorList(compositorColList); //xwj for td2451 on 2005-11-14
    for(int a = 0; a < compositorColList2.size(); a++){
    rcColListBean = (ReportCompositorListBean)compositorColList2.get(a);
    RecordSet.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = " +rcColListBean.getFieldId());
   // if(RecordSet.next())
    String  tempfieldid = rcColListBean.getFieldId();
    htmltypes.add(rcColListBean.getHtmlType());
    types.add(rcColListBean.getTypes());
    isdetails.add(rcColListBean.getIsDetail());
    //---2014add------------------------------
    fieldwidths.add(rcColListBean.getFieldWidth());
     if (Util.null2String(rcColListBean.getDbOrder()).equals("1"))
        {ordercount ++ ;
       isdborders.add("1") ;
        }
        else
       isdborders.add("") ;
    if (Util.null2String(rcColListBean.getIsstat()).equals("1"))
        { statcount ++ ;
          isstats.add("1") ;
        }
        else
        isstats.add("") ;
  
    statvalues.add("") ;
    tempstatvalues.add("") ;
     fieldids.add(tempfieldid);
    }//xwj for td2451 on 2005-11-14 
      fieldname =  ReportComInfo.getCompositorListByStrs(compositorColList)+",c.requestid"; //xwj for td2451 on 2005-11-14
    orderbystr = ReportComInfo.getCompositorOrderByStrs(compositorOrderList); //added by xwj for td2099 on2005-06-08
    /*-----  xwj for td2974 20051026   E N D  ---*/

}
else {
  //deleted xwj for td2451 20051114
    /*-----  xwj for td2974 20051026   B E G I N  ---*/
//deleted xwj for td2451 20051114
   //\u53ea\u6709\u663e\u793a\u8bf7\u6c42\u8bf4\u660e\u65f6\u624d\u6267\u884c\u4e0b\u9762\u7684\u64cd\u4f5c



  if(isShowList.indexOf("-1")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -1");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("requestname");//xwj for td2451 20051114
        rcListBean.setFieldId("-1");//xwj for td2451 20051114
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(1334,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("requestname");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
            reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
            reportCompositorOrderBean.setFieldName("requestname");
            reportCompositorOrderBean.setSqlFlag("c");
            compositorOrderList.add(reportCompositorOrderBean);
        }
    }
  }

   //\u53ea\u6709\u663e\u793a\u7d27\u6025\u7a0b\u5ea6\u65f6\u624d\u6267\u884c\u4e0b\u9762\u7684\u64cd\u4f5c
  if(isShowList.indexOf("-2")!=-1){    
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -2");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("requestlevel");//xwj for td2451 20051114
        rcListBean.setFieldId("-2");//xwj for td2451 20051114
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(15534,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("requestlevel");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
            reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
            reportCompositorOrderBean.setFieldName("requestlevel");
            reportCompositorOrderBean.setSqlFlag("c");
            compositorOrderList.add(reportCompositorOrderBean);
        }
    }
  }
   
  /**2014**/
  //\u521b\u5efa\u4eba



 if(isShowList.indexOf("-10")!=-1){ 
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -10");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("creater");//xwj for td2451 20051114
        rcListBean.setFieldId("-10");//xwj for td2451 20051114
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(882,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("creater");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
           reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
           reportCompositorOrderBean.setFieldName("creater");
           reportCompositorOrderBean.setSqlFlag("c");
           compositorOrderList.add(reportCompositorOrderBean);
        }
    }
 }
  
 //\u521b\u5efa\u65e5\u671f
if(isShowList.indexOf("-11")!=-1){ 
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -11");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("createdate");//xwj for td2451 20051114
        rcListBean.setFieldId("-11");//xwj for td2451 20051114
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(722,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("createdate");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
          reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
          reportCompositorOrderBean.setFieldName("createdate");
          reportCompositorOrderBean.setSqlFlag("c");
          compositorOrderList.add(reportCompositorOrderBean);
        }
    }
}
 
//\u5de5\u4f5c\u6d41



if(isShowList.indexOf("-12")!=-1){ 
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -12");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("workflowid");//xwj for td2451 20051114
        rcListBean.setFieldId("-12");//xwj for td2451 20051114
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(26361,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("workflowid");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
         reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
         reportCompositorOrderBean.setFieldName("workflowid");
         reportCompositorOrderBean.setSqlFlag("c");
         compositorOrderList.add(reportCompositorOrderBean);
        }
    }
}

//\u5f53\u524d\u8282\u70b9
if(isShowList.indexOf("-13")!=-1){ 
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -13");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("currentnodeid");//xwj for td2451 20051114
        rcListBean.setFieldId("-13");//xwj for td2451 20051114
        String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(18564,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("currentnodeid");
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
         reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
         reportCompositorOrderBean.setFieldName("currentnodeid");
         reportCompositorOrderBean.setSqlFlag("c");
         compositorOrderList.add(reportCompositorOrderBean);
        }
    }
}

if(isShowList.indexOf("-14")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -14");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("requestid");//xwj for td2451 20051114
        rcListBean.setFieldId("-14");//xwj for td2451 20051114
        rcListBean.setHtmlType("-14");
        rcListBean.setTypes("-14");
        rcListBean.setIsDetail("0");
       String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(16354,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("requestid");
       if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
          totleWidth += Double.parseDouble(fieldwidth);
         totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
          reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
          reportCompositorOrderBean.setFieldName("requestid");
          reportCompositorOrderBean.setSqlFlag("c");
          compositorOrderList.add(reportCompositorOrderBean);
        }
    }
 }
//-15
 
 if(isShowList.indexOf("-15")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -15");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("currentnodetype");//xwj for td2451 20051114
        rcListBean.setFieldId("-15");//xwj for td2451 20051114
        rcListBean.setHtmlType("-15");
        rcListBean.setTypes("-15");
        rcListBean.setIsDetail("0");
       String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(31485,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("currentnodetype");
       if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
          totleWidth += Double.parseDouble(fieldwidth);
         totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
          reportCompositorOrderBean = new ReportCompositorOrderBean();
          reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
          reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
          reportCompositorOrderBean.setFieldName("currentnodetype");
          reportCompositorOrderBean.setSqlFlag("c");
          compositorOrderList.add(reportCompositorOrderBean);
        }
    }
 }
//-16
 
 if(isShowList.indexOf("-16")!=-1){   
    rs1.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = -16");
    if(rs1.next()){
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(rs1.getDouble("dsporder"));//xwj for td2451 20051114
        rcListBean.setSqlFlag("c");//xwj for td2451 20051114
        rcListBean.setFieldName("lastoperatedate");//xwj for td2451 20051114
        rcListBean.setFieldId("-16");//xwj for td2451 20051114
      rcListBean.setHtmlType("-16");
        rcListBean.setTypes("-16");
        rcListBean.setIsDetail("0");
       String fieldwidth = Util.null2String(rs1.getString("fieldwidth"));
        rcListBean.setFieldWidth(fieldwidth);
        rcListBean.setColName(SystemEnv.getHtmlLabelName(3000,user.getLanguage()));//xwj for td2451 20051114
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add("lastoperatedate");
       if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
          totleWidth += Double.parseDouble(fieldwidth);
         totleindex++;
        }
        if("1".equals(rs1.getString("dborder"))){
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(rs1.getInt("compositororder"));
          reportCompositorOrderBean.setOrderType(Util.null2String(rs1.getString("dbordertype")));
          reportCompositorOrderBean.setFieldName("lastoperatedate");
          reportCompositorOrderBean.setSqlFlag("c");
          compositorOrderList.add(reportCompositorOrderBean);
        }
    }
 }
   
    /*-----  xwj for td2974 20051026   E N D ----*/
    
    /*-----  xwj for td2974 20051026   B E G I N  ---*/
    sql = " select a.fieldname , c.labelname, a.fieldhtmltype, a.type, b.isstat , a.viewtype , b.dborder , a.id , b.dbordertype , b.compositororder, b.dsporder, a.detailtable as detailtable ,b.fieldwidth from  workflow_billfield a, Workflow_ReportDspField b , HtmlLabelInfo c " +
          " where a.id = b.fieldid and a.fieldlabel = c.indexid and b.reportid = " + reportid +" and  c.languageid = " + user.getLanguage() + " order by b.dsporder " ;
    /*-----  xwj for td2974 20051026   end  ---*/
    //System.out.println("***********sql = "+sql);
    RecordSet.execute(sql) ;
    while(RecordSet.next()) {

        if(isShowList.indexOf(Util.null2String(RecordSet.getString(8)))==-1){
            continue;
        }

        String viewtype = Util.null2String(RecordSet.getString(6)) ;
        if(viewtype.equals("1")) {
            if(isNewBill) viewtype = Util.null2String(RecordSet.getString("detailtable")) ;
            else
            viewtype ="d" ; // "b." --> "b"   xwj for td2131 on 2005-06-20
            detailcount ++ ;
        }
        else {
            viewtype ="a" ; // "a." --> "a"   xwj for td2131 on 2005-06-20
            maincount ++ ;
        }

        /*-----  xwj for td2974 20051026   B E G I N  ---*/
        rcListBean = new ReportCompositorListBean();//xwj for td2451 20051114
        rcListBean.setCompositorList(RecordSet.getDouble(11));//xwj for td2451 20051114
        rcListBean.setSqlFlag(viewtype);//xwj for td2451 20051114
        rcListBean.setFieldName(Util.null2String(RecordSet.getString(1)));//xwj for td2451 20051114
        rcListBean.setFieldId(Util.null2String(RecordSet.getString(8)));//xwj for td2451 20051114
        rcListBean.setColName(Util.toScreen(RecordSet.getString(2),user.getLanguage()));//xwj for td2451 20051114
        //rcListBean.setFieldWidth(Util.null2String(RecordSet.getString(13)));//xwj for td2451 20051114
        String fieldwidth = Util.null2String(RecordSet.getString(13));
        rcListBean.setFieldWidth(fieldwidth);
        if(!("".equals(fieldwidth) || "0.00".equals(fieldwidth) || "0".equals(fieldwidth))){
            totleWidth += Double.parseDouble(fieldwidth);
            totleindex++;
        }
        compositorColList.add(rcListBean);//xwj for td2451 20051114
        fields.add(Util.null2String(RecordSet.getString(1))) ;
         /*-----  xwj for td2974 20051026   E N D  ---*/
        
         // deleted by xwj for td2974 20051026

        if(Util.null2String(RecordSet.getString(7)).equals("1")) {
            /* ---deleted and added by xwj for td2099 on 2005-06-08      B E G I N ---*/
            //orderbystr = " order by " + viewtype + Util.null2String(RecordSet.getString(1)) ;
            reportCompositorOrderBean = new ReportCompositorOrderBean();
            reportCompositorOrderBean.setCompositorOrder(RecordSet.getInt(10));
            reportCompositorOrderBean.setOrderType(Util.null2String(RecordSet.getString(9)));
            reportCompositorOrderBean.setFieldName(Util.null2String(RecordSet.getString(1)));
            reportCompositorOrderBean.setSqlFlag(viewtype);
            compositorOrderList.add(reportCompositorOrderBean);
             /* ---deleted and added by xwj for td2099 on 2005-06-08      E N D ---*/
             // deleted by xwj for td2974 20051026
        }
        // deleted by xwj for td2974 20051026
        //delete by xhheng @20050127 for TD 1621

    }
    /*-----  xwj for td2974 20051026  B E G I N  ---*/
    
     /*-----  xwj for td2451 on 2005-11-14  B E G I N  ---*/
    compositorColList2 = ReportComInfo.getCompositorList(compositorColList); //xwj for td2451 on 2005-11-14
    for(int a = 0; a < compositorColList2.size(); a++){
    rcColListBean = (ReportCompositorListBean)compositorColList2.get(a);
    RecordSet.executeSql("select * from Workflow_ReportDspField where reportid = " + reportid + " and fieldid = " +rcColListBean.getFieldId());
    if(RecordSet.next()){
      /*-----  xwj for td2451 on 2005-11-14  E N D  ---*/
    
    String  tempfieldid = RecordSet.getString("fieldid");
    fieldwidths.add(rcColListBean.getFieldWidth());
    if("-1".equals(tempfieldid) || "-2".equals(tempfieldid) || "-10".equals(tempfieldid) || "-11".equals(tempfieldid) || "-12".equals(tempfieldid) || "-13".equals(tempfieldid) || "-14".equals(tempfieldid) || "-15".equals(tempfieldid) || "-16".equals(tempfieldid)){
    htmltypes.add(tempfieldid);
    types.add(tempfieldid);
    isdetails.add("");
    }
    else{
    rs3.executeSql("select formid from workflow_report b where   b.id = "+ reportid);
    if(rs3.next()){
    rs2.executeSql("select * from workflow_billfield where id = " + tempfieldid + " and billid=" + rs3.getString("formid"));
    if(rs2.next()){
     htmltypes.add(Util.null2String(rs2.getString("fieldhtmltype")));
     types.add(Util.null2String(rs2.getString("type")));
     isdetails.add(Util.null2String(rs2.getString("viewtype")));
/* QC136988 \u660e\u7ec6\u8868\u5b57\u6bb5\u5224\u65ad\u53c2\u6570\u83b7\u53d6\u4fee\u6539\uff0c\u7cfb\u7edf\u8868\u5355\u660e\u7ec6\u5b57\u6bb5\u65e0detailtable\u5b57\u6bb5\u503c\u5bfc\u81f4\u95ee\u9898



     String detailtabletmp = Util.null2String(rs2.getString("detailtable"));
     if(!"".equals(detailtabletmp)){
         isdetails.add("1");
     }else{
         isdetails.add("");
     }
     */
    }
    }
    }
    fieldids.add(tempfieldid);
    if(Util.null2String(RecordSet.getString("isstat")).equals("1")) {
            statcount ++ ;
            isstats.add("1") ;
    }
    else{ 
      isstats.add("") ;
    }
    statvalues.add("") ;
    tempstatvalues.add("") ;
     if(Util.null2String(RecordSet.getString("dborder")).equals("1")) {
            ordercount ++ ;
            isdborders.add("1") ;
    }
    else{ 
      isdborders.add("") ;
    }
   }
    } //xwj for td2451 on 2005-11-14 
    fieldname =  ReportComInfo.getCompositorListByStrs(compositorColList)+",c.requestid"; //xwj for td2451 on 2005-11-14
    orderbystr = ReportComInfo.getCompositorOrderByStrs(compositorOrderList); //added by xwj for td2099 on2005-06-08
    /*-----  xwj for td2974 20051026   E N D  ---*/
    
    sql = " select tablename , detailtablename , detailkeyfield from workflow_bill where id = " + formid ;
    RecordSet.execute(sql) ;
    RecordSet.next() ;
    tablename = Util.null2String(RecordSet.getString(1)) ;
    detailtablename = Util.null2String(RecordSet.getString(2)) ;
    detailkeyfield = Util.null2String(RecordSet.getString(3)) ;
    if(isNewBill){//\u65b0\u8868\u5355



        detailtablename = "";
        RecordSet.executeSql("select tablename from workflow_billdetailtable where billid="+formid);
        while(RecordSet.next()){
            detailtablename += RecordSet.getString("tablename")+",";
        }
    }
}
if (hasrightdeps.equals("")) hasrightdeps="-100";
if(hasrightdeps.startsWith(",")) hasrightdeps = hasrightdeps.substring(1);
String otherSqlWhere = "";
if(RecordSet.getDBType().equals("oracle"))
{
    otherSqlWhere += " and nvl(r.currentstatus,-1) = -1 ";
}
else
{
    otherSqlWhere += " and isnull(r.currentstatus,-1) = -1 ";
}
if(isbill.equals("0")) {
    //modify by xhheng @20050322 for Td 1625
    //modify by xhheng @20050127 for TD 1621
    if((sharelevel_1 <2 && sharelevel_1>-1) || (sharelevel_1<2 && (sharelevel_2 ==3 || sharelevel_3==9))) {
        if (RecordSet.getDBType().equals("oracle")||RecordSet.getDBType().equals("db2"))
        {
         sql="SELECT "+fieldname+",a.requestid FROM" +
        " Workflow_Report b INNER JOIN (select deleted,formid,workflowid,id,requestid ,creater,createdate,workflowid,currentnodeid,lastoperatedate,lastoperator,status,workflowid,requestname,requestlevel,currentnodetype,lastoperatedate from workflow_requestbase,workflow_base where (workflow_requestbase.deleted <> 1 or workflow_requestbase.deleted is null or workflow_requestbase.deleted='') and (workflow_base.isvalid='1' or workflow_base.isvalid='3') and workflow_requestbase.workflowid=workflow_base.id "+otherSqlWhere+")  c INNER JOIN hrmresource e INNER JOIN hrmdepartment f " + 
        " ON e.departmentid=f.id ON c.creater=e.id  ON b.formid = c.formid   and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'||to_char(c.id)||',%'" +
        " INNER JOIN workflow_form a ";
        }
        else
        {
      sql="SELECT "+fieldname+",a.requestid FROM" +
        " Workflow_Report b INNER JOIN (select deleted,formid,workflowid,id,requestid ,creater,createdate,workflowid,currentnodeid,lastoperatedate,lastoperator,status,workflowid,requestname,requestlevel,currentnodetype,lastoperatedate from workflow_requestbase,workflow_base where (workflow_requestbase.deleted <> 1 or workflow_requestbase.deleted is null or workflow_requestbase.deleted='') and (workflow_base.isvalid='1' or workflow_base.isvalid='3') and workflow_requestbase.workflowid=workflow_base.id "+otherSqlWhere+")  c INNER JOIN hrmresource e INNER JOIN hrmdepartment f " + 
        " ON e.departmentid=f.id ON c.creater=e.id  ON b.formid = c.formid   and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'+convert(varchar,c.id)+',%'" +
        " INNER JOIN workflow_form a ";
        }
     if(detailcount != 0 ){  
         sql+=  " LEFT JOIN workflow_formdetail d  ON a.requestid = d.requestid " ;
         String tempGroupIds = ",";
         ArrayList fieldnamelist = Util.TokenizerString(fieldname,",");
         for(int tempindex=0;tempindex<fieldnamelist.size();tempindex++){
             String tempfieldname = (String)fieldnamelist.get(tempindex);
             if(tempfieldname.indexOf("d.")==0){
                 tempfieldname = tempfieldname.substring(2);
                 RecordSet.executeSql("select groupId from workflow_formfield where formid="+formid+" and fieldid=(select id from workflow_formdictdetail where fieldname='"+tempfieldname+"')");
                 if(RecordSet.next()){
                     String tempGroupId = RecordSet.getString("groupId");
                     if(tempGroupIds.indexOf(","+tempGroupId+",")<0)
                         tempGroupIds += tempGroupId+",";
                 }
             }
         }
         if(!tempGroupIds.equals(",")){//\u5728\u591a\u660e\u7ec6\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u9700\u8981\u663e\u793a\u7684\u660e\u7ec6\u3002



             String tempSql = "(";
             ArrayList tempGroupIdslist = Util.TokenizerString(tempGroupIds,",");
             for(int tempindex=0;tempindex<tempGroupIdslist.size();tempindex++){
                 String tempGroupId = (String)tempGroupIdslist.get(tempindex);
                 if(tempSql.equals("(")) tempSql += "d.groupId="+tempGroupId;
                 else tempSql += " or d.groupId="+tempGroupId;
             }
             tempSql += ")";
             if(!tempSql.equals("()")){
                 sql += " and " + tempSql;
             }
         }
     }
       
      sql+= "  ON c.requestid = a.requestid  " +
        " WHERE (b.id = "+reportid+") AND (f.id in("+hasrightdeps+"))";
    }else{
            if (RecordSet.getDBType().equals("oracle")||RecordSet.getDBType().equals("db2"))
        {
             sql = "SELECT "+fieldname+",a.requestid FROM Workflow_Report b " +
              "INNER JOIN (select deleted,formid,workflowid,id,requestid ,creater,createdate,workflowid,currentnodeid,lastoperatedate,lastoperator,status,workflowid,requestname,requestlevel,currentnodetype,lastoperatedate from workflow_requestbase,workflow_base where (workflow_requestbase.deleted <> 1 or workflow_requestbase.deleted is null or workflow_requestbase.deleted='') and (workflow_base.isvalid='1' or workflow_base.isvalid='3') and workflow_requestbase.workflowid=workflow_base.id "+otherSqlWhere+") c " +
              "ON  b.formid = c.formid and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'||to_char(c.id)||',%' " +
              "INNER JOIN workflow_form a " ;
            }
            else
        {
      sql = "SELECT "+fieldname+",a.requestid FROM Workflow_Report b " +
              "INNER JOIN (select deleted,formid,workflowid,id,requestid ,creater,createdate,workflowid,currentnodeid,lastoperatedate,lastoperator,status,workflowid,requestname,requestlevel,currentnodetype,lastoperatedate from workflow_requestbase,workflow_base where (workflow_requestbase.deleted <> 1 or workflow_requestbase.deleted is null or workflow_requestbase.deleted='') and (workflow_base.isvalid='1' or workflow_base.isvalid='3') and workflow_requestbase.workflowid=workflow_base.id "+otherSqlWhere+") c " +
              "ON  b.formid = c.formid and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'+convert(varchar,c.id)+',%' " +
              "INNER JOIN workflow_form a " ;
        }
     if(detailcount != 0 ) {  
         sql+=  " LEFT JOIN workflow_formdetail d  ON a.requestid = d.requestid " ;
         String tempGroupIds = ",";
         ArrayList fieldnamelist = Util.TokenizerString(fieldname,",");
         for(int tempindex=0;tempindex<fieldnamelist.size();tempindex++){
             String tempfieldname = (String)fieldnamelist.get(tempindex);
             if(tempfieldname.indexOf("d.")==0){
                 tempfieldname = tempfieldname.substring(2);
                 RecordSet.executeSql("select groupId from workflow_formfield where formid="+formid+" and fieldid=(select id from workflow_formdictdetail where fieldname='"+tempfieldname+"')");
                 if(RecordSet.next()){
                     String tempGroupId = RecordSet.getString("groupId");
                     if(tempGroupIds.indexOf(","+tempGroupId+",")<0)
                         tempGroupIds += tempGroupId+",";
                 }
             }
         }
         if(!tempGroupIds.equals(",")){//\u5728\u591a\u660e\u7ec6\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u9700\u8981\u663e\u793a\u7684\u660e\u7ec6\u3002



             String tempSql = "(";
             ArrayList tempGroupIdslist = Util.TokenizerString(tempGroupIds,",");
             for(int tempindex=0;tempindex<tempGroupIdslist.size();tempindex++){
                 String tempGroupId = (String)tempGroupIdslist.get(tempindex);
                 if(tempSql.equals("(")) tempSql += "d.groupId="+tempGroupId;
                 else tempSql += " or d.groupId="+tempGroupId;
             }
             tempSql += ")";
             if(!tempSql.equals("()")){
                 sql += " and " + tempSql;
             }
         }
     }
             
       sql+= " ON c.requestid = a.requestid " +
              "WHERE (b.id = "+reportid+")";
    }
}
else {
    //modify by xhheng @20050127 for TD 1621
    boolean haswhere = false ;
    //modify by mackjoe at 20070625 for TD6865
    if(detailcount != 0 && ("156".equals(formid) || "157".equals(formid) || "158".equals(formid) || "159".equals(formid))){
        fieldname+=",d.organizationtype";
    }
    sql = " select " + fieldname + ", c.workflowid c_workflowid_QC194991, c.formid c_formid_QC194991 from " ;
    sql += " Workflow_Report b INNER JOIN (select deleted,formid,workflowid,id,requestid ,creater,requestname,requestlevel,currentnodetype,lastoperatedate from workflow_requestbase,workflow_base where (workflow_requestbase.deleted <> 1 or workflow_requestbase.deleted is null or workflow_requestbase.deleted='') and (workflow_base.isvalid='1' or workflow_base.isvalid='3') and workflow_requestbase.workflowid=workflow_base.id "+otherSqlWhere+") c " ;
    if((sharelevel_1 <2 && sharelevel_1>-1) || (sharelevel_1<2 && (sharelevel_2 ==3 || sharelevel_3==9))) {
        if (RecordSet.getDBType().equals("oracle")||RecordSet.getDBType().equals("db2"))
        {
            sql += " INNER JOIN hrmresource e INNER JOIN hrmdepartment f ON e.departmentid=f.id ON c.creater=e.id and f.id in("+hasrightdeps+") ON b.formid = c.formid and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'|| to_char(c.id) || ',%' ";
        }else{
            sql += " INNER JOIN hrmresource e INNER JOIN hrmdepartment f ON e.departmentid=f.id ON c.creater=e.id and f.id in("+hasrightdeps+") ON b.formid = c.formid and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'+convert(varchar,c.id)+',%' ";
        }
        
        //sql += " INNER JOIN hrmresource e INNER JOIN hrmdepartment f ON e.departmentid=f.id ON c.creater=e.id and f.id in("+hasrightdeps+") ON b.formid = c.formid and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'+convert(varchar,c.id)+',%' ";
    }else{
        if (RecordSet.getDBType().equals("oracle")||RecordSet.getDBType().equals("db2"))
        {
            sql += " ON b.formid = c.formid and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'||to_char(c.id)||',%'  and b.id="+reportid ;
        }
        else
        {
            sql += " ON b.formid = c.formid and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'+convert(varchar,c.id)+',%'  and b.id="+reportid;
        }
    }
    sql += " INNER JOIN " + tablename + " a ";
    if(detailcount != 0 ) {
        if(isNewBill){
            //String fromSQL = "";
            //String whereSQL = "";
            List detailtablenameList = Util.TokenizerString(detailtablename, ",");
            for(int tempInt=0;tempInt<detailtablenameList.size();tempInt++){
                String tempdetailtablename = (String)detailtablenameList.get(tempInt);
                sql += " LEFT JOIN "+tempdetailtablename + " ON a.id="+tempdetailtablename+"."+detailkeyfield;
                //fromSQL += tempdetailtablename+",";
                //if(whereSQL.equals("")) whereSQL = " where a.id="+tempdetailtablename+"."+detailkeyfield;
                //else whereSQL += " and a.id="+tempdetailtablename+"."+detailkeyfield;
            }
            //if(!fromSQL.equals("")){
            //  fromSQL = fromSQL.substring(0,fromSQL.length()-1);
            //  sql += ", "+fromSQL+whereSQL;
            //}
            haswhere = true ;
        }else{
            sql += " LEFT JOIN " + detailtablename + " d ON a.id = d." +  detailkeyfield ;
            haswhere = true ;
      }
      //sql += " ON c.requestid = a.requestid ";
    }
    sql += " ON c.requestid = a.requestid ";

    //if(formid.equals("180")&&isbill.equals("1")){//\u8bf7\u5047\u5355\u636e
    //  sql += " ON c.requestid = a.requestid ";
    //}

    //if(haswhere)  {
    //  sql += " and ";
    //}else {
    //  sql += " where ";
    //}
    if((sharelevel_1 <2 && sharelevel_1>-1) || (sharelevel_1<2 && (sharelevel_2 ==3 || sharelevel_3==9))) {
    //  sql += " c.creater=e.id and e.departmentid=f.id and f.id in("+hasrightdeps+") and ";
    //}
    if (RecordSet.getDBType().equals("oracle")||RecordSet.getDBType().equals("db2"))
        {
       sql += " and b.formid = c.formid and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'||to_char(c.id)||',%'  and b.id="+reportid+" and a.requestid = c.requestid " ;
    }
    else
    {
    sql += " and b.formid = c.formid and '" + "," + WorkflowVersion.getAllVersionStringByWFIDs(reportwfid) + "," + "' like '%,'+convert(varchar,c.id)+',%'  and b.id="+reportid+" and a.requestid = c.requestid " ;
    }
    }
}
//    out.println("====================");
sql = request.getParameter("pmSql");

//------------------------------------------
int pageSize = Util.getIntValue((String)request.getParameter("pageSize"), 20);
int currentPage = Util.getIntValue((String)request.getParameter("currentPage"), 1);
int rowcount = 0;
int pageCount = 0;
String dbType = RecordSet.getDBType();
String countsql = "";
if ("sqlserver".equals((dbType))) {
    //countsql = "select count(1) as count from (" + " SELECT TOP 100 PERCENT " + sql.substring(sql.toLowerCase().indexOf("select") + 6) + ") tbl_1";
    countsql = "select count(1) as count from (" + " SELECT TOP 100 PERCENT t1.* from (" + sql + ") t1 ) tbl_1";
} else {
    countsql = "select count(1) as count from (" + sql + ") tbl_1";
}

//System.out.println("===========================");
//System.out.println("===========================");
//System.out.println("...sql=" + sql);

//System.out.println("===========================");
//System.out.println("===========================");

RecordSet.execute(countsql);
if (RecordSet.next()) {
    rowcount = Util.getIntValue(RecordSet.getString("count"), 0);
}

if(rowcount % pageSize == 0) {
    pageCount = rowcount / pageSize;
} else {
    pageCount = rowcount / pageSize + 1;
}

int tmpPageSize = pageSize;

if (rowcount - currentPage * pageSize < 0) {
    tmpPageSize = currentPage * pageSize - rowcount;
}

String tmpTblName = null;

StringBuffer splitPageSql = new StringBuffer();
if ("sqlserver".equals((dbType))) {
    
    tmpTblName = "TEMP_TBL_RPTDATA_" + new Date().getTime();
    StringBuffer splitinertSql = new StringBuffer();
    
    splitinertSql.append("SELECT *, identity(int,1,1) as rptRltSltId into " + tmpTblName + " FROM (");
    splitinertSql.append(" select top " + pageSize * currentPage + " * from  (    ");
    //splitinertSql.append(" SELECT TOP 100 PERCENT " + sql.substring(sql.toLowerCase().indexOf("select") + 6));
    splitinertSql.append(" SELECT TOP 100 PERCENT t1.* from (" + sql + ") t1");
    splitinertSql.append("    ) tbl");
    splitinertSql.append(") tbl");
    RecordSet.execute(splitinertSql.toString());
    if (currentPage == 1) {
        splitPageSql.append(" select top " + pageSize + " * from ");
        splitPageSql.append(tmpTblName);
    } else {
        splitPageSql.append(" select * from ");
        splitPageSql.append(tmpTblName);
        splitPageSql.append(" where rptRltSltId > ");
        splitPageSql.append((currentPage - 1) * pageSize);
    }
} else {
    splitPageSql.append(" SELECT * FROM ");
    splitPageSql.append(" (");
    splitPageSql.append(" SELECT A.*, ROWNUM RN ");
    splitPageSql.append(" FROM (SELECT * FROM (" + sql + ")) A ");
    splitPageSql.append(" WHERE ROWNUM <= " + currentPage * pageSize + "");
    splitPageSql.append(" )");
    splitPageSql.append(" WHERE RN > " + (currentPage - 1) * pageSize + "");
}


String oldsql = sql;
if(!"1".equals(outputExcel)){
    sql = splitPageSql.toString();
}
Map statisticsRowKv = new HashMap();
List rowNames = new ArrayList();
//------------------------------------------
ArrayList colList = ReportComInfo.getCompositorList(compositorColList); //xwj for td2451 on 2005-11-14
int totalWidth = 25;
String colStr = "";
String strtotalWidth = "width:100%;";
totalWidth = colList.size()*80;
if(100/colList.size() < 5 ) {
    //totalWidth = 1000;
    strtotalWidth = "width:" + totalWidth + "px;";
}


      out.write(_jsp_string70, 0, _jsp_string70.length);
      out.print((strtotalWidth));
      out.write(_jsp_string71, 0, _jsp_string71.length);
      
////\u79fb\u5230\u524d\u9762\u5904\u7406  fanggsh 20060828 for TD4875
//rs2.executeSql("select reportname from workflow_report where id = " + reportid);
//String titlename1 = "";
//if(rs2.next()){
//titlename1 = rs2.getString("reportname") ;
//}

      out.write(_jsp_string72, 0, _jsp_string72.length);
      
  ExcelSheet es = new ExcelSheet() ;
  ExcelRow er = es.newExcelRow () ;
  /*-----  xwj for td2451 20051114  B E G I N   ---*/
  double several = 0.00;
  int minnum = colList.size()-totleindex;
  //System.out.println("minnum = "+minnum);
  if(totleWidth >= 100){
      several = 100/(totleWidth+minnum*10);
      totleWidth = minnum*10;
  }else{
      if(minnum == 0){
          several = 100/totleWidth;
          minnum = 1;
      }else{
          several = 1.00;
      }
      double surplus = (100 - totleWidth)/minnum*several;
      if(surplus < 3){
          several = 100/(totleWidth+minnum*3);
          totleWidth = minnum*3;
      }else{
          totleWidth = 100 - totleWidth;
      }
  }
   for(int i = 0; i < colList.size(); i++) {
        rcColListBean = (ReportCompositorListBean) colList.get(i);
        String fieldwidthn = Util.null2String(rcColListBean.getFieldWidth());
        //System.out.println("fieldwidthn = "+fieldwidthn);
        //if(fieldwidthn!=""&&fieldwidthn!=null&&fieldwidthn!="0.00"){
            //fieldwidthn= fieldwidthn + "%";
        //}else{ 
            //fieldwidthn = 100.00/colList.size() + "%";
        //}
        double fieldwidthnnew = 0.00;
        if("".equals(fieldwidthn) || "0.00".equals(fieldwidthn) || "0".equals(fieldwidthn)){
            fieldwidthnnew = (totleWidth/minnum)*several;
        }else{
            fieldwidthnnew = Double.parseDouble(fieldwidthn)*several;
        }
        //System.out.println("fieldwidthnnew = "+fieldwidthnnew);
        BigDecimal   b   =   new   BigDecimal(fieldwidthnnew);  
        double   f1   =   b.setScale(2,   BigDecimal.ROUND_HALF_UP).doubleValue();  
        er.addStringValue(rcColListBean.getColName()) ;
  
      out.write(_jsp_string73, 0, _jsp_string73.length);
      out.print((f1 + "%"));
      out.write(_jsp_string74, 0, _jsp_string74.length);
      out.print((rcColListBean.getColName()));
      out.write(_jsp_string75, 0, _jsp_string75.length);
      out.print((rcColListBean.getColName()));
      out.write(_jsp_string76, 0, _jsp_string76.length);
      }
     es.addExcelRow(er) ;
   
  /*-----  xwj for td2451 20051114   E N D  ---*/
  
    
      out.write(_jsp_string77, 0, _jsp_string77.length);
      
   //alan

    String useddetailtable = Util.null2String(request.getParameter("useddetailtable"));
    //RecordSet.execute(sql);
    int needchange = 0;
    String tempvalue = ""; //added by xwj for td2132 on 20050701
    String tempdbordervalue = "" ;
    boolean needstat = false ;
    boolean isfirst = true ;
    if(!"".equals(useddetailtable)) useddetailtable = useddetailtable.substring(1);
    detailtablename = useddetailtable;
    ArrayList detailtablenameList = Util.TokenizerString(detailtablename, ",");
    int details = detailtablenameList.size();
    String[] detailids = null;
    if(details>0) detailids = new String[details];
    for(int flag=0;flag<details;flag++){
        detailids[flag] = ",";
    }

    if(details>0&&isNewBill){
        
    	  RecordSet.execute("select * from (" + sql + ") tb1 order by tb1.requestid");	
  		String old_requestid = "";
  		Map<String, List<String>> dtMap = new HashMap<String, List<String>>();
  		while(RecordSet.next()){
  			if(details > 1 && !old_requestid.equals(RecordSet.getString("requestid"))){
  				old_requestid = RecordSet.getString("requestid");
  				dtMap.clear();
  			}
  			
  			boolean isExec = false;
  			for(int indexflag=0;indexflag<details;indexflag++){
  				String thisrowflag = (String)detailtablenameList.get(indexflag);				
  				thisrowflag = thisrowflag.toUpperCase();
  				
  				if(details > 1){
  					String thisdetailid = RecordSet.getString(thisrowflag + "_id_");
  				
  					if("".equals(thisdetailid)){
  						if(isExec || indexflag != (details-1)){
  							continue;
  						}
  					}else{
  						isExec = true;
  					}					
  				
  					List dtList = dtMap.get(thisrowflag);
  					if(dtList == null){					
  						dtList = new ArrayList<String>();
  						dtList.add(thisdetailid);
  						dtMap.put(thisrowflag, dtList);
  					}else{
  						if(!dtList.contains(thisdetailid)){
  							dtList.add(thisdetailid);
  						}else{
  							continue;
  						}
  					}
  				}
        if(ordercount == 1) { //modified by xwj for td2132 on 20050701
            for(int i =0 ; i< fields.size() ; i++) {
                if(((String)isdborders.get(i)).equals("1")) {
                    tempvalue = Util.null2String(RecordSet.getString(i+1));
                    if(!tempvalue.equals(tempdbordervalue)) {
                        needstat = true ;
                        tempdbordervalue = tempvalue ;
                    }
                    else {
                        needstat = false ;
                    }
                }
            }
        }
        
        //added by xwj for td2132 on 20050701
        
        if(ordercount > 1){
            List list  = new ArrayList();
            for(int i =0 ; i< fields.size() ; i++) {
                if(((String)isdborders.get(i)).equals("1")) {
                     tempvalue += Util.null2String(RecordSet.getString(i+1));
                }
           }
          
              if(!tempvalue.equals(tempdbordervalue)) {
                        needstat = true ;
                        tempdbordervalue = tempvalue ;
                    }
                    else {
                        needstat = false ;
                    }
           tempvalue = "";
        } 
  
        if(needstat && statcount != 0 && !isfirst ) {
            er = es.newExcelRow () ;
        
      out.write(_jsp_string78, 0, _jsp_string78.length);
       for(int i =0 ; i< tempstatvalues.size() ; i++) {
               er.addValue(formatData((String)tempstatvalues.get(i))) ;
            
      out.write(_jsp_string79, 0, _jsp_string79.length);
      out.print((formatData((String)tempstatvalues.get(i))));
      out.write(_jsp_string75, 0, _jsp_string75.length);
      out.print((formatData((String)tempstatvalues.get(i))));
      out.write(_jsp_string80, 0, _jsp_string80.length);
      tempstatvalues.set(i,"") ; }

              es.addExcelRow(er) ;
            
      out.write(_jsp_string81, 0, _jsp_string81.length);
      out.print((colList.size()));
      out.write(_jsp_string82, 0, _jsp_string82.length);
      
        }

        isfirst = false ;

        er = es.newExcelRow () ;

        if(needchange ==0){
            needchange = 1;

      out.write(_jsp_string83, 0, _jsp_string83.length);
      
    }else{
        needchange=0;
  
      out.write(_jsp_string84, 0, _jsp_string84.length);
      }
      out.write(_jsp_string85, 0, _jsp_string85.length);
      
          String temRequestid = RecordSet.getString("requestid");
          String temWorkflowid = Util.null2String(RecordSet.getString("c_workflowid_QC194991")).trim();
          String temFormid = Util.null2String(RecordSet.getString("c_formid_QC194991")).trim();

          if(!temRequestid.equals(requestid)){
              isnew = true;
              requestid = temRequestid;
          }else{
              isnew = false;
          }

  String leavetype = "";
  for(int i =0 ; i< fields.size() ; i++) {
     String result = Util.null2String(RecordSet.getString(i+1)) ;
     String name = "" ;
    //modify by mackjoe at 20070625 for TD6865
    String tcolname= RecordSet.getColumnName(i+1);
    String tcolname_fullname = tcolname.toUpperCase();
    if(tcolname.toLowerCase().equals("c_requestname")){
        result = "<a href=\"javaScript:openFullWindowHaveBar('/workflow/request/ViewRequest.jsp?requestid="+requestid+"&reportid="+reportid+"&isfromreport=1&isovertime=0')\">"+result+"</a>";
    }
    if("1".equals(outputExcel)){
        result = Util.null2String(RecordSet.getString(i+1));
    }
    if(tcolname.indexOf("__")>0&&tcolname.toUpperCase().indexOf(thisrowflag)==-1) result = "";
    String htmltype = (String)htmltypes.get(i);
    int type = Util.getIntValue((String)types.get(i)) ;
    if(tcolname.indexOf("__")>0){
       tcolname = tcolname.substring(0,tcolname.indexOf("__"));
    }
    if(tcolname.equalsIgnoreCase("leavetype") && "1".equals(isbill) && "180".equals(formid)){
        leavetype=result;
    }
    if(tcolname.equalsIgnoreCase("otherleavetype") && "1".equals(isbill) && "180".equals(formid)){
        if(!leavetype.equals("4")) result = "";
    }

    //new BaseBean().writeLog("tcolname_fullname>>>"+tcolname_fullname);
    if(tcolname.equalsIgnoreCase("organizationid") && "1".equals(isbill) && ("156".equals(formid) || "157".equals(formid) || "158".equals(formid) || "159".equals(formid))){
        int organizationtype=Util.getIntValue(RecordSet.getString("organizationtype"));
        if(organizationtype==1){ //\u5206\u90e8
            type=42;
        }else{
        if(organizationtype==2){  //\u90e8\u95e8
            type=4;
        }
        if(organizationtype==3){  //\u4e2a\u4eba  \u9700\u8981\u628a\u4e2a\u4eba\u7684\u4e5f\u52a0\u4e0a
                type=1;
        }
        }
    }else if(temWorkflowid!=null&&temFormid!=null&&!"".equals(temWorkflowid)&&!"".equals(temFormid)&&tcolname_fullname!=null&&!"".equals(tcolname_fullname)){
        String fnaFeeWfInfo_fieldName_orgId_3 = Util.null2String(fnaFeeWfInfo_fieldName_hm.get(temWorkflowid+"_3")).trim().toUpperCase();//3\uff1a\u627f\u62c5\u4e3b\u4f53\uff1b
        String fnaFeeWfInfo_fieldName_orgId_isDtl_3 = Util.null2String(fnaFeeWfInfo_fieldIsDtl_hm.get(temWorkflowid+"_3")).trim();
        String fnaFeeWfInfo_fieldName_orgId_12 = Util.null2String(fnaFeeWfInfo_fieldName_hm.get(temWorkflowid+"_12")).trim().toUpperCase();//3\uff1a\u627f\u62c5\u4e3b\u4f53\uff1b
        String fnaFeeWfInfo_fieldName_orgId_isDtl_12 = Util.null2String(fnaFeeWfInfo_fieldIsDtl_hm.get(temWorkflowid+"_12")).trim();
        
        if("1".equals(fnaFeeWfInfo_fieldName_orgId_isDtl_3)){
            fnaFeeWfInfo_fieldName_orgId_3 = "FORMTABLE_MAIN_"+Math.abs(Util.getIntValue(temFormid,0))+"_DT1__"+fnaFeeWfInfo_fieldName_orgId_3;
            //new BaseBean().writeLog("1 fnaFeeWfInfo_fieldName_orgId>>>"+fnaFeeWfInfo_fieldName_orgId);
            //new BaseBean().writeLog("colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId)>>>"+colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId));
            if(colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId_3)){
                fnaFeeWfInfo_fieldName_orgId_3 = Util.null2String(colNameAliasNameHm.get(fnaFeeWfInfo_fieldName_orgId_3)).trim();
                //new BaseBean().writeLog("2 fnaFeeWfInfo_fieldName_orgId>>>"+fnaFeeWfInfo_fieldName_orgId);
            }
        }else{
            fnaFeeWfInfo_fieldName_orgId_3 = "A_"+fnaFeeWfInfo_fieldName_orgId_3;
        }
        fnaFeeWfInfo_fieldName_orgId_3 = fnaFeeWfInfo_fieldName_orgId_3.toUpperCase();
        
        if("1".equals(fnaFeeWfInfo_fieldName_orgId_isDtl_12)){
            fnaFeeWfInfo_fieldName_orgId_12 = "FORMTABLE_MAIN_"+Math.abs(Util.getIntValue(temFormid,0))+"_DT1__"+fnaFeeWfInfo_fieldName_orgId_12;
            //new BaseBean().writeLog("1 fnaFeeWfInfo_fieldName_orgId_12>>>"+fnaFeeWfInfo_fieldName_orgId_12);
            //new BaseBean().writeLog("colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId_12)>>>"+colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId_12));
            if(colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId_12)){
                fnaFeeWfInfo_fieldName_orgId_12 = Util.null2String(colNameAliasNameHm.get(fnaFeeWfInfo_fieldName_orgId_12)).trim();
                //new BaseBean().writeLog("2 fnaFeeWfInfo_fieldName_orgId_12>>>"+fnaFeeWfInfo_fieldName_orgId_12);
            }
        }else{
            fnaFeeWfInfo_fieldName_orgId_12 = "A_"+fnaFeeWfInfo_fieldName_orgId_12;
        }
        fnaFeeWfInfo_fieldName_orgId_12 = fnaFeeWfInfo_fieldName_orgId_12.toUpperCase();
        //new BaseBean().writeLog("3 fnaFeeWfInfo_fieldName_orgId_12>>>"+fnaFeeWfInfo_fieldName_orgId_12);

        //new BaseBean().writeLog("fnaFeeWfInfo_fieldName_orgId_3>>>>>>>>>>"+fnaFeeWfInfo_fieldName_orgId_3);
        //new BaseBean().writeLog("fnaFeeWfInfo_fieldName_orgId_12>>>>>>>>>>"+fnaFeeWfInfo_fieldName_orgId_12);
        //new BaseBean().writeLog("tcolname_fullname>>>>>>>>>>"+tcolname_fullname);
        if(fnaFeeWfInfo_fieldName_orgId_3.equals(tcolname_fullname) || fnaFeeWfInfo_fieldName_orgId_12.equals(tcolname_fullname)){
        	String _fieldType = "";
        	if(fnaFeeWfInfo_fieldName_orgId_3.equals(tcolname_fullname)){
        		_fieldType = "2";
        	}else if(fnaFeeWfInfo_fieldName_orgId_12.equals(tcolname_fullname)){
        		_fieldType = "11";
        	}
            //new BaseBean().writeLog("_fieldType>>>>>>>>>>"+_fieldType);
        	
            String fnaFeeWfInfo_fieldName_orgType = Util.null2String(fnaFeeWfInfo_fieldName_hm.get(temWorkflowid+"_"+_fieldType)).trim().toUpperCase();//2\uff1a\u627f\u62c5\u4e3b\u4f53\u7c7b\u578b\uff1b
            String fnaFeeWfInfo_fieldName_orgType_isDtl = Util.null2String(fnaFeeWfInfo_fieldIsDtl_hm.get(temWorkflowid+"_"+_fieldType)).trim();
            if("1".equals(fnaFeeWfInfo_fieldName_orgType_isDtl)){
                fnaFeeWfInfo_fieldName_orgType = "FORMTABLE_MAIN_"+Math.abs(Util.getIntValue(temFormid,0))+"_DT1__"+fnaFeeWfInfo_fieldName_orgType;
                if(colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgType)){
                    fnaFeeWfInfo_fieldName_orgType = Util.null2String(colNameAliasNameHm.get(fnaFeeWfInfo_fieldName_orgType)).trim();
                }
            }else{
                fnaFeeWfInfo_fieldName_orgType = "A_"+fnaFeeWfInfo_fieldName_orgType;
            }
            fnaFeeWfInfo_fieldName_orgType = fnaFeeWfInfo_fieldName_orgType.toUpperCase();
			String fna_orgType_value_QC194991 = "";
            if("".equals(fna_orgType_value_QC194991)){
                fna_orgType_value_QC194991 = Util.null2String(RecordSet.getString(fnaFeeWfInfo_fieldName_orgType)).trim();
            }
            //new BaseBean().writeLog("2 fna_orgType_value_QC194991>>>>>>>>>>"+fna_orgType_value_QC194991+";type="+type);
            if("2".equals(fna_orgType_value_QC194991)){ //\u5206\u90e8
                type=42;
            }else if("1".equals(fna_orgType_value_QC194991)){  //\u90e8\u95e8
                type=4;
            }else if("0".equals(fna_orgType_value_QC194991)){  //\u4e2a\u4eba  \u9700\u8981\u628a\u4e2a\u4eba\u7684\u4e5f\u52a0\u4e0a
                type=1;
            }else if("3".equals(fna_orgType_value_QC194991)){  //\u6210\u672c\u4e2d\u5fc3
                type=251;
            }
            //new BaseBean().writeLog("3 fna_orgType_value_QC194991>>>>>>>>>>"+fna_orgType_value_QC194991+";type="+type);
         }
    
    }
    
    String results[] = null ;
      
    /*-----  xwj for td2974 20051026   B E G I N  ---*/
    if(htmltype.equals("-2")) {
       if("0".equals(result)){
         result = SystemEnv.getHtmlLabelName(225,user.getLanguage());
       }
       else if("1".equals(result)){
         result = SystemEnv.getHtmlLabelName(15533,user.getLanguage()); 
       }
       else if("2".equals(result)){
         result = SystemEnv.getHtmlLabelName(2087,user.getLanguage());
       }
    }
    /*-----  xwj for td2974 20051026   E N D  ---*/
    
    //-----------------------------
    
    //\u521b\u5efa\u4eba



    if(htmltype.equals("-10")) {
        if("1".equals(outputExcel)){
            result = WorkFlowTransMethod.getWFSearchResultName(result,"0");
        }else{
            result = ResourceComInfo.getResourcename(result);
        }
    }
    //\u521b\u5efa\u65e5\u671f
    if(htmltype.equals("-11")) {
        //result = WorkFlowTransMethod.getWFSearchResultName(result,"0");
    }
    //\u5de5\u4f5c\u6d41



    if(htmltype.equals("-12")) {
        result = WorkflowComInfo.getWorkflowname(result);
    }
    //\u5f53\u524d\u8282\u70b9
    if(htmltype.equals("-13")) {
        result = WorkFlowTransMethod.getCurrentNode(result);
    }
    //\u672a\u64cd\u4f5c\u8005



    if(htmltype.equals("-14")) {
        if("1".equals(outputExcel)){
            result = WorkFlowTransMethod.getUnOptOutPutExcel(result);
        }else{
            result = WorkFlowTransMethod.getUnOptInRep(result);
        }
    }
    //\u6d41\u7a0b\u72b6\u6001



    if(htmltype.equals("-15")) {
        if(!"3".equals(result)){
            result = SystemEnv.getHtmlLabelName(17999,user.getLanguage());
        }else{
            result = SystemEnv.getHtmlLabelName(251,user.getLanguage());
        }
    }
    //\u5f52\u6863\u65e5\u671f
    if(htmltype.equals("-16")) {
        //result = SystemEnv.getHtmlLabelName(2087,user.getLanguage());
    }
    
    //-----------------------------
    
    if(htmltype.equals("3")) {
        switch (type) {
            case 1:
                result = Util.toScreen(ResourceComInfo.getResourcename(result),user.getLanguage()) ;
                break ;
            case 23:
                result = Util.toScreen(CapitalComInfo.getCapitalname(result),user.getLanguage()) ;
                break ;
            case 4:
                result = Util.toScreen(DepartmentComInfo.getDepartmentname(result),user.getLanguage()) ;
                break ;
            case 6:
                result = Util.toScreen(CostcenterComInfo.getCostCentername(result),user.getLanguage()) ;
                break ;
            case 7:
                result = Util.toScreen(CustomerInfoComInfo.getCustomerInfoname(result),user.getLanguage()) ;
                break ;
            case 8:
                result = Util.toScreen(ProjectInfoComInfo.getProjectInfoname(result),user.getLanguage()) ;
                break ;
            case 9:
                result = Util.toScreen(DocComInfo.getDocname(result),user.getLanguage()) ;
                break ;
            case 12:
                result = Util.toScreen(CurrencyComInfo.getCurrencyname(result),user.getLanguage()) ;
                break ;
            case 25:
                result = Util.toScreen(CapitalAssortmentComInfo.getAssortmentName(result),user.getLanguage()) ;
                break ;
            case 14:
            case 15:
                result = Util.toScreen(LedgerComInfo.getLedgername(result),user.getLanguage()) ;
                break ;
            case 16:
                result = Util.toScreen(RequestComInfo.getRequestname(result),user.getLanguage()) ;
                break ;
            case 17:
            
	            WorkflowJspBean workflowJspBean = new WorkflowJspBean();
	            workflowJspBean.setRequestid(Integer.valueOf(requestid));
	            StringBuffer _sbf = new StringBuffer(result);
	            String browsplitflg = ",";
	            String showname = workflowJspBean.getMultiResourceShowName(_sbf, "", ""+fieldids.get(i),user.getLanguage(), browsplitflg, false);
	            result = ""+delHtml(showname) ;
	            if(result.endsWith(",")){
	                result = result.substring(0,result.length() - 1);
	            }
	            /*
                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(ResourceComInfo.getResourcename(results[j]),user.getLanguage()) ;
                        else
                            result += ","+Util.toScreen(ResourceComInfo.getResourcename(results[j]),user.getLanguage()) ;
                    }
                }
                */
                break ;
            case 18:
                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(CustomerInfoComInfo.getCustomerInfoname(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(CustomerInfoComInfo.getCustomerInfoname(results[j]),user.getLanguage()) ;
                    }
                }
                break ;
            case 24:
                result = Util.toScreen(JobTitlesComInfo.getJobTitlesname(result),user.getLanguage()) ;
                break ;
            case 37:            // \u589e\u52a0\u591a\u6587\u6863\u5904\u7406



                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) ;
                    }
                }
                break ;
             case 57:            // \u589e\u52a0\u591a\u90e8\u95e8\u5904\u7406


                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(DepartmentComInfo.getDepartmentname(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(DepartmentComInfo.getDepartmentname(results[j]),user.getLanguage()) ;
                    }
                }
                break ;
            case 2:
                break ;
            case 19:
                break ;
            case 42:      //\u5206\u90e8
                result = Util.toScreen(SubCompanyComInfo.getSubCompanyname(result),user.getLanguage()) ;
                break ;
            case 164:      //\u5206\u90e8
                result = Util.toScreen(SubCompanyComInfo.getSubCompanyname(result),user.getLanguage()) ;
                break ;
            case 194:      //\u5206\u90e8
                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(SubCompanyComInfo.getSubCompanyname(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(SubCompanyComInfo.getSubCompanyname(results[j]),user.getLanguage()) ;
                    }
                }
                break ;
            case 65: //\u591a\u89d2\u8272\u5904\u7406 added xwj for td2127 on 2005-06-20
                Map roleMap  = new HashMap(); 
                String sql_  = "select ID,RolesName from HrmRoles";
                rs.executeSql(sql_);
                while(rs.next()){
                   roleMap.put(rs.getString("ID"),rs.getString("RolesName"));
                }
                results = Util.TokenizerString2(result,",");
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen((String)roleMap.get(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen((String)roleMap.get(results[j]),user.getLanguage()) ;
                    }
                }
                break ;
             
            case 141:
            //\u4eba\u529b\u8d44\u6e90\u6761\u4ef6
                result = resourceConditionManager.getFormShowName(result, user.getLanguage());            
                break;
            case 142:
            //\u6536\u53d1\u6587\u5355\u4f4d



                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(DocReceiveUnitComInfo.getReceiveUnitName(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(DocReceiveUnitComInfo.getReceiveUnitName(results[j]),user.getLanguage()) ;
                    }
                }
                break;
            case 143:
            //\u6811\u72b6\u6587\u6863
                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(DocTreeDocFieldComInfo.getTreeDocFieldName(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(DocTreeDocFieldComInfo.getTreeDocFieldName(results[j]),user.getLanguage()) ;
                    }
                }
                break;
            case 152:
            //\u591a\u8bf7\u6c42



                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                        result = "";
                    for(int j=0 ; j< results.length ; j++) {
                       String sql2= "select "+BrowserComInfo.getBrowsercolumname(""+type)+" from "+BrowserComInfo.getBrowsertablename(""+type)+" where "+BrowserComInfo.getBrowserkeycolumname(""+type)+"="+results[j];
                       rs.executeSql(sql2);
                           while(rs.next()){
                             result += Util.toScreen(rs.getString(1),user.getLanguage())+"," ;
                           }
                    }
                    if(!result.equals("")) result = result.substring(0,result.length()-1);
                }
                break;
            case 135:
            //\u591a\u9879\u76ee



                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                        result = "";
                    for(int j=0 ; j< results.length ; j++) {
                       String sql2= "select "+BrowserComInfo.getBrowsercolumname(""+type)+" from "+BrowserComInfo.getBrowsertablename(""+type)+" where "+BrowserComInfo.getBrowserkeycolumname(""+type)+"="+results[j];
                       rs.executeSql(sql2);
                           while(rs.next()){
                             result += Util.toScreen(rs.getString(1),user.getLanguage())+"," ;
                           }
                    }
                    if(!result.equals("")) result = result.substring(0,result.length()-1);
                }
                break;
            case 161:
            case 162:
            //\u81ea\u5b9a\u4e49\u5355\u9009,\u591a\u9009



                if(!result.equals("")) {
                //\u83b7\u53d6\u5b57\u6bb5\u7684\u6570\u636e\u5e93\u7c7b\u578b
                String tempfid=(String)fieldids.get(i);
                String tempfdbtype="";
                if (isbill.equals("1"))  
                    {
                    rs1.execute("select fielddbtype from workflow_billfield where id="+tempfid);
                     if (rs1.next()) tempfdbtype=rs1.getString("fielddbtype");
                    }
                    else
                    {String tempdetal=(String)isdetails.get(i);
                    if (!tempdetal.equals("1"))
                      rs1.execute("select fielddbtype from workflow_formdict where id="+tempfid);
                    else 
                      rs1.execute("select fielddbtype from workflow_formdictdetail where id="+tempfid);

                     if (rs1.next()) tempfdbtype=rs1.getString("fielddbtype");
                    }
	                if(type == 161){
	                    if(!result.equals("")){	                    	
	                        //Browser browser=(Browser) StaticObj.getServiceByFullname(tempfdbtype, Browser.class);
	                        //BrowserBean bb=browser.searchById(result);
							//BrowserBean bb = WorkflowJspBean.getBrowserBeanByCache(""+result,tempfdbtype);
							BrowserBean bb = WorkflowJspBean.getBrowserBeanByCache(Integer.valueOf(requestid) + "^~^" +result,tempfdbtype);
							
	                        if(bb != null){
	                             name = Util.null2String(bb.getName());
	                        }
	                    }
	                }else if(type == 162){
	                    //Browser browser=(Browser)StaticObj.getServiceByFullname(tempfdbtype, Browser.class);
	                    List l=Util.TokenizerString(result,",");
	                    for(int j=0;j<l.size();j++){
	                        String curid=(String)l.get(j);
	                        //BrowserBean bb=browser.searchById(curid);
							
							//BrowserBean bb = WorkflowJspBean.getBrowserBeanByCache(""+curid,tempfdbtype);
							BrowserBean bb = WorkflowJspBean.getBrowserBeanByCache(Integer.valueOf(requestid) + "^~^" +curid,tempfdbtype);
	                        if(bb != null){
	                            name += Util.null2String(bb.getName())+","; 
	                        }
	                    }
	                    if(!name.equals("")){
	                        name = name.substring(0,name.length() - 1);
	                    }
	                    
	                }
	                
					result=WorkflowJspBean.getWorkflowBrowserShowName(temRequestid+"^~^"+result,""+type,"","",tempfdbtype);
                   
                }
                if(type==161){
                    result = result.replaceAll("</a>&nbsp", "</apan>").replaceAll("<a", "<apan"); 
                }
                if (type==162) 
                    {
                        if(!result.equals("")){
                            try {
                                result = result.replaceAll("</a>&nbsp", "</apan>,").replaceAll("<a", "<apan");
                            } catch (Exception e) {
                                e.printStackTrace();
                            }
                            result = result.substring(0,result.length()-1);
                        }
                    }
                break;
            case 256:
            case 257:
                if(!result.equals("")) {
                    //\u83b7\u53d6\u5b57\u6bb5\u7684\u6570\u636e\u5e93\u7c7b\u578b
                    String tempfid=(String)fieldids.get(i);
                    String tempfdbtype="";
                    if (isbill.equals("1"))  
                        {
                        rs1.execute("select fielddbtype from workflow_billfield where id="+tempfid);
                         if (rs1.next()) tempfdbtype=rs1.getString("fielddbtype");
                        }
                        else
                        {String tempdetal=(String)isdetails.get(i);
                        if (!tempdetal.equals("1"))
                          rs1.execute("select fielddbtype from workflow_formdict where id="+tempfid);
                        else 
                          rs1.execute("select fielddbtype from workflow_formdictdetail where id="+tempfid);

                         if (rs1.next()) tempfdbtype=rs1.getString("fielddbtype");
                        }
	                    CustomTreeUtil customTreeUtil = new CustomTreeUtil();                    
	                    name = customTreeUtil.getTreeFieldShowName(result,tempfdbtype,"onlyname");
                        result=WorkflowJspBean.getWorkflowBrowserShowName(result,""+type,"","",tempfdbtype);
                    }
                if(type==256){
                    result = result.replaceAll("</a>&nbsp", "</apan>").replaceAll("<a", "<apan"); 
                }
                if (type==257) 
                    {
                        if(!result.equals("")){
                            try {
                                result = result.replaceAll("</a>&nbsp", "</apan>,").replaceAll("<a", "<apan");
                            } catch (Exception e) {
                                e.printStackTrace();
                            }
                            result = result.substring(0,result.length()-1);
                        }
                    }
                break;
            case 224:
                  break; 
               case 225:
              break; 
              case 226:
              break; 
               case 227:
              break; 
            default:
                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                        result = "";
                    for(int j=0 ; j< results.length ; j++) {
                       String sql2= "select "+BrowserComInfo.getBrowsercolumname(""+type)+" from "+BrowserComInfo.getBrowsertablename(""+type)+" where "+BrowserComInfo.getBrowserkeycolumname(""+type)+"="+results[j];
                       rs.executeSql(sql2);
                           while(rs.next()){
                             result += Util.toScreen(rs.getString(1),user.getLanguage())+"," ;
                           }
                    }
                    if(!result.equals("")) result = result.substring(0,result.length()-1);
                }
        }
    }
    
    if(htmltype.equals("5"))
    // \u9009\u62e9\u6846\u5b57\u6bb5



    {
        char flag = Util.getSeparator();
        if(!result.equals("")){
			String selectkey = (String)fieldids.get(i) + flag + isbill + flag + result;
			if(selectMap != null && !"".equals(Util.null2String(selectMap.get(selectkey)))){
				result = selectMap.get(selectkey);
			}else{
				rs.executeProc("workflow_SelectItemSByvalue", (String)fieldids.get(i) + flag + isbill + flag + result);
			
				if(rs.next())
				{
					result = Util.toScreen(rs.getString("selectname"), user.getLanguage());
					selectMap.put(selectkey,result);
				}
				else
				{
					result = "";
				}
			}
      }else{
         result = "";
        }
    }
     
        if(htmltype.equals("6")) {  // \u589e\u52a0\u6587\u4ef6\u4e0a\u4f20 added xwj for td2127 on 2005-06-20
       switch (type) {
        case 1:           
            //result = Util.toScreen(DocComInfo.getMuliDocName(result),user.getLanguage());
            results = Util.TokenizerString2(result,",") ;
            if(results != null) {
                for(int j=0 ; j< results.length ; j++) {
                    if(j==0)
                       result =  " <a href=\"javaScript:openFullWindowHaveBar('/docs/docs/DocDsp.jsp?id="+results[j]+"')\">"+Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) +"</a> ";
                    else
                        result += "<br>"+  " <a href=\"javaScript:openFullWindowHaveBar('/docs/docs/DocDsp.jsp?id="+results[j]+"')\">"+Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) +"</a> ";
                }
            }
            break ;
        //add by liaodong for qc55789 in 2013\u5e7410\u670823\u65e5 start 
        case 2:           
            //result = Util.toScreen(DocComInfo.getMuliDocName(result),user.getLanguage());
            results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                           result =  " <a href=\"javaScript:openFullWindowHaveBar('/docs/docs/DocDsp.jsp?id="+results[j]+"')\">"+Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) +"</a> ";
                        else
                            result += "<br>"+  " <a href=\"javaScript:openFullWindowHaveBar('/docs/docs/DocDsp.jsp?id="+results[j]+"')\">"+Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) +"</a> ";
                    }
                }
            break ;
        //end 
        default:
        }
    }
       if(htmltype.equals("9")){
            if(!result.equals("")){
                String[] locations =  result.split(LocateUtil.SPLIT_LOCATION);
                result= "";
                String addr = "";
                for(int j=0; j<locations.length;j++){
                    addr = locations[j].split(LocateUtil.SPLIT_FIELD)[3];
                    if(!addr.equals("")){
                        result +=addr;
                        if(j<locations.length-1){
                            result +=","; 
                         }
                    }
                }
                if(!result.equals("") && result.length()>1){
                    if(result.substring(result.length()-1).equals(",")){
                        result = result.substring(0,result.length()-1);
                    }
                }
                     
            }

       }
    if (!rowNames.contains(RecordSet.getColumnName(i + 1))) {
        rowNames.add(RecordSet.getColumnName(i + 1));
    }
        
    if(((String)isstats.get(i)).equals("1")) {

        //double resultdouble = Util.getDoubleValue((String)statvalues.get(i) , 0) ;
        //double tempresultdouble = Util.getDoubleValue((String)tempstatvalues.get(i) , 0) ;
        BigDecimal resultdouble = null;
        BigDecimal tempresultdouble = null;
        if("".equals(String.valueOf(statvalues.get(i)))){
            resultdouble = new BigDecimal(0);
        }else{
            resultdouble = new BigDecimal(String.valueOf(statvalues.get(i)));
        }
        if("".equals(String.valueOf(tempstatvalues.get(i)))){
            tempresultdouble = new BigDecimal(0);
        }else{
            tempresultdouble = new BigDecimal(String.valueOf(tempstatvalues.get(i)));
        }
        
        statisticsRowKv.put(RecordSet.getColumnName(i + 1), Boolean.valueOf(!isdetails.get(i).equals("1")));
        if(!isdetails.get(i).equals("1")){
            if(isnew){
                //resultdouble += Util.getDoubleValue(result , 0) ;
                //tempresultdouble += Util.getDoubleValue(result , 0) ;
                result = result.replace("\u3000", "").replace(" ", "");
                if("".equals(result)){
                    resultdouble = resultdouble.add(new BigDecimal(0));
                    tempresultdouble = tempresultdouble.add(new BigDecimal(0));
                }else{
                    resultdouble = resultdouble.add(new BigDecimal(Util.null2String(Util.getDoubleValue(result , 0))));
                    tempresultdouble = tempresultdouble.add(new BigDecimal(Util.null2String(Util.getDoubleValue(result , 0))));
                }
                requestid = temRequestid;
                statvalues.set(i, ""+resultdouble) ;
                tempstatvalues.set(i, ""+tempresultdouble) ;
            }else{
                result = "0";
            }
        }else{
            //resultdouble += Util.getDoubleValue(result , 0) ;
            //tempresultdouble += Util.getDoubleValue(result , 0) ;
            result = result.replace("\u3000", "").replace(" ", "");
            if("".equals(result)){
                resultdouble = resultdouble.add(new BigDecimal(0));
                tempresultdouble = tempresultdouble.add(new BigDecimal(0));
            }else{
                resultdouble = resultdouble.add(new BigDecimal(Util.null2String(Util.getDoubleValue(result , 0))));
                tempresultdouble = tempresultdouble.add(new BigDecimal(Util.null2String(Util.getDoubleValue(result , 0))));
            }
            requestid = temRequestid;
            statvalues.set(i, ""+resultdouble) ;
            tempstatvalues.set(i, ""+tempresultdouble) ;
        }

    }
  
      out.write(_jsp_string86, 0, _jsp_string86.length);
       
    String tempTdTextValue = "";
    if(!((String)isdborders.get(i)).equals("1") || ((String)isdborders.get(i)).equals("1") && (needstat||statcount== 0) ) { if(htmltype.equals("1") && (type==3)) {
      out.write(_jsp_string87, 0, _jsp_string87.length);
      tempTdTextValue=formatData(result);
      
      er.addValue(formatData(result)) ;
        }else{
    
      out.write(_jsp_string88, 0, _jsp_string88.length);
      tempTdTextValue=result;
      out.write(_jsp_string89, 0, _jsp_string89.length);
      
    String tempString = "";
        if("1".equals(outputExcel)){        
            tempString = Util.processBody(Util.StringReplace(delHtml(result),"%nbsp;"," "),user.getLanguage()+"");
	       	if(type == 161 || type == 162 || type == 256 || type == 257){
	            tempString = name;
	        }
        }else{          
            tempString = Util.StringReplace(Util.getTxtWithoutHTMLElement(FieldInfo.toExcel(StringEscapeUtils.unescapeHtml(result))),"%nbsp;"," ");
        }
        tempString = Util.StringReplace(tempString,"&dt;&at;"," ");
        tempString = Util.StringReplace(tempString,"&amp;","&");
         if((htmltype.equals("1")&&type==1)||htmltype.equals("2")) er.addStringValue(tempString) ;
         else er.addValue(tempString) ;
      }
    } else {
        tempTdTextValue=result;
      er.addValue(formatData(delHtml(result)));
    }

    
      out.write(_jsp_string90, 0, _jsp_string90.length);
      out.print((delHtml(StringEscapeUtils.unescapeHtml(tempTdTextValue)) ));
      out.write(_jsp_string91, 0, _jsp_string91.length);
       if(tcolname.toLowerCase().equals("c_requestname")){
      out.write(_jsp_string89, 0, _jsp_string89.length);
      out.print((StringEscapeUtils.unescapeHtml(tempTdTextValue)));
      out.write(_jsp_string89, 0, _jsp_string89.length);
      }else{ 
    
               if(htmltype.equals("6")){
      out.write(_jsp_string92, 0, _jsp_string92.length);
      out.print((StringEscapeUtils.unescapeHtml(tempTdTextValue) ));
      out.write(_jsp_string93, 0, _jsp_string93.length);
      }else{            
                 if(type == 161 || type == 162 || type == 256 || type == 257){           	
                     
      out.write(_jsp_string94, 0, _jsp_string94.length);
      out.print((tempTdTextValue ));
      out.write(_jsp_string92, 0, _jsp_string92.length);
           }else{
      out.write(_jsp_string95, 0, _jsp_string95.length);
      out.print((delHtml(StringEscapeUtils.unescapeHtml(tempTdTextValue)) ));
      out.write(_jsp_string92, 0, _jsp_string92.length);
       }
              }
           } 
      out.write(_jsp_string96, 0, _jsp_string96.length);
      }
      out.write(_jsp_string97, 0, _jsp_string97.length);
      out.print((colList.size()));
      out.write(_jsp_string98, 0, _jsp_string98.length);
      
    es.addExcelRow(er) ;
//}
}
}
  }else{
    RecordSet.execute(sql);
      while(RecordSet.next()){

        if(ordercount == 1) { //modified by xwj for td2132 on 20050701
            for(int i =0 ; i< fields.size() ; i++) {
                if(((String)isdborders.get(i)).equals("1")) {
                    tempvalue = Util.null2String(RecordSet.getString(i+1));
                    if(!tempvalue.equals(tempdbordervalue)) {
                        needstat = true ;
                        tempdbordervalue = tempvalue ;
                    }
                    else {
                        needstat = false ;
                    }
                }
               
            }
        }

        //added by xwj for td2132 on 20050701
        
        if(ordercount > 1){
            List list  = new ArrayList();
            for(int i =0 ; i< fields.size() ; i++) {
                if(((String)isdborders.get(i)).equals("1")) {
                     tempvalue += Util.null2String(RecordSet.getString(i+1));
                }
           }
          
              if(!tempvalue.equals(tempdbordervalue)) {
                        needstat = true ;
                        tempdbordervalue = tempvalue ;
                    }
                    else {
                        needstat = false ;
                    }
           tempvalue = "";
        } 
        
        if(needstat && statcount != 0 && !isfirst ) {
            er = es.newExcelRow () ;
        
      out.write(_jsp_string99, 0, _jsp_string99.length);
       for(int i =0 ; i< tempstatvalues.size() ; i++) {
               er.addValue(formatData((String)tempstatvalues.get(i))) ;
            
      out.write(_jsp_string79, 0, _jsp_string79.length);
      out.print((formatData((String)tempstatvalues.get(i))));
      out.write(_jsp_string75, 0, _jsp_string75.length);
      out.print((formatData((String)tempstatvalues.get(i))));
      out.write(_jsp_string80, 0, _jsp_string80.length);
      tempstatvalues.set(i,"") ; }

              es.addExcelRow(er) ;
            
      out.write(_jsp_string100, 0, _jsp_string100.length);
      out.print((colList.size()));
      out.write(_jsp_string82, 0, _jsp_string82.length);
      
        }

        isfirst = false ;

        er = es.newExcelRow () ;

        if(needchange ==0){
            needchange = 1;

      out.write(_jsp_string83, 0, _jsp_string83.length);
      
    }else{
        needchange=0;
  
      out.write(_jsp_string101, 0, _jsp_string101.length);
      }
      out.write(_jsp_string85, 0, _jsp_string85.length);
      
          String temRequestid = RecordSet.getString("requestid");
          String temWorkflowid = Util.null2String(RecordSet.getString("c_workflowid_QC194991")).trim();
          String temFormid = Util.null2String(RecordSet.getString("c_formid_QC194991")).trim();

          if(!temRequestid.equals(requestid)){
              isnew = true;
              requestid = temRequestid;
          }else{
              isnew = false;
          }
  String leavetype = "";
  for(int i =0 ; i< fields.size() ; i++) {
    String result = Util.null2String(RecordSet.getString(i+1)) ;
    String name= "";
    //modify by mackjoe at 20070625 for TD6865
    String tcolname= RecordSet.getColumnName(i+1);
    String tcolname_fullname = tcolname.toUpperCase();
    //System.out.println("tcolname1 = "+tcolname);
    if(tcolname.toLowerCase().equals("c_requestname")){
        result = "<a href=\"javaScript:openFullWindowHaveBar('/workflow/request/ViewRequest.jsp?requestid="+requestid+"&reportid="+reportid+"&isfromreport=1&isovertime=0')\">"+result+"</a>";
    }
    String htmltype = (String)htmltypes.get(i);

    int type = Util.getIntValue((String)types.get(i)) ;
    if(tcolname.indexOf("__")>0){
       tcolname = tcolname.substring(0,tcolname.indexOf("__"));
    }
    if(tcolname.equalsIgnoreCase("leavetype") && "1".equals(isbill) && "180".equals(formid)){
        leavetype=result;
    }
    if(tcolname.equalsIgnoreCase("otherleavetype") && "1".equals(isbill) && "180".equals(formid)){
        if(!leavetype.equals("4")) result = "";
    }
   if(tcolname.equalsIgnoreCase("requestname"))  //\u5904\u7406\u8d85\u957f\u7684\u6570\u5b57\u4f1a\u6210\u4e3a\u79d1\u5b66\u8ba1\u6570\u6cd5



   {
   result=result+"\u3000"; 
   }
    if(tcolname.equalsIgnoreCase("organizationid") && "1".equals(isbill) && ("156".equals(formid) || "157".equals(formid) || "158".equals(formid) || "159".equals(formid))){
        int organizationtype=Util.getIntValue(RecordSet.getString("organizationtype"));
        if(organizationtype==1){ //\u5206\u90e8
            type=42;
        }else{
        if(organizationtype==2){  //\u90e8\u95e8
            type=4;
        }
        if(organizationtype==3){  //\u4e2a\u4eba  \u9700\u8981\u628a\u4e2a\u4eba\u7684\u4e5f\u52a0\u4e0a
                type=1;
            }
        }
    }else if(temWorkflowid!=null&&temFormid!=null&&!"".equals(temWorkflowid)&&!"".equals(temFormid)&&tcolname_fullname!=null&&!"".equals(tcolname_fullname)){
        String fnaFeeWfInfo_fieldName_orgId_3 = Util.null2String(fnaFeeWfInfo_fieldName_hm.get(temWorkflowid+"_3")).trim().toUpperCase();//3\uff1a\u627f\u62c5\u4e3b\u4f53\uff1b
        String fnaFeeWfInfo_fieldName_orgId_isDtl_3 = Util.null2String(fnaFeeWfInfo_fieldIsDtl_hm.get(temWorkflowid+"_3")).trim();
        String fnaFeeWfInfo_fieldName_orgId_12 = Util.null2String(fnaFeeWfInfo_fieldName_hm.get(temWorkflowid+"_12")).trim().toUpperCase();//3\uff1a\u627f\u62c5\u4e3b\u4f53\uff1b
        String fnaFeeWfInfo_fieldName_orgId_isDtl_12 = Util.null2String(fnaFeeWfInfo_fieldIsDtl_hm.get(temWorkflowid+"_12")).trim();
        
        if("1".equals(fnaFeeWfInfo_fieldName_orgId_isDtl_3)){
            fnaFeeWfInfo_fieldName_orgId_3 = "FORMTABLE_MAIN_"+Math.abs(Util.getIntValue(temFormid,0))+"_DT1__"+fnaFeeWfInfo_fieldName_orgId_3;
            //new BaseBean().writeLog("1 fnaFeeWfInfo_fieldName_orgId>>>"+fnaFeeWfInfo_fieldName_orgId);
            //new BaseBean().writeLog("colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId)>>>"+colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId));
            if(colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId_3)){
                fnaFeeWfInfo_fieldName_orgId_3 = Util.null2String(colNameAliasNameHm.get(fnaFeeWfInfo_fieldName_orgId_3)).trim();
                //new BaseBean().writeLog("2 fnaFeeWfInfo_fieldName_orgId>>>"+fnaFeeWfInfo_fieldName_orgId);
            }
        }else{
            fnaFeeWfInfo_fieldName_orgId_3 = "A_"+fnaFeeWfInfo_fieldName_orgId_3;
        }
        fnaFeeWfInfo_fieldName_orgId_3 = fnaFeeWfInfo_fieldName_orgId_3.toUpperCase();
        
        if("1".equals(fnaFeeWfInfo_fieldName_orgId_isDtl_12)){
            fnaFeeWfInfo_fieldName_orgId_12 = "FORMTABLE_MAIN_"+Math.abs(Util.getIntValue(temFormid,0))+"_DT1__"+fnaFeeWfInfo_fieldName_orgId_12;
            //new BaseBean().writeLog("1 fnaFeeWfInfo_fieldName_orgId_12>>>"+fnaFeeWfInfo_fieldName_orgId_12);
            //new BaseBean().writeLog("colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId_12)>>>"+colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId_12));
            if(colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgId_12)){
                fnaFeeWfInfo_fieldName_orgId_12 = Util.null2String(colNameAliasNameHm.get(fnaFeeWfInfo_fieldName_orgId_12)).trim();
                //new BaseBean().writeLog("2 fnaFeeWfInfo_fieldName_orgId_12>>>"+fnaFeeWfInfo_fieldName_orgId_12);
            }
        }else{
            fnaFeeWfInfo_fieldName_orgId_12 = "A_"+fnaFeeWfInfo_fieldName_orgId_12;
        }
        fnaFeeWfInfo_fieldName_orgId_12 = fnaFeeWfInfo_fieldName_orgId_12.toUpperCase();
        //new BaseBean().writeLog("3 fnaFeeWfInfo_fieldName_orgId_12>>>"+fnaFeeWfInfo_fieldName_orgId_12);
        
        if(fnaFeeWfInfo_fieldName_orgId_3.equals(tcolname_fullname) || fnaFeeWfInfo_fieldName_orgId_12.equals(tcolname_fullname)){
        	String _fieldType = "";
        	if(fnaFeeWfInfo_fieldName_orgId_3.equals(tcolname_fullname)){
        		_fieldType = "2";
        	}else if(fnaFeeWfInfo_fieldName_orgId_12.equals(tcolname_fullname)){
        		_fieldType = "11";
        	}
        	
            String fnaFeeWfInfo_fieldName_orgType = Util.null2String(fnaFeeWfInfo_fieldName_hm.get(temWorkflowid+"_"+_fieldType)).trim().toUpperCase();//2\uff1a\u627f\u62c5\u4e3b\u4f53\u7c7b\u578b\uff1b
            String fnaFeeWfInfo_fieldName_orgType_isDtl = Util.null2String(fnaFeeWfInfo_fieldIsDtl_hm.get(temWorkflowid+"_"+_fieldType)).trim();
            if("1".equals(fnaFeeWfInfo_fieldName_orgType_isDtl)){
                fnaFeeWfInfo_fieldName_orgType = "FORMTABLE_MAIN_"+Math.abs(Util.getIntValue(temFormid,0))+"_DT1__"+fnaFeeWfInfo_fieldName_orgType;
                if(colNameAliasNameHm.containsKey(fnaFeeWfInfo_fieldName_orgType)){
                    fnaFeeWfInfo_fieldName_orgType = Util.null2String(colNameAliasNameHm.get(fnaFeeWfInfo_fieldName_orgType)).trim();
                }
            }else{
                fnaFeeWfInfo_fieldName_orgType = "A_"+fnaFeeWfInfo_fieldName_orgType;
            }
            fnaFeeWfInfo_fieldName_orgType = fnaFeeWfInfo_fieldName_orgType.toUpperCase();
			String fna_orgType_value_QC194991 = "";
            if("".equals(fna_orgType_value_QC194991)){
                fna_orgType_value_QC194991 = Util.null2String(RecordSet.getString(fnaFeeWfInfo_fieldName_orgType)).trim();
            }
            //new BaseBean().writeLog("2 fna_orgType_value_QC194991>>>>>>>>>>"+fna_orgType_value_QC194991+";type="+type);
            if("2".equals(fna_orgType_value_QC194991)){ //\u5206\u90e8
                type=42;
            }else if("1".equals(fna_orgType_value_QC194991)){  //\u90e8\u95e8
                type=4;
            }else if("0".equals(fna_orgType_value_QC194991)){  //\u4e2a\u4eba  \u9700\u8981\u628a\u4e2a\u4eba\u7684\u4e5f\u52a0\u4e0a
                type=1;
            }else if("3".equals(fna_orgType_value_QC194991)){  //\u6210\u672c\u4e2d\u5fc3
                type=251;
            }
            //new BaseBean().writeLog("3 fna_orgType_value_QC194991>>>>>>>>>>"+fna_orgType_value_QC194991+";type="+type);
         }
    }
    String results[] = null ;
      
    /*-----  xwj for td2974 20051026   B E G I N  ---*/
    if(htmltype.equals("-2")) {
       if("0".equals(result)){
         result = SystemEnv.getHtmlLabelName(225,user.getLanguage());
       }
       else if("1".equals(result)){
         result = SystemEnv.getHtmlLabelName(15533,user.getLanguage()); 
       }
       else if("2".equals(result)){
         result = SystemEnv.getHtmlLabelName(2087,user.getLanguage());
       }
    }
    /*-----  xwj for td2974 20051026   E N D  ---*/

    //------------------------------
    //\u521b\u5efa\u4eba



    if(htmltype.equals("-10")) {
        if("1".equals(outputExcel)){
            result = WorkFlowTransMethod.getWFSearchResultName(result,"0");
        }else{
            result = ResourceComInfo.getResourcename(result);
        }
    }
    //\u521b\u5efa\u65e5\u671f
    //if(htmltype.equals("-11")) {
    //  result = WorkFlowTransMethod.getWFSearchResultName(result,"0");
    //}
    //\u5de5\u4f5c\u6d41



    if(htmltype.equals("-12")) {
        result = WorkflowComInfo.getWorkflowname(result);
    }
    //\u5f53\u524d\u8282\u70b9
    if(htmltype.equals("-13")) {
        result = WorkFlowTransMethod.getCurrentNode(result);
    }
    //\u672a\u64cd\u4f5c\u8005



    if(htmltype.equals("-14")) {
        if("1".equals(outputExcel)){
            result = WorkFlowTransMethod.getUnOptOutPutExcel(result);
        }else{
            result = WorkFlowTransMethod.getUnOptInRep(result);
        }
    }
  //\u6d41\u7a0b\u72b6\u6001



    if(htmltype.equals("-15")) {
        if(!"3".equals(result)){
            result = SystemEnv.getHtmlLabelName(17999,user.getLanguage());
        }else{
            result = SystemEnv.getHtmlLabelName(251,user.getLanguage());
        }
    }
  //\u5f52\u6863\u65e5\u671f
    //if(htmltype.equals("-16")) {
    //  result = WorkFlowTransMethod.getWFSearchResultName(result,"0");
    //}
    //------------------------------
    if(htmltype.equals("3")) {
        switch (type) {
            case 1:
                result = Util.toScreen(ResourceComInfo.getResourcename(result),user.getLanguage()) ;
                break ;
            case 23:
                result = Util.toScreen(CapitalComInfo.getCapitalname(result),user.getLanguage()) ;
                break ;
            case 4:
                result = Util.toScreen(DepartmentComInfo.getDepartmentname(result),user.getLanguage()) ;
                break ;
            case 6:
                result = Util.toScreen(CostcenterComInfo.getCostCentername(result),user.getLanguage()) ;
                break ;
            case 7:
                result = Util.toScreen(CustomerInfoComInfo.getCustomerInfoname(result),user.getLanguage()) ;
                break ;
            case 8:
                result = Util.toScreen(ProjectInfoComInfo.getProjectInfoname(result),user.getLanguage()) ;
                break ;
            case 9:
                result = Util.toScreen(DocComInfo.getDocname(result),user.getLanguage()) ;
                break ;
            case 12:
                result = Util.toScreen(CurrencyComInfo.getCurrencyname(result),user.getLanguage()) ;
                break ;
            case 25:
                result = Util.toScreen(CapitalAssortmentComInfo.getAssortmentName(result),user.getLanguage()) ;
                break ;
            case 14:
            case 15:
                result = Util.toScreen(LedgerComInfo.getLedgername(result),user.getLanguage()) ;
                break ;
            case 16:
                result = Util.toScreen(RequestComInfo.getRequestname(result),user.getLanguage()) ;
                break ;
            case 17:
                WorkflowJspBean workflowJspBean = new WorkflowJspBean();
                workflowJspBean.setRequestid(Integer.valueOf(requestid));
                StringBuffer _sbf = new StringBuffer(result);
                String browsplitflg = ",";
                String showname = workflowJspBean.getMultiResourceShowName(_sbf, "", ""+fieldids.get(i),user.getLanguage(), browsplitflg, false);
                result = ""+delHtml(showname) ;
                if(result.endsWith(",")){
                    result = result.substring(0,result.length() - 1);
                }
                /*
                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(ResourceComInfo.getResourcename(results[j]),user.getLanguage()) ;
                        else
                            result += ","+Util.toScreen(ResourceComInfo.getResourcename(results[j]),user.getLanguage()) ;
                    }
                }
                */
                break ;
            case 18:
                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(CustomerInfoComInfo.getCustomerInfoname(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(CustomerInfoComInfo.getCustomerInfoname(results[j]),user.getLanguage()) ;
                    }
                }
                break ;
            case 24:
                result = Util.toScreen(JobTitlesComInfo.getJobTitlesname(result),user.getLanguage()) ;
                break ;
            case 37:            // \u589e\u52a0\u591a\u6587\u6863\u5904\u7406



                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) ;
                    }
                }
                break ;
             case 57:            // \u589e\u52a0\u591a\u90e8\u95e8\u5904\u7406



                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(DepartmentComInfo.getDepartmentname(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(DepartmentComInfo.getDepartmentname(results[j]),user.getLanguage()) ;
                    }
                }
                break ;
            case 2:
                break ;
            case 19:
                break ;
            case 42:      //\u5206\u90e8
                result = Util.toScreen(SubCompanyComInfo.getSubCompanyname(result),user.getLanguage()) ;
                break ;
            case 164:      //\u5206\u90e8
                result = Util.toScreen(SubCompanyComInfo.getSubCompanyname(result),user.getLanguage()) ;
                break ;
            case 194:      //\u5206\u90e8
                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(SubCompanyComInfo.getSubCompanyname(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(SubCompanyComInfo.getSubCompanyname(results[j]),user.getLanguage()) ;
                    }
                }
                break ;
            case 65: //\u591a\u89d2\u8272\u5904\u7406 added xwj for td2127 on 2005-06-20
                Map roleMap  = new HashMap(); 
                String sql_  = "select ID,RolesName from HrmRoles";
                rs.executeSql(sql_);
                while(rs.next()){
                   roleMap.put(rs.getString("ID"),rs.getString("RolesName"));
                }
                results = Util.TokenizerString2(result,",");
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen((String)roleMap.get(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen((String)roleMap.get(results[j]),user.getLanguage()) ;
                    }
                }
                break ;
             
            case 141:
            //\u4eba\u529b\u8d44\u6e90\u6761\u4ef6
                result = resourceConditionManager.getFormShowName(result, user.getLanguage());            
                break;
            case 142:
            //\u6536\u53d1\u6587\u5355\u4f4d



                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(DocReceiveUnitComInfo.getReceiveUnitName(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(DocReceiveUnitComInfo.getReceiveUnitName(results[j]),user.getLanguage()) ;
                    }
                }
                break;
            case 143:
            //\u6811\u72b6\u6587\u6863
                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                            result = Util.toScreen(DocTreeDocFieldComInfo.getTreeDocFieldName(results[j]),user.getLanguage()) ;
                        else
                            result += ","+ Util.toScreen(DocTreeDocFieldComInfo.getTreeDocFieldName(results[j]),user.getLanguage()) ;
                    }
                }
                break;
            case 152:
            //\u591a\u8bf7\u6c42



                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                        result = "";
                    for(int j=0 ; j< results.length ; j++) {
                       String sql2= "select "+BrowserComInfo.getBrowsercolumname(""+type)+" from "+BrowserComInfo.getBrowsertablename(""+type)+" where "+BrowserComInfo.getBrowserkeycolumname(""+type)+"="+results[j];
                       rs.executeSql(sql2);
                           while(rs.next()){
                             result += Util.toScreen(rs.getString(1),user.getLanguage())+"," ;
                           }
                    }
                    if(!result.equals("")) result = result.substring(0,result.length()-1);
                }
                break;
            case 135:
            //\u591a\u9879\u76ee



                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                        result = "";
                    for(int j=0 ; j< results.length ; j++) {
                       String sql2= "select "+BrowserComInfo.getBrowsercolumname(""+type)+" from "+BrowserComInfo.getBrowsertablename(""+type)+" where "+BrowserComInfo.getBrowserkeycolumname(""+type)+"="+results[j];
                       rs.executeSql(sql2);
                           while(rs.next()){
                             result += Util.toScreen(rs.getString(1),user.getLanguage())+"," ;
                           }
                    }
                    if(!result.equals("")) result = result.substring(0,result.length()-1);
                }
                break;
            case 161:
            case 162:
            //\u81ea\u5b9a\u4e49\u5355\u9009,\u591a\u9009



                if(!result.equals("")) {
                //\u83b7\u53d6\u5b57\u6bb5\u7684\u6570\u636e\u5e93\u7c7b\u578b
                String tempfid=(String)fieldids.get(i);
                String tempfdbtype="";
                if (isbill.equals("1"))  
                    {
                    rs1.execute("select fielddbtype from workflow_billfield where id="+tempfid);
                     if (rs1.next()) tempfdbtype=rs1.getString("fielddbtype");
                    }
                    else
                    {String tempdetal=(String)isdetails.get(i);
                    if (!tempdetal.equals("1"))
                      rs1.execute("select fielddbtype from workflow_formdict where id="+tempfid);
                    else 
                      rs1.execute("select fielddbtype from workflow_formdictdetail where id="+tempfid);

                     if (rs1.next()) tempfdbtype=rs1.getString("fielddbtype");
                    }
                    if(type == 161){
                        if(!result.equals("")){
                            //Browser browser=(Browser) StaticObj.getServiceByFullname(tempfdbtype, Browser.class);
                            //BrowserBean bb=browser.searchById(result);
							//BrowserBean bb = WorkflowJspBean.getBrowserBeanByCache(""+result,tempfdbtype);
							BrowserBean bb = WorkflowJspBean.getBrowserBeanByCache(Integer.valueOf(requestid) + "^~^" +result,tempfdbtype);
							
                            if(bb != null){
                                 name = Util.null2String(bb.getName());
                            }
                        }
                    }else if(type == 162){
                        //Browser browser=(Browser)StaticObj.getServiceByFullname(tempfdbtype, Browser.class);
                        List l=Util.TokenizerString(result,",");
                        for(int j=0;j<l.size();j++){
                            String curid=(String)l.get(j);
                            //BrowserBean bb=browser.searchById(curid);
							//BrowserBean bb = WorkflowJspBean.getBrowserBeanByCache(""+curid,tempfdbtype);
							BrowserBean bb = WorkflowJspBean.getBrowserBeanByCache(Integer.valueOf(requestid) + "^~^" +curid,tempfdbtype);
							
                            if(bb != null){
                                name += Util.null2String(bb.getName())+","; 
                            }
                        }
                        if(!name.equals("")){
                            name = name.substring(0,name.length() - 1);
                        }
                        
                    }
					result=WorkflowJspBean.getWorkflowBrowserShowName(temRequestid+"^~^"+result,""+type,"","",tempfdbtype);
                }
                if(type==161){
                    result = result.replaceAll("</a>&nbsp", "</apan>").replaceAll("<a", "<apan"); 
                }
                if (type==162) 
                    {
                        if(!result.equals("")){
                            try {
                                result = result.replaceAll("</a>&nbsp", "</apan>,").replaceAll("<a", "<apan");                          
                            } catch (Exception e) {
                                e.printStackTrace();
                            }
                            result = result.substring(0,result.length()-1);
                        }
                    }
                break;
            case 256:
            case 257:
                if(!result.equals("")) {
                    //\u83b7\u53d6\u5b57\u6bb5\u7684\u6570\u636e\u5e93\u7c7b\u578b
                    String tempfid=(String)fieldids.get(i);
                    String tempfdbtype="";
                    if (isbill.equals("1"))  
                        {
                        rs1.execute("select fielddbtype from workflow_billfield where id="+tempfid);
                         if (rs1.next()) tempfdbtype=rs1.getString("fielddbtype");
                        }
                        else
                        {String tempdetal=(String)isdetails.get(i);
                        if (!tempdetal.equals("1"))
                          rs1.execute("select fielddbtype from workflow_formdict where id="+tempfid);
                        else 
                          rs1.execute("select fielddbtype from workflow_formdictdetail where id="+tempfid);

                         if (rs1.next()) tempfdbtype=rs1.getString("fielddbtype");
                        }
                        CustomTreeUtil customTreeUtil = new CustomTreeUtil();                    
                        name = customTreeUtil.getTreeFieldShowName(result,tempfdbtype,"onlyname");
                        result=WorkflowJspBean.getWorkflowBrowserShowName(result,""+type,"","",tempfdbtype);
                    }
                if(type==256){
                    result = result.replaceAll("</a>&nbsp", "</apan>").replaceAll("<a", "<apan"); 
                }
                if (type==257) 
                    {
                        if(!result.equals("")){
                            try {
                                result = result.replaceAll("</a>&nbsp", "</apan>,").replaceAll("<a", "<apan");
                            } catch (Exception e) {
                                e.printStackTrace();
                            }
                            result = result.substring(0,result.length()-1);
                        }
                    }
                break;
              case 224:
              break; 
              case 225:
              break; 
              case 226:
              break; 
               case 227:
              break; 
            default:
                results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                        result = "";
                    for(int j=0 ; j< results.length ; j++) {
                       String sql2= "select "+BrowserComInfo.getBrowsercolumname(""+type)+" from "+BrowserComInfo.getBrowsertablename(""+type)+" where "+BrowserComInfo.getBrowserkeycolumname(""+type)+"="+results[j];
                       rs.executeSql(sql2);
                           while(rs.next()){
                             result += Util.toScreen(rs.getString(1),user.getLanguage())+"," ;
                           }
                    }
                    if(!result.equals("")) result = result.substring(0,result.length()-1);
                }
        }
    }
    
    if(htmltype.equals("5"))
    // \u9009\u62e9\u6846\u5b57\u6bb5



    {
        char flag = Util.getSeparator();
        if(!result.equals("")){
			String selectkey = (String)fieldids.get(i) + flag + isbill + flag + result;
			if(selectMap != null && !"".equals(Util.null2String(selectMap.get(selectkey)))){
				result = selectMap.get(selectkey);
			}else{
				rs.executeProc("workflow_SelectItemSByvalue", (String)fieldids.get(i) + flag + isbill + flag + result);
			
				if(rs.next())
				{
					result = Util.toScreen(rs.getString("selectname"), user.getLanguage());
					selectMap.put(selectkey,result);
				}
				else
				{
					result = "";
				}
			}
      }else{
         result = "";
        }
    }
     
        if(htmltype.equals("6")) {  // \u589e\u52a0\u6587\u4ef6\u4e0a\u4f20 added xwj for td2127 on 2005-06-20
       switch (type) {
        case 1:           
            //result = Util.toScreen(DocComInfo.getDocname(result),user.getLanguage());
            results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                           result =  " <a href=\"javaScript:openFullWindowHaveBar('/docs/docs/DocDsp.jsp?id="+results[j]+"')\">"+Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) +"</a> ";
                        else
                            result += "<br>"+  " <a href=\"javaScript:openFullWindowHaveBar('/docs/docs/DocDsp.jsp?id="+results[j]+"')\">"+Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) +"</a> ";
                    }
                }
            break ;
            //add by liaodong for qc55789 in 2013\u5e7410\u670823\u65e5



         case 2:
            results = Util.TokenizerString2(result,",") ;
                if(results != null) {
                    for(int j=0 ; j< results.length ; j++) {
                        if(j==0)
                           result =  " <a href=\"javaScript:openFullWindowHaveBar('/docs/docs/DocDsp.jsp?id="+results[j]+"')\">"+Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) +"</a> ";
                        else
                            result += "<br>"+  " <a href=\"javaScript:openFullWindowHaveBar('/docs/docs/DocDsp.jsp?id="+results[j]+"')\">"+Util.toScreen(DocComInfo.getDocname(results[j]),user.getLanguage()) +"</a> ";
                    }
                }
         break;
         //end
        default:
        }
    }
    if(htmltype.equals("9")) {  // \u589e\u52a0\u4f4d\u7f6e\u4fe1\u606f

        String[] locations = result.split(LocateUtil.SPLIT_LOCATION);
        result = "";
        for(int cnt=0; cnt<locations.length; cnt++){
           String[] fieldValues = locations[cnt].split(LocateUtil.SPLIT_FIELD);
           if(fields != null && fieldValues.length >= 4 && !fieldValues[3].equals("")){                          
               if(cnt == locations.length-1){
                   result += fieldValues[3]; 
               }else{
                   result += (fieldValues[3] + ",");
               }
           }
        }
        if(!result.equals("") && result.length()>1){
            if(result.substring(result.length()-1).equals(",")){
                result = result.substring(0,result.length()-1);
            }
        }
    }
     if(htmltype.equals("1")) {   //\u5904\u7406\u8d85\u957f\u7684\u6570\u5b57\u4f1a\u6210\u4e3a\u79d1\u5b66\u8ba1\u6570\u6cd5(\u5982\u6587\u672c\uff0c\u7535\u8bdd\u53f7\u7801)
       if (type==1) 
         { 
           if (!"".equals(result) && result.matches("[\\d]+")) {
               result=result+"\u3000";
           }
         }else if(type==3&&("156".equals(formid)||"158".equals(formid))){
           int organizationtype = RecordSet.getInt("organizationtype");
           int organizationid = RecordSet.getInt("organizationid");
           String budgetperiod = RecordSet.getString("budgetperiod");
           int subject = RecordSet.getInt("subject");
           BudgetHandler bp = new BudgetHandler();
           String kpi = bp.getBudgetKPI(budgetperiod, organizationtype, organizationid, subject);
           
             String[] kpiArray = kpi.split("\\|");
             String[] kpi1 = kpiArray[0].split(",");
             String kpi11 = kpi1[0];
             String kpi12 = kpi1[1];
             String kpi13 = kpi1[2];
             String span1 = "<span><span style='white-space :nowrap'>" + SystemEnv.getHtmlLabelName(18768, user.getLanguage()) + ":" + Util.round(kpi11,2) + "</span><br><span style='white-space :nowrap;color:red'>" + SystemEnv.getHtmlLabelName(18503, user.getLanguage()) + ":" + Util.round(kpi12,2) + "</span><br><span style='white-space :nowrap;color:green'> " + SystemEnv.getHtmlLabelName(18769, user.getLanguage()) + ":" + Util.round(kpi13,2) + "</span></span>";

             String[] kpi2 = kpiArray[1].split(",");
             String kpi21 = kpi2[0];
             String kpi22 = kpi2[1];
             String kpi23 = kpi2[2];
             String span2 = "<span><span style='white-space :nowrap'>" + SystemEnv.getHtmlLabelName(18768, user.getLanguage()) + ":" + Util.round(kpi21,2) + "</span><br><span style='white-space :nowrap;color:red'>" + SystemEnv.getHtmlLabelName(18503, user.getLanguage()) + ":" + Util.round(kpi22,2) + "</span><br><span style='white-space :nowrap;color:green'>" + SystemEnv.getHtmlLabelName(18769, user.getLanguage()) + ":" + Util.round(kpi23,2) + "</span></span>";

             String[] kpi3 = kpiArray[2].split(",");
             String kpi31 = kpi3[0];
             String kpi32 = kpi3[1];
             String kpi33 = kpi3[2];
             String span3 = "<span><span style='white-space :nowrap'>" + SystemEnv.getHtmlLabelName(18768, user.getLanguage()) + ":" + kpi31 + "</span><br><span style='white-space :nowrap;color:red'>" + SystemEnv.getHtmlLabelName(18503, user.getLanguage()) + ":" + kpi32 + "</span><br><span style='white-space :nowrap;color:green'>" + SystemEnv.getHtmlLabelName(18769, user.getLanguage()) + ":" + kpi33 + "</span></span>";
       
           if(tcolname.equals("hrmremain")){
                if("1".equals(outputExcel)){
                    result = ""+delHtml(span1) ;
                }else{
                    result = ""+span1;
                }
           }else if(tcolname.equals("deptremain")){
                if("1".equals(outputExcel)){
                    result = ""+delHtml(span2) ;
                }else{
                    result = ""+span2 ;
                }
           }else if(tcolname.equals("subcomremain")){
               if("1".equals(outputExcel)){
                   result = ""+delHtml(span3) ;
                }else{
                    result = ""+span3 ;
                }
           }else{
               result=result+"\u3000";
           }
       }
    }
     if (!rowNames.contains(RecordSet.getColumnName(i + 1))) {
        rowNames.add(RecordSet.getColumnName(i + 1));
     }


    if(((String)isstats.get(i)).equals("1")) {
        //double resultdouble = Util.getDoubleValue((String)statvalues.get(i) , 0) ;
        //double tempresultdouble = Util.getDoubleValue((String)tempstatvalues.get(i) , 0) ;
        BigDecimal resultdouble = null;
        BigDecimal tempresultdouble = null;
        if("".equals(String.valueOf(statvalues.get(i)))){
            resultdouble = new BigDecimal(0);
        }else{
            resultdouble = new BigDecimal(String.valueOf(statvalues.get(i)));
        }
        if("".equals(String.valueOf(tempstatvalues.get(i)))){
            tempresultdouble = new BigDecimal(0);
        }else{
            tempresultdouble = new BigDecimal(String.valueOf(tempstatvalues.get(i)));
        }
        
        statisticsRowKv.put(RecordSet.getColumnName(i + 1), Boolean.valueOf(!isdetails.get(i).equals("1")));
        if(!isdetails.get(i).equals("1")){
            if(isnew){
                result = result.replace("\u3000", "").replace(" ", "");
                if("".equals(result.replace("\u3000", ""))){
                    resultdouble = resultdouble.add(new BigDecimal(0));
                    tempresultdouble = tempresultdouble.add(new BigDecimal(0));
                }else{
                    resultdouble = resultdouble.add(new BigDecimal(Util.null2String(Util.getDoubleValue(result , 0))));
                    tempresultdouble = tempresultdouble.add(new BigDecimal(Util.null2String(Util.getDoubleValue(result , 0))));
                }
                requestid = temRequestid;
                statvalues.set(i, ""+resultdouble) ;
                tempstatvalues.set(i, ""+tempresultdouble) ;
            }else{
                result = "0";
            }
        }else{
            //resultdouble += Util.getDoubleValue(result , 0) ;
            //tempresultdouble += Util.getDoubleValue(result , 0) ;
            result = result.replace("\u3000", "").replace(" ", "");
            if("".equals(result)){
                resultdouble = resultdouble.add(new BigDecimal(0));
                tempresultdouble = tempresultdouble.add(new BigDecimal(0));
            }else{
                resultdouble = resultdouble.add(new BigDecimal(Util.null2String(Util.getDoubleValue(result , 0))));
                tempresultdouble = tempresultdouble.add(new BigDecimal(Util.null2String(Util.getDoubleValue(result , 0))));
            }
            requestid = temRequestid;
            statvalues.set(i, ""+resultdouble) ;
            tempstatvalues.set(i, ""+tempresultdouble) ;
        }
    }
    
  
      out.write(_jsp_string102, 0, _jsp_string102.length);
       
    String tempTdTextValue = "";
    if(!((String)isdborders.get(i)).equals("1") || ((String)isdborders.get(i)).equals("1") && (needstat||statcount== 0) ) { if(htmltype.equals("1") && (type==3)) {
      out.write(_jsp_string103, 0, _jsp_string103.length);
      tempTdTextValue=formatData(result);
      
      er.addValue(formatData(result)) ;
        }else{
    
      out.write(_jsp_string88, 0, _jsp_string88.length);
      tempTdTextValue=result;
      out.write(_jsp_string89, 0, _jsp_string89.length);
      
        String tempString = "";
        if("1".equals(outputExcel)){
            tempString = Util.StringReplace(delHtml(StringEscapeUtils.unescapeHtml(result)),"%nbsp;"," ");
            if(type == 161 || type == 162 || type == 256 || type == 257){
                tempString = name;
            }
            tempString = Util.processBody(tempString,user.getLanguage()+"");
        }else{
            tempString = Util.StringReplace(Util.getTxtWithoutHTMLElement(FieldInfo.toExcel(StringEscapeUtils.unescapeHtml(result))),"%nbsp;"," ");
        }
        tempString = Util.StringReplace(tempString,"&dt;&at;"," ");
        tempString = Util.StringReplace(tempString,"&amp;","&");
         if((htmltype.equals("1")&&type==1)||htmltype.equals("2")) er.addStringValue(tempString) ;
         else er.addValue(tempString) ;
      }
    } else {
      tempTdTextValue=result;
      
        er.addValue(formatData(delHtml(result)));
    
    }
      out.write(_jsp_string104, 0, _jsp_string104.length);
      out.print((delHtml(tempTdTextValue)));
      out.write(_jsp_string105, 0, _jsp_string105.length);
       if(tcolname.toLowerCase().equals("c_requestname")){
      out.write(_jsp_string106, 0, _jsp_string106.length);
      out.print((tempTdTextValue));
      out.write(_jsp_string88, 0, _jsp_string88.length);
       }else{ 
               if(htmltype.equals("6")){
      out.write(_jsp_string92, 0, _jsp_string92.length);
      out.print((tempTdTextValue ));
      out.write(_jsp_string93, 0, _jsp_string93.length);
      }else{ 
            
             if(type == 161 || type == 162 || type == 256 || type == 257){
             
      out.write(_jsp_string92, 0, _jsp_string92.length);
      out.print((tempTdTextValue ));
      out.write(_jsp_string88, 0, _jsp_string88.length);
           }else{
      out.write(_jsp_string107, 0, _jsp_string107.length);
      out.print((delHtml(tempTdTextValue) ));
      out.write(_jsp_string88, 0, _jsp_string88.length);
       }
             }
           } 
      out.write(_jsp_string96, 0, _jsp_string96.length);
      }

    
      out.write(_jsp_string108, 0, _jsp_string108.length);
      out.print((colList.size()));
      out.write(_jsp_string98, 0, _jsp_string98.length);
      
    es.addExcelRow(er) ;
}
  }

    //\u5982\u679c\u5b58\u5728
    if ("sqlserver".equals((dbType))) {
        RecordSet.execute("drop table " + tmpTblName);
    }
    //----------------------------------------
    // \u7edf\u8ba1
    //---------------------------------------
  //statisticsRowKv.put(RecordSet.getColumnName(i + 1), !isdetails.get(i).equals("1"));
    
    List newTempStatValues = new ArrayList();
    for (Iterator it = rowNames.iterator();it.hasNext();) {
        String rowName = (String) it.next();
        Object obj = statisticsRowKv.get(rowName);
        String tval = "";
        if (obj != null) {
            StringBuffer totalSql = new StringBuffer();
            Boolean blnobj = (Boolean)obj;
            boolean isTotal = blnobj.booleanValue(); 
            
            if (isTotal) {
                totalSql.append("select sum(t2.rowsum) as rowsum from ( select Avg(tbl." + rowName + ") as rowsum from ( ");
                totalSql.append(oldsql);
                totalSql.append(" ) tbl group by tbl.requestid) t2");
            } else {
                if (isNewBill) {
                    totalSql.append("select sum(t2.rowsum) as rowsum from ( select Avg(tbl." + rowName + ") as rowsum from ( ");
                    totalSql.append(oldsql);
                    totalSql.append(" ) tbl group by tbl." + rowName.substring(0, rowName.lastIndexOf("__") + 1) + "id_) t2");
                } else {
                    totalSql.append("select sum(t2.rowsum) as rowsum from ( select Avg(tbl." + rowName + ") as rowsum from ( ");
                    totalSql.append(oldsql);
                    totalSql.append(" ) tbl group by tbl." + rowName + ") t2");
                }
            }
            RecordSet.execute(totalSql.toString());
            if (RecordSet.next()) {
                //tval = String.valueOf(Util.getDoubleValue(Util.null2String(RecordSet.getString("rowsum")), 0));
                if("".equals(Util.null2String(RecordSet.getString("rowsum")))){
                    tval = String.valueOf(new BigDecimal(0));
                }else{
                    tval = String.valueOf(new BigDecimal(Util.null2String(RecordSet.getString("rowsum"))).stripTrailingZeros().toPlainString());
                }
            } else {
                tval = "0.00";
            }
        }else {
            tval = "";
        }
        newTempStatValues.add(tval);
    }
    //----------------------------------------
    // end
    //----------------------------------------
if(statcount != 0 && !isfirst ) {
    er = es.newExcelRow () ;
        
      out.write(_jsp_string99, 0, _jsp_string99.length);
       //for(int i =0 ; i< tempstatvalues.size() ; i++) {
            for(int i =0 ; i< tempstatvalues.size() ; i++) {
                er.addValue(formatData((String)tempstatvalues.get(i))) ;
            
      out.write(_jsp_string109, 0, _jsp_string109.length);
      out.print((formatData((String)tempstatvalues.get(i))));
      out.write(_jsp_string75, 0, _jsp_string75.length);
      out.print((formatData((String)tempstatvalues.get(i))));
      out.write(_jsp_string80, 0, _jsp_string80.length);
      tempstatvalues.set(i,"") ; }
      out.write(_jsp_string110, 0, _jsp_string110.length);
      out.print((colList.size()));
      out.write(_jsp_string98, 0, _jsp_string98.length);
      
es.addExcelRow(er) ;
}

      out.write(_jsp_string1, 0, _jsp_string1.length);
      
    er = es.newExcelRow () ;

      out.write(_jsp_string111, 0, _jsp_string111.length);
       for(int i =0 ; i< newTempStatValues.size() ; i++) {
                er.addValue(formatData((String)newTempStatValues.get(i))) ;
            
      out.write(_jsp_string112, 0, _jsp_string112.length);
      out.print((formatData((String)newTempStatValues.get(i))));
      out.write(_jsp_string75, 0, _jsp_string75.length);
      out.print((formatData((String)newTempStatValues.get(i))));
      out.write(_jsp_string80, 0, _jsp_string80.length);
       }
      out.write(_jsp_string113, 0, _jsp_string113.length);
      out.print((colList.size()));
      out.write(_jsp_string98, 0, _jsp_string98.length);
      
    es.addExcelRow(er) ;
    

      out.write(_jsp_string114, 0, _jsp_string114.length);
      out.print((tempstatvalues.size()));
      out.write(_jsp_string115, 0, _jsp_string115.length);
      out.print((pageSize ));
      out.write(_jsp_string116, 0, _jsp_string116.length);
      out.print((currentPage ));
      out.write(_jsp_string117, 0, _jsp_string117.length);
      out.print((rowcount ));
      out.write(_jsp_string118, 0, _jsp_string118.length);
      out.print((pageCount ));
      out.write(_jsp_string119, 0, _jsp_string119.length);
       
            String strnew = getSplitPageStringnew(pageSize, currentPage, rowcount, pageCount, "bottom",user);
            //System.out.println("strnew888888 = "+strnew);
            out.print(strnew);
            
      out.write(_jsp_string120, 0, _jsp_string120.length);
      
ExcelFile.init() ;
ExcelFile.setFilename(Util.toScreen(ReportComInfo.getReportname(reportid),user.getLanguage())) ;
ExcelFile.addSheet(Util.toScreen(ReportComInfo.getReportname(reportid),user.getLanguage()), es) ;
 
      out.write(_jsp_string121, 0, _jsp_string121.length);
      
if("1".equals(outputExcel)){
    ExcelFile.init();
    ExcelFile.setFilename(Util.toScreen(ReportComInfo.getReportname(reportid),user.getLanguage())) ;
    ExcelFile.addSheet(Util.toScreen(ReportComInfo.getReportname(reportid),user.getLanguage()), es) ;
}

      out.write(_jsp_string122, 0, _jsp_string122.length);
      if("1".equals(outputExcel)){
      out.write(_jsp_string123, 0, _jsp_string123.length);
      }
      out.write(_jsp_string124, 0, _jsp_string124.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("workflow/report/ReportResultData.jsp"), -1713429050359304189L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("systeminfo/init_wev8.jsp"), 8775654873609053482L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("wui/common/page/initWui.jsp"), 3390533274175540290L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string21;
  private final static char []_jsp_string74;
  private final static char []_jsp_string22;
  private final static char []_jsp_string102;
  private final static char []_jsp_string63;
  private final static char []_jsp_string9;
  private final static char []_jsp_string33;
  private final static char []_jsp_string106;
  private final static char []_jsp_string84;
  private final static char []_jsp_string49;
  private final static char []_jsp_string39;
  private final static char []_jsp_string44;
  private final static char []_jsp_string54;
  private final static char []_jsp_string124;
  private final static char []_jsp_string80;
  private final static char []_jsp_string20;
  private final static char []_jsp_string75;
  private final static char []_jsp_string105;
  private final static char []_jsp_string85;
  private final static char []_jsp_string17;
  private final static char []_jsp_string19;
  private final static char []_jsp_string13;
  private final static char []_jsp_string118;
  private final static char []_jsp_string79;
  private final static char []_jsp_string56;
  private final static char []_jsp_string91;
  private final static char []_jsp_string86;
  private final static char []_jsp_string98;
  private final static char []_jsp_string82;
  private final static char []_jsp_string73;
  private final static char []_jsp_string77;
  private final static char []_jsp_string123;
  private final static char []_jsp_string18;
  private final static char []_jsp_string94;
  private final static char []_jsp_string88;
  private final static char []_jsp_string100;
  private final static char []_jsp_string61;
  private final static char []_jsp_string45;
  private final static char []_jsp_string7;
  private final static char []_jsp_string112;
  private final static char []_jsp_string120;
  private final static char []_jsp_string47;
  private final static char []_jsp_string122;
  private final static char []_jsp_string87;
  private final static char []_jsp_string6;
  private final static char []_jsp_string52;
  private final static char []_jsp_string15;
  private final static char []_jsp_string111;
  private final static char []_jsp_string28;
  private final static char []_jsp_string57;
  private final static char []_jsp_string69;
  private final static char []_jsp_string66;
  private final static char []_jsp_string64;
  private final static char []_jsp_string97;
  private final static char []_jsp_string121;
  private final static char []_jsp_string107;
  private final static char []_jsp_string35;
  private final static char []_jsp_string12;
  private final static char []_jsp_string0;
  private final static char []_jsp_string26;
  private final static char []_jsp_string10;
  private final static char []_jsp_string43;
  private final static char []_jsp_string8;
  private final static char []_jsp_string34;
  private final static char []_jsp_string67;
  private final static char []_jsp_string46;
  private final static char []_jsp_string31;
  private final static char []_jsp_string96;
  private final static char []_jsp_string89;
  private final static char []_jsp_string4;
  private final static char []_jsp_string32;
  private final static char []_jsp_string115;
  private final static char []_jsp_string65;
  private final static char []_jsp_string37;
  private final static char []_jsp_string70;
  private final static char []_jsp_string27;
  private final static char []_jsp_string53;
  private final static char []_jsp_string109;
  private final static char []_jsp_string48;
  private final static char []_jsp_string55;
  private final static char []_jsp_string38;
  private final static char []_jsp_string16;
  private final static char []_jsp_string58;
  private final static char []_jsp_string62;
  private final static char []_jsp_string81;
  private final static char []_jsp_string42;
  private final static char []_jsp_string99;
  private final static char []_jsp_string2;
  private final static char []_jsp_string14;
  private final static char []_jsp_string117;
  private final static char []_jsp_string78;
  private final static char []_jsp_string119;
  private final static char []_jsp_string36;
  private final static char []_jsp_string5;
  private final static char []_jsp_string116;
  private final static char []_jsp_string51;
  private final static char []_jsp_string114;
  private final static char []_jsp_string24;
  private final static char []_jsp_string104;
  private final static char []_jsp_string92;
  private final static char []_jsp_string68;
  private final static char []_jsp_string1;
  private final static char []_jsp_string113;
  private final static char []_jsp_string110;
  private final static char []_jsp_string108;
  private final static char []_jsp_string11;
  private final static char []_jsp_string93;
  private final static char []_jsp_string50;
  private final static char []_jsp_string41;
  private final static char []_jsp_string101;
  private final static char []_jsp_string23;
  private final static char []_jsp_string30;
  private final static char []_jsp_string72;
  private final static char []_jsp_string90;
  private final static char []_jsp_string76;
  private final static char []_jsp_string60;
  private final static char []_jsp_string59;
  private final static char []_jsp_string29;
  private final static char []_jsp_string25;
  private final static char []_jsp_string95;
  private final static char []_jsp_string40;
  private final static char []_jsp_string71;
  private final static char []_jsp_string83;
  private final static char []_jsp_string3;
  private final static char []_jsp_string103;
  static {
    _jsp_string21 = "&f_weaver_belongto_usertype=".toCharArray();
    _jsp_string74 = ";\" title=\"".toCharArray();
    _jsp_string22 = "\";\r\n	    xmlhttp.open(\"GET\",URL, false);\r\n	    xmlhttp.send(null);\r\n	    var result = xmlhttp.status;\r\n	    if(result==200) {\r\n		    isconn = true;\r\n	    	var response_flag = xmlhttp.responseText;\r\n	    	if(response_flag!='0') {\r\n	    		var flag_msg = '';\r\n	    		if(response_flag=='1') {\r\n	    			var diag = new Dialog();\r\n					diag.Width = 300;\r\n					diag.Height = 180;\r\n					diag.ShowCloseButton=false;\r\n					diag.Title = \"".toCharArray();
    _jsp_string102 = "\r\n    \r\n    \r\n    ".toCharArray();
    _jsp_string63 = "\";\r\n//\u5f53\u524d\u4e3b\u9898\u4f7f\u7528\u7684\u76ae\u80a4\r\nvar GLOBAL_SKINS_FOLDER = \"".toCharArray();
    _jsp_string9 = "\r\n<script type=\"text/javascript\" src=\"/js/select/script/jquery-1.8.3.min_wev8.js\"></script>	    \r\n".toCharArray();
    _jsp_string33 = "\", function () {\r\n						    formElementFocus(tempElement);						\r\n							});\r\n						}\r\n						return false;\r\n					}else{\r\n						if(window.__oriAlert__){\r\n							try{\r\n								window.top.Dialog.alert(\"".toCharArray();
    _jsp_string106 = "\r\n            ".toCharArray();
    _jsp_string84 = "<TR>\r\n  ".toCharArray();
    _jsp_string49 = "\";\r\ndoCheckusb();\r\n</script>\r\n".toCharArray();
    _jsp_string39 = "\");\r\n						}else{\r\n							window.top.Dialog.alert(\"".toCharArray();
    _jsp_string44 = "\";\r\n\r\n  if(companyname.length >0 ){\r\n  	window.status = str1+companyname;\r\n  }\r\n</script>\r\n<!-- \u5220\u9664 -->\r\n</head></html>\r\n\r\n<!--USB \u9a8c\u8bc1 -->\r\n".toCharArray();
    _jsp_string54 = "\r\n<!--For wui-->\r\n<link type='text/css' rel='stylesheet'  href='/wui/theme/".toCharArray();
    _jsp_string124 = "\r\n//-->\r\n</script>\r\n".toCharArray();
    _jsp_string80 = "</TD>\r\n            ".toCharArray();
    _jsp_string20 = "&time=\"+new Date()+\"&f_weaver_belongto_userid=".toCharArray();
    _jsp_string75 = "\">".toCharArray();
    _jsp_string105 = "\" >\r\n        ".toCharArray();
    _jsp_string85 = "\r\n  ".toCharArray();
    _jsp_string17 = "');\r\n}\r\n\r\nfunction _onViewLog(operateitem,sqlwhere,id){\r\n	if(!sqlwhere)sqlwhere = \"\";\r\n	var dialog = new window.top.Dialog();\r\n	dialog.currentWindow = window;\r\n	dialog.Title = \"".toCharArray();
    _jsp_string19 = "\";\r\n		}\r\n	}\r\n	dialog.Width = jQuery(window).width();\r\n	dialog.Height = 610;\r\n	dialog.Drag = true;\r\n	dialog.checkDataChange = false;\r\n	dialog.maxiumnable = true;\r\n	dialog.URL = url;\r\n	dialog.show();\r\n}\r\n\r\n\r\nfunction check_form(thiswins,items)\r\n{\r\n	/* added by cyril on 2008-08-14 for td:8521 */\r\n	var isconn = false;\r\n	try {\r\n		var xmlhttp;\r\n	    if (window.XMLHttpRequest) {\r\n	    	xmlhttp = new XMLHttpRequest();\r\n	    }  \r\n	    else if (window.ActiveXObject) {\r\n	    	xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\");  \r\n	    }\r\n	    var URL = \"/systeminfo/CheckConn.jsp?userid=".toCharArray();
    _jsp_string13 = "\r\n<!-- js \u6574\u5408\u5230 init_wev8.js -->\r\n<script type=\"text/javascript\" src=\"/js/jquery.table_wev8.js\"></script>\r\n<script language=\"javascript\" type=\"text/javascript\" src=\"/js/init_wev8.js\"></script>\r\n<script language=\"javascript\"  src=\"/js/wbusb_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/jquery/plugins/client/jquery.client_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/ecology8/jNice/jNice/jquery.jNice_wev8.js\"></script>\r\n<script type='text/javascript' src='/js/jquery-autocomplete/jquery.autocomplete_wev8.js'></script>\r\n<script type='text/javascript' src='/js/jquery-autocomplete/browser_wev8.js'></script>\r\n<script language=javascript src=\"/wui/theme/ecology8/jquery/js/zDialog_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/ecology8/request/hoverBtn_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/ecology8/lang/weaver_lang_".toCharArray();
    _jsp_string118 = "\">\r\n            <input type=\"hidden\" name=\"pageCount\" value=\"".toCharArray();
    _jsp_string79 = "\r\n            <TD style=\"overflow: hidden; vertical-align: middle; white-space: nowrap; word-break: keep-all; text-overflow: ellipsis;background:#e9f3fb;\" title=\"".toCharArray();
    _jsp_string56 = "/wui_wev8.css'/>\r\n".toCharArray();
    _jsp_string91 = "\">\r\n    ".toCharArray();
    _jsp_string86 = "\r\n    \r\n    ".toCharArray();
    _jsp_string98 = "\" class=\"paddingLeft0Table\"><div class=\"intervalDivClass\"></div></td></tr>\r\n".toCharArray();
    _jsp_string82 = "\" class=\"paddingLeft0Table\"><div class=\"intervalDivClass\"></div></td></tr>\r\n        ".toCharArray();
    _jsp_string73 = "\r\n    \r\n    <!-- 2012-08-16 ypc \u4fee\u6539 height:38px \u5bfc\u81f4IE\u6d4f\u89c8\u5668\u4e2d\u8868\u5934\u663e\u793a\u6709\u95ee\u9898 -->\r\n    <TH style=\"overflow: hidden; vertical-align: middle; white-space: nowrap; word-break: keep-all; text-overflow: ellipsis;width: ".toCharArray();
    _jsp_string77 = "\r\n  </TR>\r\n".toCharArray();
    _jsp_string123 = "\r\n    //window.parent.document.getElementById(\"excelwaitDiv\").style.display = \"none\"; \r\n    window.parent.e8showAjaxTips(\"\",false);\r\n    window.location.href = \"/weaver/weaver.file.ExcelOut\";\r\n".toCharArray();
    _jsp_string18 = "\";\r\n	var url = \"/docs/tabs/DocCommonTab.jsp?_fromURL=3&operateitem=\"+operateitem+\"&sqlwhere=\"+sqlwhere;\r\n	if(id){\r\n		url = \"/docs/tabs/DocCommonTab.jsp?_fromURL=3&relatedid=\"+id+\"&operateitem=\"+operateitem+\"&sqlwhere=\"+sqlwhere;\r\n		if(operateitem==418||operateitem==419||operateitem==420){\r\n			dialog.Title = \"".toCharArray();
    _jsp_string94 = "\r\n                        ".toCharArray();
    _jsp_string88 = "\r\n        ".toCharArray();
    _jsp_string100 = "\r\n        </tr>\r\n<tr class=\"Spacing\" style=\"width:100%;height:1px!important;\"><td colspan=\"".toCharArray();
    _jsp_string61 = ")\">\r\n".toCharArray();
    _jsp_string45 = "\r\n<script language=javascript>\r\nubsfirmcode0 = ".toCharArray();
    _jsp_string7 = "\r\n\r\n\r\n<script language=javascript>;\r\ntop.Dialog.alert(\"".toCharArray();
    _jsp_string112 = "\r\n            \r\n            <TD style=\"overflow: hidden; vertical-align: middle; white-space: nowrap; word-break: keep-all; text-overflow: ellipsis;background:#ecfdea;color: #00b050;\" title=\"".toCharArray();
    _jsp_string120 = "\r\n\r\n    </div>\r\n    </td></tr>\r\n\r\n<!--  -->\r\n\r\n\r\n<!--  -->\r\n\r\n    <tr>\r\n        <td height=\"10\" colspan=\"3\"></td>\r\n    </tr>\r\n</table>\r\n\r\n ".toCharArray();
    _jsp_string47 = ";\r\nusbserial0 = \"".toCharArray();
    _jsp_string122 = "\r\n</HTML>\r\n<script type=\"text/javascript\">\r\n<!--\r\n".toCharArray();
    _jsp_string87 = " \r\n        ".toCharArray();
    _jsp_string6 = "\";\r\n		});		\r\n	</script>\r\n	".toCharArray();
    _jsp_string52 = "\r\n}\r\n\r\nfunction doScannerEscape(ev, obj){\r\n	IMCarousel.doScannerEscape(ev, obj);\r\n}\r\n\r\nfunction scaleImg(obj, tag){\r\n	IMCarousel.scaleImg(obj, tag);\r\n}\r\n\r\nfunction rotateImg(obj){\r\n	IMCarousel.rotateImg(obj);\r\n}\r\n\r\nfunction downloadImg(obj){\r\n	IMCarousel.downloadImg(obj);\r\n}\r\n\r\nfunction slideImg(obj, direction){\r\n	IMCarousel.slideImg(obj, direction);\r\n}\r\n\r\nfunction showImgScanner(ev, isShow, id){\r\n	IMCarousel.showImgScanner(ev, isShow, id);\r\n}\r\n\r\nfunction downloads(id){\r\n	document.location.href=\"/weaver/weaver.file.FileDownload?fileid=\"+id+\"&download=1\";\r\n}\r\n</script>\r\n".toCharArray();
    _jsp_string15 = "\";\r\nfunction check_conn() {\r\n	return confirm('".toCharArray();
    _jsp_string111 = "\r\n<TR  style=\"FONT-WEIGHT: bold;background:#ecfdea;\">\r\n            ".toCharArray();
    _jsp_string28 = "\r\n	    try {\r\n		    var lenck = true;\r\n		    var tempfieldvlaue = document.getElementById(\"htmlfieldids\").value;\r\n		    while(true) {\r\n			    var tempfield = tempfieldvlaue.substring(0, tempfieldvlaue.indexOf(\",\"));\r\n			    tempfieldvlaue = tempfieldvlaue.substring(tempfieldvlaue.indexOf(\",\")+1);\r\n			    var fieldid = tempfield.substring(0, tempfield.indexOf(\";\"));\r\n			    var fieldname = tempfield.substring(tempfield.indexOf(\";\")+1);\r\n			    if(fieldname=='') break;\r\n			    if(!checkLengthOnly(fieldid,'4000',fieldname,'".toCharArray();
    _jsp_string57 = "\r\n\r\n\r\n<!-- \u5b57\u4f53\u8bbe\u7f6e\uff0cwin7\u3001vista\u7cfb\u7edf\u4f7f\u7528\u96c5\u9ed1\u5b57\u4f53,\u5176\u4ed6\u7cfb\u7edf\u4f7f\u7528\u5b8b\u4f53 Start -->\r\n<!--\r\n\u6dfb\u52a0\u81f3init_wev8.css \r\n<link type='text/css' rel='stylesheet'  href='/wui/common/css/w7OVFont_wev8.css' id=\"FONT2SYSTEMF\">\r\n -->\r\n<script language=\"javascript\"> \r\n/*\r\nif (jQuery.client.version< 6) {\r\n	document.getElementById('FONT2SYSTEMF').href = \"/wui/common/css/notW7AVFont_wev8.css\";\r\n}\r\n*/\r\n</script> \r\n<!-- \u5b57\u4f53\u8bbe\u7f6e\uff0cwin7\u3001vista\u7cfb\u7edf\u4f7f\u7528\u96c5\u9ed1\u5b57\u4f53,\u5176\u4ed6\u7cfb\u7edf\u4f7f\u7528\u5b8b\u4f53 End -->\r\n\r\n<!-- \u9875\u9762\u5207\u6362\u6548\u679cStart -->\r\n".toCharArray();
    _jsp_string69 = "\r\n\r\n\r\n\r\n\r\n<HTML>\r\n<HEAD>\r\n<link rel=stylesheet type=\"text/css\" href=\"/css/Weaver_wev8.css\">\r\n</HEAD>\r\n<BODY id=\"reportBody\">\r\n".toCharArray();
    _jsp_string66 = "<!--added by xwj for td2974 20051026-->\r\n".toCharArray();
    _jsp_string64 = "\";\r\n</script>\r\n\r\n<!--For wuiForm-->\r\n<script type=\"text/javascript\" src=\"/wui/common/jquery/plugin/wuiform/jquery.wuiform_wev8.js\"></script>\r\n<script language=\"javascript\">\r\njQuery(document).ready(function(){\r\n	wuiform.init();\r\n});\r\n</script>\r\n".toCharArray();
    _jsp_string97 = "\r\n    </TR>\r\n  <tr class=\"Spacing\" style=\"width:100%;height:1px!important;\"><td colspan=\"".toCharArray();
    _jsp_string121 = "\r\n \r\n \r\n \r\n</BODY>\r\n\r\n".toCharArray();
    _jsp_string107 = "\r\n               ".toCharArray();
    _jsp_string35 = "\");\r\n							}\r\n						}else{\r\n							try{\r\n								window.top.Dialog.alert(\"".toCharArray();
    _jsp_string12 = "\r\n<!-- IE\u4e0b\u4e13\u7528vbs\uff08\u4e34\u65f6\uff09 -->\r\n<script language=\"vbs\" src=\"/js/string2VbArray.vbs\"></script>        \r\n        ".toCharArray();
    _jsp_string0 = "\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string26 = "';\r\n	   \r\n	    			return false;\r\n	    		}\r\n	    		flag_msg += '\\r\\n\\r\\n".toCharArray();
    _jsp_string10 = "\r\n<script type=\"text/javascript\" src=\"/wui/common/jquery/jquery.min_wev8.js\"></script>\r\n".toCharArray();
    _jsp_string43 = "\";\r\n  var str1 = \"".toCharArray();
    _jsp_string8 = "\",function(){\r\n	window.top.location=\"/login/Login.jsp\";\r\n});\r\n</script>\r\n".toCharArray();
    _jsp_string34 = "\");\r\n							}catch(e){\r\n								Dialog.alert(\"".toCharArray();
    _jsp_string67 = "\r\n\r\n\r\n".toCharArray();
    _jsp_string46 = ";\r\nusbusercode0 = ".toCharArray();
    _jsp_string31 = "\r\n	}\r\n	catch(e) {\r\n		return check_conn();\r\n	}\r\n	if(!isconn)\r\n		return check_conn();\r\n    /* end by cyril on 2008-08-14 for td:8521 */\r\n	\r\n	thiswin = thiswins\r\n	items = \",\"+items + \",\";\r\n	\r\n	var tempfieldvlaue1 = \"\";\r\n	try{\r\n		tempfieldvlaue1 = document.getElementById(\"htmlfieldids\").value;\r\n	}catch (e) {\r\n	}\r\n\r\n	for(i=1;i<=thiswin.length;i++){\r\n		tmpname = thiswin.elements[i-1].name;\r\n		tmpvalue = thiswin.elements[i-1].value;\r\n	    if(tmpvalue==null){\r\n	        continue;\r\n	    }\r\n\r\n		if(tmpname!=\"\" && items.indexOf(\",\"+tmpname+\",\")!=-1){		\r\n			var __fieldhtmltype = jQuery(\"input[name=\" + tmpname + \"]\").attr(\"__fieldhtmltype\");\r\n		    if (__fieldhtmltype == '9') {\r\n		        continue;\r\n		    }\r\n		\r\n			var href = location.href;\r\n			if(href && href.indexOf(\"Ext.jsp\")!=-1){\r\n				window.__oriAlert__ = true;\r\n			}\r\n			if(tempfieldvlaue1.indexOf(tmpname+\";\") == -1){\r\n				while(tmpvalue.indexOf(\" \") >= 0){\r\n					tmpvalue = tmpvalue.replace(\" \", \"\");\r\n				}\r\n				while(tmpvalue.indexOf(\"\\r\\n\") >= 0){\r\n					tmpvalue = tmpvalue.replace(\"\\r\\n\", \"\");\r\n				}\r\n\r\n				if(tmpvalue == \"\"){\r\n					if(thiswin.elements[i-1].getAttribute(\"temptitle\")!=null && thiswin.elements[i-1].getAttribute(\"temptitle\")!=\"\"){\r\n						if(window.__oriAlert__){\r\n							window.top.Dialog.alert(\"\\\"\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"\\\"\"+\"".toCharArray();
    _jsp_string96 = "\r\n    </TD>\r\n    ".toCharArray();
    _jsp_string89 = "\r\n    ".toCharArray();
    _jsp_string4 = "\r\n	<script language=\"javascript\">\r\n		window.top.Dialog.alert(\"".toCharArray();
    _jsp_string32 = "\");\r\n						}else{\r\n							var tempElement = thiswin.elements[i-1];\r\n							//ueditor\u5fc5\u586b\u9a8c\u8bc1\r\n							if (checkueditorContent(tempElement)) {\r\n								continue;\r\n							}\r\n							\r\n							window.top.Dialog.alert(\"&quot;\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"&quot;\"+\"".toCharArray();
    _jsp_string115 = "\" align=\"right\">\r\n    <div align=\"right\">\r\n        <span class=\"e8_pageinfo\">\r\n            <input type=\"hidden\" name=\"pageSize\" value=\"".toCharArray();
    _jsp_string65 = "\r\n\r\n\r\n<!--ReportCompositorOrderBean is added by xwj for td2099 on 20050608-->\r\n<!--ReportCompositorListBean is added by xwj for td2451 on 20051114-->\r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n<!--added by xwj for td2974 20051026-->\r\n ".toCharArray();
    _jsp_string37 = "\");\r\n						}else{\r\n							var tempElement = thiswin.elements[i-1];\r\n							\r\n							//ueditor\u5fc5\u586b\u9a8c\u8bc1\r\n							if (checkueditorContent(tempElement)) {\r\n								continue;\r\n							}\r\n							\r\n							window.top.Dialog.alert(\"&quot;\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"&quot;\"+\"".toCharArray();
    _jsp_string70 = "\r\n<div style=\"height:0px;width:0px;\">\r\n<iframe id=\"ExcelOut\" name=\"ExcelOut\" border=0 frameborder=no noresize=NORESIZE height=\"0px\" width=\"0px\"></iframe>\r\n</div>\r\n<div id=\"firstDiv\" name=\"firstDiv\" style=\"width:100%;overflow:auto;height:99%;\">\r\n<table>\r\n    <COLGROUP>\r\n    <col width=\"10\">\r\n    <col width=\"\">\r\n    <col width=\"10\">\r\n<tr><td></td>\r\n<td>\r\n<TABLE class=ListStyle cellspacing=1 id=\"reportDateTbl\" name=\"reportDateTbl\" style=\"table-Layout:fixed;".toCharArray();
    _jsp_string27 = "';\r\n	        	//alert(xmlhttp.responseText);\r\n	        	return confirm(flag_msg);\r\n	        }\r\n	    }\r\n	    xmlhttp = null;\r\n\r\n	  	//\u68c0\u67e5\u591a\u884c\u6587\u672c\u6846 oracle\u4e0b\u68c0\u67e5HTML\u4e0d\u80fd\u8d85\u8fc74000\u4e2a\u5b57\u7b26\r\n	    ".toCharArray();
    _jsp_string53 = "\r\n\r\n\r\n<!--For wui-->\r\n".toCharArray();
    _jsp_string109 = "\r\n            \r\n            <TD style=\"overflow: hidden; vertical-align: middle; white-space: nowrap; word-break: keep-all; text-overflow: ellipsis;background:#e9f3fb;\" title=\"".toCharArray();
    _jsp_string48 = "\";\r\nusblanguage = \"".toCharArray();
    _jsp_string55 = "/skins/".toCharArray();
    _jsp_string38 = "\", function () {\r\n								formElementFocus(tempElement);\r\n							});\r\n							\r\n						}\r\n						return false;\r\n					}else{\r\n						if(window.__oriAlert__){\r\n							window.top.Dialog.alert(\"".toCharArray();
    _jsp_string16 = "\\r\\n\\r\\n".toCharArray();
    _jsp_string58 = "\r\n    <meta http-equiv=\"".toCharArray();
    _jsp_string62 = "\r\n<!-- \u9875\u9762\u5207\u6362\u6548\u679cEnd -->\r\n\r\n\r\n<script language=\"javascript\">\r\n\r\n//------------------------------\r\n// the folder of current skins \r\n//------------------------------\r\n//\u5f53\u524d\u4f7f\u7528\u7684\u4e3b\u9898\r\nvar GLOBAL_CURRENT_THEME = \"".toCharArray();
    _jsp_string81 = "\r\n        </tr>\r\n<tr class=\"Spacing\" style=\"width:100%; height:1px!important;\"><td colspan=\"".toCharArray();
    _jsp_string42 = "\";\r\n   if(!confirm(str)){\r\n       return false;\r\n   }\r\n       return true;\r\n   } \r\n\r\n///*\u6d41\u7a0b\u91cc\u9762\u4f7f\u7528\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u6d41\u7a0b\u5185\u5bb9\u653e\u5230iframe\u91cc\u9762\uff0c\u901a\u8fc7response\u8fd4\u56de\u7684\u65f6\u5019\uff0c\u8981\u8fd4\u56de\u7684\u5230\u5176\u7236\u7a97\u53e3*/\r\nfunction wfforward(wfurl){\r\n	parent.location.href = wfurl;\r\n}\r\n\r\nfunction myescapecode(str)\r\n{\r\n	return encodeURIComponent(str);\r\n}\r\n</script>\r\n\r\n\r\n\r\n<meta http-equiv=Content-Type content=\"text/html; charset=UTF-8\">\r\n<script language=JavaScript> \r\n  var companyname = \"".toCharArray();
    _jsp_string99 = "\r\n        <TR  style=\"FONT-WEIGHT: bold;background:#e9f3fb;\">\r\n            ".toCharArray();
    _jsp_string2 = "\r\n<!DOCTYPE HTML>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<html>\r\n<head>\r\n<!-- \r\n\u6dfb\u52a0\u81f3init.css\r\n<style type=\"text/css\">\r\n	html{height:100%;}\r\n</style>\r\n -->\r\n".toCharArray();
    _jsp_string14 = "_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/messagejs/highslide/highslide-full_wev8.js\"></script>\r\n<script type=\"text/javascript\">\r\n    hs.graphicsDir = '/js/messagejs/highslide/graphics/';\r\n    hs.align = 'center';\r\n    hs.transitions = ['expand', 'crossfade'];\r\n    hs.outlineType = 'rounded-white';\r\n    hs.fadeInOut = true;\r\n</script>\r\n<!-- init.css, \u6240\u6709css\u6587\u4ef6\u90fd\u5728\u6b64\u6587\u4ef6\u4e2d\u5f15\u5165 -->\r\n<link rel=\"stylesheet\" href=\"/css/init_wev8.css\" type=\"text/css\" />\r\n\r\n\r\n<script language=javascript>\r\nwindow[\"_jsessionid\"] = \"".toCharArray();
    _jsp_string117 = "\">\r\n            <input type=\"hidden\" name=\"rowcount\" value=\"".toCharArray();
    _jsp_string78 = "\r\n        <TR style=\"FONT-WEIGHT: bold;background:#e9f3fb;\">\r\n            ".toCharArray();
    _jsp_string119 = "\">\r\n            ".toCharArray();
    _jsp_string36 = "\");\r\n							}\r\n						}\r\n						return false;\r\n					}\r\n				}\r\n			} else {\r\n				var divttt=document.createElement(\"div\");\r\n				divttt.innerHTML = tmpvalue;\r\n				var tmpvaluettt = jQuery.trim(jQuery(divttt).text());\r\n				if(tmpvaluettt == \"\"){\r\n					if(thiswin.elements[i-1].getAttribute(\"temptitle\")!=null && thiswin.elements[i-1].getAttribute(\"temptitle\")!=\"\"){\r\n						if(window.__oriAlert__){\r\n							window.top.Dialog.alert(\"\\\";\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"\\\"\"+\"".toCharArray();
    _jsp_string5 = "\",function(){\r\n			window.top.location=\"".toCharArray();
    _jsp_string116 = "\">\r\n            <input type=\"hidden\" name=\"currentPage\" value=\"".toCharArray();
    _jsp_string51 = "\r\n<LINK href=\"/js/jquery/jquery_dialog_wev8.css\" type=text/css rel=STYLESHEET>\r\n<script type=\"text/javascript\" src=\"/wui/common/jquery/jquery.min_wev8.js\"></script>\r\n<script type=\"text/javascript\" language=\"javascript\" src=\"/js/jquery/jquery_dialog_wev8.js\"></script>\r\n\r\n<script src=\"/social/js/drageasy/drageasy.js\"></script>\r\n<script type=\"text/javascript\" src=\"/social/js/bootstrap/js/bootstrap.js\"></script>\r\n<script type=\"text/javascript\" src=\"/social/im/js/IMUtil_wev8.js\"></script>\r\n\r\n<script type=\"text/javascript\" src=\"/social/js/imcarousel/imcarousel.js\"></script>\r\n<script type=\"text/javascript\" language=\"javascript\">\r\nfunction ReloadOpenerByDialogClose() {\r\n    ".toCharArray();
    _jsp_string114 = "\r\n </TBODY></TABLE>\r\n</td>\r\n<td></td>\r\n</tr>\r\n</table>\r\n</div>\r\n    \r\n<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\">\r\n<colgroup>\r\n<col width=\"10\">\r\n<col width=\"\">\r\n<col width=\"10\">\r\n<tr>\r\n    <td height=\"10\" colspan=\"3\"></td>\r\n</tr>\r\n\r\n\r\n    <tr><td colspan=\"".toCharArray();
    _jsp_string24 = "\";\r\n					diag.show();\r\n			        return false;\r\n	    		}\r\n	    		else if(response_flag=='2') {\r\n	    			flag_msg = '".toCharArray();
    _jsp_string104 = "\r\n     \r\n    <TD style=\"overflow: hidden; vertical-align: middle; white-space: nowrap; word-break: keep-all; text-overflow: ellipsis;\" title=\"".toCharArray();
    _jsp_string92 = "\r\n                ".toCharArray();
    _jsp_string68 = "    \r\n".toCharArray();
    _jsp_string1 = "\r\n".toCharArray();
    _jsp_string113 = "\r\n            </tr>\r\n            <tr class=\"Spacing\" style=\"width:100%;height:1px!important;\"><td colspan=\"".toCharArray();
    _jsp_string110 = "\r\n        </tr>\r\n        <tr class=\"Spacing\" style=\"width:100%;height:1px!important;\"><td colspan=\"".toCharArray();
    _jsp_string108 = "\r\n  </TR>\r\n  <tr class=\"Spacing\" style=\"width:100%;height:1px!important;\"><td colspan=\"".toCharArray();
    _jsp_string11 = "\r\n<script language=\"javascript\" type=\"text/javascript\" src=\"/FCKEditor/swfobject_wev8.js\"></script>\r\n\r\n".toCharArray();
    _jsp_string93 = "\r\n             ".toCharArray();
    _jsp_string50 = "\r\n\r\n<!--WUI -->\r\n".toCharArray();
    _jsp_string41 = "\";\r\n   if(!confirm(str)){\r\n       return false;\r\n   }\r\n       return true;\r\n } \r\n\r\nfunction issubmit(){\r\n	var str = \"".toCharArray();
    _jsp_string101 = "<TR >\r\n  ".toCharArray();
    _jsp_string23 = "\";\r\n					//diag.InvokeElementId=\"pageOverlay\"\r\n					diag.URL = \"/wui/theme/ecology7/page/loginSmall.jsp?username=".toCharArray();
    _jsp_string30 = "')) {\r\n				    lenck = false;\r\n				    break;\r\n			    }\r\n		    }\r\n		    if(lenck==false) return false;\r\n	    }\r\n	    catch(e) {}\r\n	    ".toCharArray();
    _jsp_string72 = " \r\n \r\n      \r\n  \r\n  <TR class=\"HeaderForXtalbe\">\r\n  ".toCharArray();
    _jsp_string90 = "\r\n    \r\n    <TD style=\"overflow: hidden; vertical-align: middle; white-space: nowrap; word-break: keep-all; text-overflow: ellipsis;\" title=\"".toCharArray();
    _jsp_string76 = "</TH>\r\n    ".toCharArray();
    _jsp_string60 = ",transition=".toCharArray();
    _jsp_string59 = "\" content=\"revealTrans(duration=".toCharArray();
    _jsp_string29 = "','".toCharArray();
    _jsp_string25 = "';\r\n	    		}\r\n	    		//\u4e3b\u4ece\u5e10\u6237\u7279\u6b8a\u5904\u7406 by alan for TD10156\r\n	    		if(response_flag=='3') {\r\n	    			flag_msg = '".toCharArray();
    _jsp_string95 = "\r\n                       ".toCharArray();
    _jsp_string40 = "\");\r\n						}\r\n						return false;\r\n					}\r\n				}\r\n			}\r\n		}\r\n	}\r\n	return true;\r\n}\r\n\r\nfunction isdel(){\r\n	var str = \"".toCharArray();
    _jsp_string71 = "\">\r\n  <COLGROUP>\r\n  <TBODY>\r\n   \r\n".toCharArray();
    _jsp_string83 = "\r\n  <TR >\r\n  ".toCharArray();
    _jsp_string3 = "\r\n\r\n".toCharArray();
    _jsp_string103 = " \r\n      ".toCharArray();
  }
}
