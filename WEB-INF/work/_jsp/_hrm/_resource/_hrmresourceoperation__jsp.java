/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._hrm._resource;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import java.security.*;
import weaver.general.Util;
import weaver.hrm.settings.RemindSettings;
import weaver.file.Prop;
import weaver.rtx.RTXConfig;
import java.lang.reflect.*;
import weaver.hrm.settings.ChgPasswdReminder;
import weaver.file.FileUpload;
import java.util.*;
import java.text.*;
import weaver.systeminfo.sysadmin.HrmResourceManagerVO;
import weaver.systeminfo.sysadmin.HrmResourceManagerDAO;
import weaver.workflow.msg.PoppupRemindInfoUtil;
import weaver.conn.RecordSet;
import weaver.general.StaticObj;
import weaver.hrm.resource.ResourceBelongtoComInfo;
import weaver.conn.RecordSetTrans;
import weaver.login.TokenUtil;
import weaver.ldap.LdapUtil;
import weaver.hrm.common.DbFunctionUtil;
import org.apache.commons.lang3.StringUtils;
import java.net.*;
import weaver.hrm.*;
import weaver.systeminfo.*;
import weaver.general.*;
import ln.LN;
import weaver.hrm.settings.HrmSettingsComInfo;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import weaver.workflow.workflow.TestWorkflowCheck;
import weaver.systeminfo.template.UserTemplate;
import weaver.systeminfo.setting.*;
import weaver.login.LicenseCheckLogin;
import weaver.hrm.online.IPUtil;
import java.util.Map;
import weaver.rtx.OrganisationComRunnable;
import weaver.hrm.definedfield.HrmFieldManager;
import weaver.interfaces.email.CoreMailAPI;
import weaver.interfaces.email.CoreMailTestAPI;

public class _hrmresourceoperation__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;

  
  private String getCurrWuiConfig(HttpSession session, User user, String keyword) throws Exception {
  	
  	if (keyword == null || "".equals(keyword)) {
  		return "";
  	}
  	
  	String curTheme = "";
  	String curskin = "";
  
  	
  		String[] rtnValue = getHrmUserSetting(user);
  		
  		curTheme = rtnValue[0];
  		curskin = rtnValue[1];
  		if(curTheme.equals("")||curskin.equals("")){
  			String templatetype = getCurrE8TemplateType(user);
  			if("".equals(templatetype)){
  				curTheme = "ecologyBasic";
  				curskin = "default";
  			}else if("ecology7".equals(templatetype)){
  				curTheme ="ecology7";
  				curskin = getCurrE8SkinInfo(user);
  			}else{
  				curTheme ="ecology8";
  				curskin = "default";
  			}
  			
  			
  			
  			
  		}else{
  			curTheme = rtnValue[0];
  			curskin = rtnValue[1];
  		}
  		
  		if(curTheme.equals("custom")){
  			curTheme ="ecology8";
  		}
  		
  		session.setAttribute("SESSION_CURRENT_THEME", curTheme);
  		session.setAttribute("SESSION_CURRENT_SKIN", curskin);
  	
  	if ("THEME".equals(keyword.toUpperCase())) {
  		return curTheme;
  	}
  	
  	if ("SKIN".equals(keyword.toUpperCase())) {
  		return curskin;
  	}
  	return "";
  }
  
  
  
  private String getCurrSkinFolder(User user) throws Exception {
  	String pslSkinfolder = "";
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  
  	int userid = user.getUID();
  
  	rs.executeSql("select skin from HrmUserSetting where resourceId=" + userid);
  	
  	if (rs.next()) {
  		pslSkinfolder = rs.getString("skin");
  	}
  
  	if (pslSkinfolder == null || "".equals(pslSkinfolder)) {
  	    pslSkinfolder = "default";
  	}
  	return pslSkinfolder;
  }
  
  private String getCurrE8TemplateType(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	String skin =  userTemplate.getTemplatetype();
  	
  	
  	return skin;
  	
  }
  
  private String getCurrE8SkinInfo(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	String skin =  userTemplate.getSkin();
  	
  	
  	return skin;
  	
  }
  
  private int getCurrTemplateId(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	int id =  userTemplate.getTemplateId();
  	
  	
  	return id;
  	
  }
  
  private String getCurrTemplateLogo(User user){
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	
  	String logo =  userTemplate.getLogo();
  	
  	
  	return logo;
  	
  }
  
  private String[] getHrmUserSetting(User user) throws Exception {
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  
  	String[] result = new String[2];
  	String theme = "";
  	String skin = "";
  	
  	String sql="select templateid from SystemTemplateSubComp where subcompanyid="+user.getUserSubCompany1();
  	rs.executeSql(sql);
  	if(rs.next()){	
  	
  		String curUserCanUse = rs.getString("templateid");
  		sql = "SELECT a.* FROM HrmUserSetting a, SystemTemplate  b WHERE a.resourceId="+user.getUID()+" AND a.templateId=b.id  and  b.id="+curUserCanUse;
  		rs.execute(sql);
  		if(rs.next()){
  			theme = rs.getString("theme");
  			skin = rs.getString("skin");
  			if("ecology8".equals(theme)){
  				skin = "default";
  			}
  			result[0] = theme;
  			result[1] = skin;
  			return result;
  		}
  	}
  	
  	
  
  	
  	int userid = user.getUID();
  	rs.executeSql("select theme, skin from HrmUserSetting where resourceId=" + userid);
  	
  	if (rs.next()) {
  		theme = rs.getString("theme");
  		skin = rs.getString("skin");
  	}
  	
  	//rs.executeSql("select * from extandHpThemeItem where extandHpThemeId=" + sqltemplateid1 + " and isopen=1 and theme='" + theme + "' and skin='" + skin + "'");
  	result[0] = theme;
  	result[1] = skin;
  	
  	
  	
  	//System.out.println("result"+result[0]+result[1]);
  	return result;
  }
  
  
  private java.util.Map getPageConfigInfo(HttpSession session, User user) throws Exception{
  	
  	weaver.conn.RecordSet rs = new weaver.conn.RecordSet();
  	java.util.Map pageConfigkv = new java.util.HashMap();
  	
  	weaver.systeminfo.template.UserTemplate  userTemplate = new weaver.systeminfo.template.UserTemplate();
  	userTemplate.getTemplateByUID(user.getUID(),user.getUserSubCompany1());
  	
  	pageConfigkv.put("logoTop",userTemplate.getLogo());
  	pageConfigkv.put("logoBottom", userTemplate.getLogo());
  	pageConfigkv.put("isopen", userTemplate.getIsopen());
  	//pageConfigkv.put("islock", rs.getString("islock"));
  	
  	int extendtempletvalueid = userTemplate.getExtendtempletvalueid();
  	rs.executeSql("select * from extandHpThemeItem where extandHpThemeId=" + extendtempletvalueid + " and isopen=1 and theme='" + getCurrWuiConfig(session, user, "THEME") + "' and skin='" + getCurrWuiConfig(session, user, "SKIN") + "'");
  	
  	if (rs.next()) {
  	
  		
  		/**
  		 * ecologybasic\u4e3b\u9898\u7528\u8bbe\u7f6e\u9879
  		 */
  		pageConfigkv.put("bodyBg", rs.getString("bodyBg"));
  		pageConfigkv.put("topBgImage", rs.getString("topBgImage"));
  		pageConfigkv.put("toolbarBgColor", rs.getString("toolbarBgColor"));
  		pageConfigkv.put("menuborderColor", rs.getString("menuborderColor"));
  
  		pageConfigkv.put("leftbarBgImage", rs.getString("leftbarBgImage"));
  		pageConfigkv.put("leftbarBgImageH", rs.getString("leftbarBgImageH"));
  
  		pageConfigkv.put("leftbarborderColor", rs.getString("leftbarborderColor"));
  		pageConfigkv.put("leftbarFontColor", rs.getString("leftbarFontColor"));
  
  		pageConfigkv.put("topleftbarBgImage_left", rs.getString("topleftbarBgImage_left"));
  		pageConfigkv.put("topleftbarBgImage_center", rs.getString("topleftbarBgImage_center"));
  		pageConfigkv.put("topleftbarBgImage_right", rs.getString("topleftbarBgImage_right"));
  
  		pageConfigkv.put("bottomleftbarBgImage_left", rs.getString("bottomleftbarBgImage_left"));
  		pageConfigkv.put("bottomleftbarBgImage_center", rs.getString("bottomleftbarBgImage_center"));
  		pageConfigkv.put("bottomleftbarBgImage_right", rs.getString("bottomleftbarBgImage_right"));
  
  	}
  	
  	return pageConfigkv;
  	
  }

  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, "/notice/error.jsp", session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      weaver.system.SysRemindWorkflow SysRemindWorkflow;
      SysRemindWorkflow = (weaver.system.SysRemindWorkflow) pageContext.getAttribute("SysRemindWorkflow");
      if (SysRemindWorkflow == null) {
        SysRemindWorkflow = new weaver.system.SysRemindWorkflow();
        pageContext.setAttribute("SysRemindWorkflow", SysRemindWorkflow);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      
	try{
		response.setBufferSize(1*1024*1024);
	}catch(Exception e){}

      out.write(_jsp_string2, 0, _jsp_string2.length);
      
// \u589e\u52a0\u53c2\u6570\u5224\u65ad\u7f13\u5b58
int isIncludeToptitle = 0;
response.setHeader("cache-control", "no-cache");
response.setHeader("pragma", "no-cache");
response.setHeader("expires", "Mon 1 Jan 1990 00:00:00 GMT");

      out.write(_jsp_string3, 0, _jsp_string3.length);
      
//
User user = HrmUserVarify.getUser (request , response) ;
LicenseCheckLogin licenseCheckLogin = new LicenseCheckLogin();
licenseCheckLogin.setOutLineDate(user.getUID(),IPUtil.getIp(request));

//\u95ee\u98981
TestWorkflowCheck twc=new TestWorkflowCheck();
if(twc.checkURI(session,request.getRequestURI(),request.getQueryString())){
    /*
    response.sendRedirect("/login/Logout.jsp");
    */
    String forwardurl = twc.reLoginMrg(request, response, request.getRequestURI());
    if (!"".equals(forwardurl)) { 
        response.sendRedirect(forwardurl);
        return;
    }
}
String userOffline = Util.null2String((String)session.getAttribute("userOffline"));	
if(userOffline.equals("1")){
	//\u5f3a\u5236\u4e0b\u7ebf
	String loginfile = Util.getCookie(request , "loginfileweaver") ;
	Map userSessions = (Map) application.getAttribute("userSessions");
	if (userSessions != null) {
		Map logmessages = (Map) application.getAttribute("logmessages");
		if (logmessages != null)logmessages.remove("" + user.getUID());
		session.removeValue("moniter");
		session.removeValue("WeaverMailSet");
		userSessions.remove(user.getUID());
		//session.invalidate();
	}
      out.write(_jsp_string4, 0, _jsp_string4.length);
      out.print((SystemEnv.getErrorMsgName(175,user.getLanguage())));
      out.write(_jsp_string5, 0, _jsp_string5.length);
      out.print(("/Refresh.jsp?loginfile="+loginfile+"&message=175"));
      out.write(_jsp_string6, 0, _jsp_string6.length);
      
  return;
}
if(user == null)  return ;
String isIE = (String)session.getAttribute("browser_isie");
if (isIE == null || "".equals(isIE)) {
	isIE = "true";
	session.setAttribute("browser_isie", "true");
}
String agentT = request.getHeader("user-agent");
//if(!"true".equals(isIE)){
//if((agentT.contains("Firefox")||agentT.contains(" Chrome")||agentT.contains("Safari") )&& !agentT.contains("Edge")){
if(agentT.contains("Firefox")||agentT.contains(" Chrome")||agentT.contains("Safari") || agentT.contains("Edge")){	
    isIE = "false";	
}
else{
    isIE = "true";	
}
//}

Log logger= LogFactory.getLog(this.getClass());



//************************************************
//\u8d85\u65f6\u6216\u8005\u91cd\u542fresin\u670d\u52a1\u65f6\uff0c\u5f39\u51fa\u767b\u9646\u5c0f\u7a97\u53e3(TD 2227)
//hubo,050707

//************************************************

String pagepath = request.getServletPath();
if(pagepath.indexOf("HrmResourceOperation.jsp")<0&&pagepath.indexOf("RemindLogin.jsp")<0&&pagepath.indexOf("HrmResourcePassword.jsp")<0){
	String changepwd = (String)request.getSession().getAttribute("changepwd");
	if("n".equals(changepwd)){
		request.getSession().removeAttribute("changepwd");
		response.sendRedirect("/login/Login.jsp");
		return;
	}else if("y".equals(changepwd)){
		request.getSession().removeAttribute("changepwd");
	}
}



//licence\u4fe1\u606f
String companyNametools="";
LN Licenseinit_1 = new LN();
try{
	Licenseinit_1.CkHrmnum();
}catch(Exception e){
	e.printStackTrace();
	out.println("<script type='text/javascript'> top.location.href='/system/InLicense.jsp?message=6&code=';</script>");
	return;
}
companyNametools = Licenseinit_1.getCompanyname();

//\u7248\u672c\u4fe1\u606f
StaticObj staticobj = null;
staticobj = StaticObj.getInstance();
String software = (String)staticobj.getObject("software") ;
if(software == null) software="ALL";
String portal = (String)staticobj.getObject("portal") ;
if(portal == null) portal="n";
boolean isPortalOK = false;
if(portal.equals("y")) isPortalOK = true;
String multilanguage = (String)staticobj.getObject("multilanguage") ;
if(multilanguage == null) multilanguage="n";
boolean isMultilanguageOK = false;
if(multilanguage.equals("y")) isMultilanguageOK = true;


      out.write(_jsp_string3, 0, _jsp_string3.length);
      
  String fromlogin=(String)session.getAttribute("fromlogin");
  session.removeAttribute("fromlogin");
  if(fromlogin==null) fromlogin="no";

  ChgPasswdReminder reminder0 = new ChgPasswdReminder();
  RemindSettings settings0=reminder0.getRemindSettings();
  String firmcode0=settings0.getFirmcode();
  String usercode0=settings0.getUsercode();

  int needusb0=user.getNeedusb();
  String usbtype0 = settings0.getUsbType();
  String serial0=user.getSerial();

//\u9650\u5236\u6bcf\u4e2a\u7528\u6237\u53ea\u80fd\u6709\u4e00\u4e2a\u767b\u5165\u7684\u7a97\u53e3
String frommain = Util.null2String(request.getParameter("frommain")) ;

Map logmessages=(Map)application.getAttribute("logmessages");
String a_logmessage="";
if(logmessages!=null)
	a_logmessage=Util.null2String((String)logmessages.get(""+user.getUID()));

String s_logmessage=Util.null2String((String)session.getAttribute("logmessage"));


//TD2125 by mackjoe \u89e3\u51b3\u6570\u636e\u4e2d\u5fc3\u767b\u9646\u4e0d\u4e86\u95ee\u9898
if(s_logmessage==null)  s_logmessage="";

String relogin0=Util.null2String(settings0.getRelogin());

String changepwd = (String)session.getAttribute("changepwd");

if(!relogin0.equals("1")&&"yes".equals(changepwd)){
logmessages=(Map)application.getAttribute("logmessages");
logmessages.put(""+user.getUID(),s_logmessage);
if(logmessages!=null)
	a_logmessage=Util.null2String((String)logmessages.get(""+user.getUID()));
}

String layoutStyle = (String)request.getSession(true).getAttribute("layoutStyle");
if(layoutStyle==null) layoutStyle ="";

String rtxFromLogintmp = (String)session.getAttribute("RtxFromLogin");


if("1".equals(user.getLogintype())&&!relogin0.equals("1")&&!fromlogin.equals("yes")&&!frommain.equals("yes")&&!s_logmessage.equals(a_logmessage) && !"true".equals(rtxFromLogintmp)){
	if(layoutStyle.equals("") || !layoutStyle.equals("1")){	//\u5982\u679c\u662f\u5c0f\u7a97\u53e3\u767b\u5f55\uff0c\u5219\u4e0d\u5224\u65ad\u662f\u5426\u4e3a\u5f53\u524d\u5de5\u4f5c\u7a97\u53e3


      out.write(_jsp_string7, 0, _jsp_string7.length);
      out.print((SystemEnv.getHtmlLabelName(23274,user.getLanguage())));
      out.write(_jsp_string8, 0, _jsp_string8.length);
      return;}}
      out.write(_jsp_string3, 0, _jsp_string3.length);
      
//\u6d41\u7a0b\u7684\u4e09\u4e2a\u9875\u9762\u9700\u8981\u4f7f\u7528\u9ad8\u7248\u672c\u7684jQuery
if (request.getRequestURI().indexOf("/workflow/request/") != -1 &&
        (request.getRequestURI().indexOf("/workflow/request/ManageRequestNoForm") != -1 
                || request.getRequestURI().indexOf("/workflow/request/ViewRequestIframe.jsp") != -1
                || request.getRequestURI().indexOf("/workflow/request/RemarkFrame.jsp") != -1)) {

      out.write(_jsp_string9, 0, _jsp_string9.length);
      
} else {

      out.write(_jsp_string10, 0, _jsp_string10.length);
      
}

      out.write(_jsp_string11, 0, _jsp_string11.length);
      
//\u6a21\u677f\u6a21\u5f0f\u5bfc\u5165
if ((request.getRequestURI().indexOf("/workflow/") != -1 && request.getRequestURI().indexOf("mode") != -1)
        || request.getRequestURI().indexOf("/workflow/request/AddRequest") != -1) {
        
      out.write(_jsp_string12, 0, _jsp_string12.length);
      
}

      out.write(_jsp_string13, 0, _jsp_string13.length);
      out.print((user.getLanguage()));
      out.write(_jsp_string14, 0, _jsp_string14.length);
      out.print((request.getSession().getId()));
      out.write(_jsp_string15, 0, _jsp_string15.length);
      out.print((SystemEnv.getHtmlLabelName(21403,user.getLanguage())));
      out.write(_jsp_string16, 0, _jsp_string16.length);
      out.print((SystemEnv.getHtmlLabelName(21791,user.getLanguage())));
      out.write(_jsp_string17, 0, _jsp_string17.length);
      out.print((SystemEnv.getHtmlLabelNames("17480",user.getLanguage())));
      out.write(_jsp_string18, 0, _jsp_string18.length);
      out.print((SystemEnv.getHtmlLabelNames("25484,83",user.getLanguage())));
      out.write(_jsp_string19, 0, _jsp_string19.length);
      out.print((user.getUID()));
      out.write(_jsp_string20, 0, _jsp_string20.length);
      out.print((user.getUID()));
      out.write(_jsp_string21, 0, _jsp_string21.length);
      out.print((user.getType()));
      out.write(_jsp_string22, 0, _jsp_string22.length);
      out.print((SystemEnv.getHtmlLabelName(26263,user.getLanguage())));
      out.write(_jsp_string23, 0, _jsp_string23.length);
      out.print((URLEncoder.encode(user.getLoginid())));
      out.write(_jsp_string24, 0, _jsp_string24.length);
      out.print((SystemEnv.getHtmlLabelName(21403,user.getLanguage())));
      out.write(_jsp_string25, 0, _jsp_string25.length);
      out.print((SystemEnv.getHtmlLabelName(23670,user.getLanguage())));
      out.write(_jsp_string26, 0, _jsp_string26.length);
      out.print((SystemEnv.getHtmlLabelName(21791,user.getLanguage())));
      out.write(_jsp_string27, 0, _jsp_string27.length);
      if(new weaver.conn.RecordSet().getDBType().equals("oracle")){
      out.write(_jsp_string28, 0, _jsp_string28.length);
      out.print((SystemEnv.getHtmlLabelName(524,user.getLanguage())));
      out.print((SystemEnv.getHtmlLabelName(698,user.getLanguage())));
      out.write(_jsp_string29, 0, _jsp_string29.length);
      out.print((SystemEnv.getHtmlLabelName(20246,user.getLanguage())));
      out.write(_jsp_string29, 0, _jsp_string29.length);
      out.print((SystemEnv.getHtmlLabelName(124962,user.getLanguage())));
      out.write(_jsp_string30, 0, _jsp_string30.length);
      }
      out.write(_jsp_string31, 0, _jsp_string31.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string32, 0, _jsp_string32.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string33, 0, _jsp_string33.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string34, 0, _jsp_string34.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string35, 0, _jsp_string35.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string34, 0, _jsp_string34.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string36, 0, _jsp_string36.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string37, 0, _jsp_string37.length);
      out.print((SystemEnv.getHtmlLabelName(21423,user.getLanguage())));
      out.write(_jsp_string38, 0, _jsp_string38.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string39, 0, _jsp_string39.length);
      out.print((SystemEnv.getHtmlNoteName(14,user.getLanguage())));
      out.write(_jsp_string40, 0, _jsp_string40.length);
      out.print((SystemEnv.getHtmlLabelName(15097,user.getLanguage())));
      out.write(_jsp_string41, 0, _jsp_string41.length);
      out.print((SystemEnv.getHtmlLabelName(22161,user.getLanguage())));
      out.write(_jsp_string42, 0, _jsp_string42.length);
      out.print((companyNametools));
      out.write(_jsp_string43, 0, _jsp_string43.length);
      out.print((SystemEnv.getHtmlLabelName(23714,user.getLanguage())));
      out.write(_jsp_string44, 0, _jsp_string44.length);
      
  if(!fromlogin.equals("yes")&&needusb0==1&&"1".equals(usbtype0)){

      out.write(_jsp_string45, 0, _jsp_string45.length);
      out.print((firmcode0));
      out.write(_jsp_string46, 0, _jsp_string46.length);
      out.print((usercode0));
      out.write(_jsp_string47, 0, _jsp_string47.length);
      out.print((serial0));
      out.write(_jsp_string48, 0, _jsp_string48.length);
      out.print((user.getLanguage()));
      out.write(_jsp_string49, 0, _jsp_string49.length);
      }
      out.write(_jsp_string50, 0, _jsp_string50.length);
      weaver.workflow.workflow.TestWorkflowCheck TestWorkflowCheckInitWui;
      TestWorkflowCheckInitWui = (weaver.workflow.workflow.TestWorkflowCheck) pageContext.getAttribute("TestWorkflowCheckInitWui");
      if (TestWorkflowCheckInitWui == null) {
        TestWorkflowCheckInitWui = new weaver.workflow.workflow.TestWorkflowCheck();
        pageContext.setAttribute("TestWorkflowCheckInitWui", TestWorkflowCheckInitWui);
      }
      out.write(_jsp_string51, 0, _jsp_string51.length);
      out.println(TestWorkflowCheckInitWui.ReloadByDialogClose(request));
      out.write(_jsp_string52, 0, _jsp_string52.length);
      
    if(TestWorkflowCheckInitWui.checkURI(session,request.getRequestURI(),request.getQueryString())){
        response.sendRedirect("/login/Login.jsp");
        return;
    }

      out.write(_jsp_string53, 0, _jsp_string53.length);
      

String curTheme = "ecology7";
//\u5f53\u524d\u76ae\u80a4
String curskin = "";
String cutoverWay = "";
String transitionTime = "";
String transitionWay = "";

HrmUserSettingComInfo instance = new HrmUserSettingComInfo();

String huscifId = String.valueOf(instance.getId(String.valueOf(user.getUID())));

curTheme = getCurrWuiConfig(session, user, "theme");
curskin = getCurrWuiConfig(session, user, "skin");

cutoverWay = instance.getCutoverWay(huscifId);
transitionTime = instance.getTransitionTime(huscifId);
transitionWay = instance.getTransitionWays(huscifId);

      out.write(_jsp_string54, 0, _jsp_string54.length);
      
String ely6flg = "";
if ("ecology6".equals(curTheme.toLowerCase())) {
	curTheme = "ecology7";
	ely6flg = "ecology6";
}

      out.write(_jsp_string55, 0, _jsp_string55.length);
      out.print((curTheme ));
      out.write(_jsp_string56, 0, _jsp_string56.length);
      out.print((curskin ));
      out.write(_jsp_string57, 0, _jsp_string57.length);
      
curTheme = "ecology8";//\u540e\u53f0\u914d\u7f6e\u9875\u9762\u5747\u4e3aE8\u4e3b\u9898\uff0c\u5982\u4f7f\u7528\u5176\u4ed6\u4e3b\u9898\u65f6\uff0c\u4f1a\u5bfc\u81f4\u6837\u5f0f\u6df7\u4e71\u3002\u6240\u4ee5\u6b64\u5904\u4e3b\u9898\u5f3a\u5236\u8d4b\u503cecology8
if("ecology8".equals(curTheme)) curskin="default";
session.setAttribute("SESSION_TEMP_CURRENT_THEME", curTheme);
session.setAttribute("SESSION_TEMP_CURRENT_SKIN", curskin);

      out.write(_jsp_string58, 0, _jsp_string58.length);
      
if (transitionTime != null && !transitionTime.equals("") && !transitionTime.equals("0")) {

      out.write(_jsp_string59, 0, _jsp_string59.length);
      out.print((cutoverWay ));
      out.write(_jsp_string60, 0, _jsp_string60.length);
      out.print((transitionTime ));
      out.write(_jsp_string61, 0, _jsp_string61.length);
      out.print((transitionWay ));
      out.write(_jsp_string62, 0, _jsp_string62.length);
      
}

      out.write(_jsp_string63, 0, _jsp_string63.length);
      out.print((curTheme ));
      out.write(_jsp_string64, 0, _jsp_string64.length);
      out.print((curskin ));
      out.write(_jsp_string65, 0, _jsp_string65.length);
      if(!"1".equals(session.getAttribute("istest"))){//\u6d41\u7a0b\u6d4b\u8bd5
      out.write(_jsp_string54, 0, _jsp_string54.length);
      pageContext.include("/synergy/showSynergy.jsp", "requestid=" + com.caucho.el.Expr.toString(Util.getIntValue(request.getParameter("requestid"),-1), null), false);
      out.write(_jsp_string54, 0, _jsp_string54.length);
      }
      out.write(_jsp_string66, 0, _jsp_string66.length);
      weaver.hrm.companyvirtual.DepartmentVirtualComInfo DepartmentVirtualComInfo;
      DepartmentVirtualComInfo = (weaver.hrm.companyvirtual.DepartmentVirtualComInfo) pageContext.getAttribute("DepartmentVirtualComInfo");
      if (DepartmentVirtualComInfo == null) {
        DepartmentVirtualComInfo = new weaver.hrm.companyvirtual.DepartmentVirtualComInfo();
        pageContext.setAttribute("DepartmentVirtualComInfo", DepartmentVirtualComInfo);
      }
      out.write(_jsp_string67, 0, _jsp_string67.length);
      weaver.general.BaseBean BaseBean;
      BaseBean = (weaver.general.BaseBean) pageContext.getAttribute("BaseBean");
      if (BaseBean == null) {
        BaseBean = new weaver.general.BaseBean();
        pageContext.setAttribute("BaseBean", BaseBean);
      }
      out.write(_jsp_string67, 0, _jsp_string67.length);
      weaver.general.GCONST GCONST;
      GCONST = (weaver.general.GCONST) pageContext.getAttribute("GCONST");
      if (GCONST == null) {
        GCONST = new weaver.general.GCONST();
        pageContext.setAttribute("GCONST", GCONST);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet rs;
      rs = (weaver.conn.RecordSet) pageContext.getAttribute("rs");
      if (rs == null) {
        rs = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs", rs);
      }
      out.write(_jsp_string67, 0, _jsp_string67.length);
      weaver.conn.RecordSet rs2;
      rs2 = (weaver.conn.RecordSet) pageContext.getAttribute("rs2");
      if (rs2 == null) {
        rs2 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs2", rs2);
      }
      out.write(_jsp_string67, 0, _jsp_string67.length);
      weaver.conn.RecordSet rs3;
      rs3 = (weaver.conn.RecordSet) pageContext.getAttribute("rs3");
      if (rs3 == null) {
        rs3 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs3", rs3);
      }
      out.write(_jsp_string67, 0, _jsp_string67.length);
      weaver.conn.RecordSet rs4;
      rs4 = (weaver.conn.RecordSet) pageContext.getAttribute("rs4");
      if (rs4 == null) {
        rs4 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs4", rs4);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet rsdb2;
      rsdb2 = (weaver.conn.RecordSet) pageContext.getAttribute("rsdb2");
      if (rsdb2 == null) {
        rsdb2 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rsdb2", rsdb2);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet RecordSet;
      RecordSet = (weaver.conn.RecordSet) pageContext.getAttribute("RecordSet");
      if (RecordSet == null) {
        RecordSet = new weaver.conn.RecordSet();
        pageContext.setAttribute("RecordSet", RecordSet);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet RecordSetDB;
      RecordSetDB = (weaver.conn.RecordSet) pageContext.getAttribute("RecordSetDB");
      if (RecordSetDB == null) {
        RecordSetDB = new weaver.conn.RecordSet();
        pageContext.setAttribute("RecordSetDB", RecordSetDB);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.company.DepartmentComInfo DepartmentComInfo;
      DepartmentComInfo = (weaver.hrm.company.DepartmentComInfo) pageContext.getAttribute("DepartmentComInfo");
      if (DepartmentComInfo == null) {
        DepartmentComInfo = new weaver.hrm.company.DepartmentComInfo();
        pageContext.setAttribute("DepartmentComInfo", DepartmentComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.tools.HrmDateCheck HrmDateCheck;
      HrmDateCheck = (weaver.hrm.tools.HrmDateCheck) pageContext.getAttribute("HrmDateCheck");
      if (HrmDateCheck == null) {
        HrmDateCheck = new weaver.hrm.tools.HrmDateCheck();
        pageContext.setAttribute("HrmDateCheck", HrmDateCheck);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.resource.ResourceComInfo ResourceComInfo;
      ResourceComInfo = (weaver.hrm.resource.ResourceComInfo) pageContext.getAttribute("ResourceComInfo");
      if (ResourceComInfo == null) {
        ResourceComInfo = new weaver.hrm.resource.ResourceComInfo();
        pageContext.setAttribute("ResourceComInfo", ResourceComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.finance.SalaryManager SalaryManager;
      SalaryManager = (weaver.hrm.finance.SalaryManager) pageContext.getAttribute("SalaryManager");
      if (SalaryManager == null) {
        SalaryManager = new weaver.hrm.finance.SalaryManager();
        pageContext.setAttribute("SalaryManager", SalaryManager);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.systeminfo.SysMaintenanceLog SysMaintenanceLog;
      SysMaintenanceLog = (weaver.systeminfo.SysMaintenanceLog) pageContext.getAttribute("SysMaintenanceLog");
      if (SysMaintenanceLog == null) {
        SysMaintenanceLog = new weaver.systeminfo.SysMaintenanceLog();
        pageContext.setAttribute("SysMaintenanceLog", SysMaintenanceLog);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.system.SystemComInfo SystemComInfo;
      SystemComInfo = (weaver.system.SystemComInfo) pageContext.getAttribute("SystemComInfo");
      if (SystemComInfo == null) {
        SystemComInfo = new weaver.system.SystemComInfo();
        pageContext.setAttribute("SystemComInfo", SystemComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.rtx.OrganisationCom OrganisationCom;
      OrganisationCom = (weaver.rtx.OrganisationCom) pageContext.getAttribute("OrganisationCom");
      if (OrganisationCom == null) {
        OrganisationCom = new weaver.rtx.OrganisationCom();
        pageContext.setAttribute("OrganisationCom", OrganisationCom);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.resource.CustomFieldTreeManager CustomFieldTreeManager;
      CustomFieldTreeManager = (weaver.hrm.resource.CustomFieldTreeManager) pageContext.getAttribute("CustomFieldTreeManager");
      if (CustomFieldTreeManager == null) {
        CustomFieldTreeManager = new weaver.hrm.resource.CustomFieldTreeManager();
        pageContext.setAttribute("CustomFieldTreeManager", CustomFieldTreeManager);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.workflow.msg.PoppupRemindInfoUtil PoppupRemindInfoUtil;
      PoppupRemindInfoUtil = (weaver.workflow.msg.PoppupRemindInfoUtil) pageContext.getAttribute("PoppupRemindInfoUtil");
      if (PoppupRemindInfoUtil == null) {
        PoppupRemindInfoUtil = new weaver.workflow.msg.PoppupRemindInfoUtil();
        pageContext.setAttribute("PoppupRemindInfoUtil", PoppupRemindInfoUtil);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.systeminfo.systemright.CheckSubCompanyRight CheckSubCompanyRight;
      CheckSubCompanyRight = (weaver.systeminfo.systemright.CheckSubCompanyRight) pageContext.getAttribute("CheckSubCompanyRight");
      if (CheckSubCompanyRight == null) {
        CheckSubCompanyRight = new weaver.systeminfo.systemright.CheckSubCompanyRight();
        pageContext.setAttribute("CheckSubCompanyRight", CheckSubCompanyRight);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      ln.LN LN;
      LN = (ln.LN) pageContext.getAttribute("LN");
      if (LN == null) {
        LN = new ln.LN();
        pageContext.setAttribute("LN", LN);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.crm.CrmShareBase CrmShareBase;
      CrmShareBase = (weaver.crm.CrmShareBase) pageContext.getAttribute("CrmShareBase");
      if (CrmShareBase == null) {
        CrmShareBase = new weaver.crm.CrmShareBase();
        pageContext.setAttribute("CrmShareBase", CrmShareBase);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.WorkPlan.WorkPlanShareBase WorkPlanShareBase;
      WorkPlanShareBase = (weaver.WorkPlan.WorkPlanShareBase) pageContext.getAttribute("WorkPlanShareBase");
      if (WorkPlanShareBase == null) {
        WorkPlanShareBase = new weaver.WorkPlan.WorkPlanShareBase();
        pageContext.setAttribute("WorkPlanShareBase", WorkPlanShareBase);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.login.VerifyPasswdCheck VerifyPasswdCheck;
      VerifyPasswdCheck = (weaver.login.VerifyPasswdCheck) pageContext.getAttribute("VerifyPasswdCheck");
      if (VerifyPasswdCheck == null) {
        VerifyPasswdCheck = new weaver.login.VerifyPasswdCheck();
        pageContext.setAttribute("VerifyPasswdCheck", VerifyPasswdCheck);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.license.PluginUserCheck PluginUserCheck;
      PluginUserCheck = (weaver.license.PluginUserCheck) pageContext.getAttribute("PluginUserCheck");
      if (PluginUserCheck == null) {
        PluginUserCheck = new weaver.license.PluginUserCheck();
        pageContext.setAttribute("PluginUserCheck", PluginUserCheck);
      }
      out.write(_jsp_string68, 0, _jsp_string68.length);
      weaver.interfaces.hrm.HrmServiceManager HrmServiceManager;
      HrmServiceManager = (weaver.interfaces.hrm.HrmServiceManager) pageContext.getAttribute("HrmServiceManager");
      if (HrmServiceManager == null) {
        HrmServiceManager = new weaver.interfaces.hrm.HrmServiceManager();
        pageContext.setAttribute("HrmServiceManager", HrmServiceManager);
      }
      out.write(_jsp_string67, 0, _jsp_string67.length);
      weaver.hrm.moduledetach.ManageDetachComInfo ManageDetachComInfo;
      ManageDetachComInfo = (weaver.hrm.moduledetach.ManageDetachComInfo) pageContext.getAttribute("ManageDetachComInfo");
      if (ManageDetachComInfo == null) {
        ManageDetachComInfo = new weaver.hrm.moduledetach.ManageDetachComInfo();
        pageContext.setAttribute("ManageDetachComInfo", ManageDetachComInfo);
      }
      out.write(_jsp_string67, 0, _jsp_string67.length);
      weaver.rsa.security.RSA RSA;
      RSA = (weaver.rsa.security.RSA) pageContext.getAttribute("RSA");
      if (RSA == null) {
        RSA = new weaver.rsa.security.RSA();
        pageContext.setAttribute("RSA", RSA);
      }
      out.write(_jsp_string69, 0, _jsp_string69.length);
      
  	//\u56fa\u5b9a\u9875\u9762\u5934\u90e8\u589e\u52a0\u4ee5\u4e0b\u4ee3\u7801
  	boolean formdefined = false;
    weaver.system.CusFormSettingComInfo CusFormSettingComInfo = new weaver.system.CusFormSettingComInfo();
    weaver.system.CusFormSetting CusFormSetting= CusFormSettingComInfo.getCusFormSetting("hrm","HrmResourceBase");
    if(CusFormSetting!=null){
    	if(CusFormSetting.getStatus()==2){
    		//\u81ea\u5b9a\u4e49\u5e03\u5c40\u9875\u9762
    		formdefined = true;
    	}
    }
    
      String mode=Prop.getPropValue(GCONST.getConfigFile() , "authentic");
	  String bbsLingUrl=BaseBean.getPropValue(GCONST.getConfigFile() , "ecologybbs.linkUrl");
      FileUpload fu = new FileUpload(request);
      String f_weaver_belongto_userid = Util.null2String(fu.getParameter("f_weaver_belongto_userid"));
      user = HrmUserVarify.getUser(request,response,f_weaver_belongto_userid,null);
      char separator = Util.getSeparator() ;

      int userid = user.getUID();
      Calendar todaycal = Calendar.getInstance ();
      String today = Util.add0(todaycal.get(Calendar.YEAR), 4) +"-"+
                     Util.add0(todaycal.get(Calendar.MONTH) + 1, 2) +"-"+
                     Util.add0(todaycal.get(Calendar.DAY_OF_MONTH) , 2) ;
      String userpara = ""+userid+separator+today;

      String operation = Util.null2String(fu.getParameter("operation"));
	  String isEdit = Util.null2String(fu.getParameter("isEdit"));
      String view=Util.null2String(fu.getParameter("view"));
      boolean isfromtab =  Util.null2String(fu.getParameter("isfromtab")).equals("true")?true:false;
      String para="";

      int isView = Util.getIntValue(fu.getParameter("isView"));
      String adtype = Util.null2String(request.getParameter("adtype"));

//update by fanggsh TD4233 begin
      HrmResourceManagerDAO dao = new HrmResourceManagerDAO();
      String hrmResourceManagerId = Util.null2String(fu.getParameter("id")) ;
      HrmResourceManagerVO vo = dao.getHrmResourceManagerByID(hrmResourceManagerId);	  
//update by fanggsh TD4233 end

// update time
if(!"addresourcebasicinfo".equals(operation)){
	String id = Util.null2String(fu.getParameter("id")) ;
	RecordSet.execute("update HrmResource set "+DbFunctionUtil.getUpdateSetSql(RecordSet.getDBType(),user.getUID())+" where id="+id) ;
	RecordSet.execute("update HrmResourceManager set "+DbFunctionUtil.getUpdateSetSql(RecordSet.getDBType(),user.getUID())+" where id="+id) ;
}


if(operation.equalsIgnoreCase("maindactylogram")){
	String id = Util.null2String(fu.getParameter("id")) ;
  if(!id.equals(String.valueOf(userid))){
  	response.sendRedirect("HrmResourcePassword.jsp?id="+id);
    return ;
	}
	String maindactylogram = Util.null2String(fu.getParameter("maindactylogram")) ;
	rs.executeSql("update HrmResource set dactylogram='"+maindactylogram+"' where id="+id);
	rs.executeSql("update HrmResourceManager set dactylogram='"+maindactylogram+"' where id="+id);
	String topage = Util.null2String(fu.getParameter("topage")) ;
	if(topage.equals(""))
		response.sendRedirect("HrmResourcePassword.jsp?id="+id);
	else
		response.sendRedirect(topage+"?id="+id);
	return;
}
if(operation.equalsIgnoreCase("assistantdactylogram")){
	String id = Util.null2String(fu.getParameter("id")) ;
  if(!id.equals(String.valueOf(userid))){
  	response.sendRedirect("HrmResourcePassword.jsp?id="+id);
    return ;
	}
	String assistantdactylogram = Util.null2String(fu.getParameter("assistantdactylogram")) ;
	rs.executeSql("update HrmResource set assistantdactylogram='"+assistantdactylogram+"' where id="+id);
	rs.executeSql("update HrmResourceManager set assistantdactylogram='"+assistantdactylogram+"' where id="+id);
	String topage = Util.null2String(fu.getParameter("topage")) ;
	if(topage.equals(""))
		response.sendRedirect("HrmResourcePassword.jsp?id="+id);
	else
		response.sendRedirect(topage+"?id="+id);
	return;
}

if(operation.equalsIgnoreCase("changepassword")&&adtype.equals("1")) {
			String frompage = Util.null2String(fu.getParameter("frompage"));
			String RedirectFile = Util.null2String(request.getParameter("RedirectFile"));
			//String passwordnew2= Util.fromScreen3(request.getParameter("passwordnew"),user.getLanguage());
			//String passwordold1= Util.fromScreen3(request.getParameter("passwordold"),user.getLanguage());
			String passwordnew2= Util.null2String(request.getParameter("passwordnew"));
			String passwordold1= Util.null2String(request.getParameter("passwordold"));
			String id = Util.null2String(fu.getParameter("id")) ;
      if(!id.equals(String.valueOf(userid))){
      	response.sendRedirect("HrmResourcePassword.jsp?message=4&id="+id+"&frompage="+frompage+"&mode=1");
        return ;
    	}
			String adaccount = Util.null2String(request.getParameter("loginid"));
			String errorType = "";
			if(!id.equals("")){
				if(!"".equals(adaccount)){
					LdapUtil ldap=LdapUtil.getInstance();
					//System.out.println("account2:"+adaccount+"lastname:"+""+"passwordnew2:"+passwordnew2);
					java.util.HashMap map=ldap.updateUserInfo(adaccount,passwordold1,"",passwordnew2,"","0");
					String isSuccess = (String)map.get("isSuccess");
					String errorMsg = (String)map.get("errorMsg");
					errorType = (String)map.get("errorType");
					
					if(isSuccess.equals("false")){
						if("2".equals(errorType)) {
							response.sendRedirect("HrmResourcePassword.jsp?message=5&id="+id+"&frompage="+frompage+"&mode=1");
						} else if("3".equals(errorType)) {//\u65e0\u6cd5\u8fde\u63a5
							response.sendRedirect("HrmResourcePassword.jsp?message=6&id="+id+"&frompage="+frompage+"&mode=1");
						}else if("4".equals(errorType)) {//\u8bc1\u4e66\u4e0d\u53ef\u4f7f\u7528
							response.sendRedirect("HrmResourcePassword.jsp?message=7&id="+id+"&frompage="+frompage+"&mode=1");
						}else if("5".equals(errorType)) {//\u8bc1\u4e66\u8def\u5f84\u9519\u8bef
							response.sendRedirect("HrmResourcePassword.jsp?message=8&id="+id+"&frompage="+frompage+"&mode=1");
						}else if("6".equals(errorType)) {//\u8bc1\u4e66\u5bc6\u7801\u9519\u8bef
							response.sendRedirect("HrmResourcePassword.jsp?message=9&id="+id+"&frompage="+frompage+"&mode=1");
						}else if("7".equals(errorType)) {//\u8bc1\u4e66\u8fc7\u671f
							response.sendRedirect("HrmResourcePassword.jsp?message=10&id="+id+"&frompage="+frompage+"&mode=1");
						}else {
							response.sendRedirect("HrmResourcePassword.jsp?message=4&id="+id+"&frompage="+frompage+"&mode=1");
						}
						
						return;
					} else {
						String procedurepara = id+separator+passwordold1+separator+passwordnew2 ;
						
						SysMaintenanceLog.resetParameter();
				    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
				    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
				            SysMaintenanceLog.setOperateItem("29");
				            SysMaintenanceLog.setOperateUserid(user.getUID());
				            SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
				    	SysMaintenanceLog.setOperateType("2");
				    	SysMaintenanceLog.setOperateDesc("HrmResource_UpdatePassword,"+procedurepara);
				    	SysMaintenanceLog.setSysLogInfo();
						
						SysMaintenanceLog.resetParameter();
				    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
				    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
				        SysMaintenanceLog.setOperateItem("421");
				        SysMaintenanceLog.setOperateUserid(user.getUID());
				        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
				    	SysMaintenanceLog.setOperateType("2");
				    	SysMaintenanceLog.setOperateDesc("HrmResource_UpdatePassword,"+procedurepara);
				    	SysMaintenanceLog.setSysLogInfo();

						//\u66f4\u65b0\u4fee\u6539\u5bc6\u7801\u65f6\u95f4
				    	if(rs.getDBType().equalsIgnoreCase("oracle")){
							rs.executeSql("update HrmResource set passwdchgdate = to_char(sysdate, 'yyyy-mm-dd') where id = "+id);
				    	}else{
				    		rs.executeSql("update HrmResource set passwdchgdate = convert(char(10),getdate(),20) where id = "+id);
				    	}
						
				    	if(frompage.length()<=0){
							//response.sendRedirect("HrmResource.jsp?id="+id);
							session.setAttribute("password",passwordnew2);
				    		response.sendRedirect("HrmResourcePassword.jsp?isfromtab="+isfromtab+"&RedirectFile="+RedirectFile+"&message=1&id="+id);
			    		}else{
			    			request.getSession().setAttribute("changepwd","y");
			    			String gotourl = "";
			    			if(RedirectFile.indexOf("templateId")>0){
			    				gotourl = RedirectFile+"&gopage=/hrm/resource/HrmResourcePassword.jsp?isfromtab=false&frompage="+frompage;
			    			}else{
			    				gotourl = RedirectFile+"?gopage=/hrm/resource/HrmResourcePassword.jsp?isfromtab=false&frompage="+frompage;
			    			}
							rs.executeSql("update HrmSysMaintenanceLog set operatedesc='y' where relatedid = "+userid+" and  id = (select MAX(id) from HrmSysMaintenanceLog where relatedid = "+userid+" and operatetype = 6 and operateitem = 60)");
			    			
      out.write(_jsp_string70, 0, _jsp_string70.length);
      out.print((gotourl));
      out.write(_jsp_string71, 0, _jsp_string71.length);
      
							return ;
			    		}
				    	
						response.sendRedirect("HrmResourcePassword.jsp?message=1&id="+id+"&frompage="+frompage+"&mode=1");
						return;
					}
				}else{
					errorType = "3";
					response.sendRedirect("HrmResourcePassword.jsp?message=4&id="+id+"&frompage="+frompage+"&mode=1");
					return;
				}
			}
			return;
}

      if(operation.equalsIgnoreCase("changepassword")) {
      
    	 String id = Util.null2String(fu.getParameter("id")) ;
    	 String frompage = Util.null2String(fu.getParameter("frompage"));
    	 if(!id.equals(String.valueOf(userid))){
    	      response.sendRedirect("HrmResourcePassword.jsp?message=4&id="+id+"&frompage="+frompage+"&mode=1");
    	       return ;
    	 }
    	  
        String logintype = user.getLogintype();     //\u5f53\u524d\u7528\u6237\u7c7b\u578b  1: \u7c7b\u522b\u7528\u6237  2:\u5916\u90e8\u7528\u6237
		String RedirectFile = Util.null2String(request.getParameter("RedirectFile"));
        if("2".equals(logintype)||!id.equals(String.valueOf(userid))){
            response.sendRedirect("HrmResource.jsp?id="+id+"&RedirectFile="+RedirectFile);
            return ;
        }

        int usertype = 0;
        if(logintype.equals("1")) usertype = 0;
        if(logintype.equals("2")) usertype = 1;
        PoppupRemindInfoUtil.updatePoppupRemindInfo(userid,6,(logintype).equals("1") ? "0" : "1",-1);
    //	String id = ""+user.getUID() ;
    	String oripasswordold = Util.null2String(fu.getParameter("passwordold"));
    	String oripasswordnew = Util.null2String(fu.getParameter("passwordnew"));
    	String passwordnew1= Util.null2String(request.getParameter("passwordnew"));

        String isrsaopen = Util.null2String(rs.getPropValue("openRSA","isrsaopen"));//\u662f\u5426\u5f00\u542fRSA
        if("1".equals(isrsaopen)){
        	List<String> rsaList = new ArrayList<String>();
        	rsaList.add(oripasswordnew);
        	rsaList.add(oripasswordnew);
        	rsaList.add(oripasswordold);
        	List<String> desList = RSA.decryptList(request,rsaList);
        	System.out.println("desList>"+desList);
        	if(desList.size() > 0){
	        	oripasswordold = desList.get(2);
	        	oripasswordnew = desList.get(0);
	        	passwordnew1 = oripasswordnew;
        	}
        	if(!RSA.getMessage().equals("0")){
              	response.sendRedirect("HrmResourcePassword.jsp?message=184&id="+id+"&frompage="+frompage+"&mode=1");
                return ;
        	}
        }
    	String passwordold= Util.getEncrypt(oripasswordold);
    	String passwordnew= Util.getEncrypt(oripasswordnew);
    	
    	
    	/*String oldpassword1 = "";
    	String oldpassword2 = "";
    	String oldpassword3 = "";
    	rs.executeSql("select password ,oldpassword1,oldpassword2 from hrmresource where id = "+id);
    	if(rs.next()){
    		oldpassword1 = rs.getString(1);
    		oldpassword2 = rs.getString(2);
    		oldpassword3 = rs.getString(3);
    	}
    	if(passwordnew.equals(oldpassword1)||passwordnew.equals(oldpassword2)||passwordnew.equals(oldpassword3)){
    		response.sendRedirect("HrmResourcePassword.jsp?message=3&id="+id+"&frompage="+frompage+"&RedirectFile="+RedirectFile);
    		return;
    	}*/
    	
    	String procedurepara = id+separator+passwordold+separator+passwordnew ;
    	rs.executeProc("HrmResource_UpdatePassword",procedurepara);

    	if (rs.next()){
			user.setPwd(passwordnew);
			session.setAttribute("weaver_user@bean", user);
    		//rs4.executeSql("update hrmresource set oldpassword1 = '"+oldpassword1+"',oldpassword2='"+oldpassword2+"' where id = "+id);
		
			//BBS\u96c6\u6210\u76f8\u5173
			if (!bbsLingUrl.equals("")) {
				/*\u53d6\u6d88\u539fBBS\u540c\u6b65\u65b9\u5f0f\uff0c\u6539\u7528\u7ebf\u7a0b\u7c7b
				try{
					Class s=Class.forName("weaver.bbs.UserOAToBBS");
					if (s!=null) {
						Class partypes[] = new Class[2];
						partypes[0]=String.class;
						partypes[1] = String.class;
						Method  meh=s.getMethod("changBBSUser",partypes);
				
				 
						Object arglist[] = new Object[2];
						arglist[0] = new String(user.getLoginid());
						arglist[1] = new String(passwordnew);   
						meh.invoke(s.newInstance(), arglist);
					}
				}catch (Exception ee){}
				*/
				new Thread(new weaver.bbs.BBSRunnable(user.getLoginid()+"",passwordnew)).start();
			}
		}

        RTXConfig rtxConfig = new RTXConfig();
	    String RtxOrElinkType = (Util.null2String(rtxConfig.getPorp(RTXConfig.RtxOrElinkType))).toUpperCase();
	    if("ELINK".equals(RtxOrElinkType)){   //\u4fee\u6539\u5bc6\u7801\u540c\u6b65\u5230ELINK\u4e2d

			OrganisationCom.editUser(Integer.parseInt(id));
		}

    	SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
            SysMaintenanceLog.setOperateItem("29");
            SysMaintenanceLog.setOperateUserid(user.getUID());
            SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("2");
    	SysMaintenanceLog.setOperateDesc("HrmResource_UpdatePassword,"+procedurepara);
    	SysMaintenanceLog.setSysLogInfo();
		
		SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
        SysMaintenanceLog.setOperateItem("421");
        SysMaintenanceLog.setOperateUserid(user.getUID());
        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("2");
    	SysMaintenanceLog.setOperateDesc("HrmResource_UpdatePassword,"+procedurepara);
    	SysMaintenanceLog.setSysLogInfo();

   	 	// \u6539\u4e3a\u81ea\u8fdb\u884c\u4fee\u6b63

		ResourceComInfo.updateResourceInfoCache(id);
    	
        //OA\u4e0e\u7b2c\u4e09\u65b9\u63a5\u53e3\u5355\u6761\u6570\u636e\u540c\u6b65\u65b9\u6cd5\u5f00\u59cb

		HrmServiceManager.SynInstantHrmResource(id,"2");  
		//OA\u4e0e\u7b2c\u4e09\u65b9\u63a5\u53e3\u5355\u6761\u6570\u636e\u540c\u6b65\u65b9\u6cd5\u7ed3\u675f
        
    	if(rs.getString(1).equals("2")){                   
		    response.sendRedirect("HrmResourcePassword.jsp?message=2&id="+id+"&frompage="+frompage+"&isfromtab="+isfromtab+"&RedirectFile="+RedirectFile);
		}
        else if( id.equals("1") ){
        	session.setAttribute("password",passwordnew1);
			response.sendRedirect("HrmResourcePassword.jsp?message=1&id="+id+"&RedirectFile="+RedirectFile);
		}
//update by fanggsh TD4233 begin
        else if(vo.getId()!=null&&!(vo.getId()).equals("")&&vo.getId().equals(String.valueOf(id))){
        	session.setAttribute("password",passwordnew1);
			response.sendRedirect("HrmResourcePassword.jsp?message=1&id="+id+"&RedirectFile="+RedirectFile);
		}     
//update by fanggsh TD4233 end
    	else{
    		if(frompage.length()<=0){
			//response.sendRedirect("HrmResource.jsp?id="+id);
			session.setAttribute("password",passwordnew1);
    		response.sendRedirect("HrmResourcePassword.jsp?isfromtab="+isfromtab+"&RedirectFile="+RedirectFile+"&message=1&id="+id);
    		}else{
    			request.getSession().setAttribute("changepwd","y");
    			String gotourl = "";
    			if(RedirectFile.indexOf("templateId")>0){
    				gotourl = RedirectFile+"&gopage=/hrm/resource/HrmResourcePassword.jsp?isfromtab=false&frompage="+frompage;
    			}else{
    				gotourl = RedirectFile+"?gopage=/hrm/resource/HrmResourcePassword.jsp?isfromtab=false&frompage="+frompage;
    			}
				rs.executeSql("update HrmSysMaintenanceLog set operatedesc='y' where relatedid = "+userid+" and  id = (select MAX(id) from HrmSysMaintenanceLog where relatedid = "+userid+" and operatetype = 6 and operateitem = 60)");
    			
      out.write(_jsp_string72, 0, _jsp_string72.length);
      out.print((gotourl));
      out.write(_jsp_string73, 0, _jsp_string73.length);
      
    		}
		}
    	return ;
      }

      if(operation.equalsIgnoreCase("delpic")) {
    	String id = Util.null2String(fu.getParameter("id")) ;
    	if(!HrmUserVarify.checkUserRight("HrmResourceEdit:Edit",user)&&!id.equals(String.valueOf(userid))) {
    		response.sendRedirect("/notice/noright.jsp") ;
    		return ;
    	}
    	String oldresourceimageid= Util.null2String(fu.getParameter("oldresourceimage"));
    	String firstname = Util.fromScreen3(fu.getParameter("firstname"),user.getLanguage());
    	String lastname = Util.fromScreen3(fu.getParameter("lastname"),user.getLanguage());
    	rs.executeProc("HrmResource_UpdatePic",id+separator+oldresourceimageid);

    	SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(firstname+" "+lastname);
            SysMaintenanceLog.setOperateItem("29");
            SysMaintenanceLog.setOperateUserid(user.getUID());
            SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("2");
    	SysMaintenanceLog.setOperateDesc("HrmResource_UpdatePic,"+id+separator+oldresourceimageid);
    	SysMaintenanceLog.setSysLogInfo();

    	if(view.equals("contactinfo")){
			response.sendRedirect("HrmResourceContactEdit.jsp?id="+id+"&isView="+isView+"&isfromtab="+isfromtab);
		}else{
    		response.sendRedirect("HrmResourceBasicEdit.jsp?id="+id+"&isView="+isView+"&isfromtab="+isfromtab); 
		}
    	return ;
      }

	//\u65b0\u589e\u57fa\u672c\u4fe1\u606fxiao
    if(operation.equalsIgnoreCase("addresourcebasicinfo")){
    	if(!HrmUserVarify.checkUserRight("HrmResourceEdit:Edit",user)) {
    		response.sendRedirect("/notice/noright.jsp") ;
    		return ;
    	}
    	String cmd = Util.null2String(fu.getParameter("cmd"));
    	String urlFrom = Util.null2String(fu.getParameter("urlFrom"));
      String id = Util.null2String(fu.getParameter("id"));
      String workcode = Util.fromScreen3(fu.getParameter("workcode"),user.getLanguage());
      String lastname = Util.fromScreen3(fu.getParameter("lastname"),user.getLanguage()).trim();
      String sex = Util.fromScreen3(fu.getParameter("sex"),user.getLanguage());
      String resourceimageid= Util.null2String(fu.uploadFiles("photoid"));
      String departmentid = Util.fromScreen3(fu.getParameter("departmentid"),user.getLanguage());
      String costcenterid = Util.fromScreen3(fu.getParameter("costcenterid"),user.getLanguage());
      String jobtitle = Util.fromScreen3(fu.getParameter("jobtitle"),user.getLanguage());
      String joblevel = Util.fromScreen3(fu.getParameter("joblevel"),user.getLanguage());
      String jobactivitydesc = Util.fromScreen3(fu.getParameter("jobactivitydesc"),user.getLanguage());
      String managerid = Util.fromScreen3(fu.getParameter("managerid"),user.getLanguage());
      String assistantid = Util.fromScreen3(fu.getParameter("assistantid"),user.getLanguage());
      String status = Util.fromScreen3(fu.getParameter("status"),user.getLanguage());
      String locationid = Util.fromScreen3(fu.getParameter("locationid"),user.getLanguage());
      String workroom = Util.fromScreen3(fu.getParameter("workroom"),user.getLanguage());
      String telephone = Util.fromScreen3(fu.getParameter("telephone"),user.getLanguage());
      String mobile = Util.fromScreen3(fu.getParameter("mobile"),user.getLanguage());
      String mobileshowtype = Util.fromScreen3(fu.getParameter("mobileshowtype"),user.getLanguage());
      String mobilecall = Util.fromScreen3(fu.getParameter("mobilecall"),user.getLanguage());
      String fax = Util.fromScreen3(fu.getParameter("fax"),user.getLanguage());
      String jobcall = Util.fromScreen3(fu.getParameter("jobcall"),user.getLanguage());
      String email = Util.fromScreen3(fu.getParameter("email"),user.getLanguage());
      String dsporder = Util.fromScreen3(fu.getParameter("dsporder"),user.getLanguage());
	  String accounttype = Util.fromScreen3(fu.getParameter("accounttype"),user.getLanguage());
	  String systemlanguage = Util.null2String(fu.getParameter("systemlanguage"));
      if(systemlanguage.equals("")||systemlanguage.equals("0")) systemlanguage = "7";
      String belongto = Util.fromScreen3(fu.getParameter("belongto"),user.getLanguage());
      
      if(dsporder.length()==0)dsporder=id;
      if(accounttype.equals("0")){
	      belongto="-1";
      }
      String departmentvirtualids = Util.null2String(fu.getParameter("departmentvirtualids"));//\u865a\u62df\u90e8\u95e8id;
      
      //Td9325,\u89e3\u51b3\u591a\u8d26\u53f7\u6b21\u8d26\u53f7\u6ca1\u6709\u767b\u9646Id\u5728\u6d4f\u89c8\u6846\u7ec4\u7ec7\u7ed3\u6784\u4e2d\u65e0\u6cd5\u663e\u793a\u7684\u95ee\u9898\u3002

      boolean falg = false;
	  String loginid = "";
		if(accounttype.equals("1")){
			rs.executeSql("select loginid from HrmResource where id ="+belongto);
			if(rs.next()){
				loginid = rs.getString("loginid");
			}
			if(LN.CkHrmnum() >= 0){
	    		response.sendRedirect("HrmResourceAdd.jsp?ifinfo=y&isfromtab=true");
	    		return;
			}
			if(!loginid.equals("")){
				String maxidsql = "select max(id) as id from HrmResource where loginid like '"+loginid+"%'";
				rs.executeSql(maxidsql);
				if(rs.next()){
					loginid = loginid+(rs.getInt("id")+1);
					falg = true;
				}
			}
		}
      rs.executeProc("HrmResourceMaxId_Get","");
      rs.next();
      id = ""+rs.getInt(1);

      String sql = "select managerstr, seclevel from HrmResource where id = "+Util.getIntValue(managerid);
      rs.executeSql(sql);
      String managerstr = "";
	  String seclevel = "";
      while(rs.next()){
      	String tmp_managerstr = rs.getString("managerstr");
        /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 begin***********/
        if(!tmp_managerstr.startsWith(","))tmp_managerstr=","+tmp_managerstr;
        if(!tmp_managerstr.endsWith(","))tmp_managerstr=tmp_managerstr+",";
        /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 end ***********/
          managerstr += tmp_managerstr;
          managerstr =","+managerid+managerstr;
          managerstr=managerstr.endsWith(",")?managerstr:(managerstr+",");
		  seclevel = rs.getString("seclevel");
      }
      
      String subcmpanyid1 = DepartmentComInfo.getSubcompanyid1(departmentid);
		RecordSetTrans rst=new RecordSetTrans();
		rst.setAutoCommit(false);
		try{

			para = ""+id+separator+workcode+separator+lastname+separator+sex+separator+resourceimageid+separator+
             departmentid+separator+ costcenterid+separator+jobtitle+separator+joblevel+separator+jobactivitydesc+separator+
             managerid+separator+assistantid+separator+status+separator+locationid+separator+workroom+separator+telephone+
             separator+mobile+separator+mobilecall+separator+fax+separator+jobcall+separator+subcmpanyid1+separator+managerstr+
             separator+accounttype+separator+belongto+separator+systemlanguage+separator+email+separator+dsporder+separator+mobileshowtype;

			rst.executeProc("HrmResourceBasicInfo_Insert",para);
			rst.executeSql("update hrmresource set countryid=(select countryid from HrmLocations where id="+locationid+"),"
					                      +DbFunctionUtil.getInsertUpdateSetSql(rst.getDBType(),user.getUID())+" where id="+id);
			if(falg){
				String logidsql = "update HrmResource set loginid = '"+loginid+"' where id = "+id;
				rst.executeSql(logidsql);
			}
			if(seclevel == null || "".equals(seclevel)){
				seclevel = "0";
			}
			//String p_para = id + separator + departmentid + separator + subcmpanyid1 + separator + managerid + separator + seclevel + separator + managerstr + separator + "0" + separator + "0" + separator + "0" + separator + "0" + separator + "0" + separator + "0";

			//System.out.println(p_para);
			//rst.executeProc("HrmResourceShare", p_para);
			rst.commit();
		}catch(Exception e){
			rst.rollback();
			e.printStackTrace();
		}

      para = ""+id;
      for(int i = 0;i<5;i++){
      	int idx = i;
      	if(formdefined) idx++;
        String datefield = Util.null2String(fu.getParameter("datefield"+idx));
        String numberfield = ""+Util.getDoubleValue(fu.getParameter("numberfield"+idx),0);
        String textfield = Util.null2String(fu.getParameter("textfield"+idx));
        String tinyintfield = ""+Util.getIntValue(fu.getParameter("tinyintfield"+idx),0);
        para += separator+datefield + separator+numberfield+separator+textfield+separator+tinyintfield;
      }
      //rs.executeProc("HrmResourceDefine_Update",para);

      rs.executeProc("HrmResource_CreateInfo",""+id+separator+userpara+separator+userpara);
      
      //
      HrmUserSettingManager.checkUserSettingInit(Integer.parseInt(id)) ;

      // \u6539\u4e3a\u53ea\u8fdb\u884c\u8be5\u4eba\u7f13\u5b58\u4fe1\u606f\u7684\u6dfb\u52a0
      ResourceComInfo.addResourceInfoCache(id);
	  
	  try{ 
	        if(Integer.parseInt(belongto) > 0){
	        	new ResourceBelongtoComInfo().updateCache(belongto);
	        }
       }catch(Exception e){
			rs.writeLog(e.getMessage());
	   }

      SalaryManager.initResourceSalary(id);
    /*
      String sql = "select managerstr from HrmResource where id = "+Util.getIntValue(managerid);

      rs.executeSql(sql);
      String managerstr = "";
      while(rs.next()){
          managerstr += rs.getString("managerstr");
          managerstr +=   managerid + "," ;
      }
      para = ""+id+separator+ managerstr;

      rs.executeProc("HrmResource_UpdateManagerStr",para);

      //String subcmpanyid1 = DepartmentComInfo.getSubcompanyid1(departmentid);
      para = ""+id+separator+subcmpanyid1;
      rs.executeProc("HrmResource_UpdateSubCom",para);
    */


      para = ""+id+separator+managerid+separator+departmentid+separator+subcmpanyid1+separator+"0"+separator+managerstr;
      rs.executeProc("HrmResource_Trigger_Insert",para);

      String sql_1=("insert into HrmInfoStatus (itemid,hrmid) values(1,"+id+")");
      rs.executeSql(sql_1);
      String sql_2=("insert into HrmInfoStatus (itemid,hrmid) values(2,"+id+")");
      rs.executeSql(sql_2);
      String sql_3=("insert into HrmInfoStatus (itemid,hrmid) values(3,"+id+")");
      rs.executeSql(sql_3);
    /*
    String sql_4=("insert into HrmInfoStatus (itemid,hrmid) values(4,"+id+")");
    rs.executeSql(sql_4);
    String sql_5=("insert into HrmInfoStatus (itemid,hrmid) values(5,"+id+")");
    rs.executeSql(sql_5);
    String sql_6=("insert into HrmInfoStatus (itemid,hrmid) values(6,"+id+")");
    rs.executeSql(sql_6);
    String sql_7=("insert into HrmInfoStatus (itemid,hrmid) values(7,"+id+")");
    rs.executeSql(sql_7);
    String sql_8=("insert into HrmInfoStatus (itemid,hrmid) values(8,"+id+")");
    rs.executeSql(sql_8);
    String sql_9=("insert into HrmInfoStatus (itemid,hrmid) values(9,"+id+")");
    rs.executeSql(sql_9);
    */
      String sql_10=("insert into HrmInfoStatus (itemid,hrmid) values(10,"+id+")");
      rs.executeSql(sql_10);

     String name = lastname;

    String CurrentUser = ""+user.getUID();
    String CurrentUserName = ""+user.getUsername();

    String SWFAccepter="";
    String SWFTitle="";
    String SWFRemark="";
    String SWFSubmiter="";
    String Subject="";
    Subject= SystemEnv.getHtmlLabelName(15670,user.getLanguage()) ;
    Subject+=":"+name;

    //modifier by lvyi 2013-12-31
    ChgPasswdReminder reminder=new ChgPasswdReminder();
		RemindSettings settings=reminder.getRemindSettings();
		if(settings.getEntervalid().equals("1")){//\u5165\u804c\u63d0\u9192
	    String thesql="select distinct hrmid from HrmInfoMaintenance where id<4 or id = 10";
	    rs.executeSql(thesql);
	    String members="";
	    while(rs.next()){
			int hrmid_tmp = Util.getIntValue(rs.getString("hrmid"));//TD9392
			if(hrmid_tmp > 0 && user.getUID() != hrmid_tmp){
				members += ","+rs.getString("hrmid");
			}
	    }
	    if(!members.equals("")){
	        members = members.substring(1);
	
	        SWFAccepter=members;
	        SWFTitle= SystemEnv.getHtmlLabelName(15670,user.getLanguage()) ;
	        SWFTitle += ":"+name;
	        SWFTitle += "-"+CurrentUserName;
	        SWFTitle += "-"+today ;
	        SWFRemark="<a href=/hrm/employee/EmployeeManage.jsp?hrmid="+id+">"+Util.fromScreen2(Subject,user.getLanguage())+"</a>";
	        SWFSubmiter=CurrentUser;
	
	        SysRemindWorkflow.setPrjSysRemind(SWFTitle,0,Util.getIntValue(SWFSubmiter),SWFAccepter,SWFRemark);
	    }
		}
		
		CustomFieldTreeManager.editCustomData("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0), fu, Util.getIntValue(id,0));
		
		  //\u66f4\u65b0\u865a\u62df\u7ec4\u7ec7\u90e8\u95e8id
		  if(departmentvirtualids.length()>0){
			  //\u4fdd\u5b58\u524d\u5148\u5220\u9664\u9700\u8981\u5220\u9664\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u6709managerid \u6240\u4ee5\u4e0d\u80fd\u5168\u90e8\u5220\u9664\u518d\u4fdd\u5b58
		  	sql = "delete from hrmresourcevirtual where resourceid="+id +" and departmentid not in ("+departmentvirtualids+")";
			  rs.executeSql(sql);
			 
			  String[] departmentvirtualid = departmentvirtualids.split(",");
			  for(int i=0;departmentvirtualid!=null&&i<departmentvirtualid.length;i++){
					rs.executeSql(" select count(*) from HrmResourceVirtual where departmentid ='"+departmentvirtualid[i]+"' and resourceid = "+id);
					if(rs.next()){
						//\u5982\u679c\u5df2\u5b58\u5728 \u65e0\u9700\u5904\u7406
						if(rs.getInt(1)>0)continue;
					}
					
					//\u5199\u5165
					int tmpid = 0;
					rs.executeSql("select max(id) from HrmResourceVirtual ");
					if(rs.next()){
						tmpid = rs.getInt(1)+1;
					}
					String subcompanyid = DepartmentVirtualComInfo.getSubcompanyid1(departmentvirtualid[i]);
					sql = " insert into HrmResourceVirtual (id,resourceid,subcompanyid,departmentid ) "+
						    " values ("+tmpid+","+id+","+subcompanyid+","+departmentvirtualid[i]+")";	
					rs.executeSql(sql);
			  }
		  }
			
      SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(lastname);
      SysMaintenanceLog.setOperateItem("29");
      SysMaintenanceLog.setOperateUserid(user.getUID());
      SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("1");
    	SysMaintenanceLog.setOperateDesc("HrmResourceBasicInfo_Insert");
    	SysMaintenanceLog.setSysLogInfo();

        CoreMailAPI coremailapi = CoreMailAPI.getInstance();
	    coremailapi.synUser(id);
	    //CoreMailTestAPI testapi = CoreMailTestAPI.getInstance();
	    //testapi.synUser(id);

     	if(software.equals("KM") || software.equals("CRM")){
    		response.sendRedirect("HrmResource.jsp?isclose=1&id="+id);
      }else if( cmd.equals("SaveAndNew")){
    		response.sendRedirect("HrmResourceAdd.jsp?departmentid="+departmentid);
    		return;
    	}else if(cmd.equals("SaveAndNext")){
    		response.sendRedirect("HrmResourceAddTwo.jsp?id="+id);
    		return;
    	}else{
    		response.sendRedirect("/hrm/search/HrmResourceSearchTmp.jsp?isclose=1&department="+departmentid);
      }
      return;
    }

    if(operation.equalsIgnoreCase("addresourcepersonalinfo")){
    	if(!HrmUserVarify.checkUserRight("HrmResourceEdit:Edit",user)) {
    		response.sendRedirect("/notice/noright.jsp") ;
    		return ;
    	}
      String id = Util.null2String(fu.getParameter("id"));
      String birthday = Util.fromScreen3(fu.getParameter("birthday"),user.getLanguage());
      String folk = Util.fromScreen3(fu.getParameter("folk"),user.getLanguage()) ;	 /*\u6c11\u65cf*/
      String nativeplace = Util.fromScreen3(fu.getParameter("nativeplace"),user.getLanguage()) ;	/*\u7c4d\u8d2f*/
      String regresidentplace = Util.fromScreen3(fu.getParameter("regresidentplace"),user.getLanguage()) ;	/*\u6237\u53e3\u6240\u5728\u5730*/
      String maritalstatus = Util.fromScreen3(fu.getParameter("maritalstatus"),user.getLanguage());
      String policy = Util.fromScreen3(fu.getParameter("policy"),user.getLanguage()) ; /*\u653f\u6cbb\u9762\u8c8c*/
      String bememberdate = Util.fromScreen3(fu.getParameter("bememberdate"),user.getLanguage()) ;	/*\u5165\u56e2\u65e5\u671f*/
      String bepartydate = Util.fromScreen3(fu.getParameter("bepartydate"),user.getLanguage()) ;	/*\u5165\u515a\u65e5\u671f*/
      String islabourunion = Util.fromScreen3(fu.getParameter("islabouunion"),user.getLanguage()) ;
      String educationlevel = Util.fromScreen3(fu.getParameter("educationlevel"),user.getLanguage()) ;/*\u5b66\u5386*/
      String degree = Util.fromScreen3(fu.getParameter("degree"),user.getLanguage()) ; /*\u5b66\u4f4d*/
      String healthinfo = Util.fromScreen3(fu.getParameter("healthinfo"),user.getLanguage()) ;/*\u5065\u5eb7\u72b6\u51b5*/
      String height = Util.null2o(fu.getParameter("height")) ;/*\u8eab\u9ad8*/
      String weight = Util.null2o(fu.getParameter("weight")) ;
      String residentplace = Util.fromScreen3(fu.getParameter("residentplace"),user.getLanguage()) ;	/*\u73b0\u5c45\u4f4f\u5730*/
      String homeaddress = Util.fromScreen3(fu.getParameter("homeaddress"),user.getLanguage()) ;
      String tempresidentnumber = Util.fromScreen3(fu.getParameter("tempresidentnumber"),user.getLanguage()) ;
      String certificatenum = Util.fromScreen3(fu.getParameter("certificatenum"),user.getLanguage()) ;/*\u8bc1\u4ef6\u53f7\u7801*/
      certificatenum=certificatenum.trim();
      String tempcertificatenum=certificatenum;
        int msg=0;
        if(!certificatenum.equals("")){
			rs.executeSql("select accounttype,certificatenum from HrmResource where id="+id);
			String accountType = "", tempCertificatenum = "";
			if(rs.next()){
				accountType = Util.null2String(rs.getString("accounttype"));
				tempCertificatenum = Util.null2String(rs.getString("certificatenum"));
			}
			if(!accountType.equals("1")) {
				rs.executeSql("select id from HrmResource where id<>"+id+" and certificatenum='"+certificatenum+"' and accounttype != '1'");
				if(rs.next()){
					msg=1;
					tempcertificatenum = tempCertificatenum;
				}
			}			
        }
      para = ""+id+	separator+birthday+separator+folk+separator+nativeplace+separator+regresidentplace+separator+
             maritalstatus+	separator+policy+separator+bememberdate+separator+bepartydate+separator+islabourunion+
             separator+educationlevel+separator+degree+separator+healthinfo+separator+height+separator+weight+
             separator+residentplace+separator+homeaddress+separator+tempresidentnumber+separator+tempcertificatenum;

      rs.executeProc("HrmResourcePersonalInfo_Insert",para);
      rs.executeProc("HrmResource_ModInfo",""+id+separator+userpara);

      int rownum = Util.getIntValue(fu.getParameter("rownum"),user.getLanguage()) ;
      for(int i = 0;i<rownum;i++){
        String member = Util.fromScreen3(fu.getParameter("member_"+i),user.getLanguage());
        String title = Util.fromScreen3(fu.getParameter("title_"+i),user.getLanguage());
        String company = Util.fromScreen3(fu.getParameter("company_"+i),user.getLanguage());
        String jobtitle = Util.fromScreen3(fu.getParameter("jobtitle_"+i),user.getLanguage());
        String address = Util.fromScreen3(fu.getParameter("address_"+i),user.getLanguage());
        String info = member+title+company+jobtitle+address;
        if(!(info.trim().equals(""))){
        para = ""+id+separator+member+separator+title+separator+company+separator+jobtitle+separator+address;
        rs.executeProc("HrmFamilyInfo_Insert",para);
        }
      }

            SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
            SysMaintenanceLog.setOperateItem("29");
            SysMaintenanceLog.setOperateUserid(user.getUID());
            SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("1");
    	SysMaintenanceLog.setOperateDesc("HrmResourcePersonalInfo_Insert");
    	SysMaintenanceLog.setSysLogInfo();
    	
        //\u5904\u7406\u81ea\u5b9a\u4e49\u5b57\u6bb5 add by wjy
        CustomFieldTreeManager.editCustomData("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0), fu, Util.getIntValue(id,0));
        CustomFieldTreeManager.editMutiCustomData("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0), fu, Util.getIntValue(id,0));

      if(msg==1)
            response.sendRedirect("HrmResourcePersonalEdit.jsp?id="+id+"&isView="+isView+"&msg=1&iscreate=1&certificatenum="+certificatenum);
      else
            response.sendRedirect("HrmResourceAddThree.jsp?id="+id);
      return;
    }

    if(operation.equalsIgnoreCase("addresourceworkinfo")){
    	if(!HrmUserVarify.checkUserRight("HrmResourceEdit:Edit",user)) {
    		response.sendRedirect("/notice/noright.jsp") ;
    		return ;
    	}
      String id = Util.null2String(fu.getParameter("id"));
      String usekind = Util.fromScreen3(fu.getParameter("usekind"),user.getLanguage()) ;
      String startdate = Util.fromScreen3(fu.getParameter("startdate"),user.getLanguage()) ;
      String probationenddate = Util.fromScreen3(fu.getParameter("probationenddate"),user.getLanguage()) ;
      String enddate = Util.fromScreen3(fu.getParameter("enddate"),user.getLanguage()) ;

      para = ""+id+	separator+usekind+separator+startdate+separator+probationenddate+separator+ enddate;
      rs.executeProc("HrmResourceWorkInfo_Insert",para);
      rs.executeProc("HrmResource_ModInfo",""+id+separator+userpara);

      para=""+id+separator+"0";
      //rs.executeProc("DocUserCategory_InsertByUser",para);

      int edurownum = Util.getIntValue(fu.getParameter("edurownum"),0);
      for(int i = 0;i<edurownum;i++){
        String school = Util.fromScreen3(fu.getParameter("school_"+i),user.getLanguage()) ;
        String speciality = Util.fromScreen3(fu.getParameter("speciality_"+i),user.getLanguage()) ;
        String edustartdate = Util.fromScreen3(fu.getParameter("edustartdate_"+i),user.getLanguage()) ;
        String eduenddate = Util.fromScreen3(fu.getParameter("eduenddate_"+i),user.getLanguage()) ;
        String educationlevel = Util.fromScreen3(fu.getParameter("educationlevel_"+i),user.getLanguage()) ;
        String studydesc = Util.fromScreen3(fu.getParameter("studydesc_"+i),user.getLanguage()) ;

        String info = school+speciality+edustartdate+eduenddate+educationlevel+studydesc;
        if(!info.trim().equals("")){
        para = ""+id+separator+edustartdate+separator+eduenddate+separator+school+separator+speciality+
        	    separator+educationlevel+separator+studydesc;
        rs.executeProc("HrmEducationInfo_Insert",para);
        }
      }

      int lanrownum = Util.getIntValue(fu.getParameter("lanrownum"),0);
      for(int i = 0;i<lanrownum;i++){
        String language = Util.fromScreen3(fu.getParameter("language_"+i),user.getLanguage()) ;
        String level = Util.fromScreen3(fu.getParameter("level_"+i),user.getLanguage()) ;
        String memo = Util.fromScreen3(fu.getParameter("memo_"+i),user.getLanguage()) ;
    	String info = language+memo;
    	if(!info.trim().equals("")){
        para = ""+id+separator+language+separator+level+separator+memo;
        rs.executeProc("HrmLanguageAbility_Insert",para);
    	}
      }

      int workrownum = Util.getIntValue(fu.getParameter("workrownum"),0);
      for(int i = 0;i<workrownum;i++){
        String company = Util.fromScreen3(fu.getParameter("company_"+i),user.getLanguage()) ;
        String workstartdate = Util.fromScreen3(fu.getParameter("workstartdate_"+i),user.getLanguage()) ;
        String workenddate = Util.fromScreen3(fu.getParameter("workenddate_"+i),user.getLanguage()) ;
        String jobtitle = Util.fromScreen3(fu.getParameter("jobtitle_"+i),user.getLanguage()) ;
        String workdesc = Util.fromScreen3(fu.getParameter("workdesc_"+i),user.getLanguage()) ;
        String leavereason = Util.fromScreen3(fu.getParameter("leavereason_"+i),user.getLanguage()) ;

        String info = company+workstartdate+workenddate+jobtitle+workdesc+leavereason;
        if(!info.trim().equals("")){
        para = ""+id+separator+workstartdate+separator+workenddate+separator+company+separator+jobtitle+
        	    separator+workdesc+separator+leavereason;
        rs.executeProc("HrmWorkResume_Insert",para);
        }
      }

      int trainrownum = Util.getIntValue(fu.getParameter("trainrownum"),0);
      for(int i = 0;i<trainrownum;i++){
        String trainname = Util.fromScreen3(fu.getParameter("trainname_"+i),user.getLanguage()) ;
        String trainstartdate = Util.fromScreen3(fu.getParameter("trainstartdate_"+i),user.getLanguage()) ;
        String trainenddate = Util.fromScreen3(fu.getParameter("trainenddate_"+i),user.getLanguage()) ;
        String trainresource = Util.fromScreen3(fu.getParameter("trainresource_"+i),user.getLanguage()) ;
        String trainmemo = Util.fromScreen3(fu.getParameter("trainmemo_"+i),user.getLanguage()) ;

        String info = trainname+trainstartdate+trainenddate+trainresource+trainmemo;
        if(!info.trim().equals("")){
        para = ""+id+separator+trainname+separator+trainresource+separator+trainstartdate+separator+trainenddate+
        	    separator+trainmemo;

        rs.executeProc("HrmTrainBeforeWork_Insert",para);
        }
      }

      int rewardrownum = Util.getIntValue(fu.getParameter("rewardrownum"),0);
      for(int i = 0;i<rewardrownum;i++){
        String rewardname = Util.fromScreen3(fu.getParameter("rewardname_"+i),user.getLanguage()) ;
        String rewarddate = Util.fromScreen3(fu.getParameter("rewarddate_"+i),user.getLanguage()) ;
        String rewardmemo = Util.fromScreen3(fu.getParameter("rewardmemo_"+i),user.getLanguage()) ;
        String info = rewardname+rewarddate+rewardmemo;
        if(!info.trim().equals("")){
        para = ""+id+separator+rewardname+separator+rewarddate+separator+rewardmemo;

        rs.executeProc("HrmRewardBeforeWork_Insert",para);
        }
      }

      int cerrownum = Util.getIntValue(fu.getParameter("cerrownum"),0);

      for(int i = 0;i<cerrownum;i++){
        String cername = Util.fromScreen3(fu.getParameter("cername_"+i),user.getLanguage()) ;
        String cerstartdate = Util.fromScreen3(fu.getParameter("cerstartdate_"+i),user.getLanguage()) ;
        String cerenddate = Util.fromScreen3(fu.getParameter("cerenddate_"+i),user.getLanguage()) ;
        String cerresource = Util.fromScreen3(fu.getParameter("cerresource_"+i),user.getLanguage()) ;

        String info = cername+cerstartdate+cerenddate+cerresource;
        if(!info.trim().equals("")){
        para = ""+id+separator+cerstartdate +separator+cerenddate +separator+cername+separator+cerresource;

        rs.executeProc("HrmCertification_Insert",para);
        }
      }


    // \u5de5\u4f5c\u4fe1\u606f\u4e0d\u9700\u8981\u6e05\u7406\u7f13\u5b58 ResourceComInfo.removeResourceCache();

        //\u5904\u7406\u81ea\u5b9a\u4e49\u5b57\u6bb5 add by wjy
        CustomFieldTreeManager.editCustomData("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0), fu, Util.getIntValue(id,0));
        CustomFieldTreeManager.editMutiCustomData("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0), fu, Util.getIntValue(id,0));


        SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
        SysMaintenanceLog.setOperateItem("29");
        SysMaintenanceLog.setOperateUserid(user.getUID());
        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("1");
    	SysMaintenanceLog.setOperateDesc("HrmResourceWorkInfo_Insert");
    	SysMaintenanceLog.setSysLogInfo();
        String isNewAgain = Util.fromScreen3(fu.getParameter("isNewAgain"),user.getLanguage()) ;
        if(isNewAgain.equals("1")){
            String deptid=ResourceComInfo.getDepartmentID(id);
            response.sendRedirect("/hrm/resource/HrmResourceAdd.jsp?departmentid="+deptid);
            return ;
        }
        //response.sendRedirect("/hrm/resource/HrmResource.jsp?id="+id);
        response.sendRedirect("/hrm/search/HrmResourceSearchResult.jsp?from=HrmResourceAdd");
        return;
    }

    if(operation.equalsIgnoreCase("addresourcefinanceinfo")){
	    	if(!HrmUserVarify.checkUserRight("HrmResourceWelfareEdit:Edit",user)) {
	    		response.sendRedirect("/notice/noright.jsp") ;
	    		return ;
	    	}
        String id = Util.null2String(fu.getParameter("id"));

        String bankid1 = Util.null2String(fu.getParameter("bankid1"));
        String accountid1 = Util.null2String(fu.getParameter("accountid1"));
        String accumfundaccount = Util.null2String(fu.getParameter("accumfundaccount"));
        String accountname = Util.null2String(fu.getParameter("accountname"));

        para = ""+id+	separator+bankid1+separator+accountid1+separator+accumfundaccount+separator+accountname;
        rs.executeProc("HrmResourceFinanceInfo_Insert",para);
        rs.executeProc("HrmResource_ModInfo",""+id+separator+userpara);
        rs.executeProc("HrmInfoStatus_UpdateFinance",""+id);

        rs.executeProc("HrmInfoStatus_UpdateFinance",""+id);
        // \u8d22\u52a1\u4fe1\u606f\u4e0d\u9700\u8981\u6e05\u7406\u4eba\u529b\u8d44\u6e90\u7f13\u5b58 ResourceComInfo.removeResourceCache();

        SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
        SysMaintenanceLog.setOperateItem("29");
        SysMaintenanceLog.setOperateUserid(user.getUID());
        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("1");
    	SysMaintenanceLog.setOperateDesc("HrmResourceFinanceInfo_Insert");
    	SysMaintenanceLog.setSysLogInfo();

        response.sendRedirect("/hrm/resource/HrmResourceFinanceView.jsp?isfromtab="+isfromtab+"&id="+id+"&isView="+isView);
        return;
    }

//\u589e\u52a0\u7cfb\u7edf\u4fe1\u606fxiao
    if(operation.equalsIgnoreCase("addresourcesysteminfo")){
    
		//\u4eba\u529b\u8d44\u6e90\u6a21\u5757\u662f\u5426\u5f00\u542f\u4e86\u7ba1\u7406\u5206\u6743\uff0c\u5982\u4e0d\u662f\uff0c\u5219\u4e0d\u663e\u793a\u6846\u67b6\uff0c\u76f4\u63a5\u8f6c\u5411\u5230\u5217\u8868\u9875\u9762(\u65b0\u7684\u5206\u6743\u7ba1\u7406)
		int hrmdetachable=0;
		if(session.getAttribute("hrmdetachable")!=null){
		    hrmdetachable=Util.getIntValue(String.valueOf(session.getAttribute("hrmdetachable")),0);
		}else{
			boolean isUseHrmManageDetach=ManageDetachComInfo.isUseHrmManageDetach();
			if(isUseHrmManageDetach){
			   hrmdetachable=1;
			   session.setAttribute("detachable","1");
			   session.setAttribute("hrmdetachable",String.valueOf(hrmdetachable));
			}else{
			   hrmdetachable=0;
			   session.setAttribute("detachable","0");
			   session.setAttribute("hrmdetachable",String.valueOf(hrmdetachable));
			}
		}  
	String id = Util.null2String(fu.getParameter("id"));
           int hrmoperatelevel=-1;
         if(hrmdetachable==1){
             String deptid=ResourceComInfo.getDepartmentID(id);
             String subcompanyid=DepartmentComInfo.getSubcompanyid1(deptid)  ;
             hrmoperatelevel=CheckSubCompanyRight.ChkComRightByUserRightCompanyId(user.getUID(),"ResourcesInformationSystem:All",Util.getIntValue(subcompanyid));
         }else{
			String departmentidtmp = ResourceComInfo.getDepartmentID(id);
			if(HrmUserVarify.checkUserRight("ResourcesInformationSystem:All",user,departmentidtmp)){
				hrmoperatelevel=2;
			}
        }
         boolean iss = ResourceComInfo.isSysInfoView(userid,id);
        if(!(hrmoperatelevel>0) && !iss){
    		response.sendRedirect("/notice/noright.jsp") ;
    		return ;
    	}
     	 String password = Util.null2String(fu.getParameter("password"));

         String isrsaopen = Util.null2String(rs.getPropValue("openRSA","isrsaopen"));//\u662f\u5426\u5f00\u542fRSA
         if("1".equals(isrsaopen)){
         	List<String> rsaList = new ArrayList<String>();
         	rsaList.add(password);
         	List<String> desList = RSA.decryptList(request,rsaList);
         	System.out.println("desList>"+desList);
         	if(desList.size() > 0){
         		password = desList.get(0);
         	}
         	if(!RSA.getMessage().equals("0")){
				response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=184");
                 return ;
         	}
         }
     	 
     	String oldpassword = "";
     	String oldloginid = "";
     	//String oldLginid = 
     	String loginid = Util.null2String(fu.getParameter("loginid"));
     	String isADAccount = Util.null2String(request.getParameter("isADAccount"));
     	//\u4fee\u6539AD\u57df\u5bc6\u7801

     	if(mode.equals("ldap") && "1".equals(isADAccount)) {
			//String adpasswordconfirm= Util.fromScreen3(request.getParameter("passwordconfirm"),user.getLanguage());
		
			rs.executeSql("select * from hrmresource where id="+id);
			if(rs.next()) {
				oldloginid = rs.getString("loginid");
				oldpassword  = rs.getString("password");
			}
			String errorType = "";
			int  flage = 0;
			if(!id.equals("")){
				if(!"".equals(loginid)){
					 ResourceComInfo.setTofirstRow();
					 while(ResourceComInfo.next()) {
					 	if(loginid.equals(ResourceComInfo.getLoginID())&&!id.equals(ResourceComInfo.getResourceid())){
             				response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=1&usingid="+ResourceComInfo.getResourceid());
            				flage = 1;
            				break;
          				}
					}
					if(flage == 1) {
						return;
					}
					LdapUtil ldap=LdapUtil.getInstance();
					//if this account is in ad
					String samaccountname = ldap.authenticuser(loginid);	
					if(samaccountname == null) {
						response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=2");
						return;
					} else if("uac".equals(samaccountname)) {//\u8d26\u53f7\u88ab\u7981\u7528

						response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=9");
						return;
					} else {
					//\u5c06AD\u4e2d\u7684\u8d26\u53f7\u53d6\u51fa\u6765 \u4f5c\u4e3aloginid\u3002\u56e0\u4e3a\u5728\u67e5\u8be2\u7684\u65f6\u5019\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u800cSQLSERVER\u6570\u636e\u5e93\u533a\u5206\u5927\u5c0f\u5199\uff0c\u8d26\u53f7\u4ee5ad\u4e3a\u51c6
						//loginid = samaccountname;
					}
					
					//System.out.println("account2:"+adaccount+"lastname:"+""+"passwordnew2:"+adpasswordconfirm);
					if(!"".equals(password)) {
						java.util.HashMap map = ldap.updateUserInfo(loginid,password,"",password,"","1");
						String isSuccess = (String)map.get("isSuccess");
						String errorMsg = (String)map.get("errorMsg");
						errorType = (String)map.get("errorType");
						
						if(isSuccess.equals("false")){
							if("2".equals(errorType)) {//\u8d26\u53f7\u4e0d\u5b58\u5728

								response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=2");
							} else if("3".equals(errorType)) {//\u65e0\u6cd5\u8fde\u63a5
								response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=3");
							}else if("4".equals(errorType)) {//\u8bc1\u4e66\u4e0d\u53ef\u4f7f\u7528
								response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=4");
							}else if("5".equals(errorType)) {//\u8bc1\u4e66\u8def\u5f84\u9519\u8bef
								response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=5");
							}else if("6".equals(errorType)) {//\u8bc1\u4e66\u5bc6\u7801\u9519\u8bef
								response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=6");
							} else if("7".equals(errorType)) {//\u8bc1\u4e66\u8fc7\u671f
								response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=8");
							}else {//\u4e0d\u7b26\u5408\u5bc6\u7801\u7b56\u7565

								response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=7");
							}
							
							return;
						} else {
						}
					}
				}else{
				}
			}
		}
		
        String logintype = user.getLogintype();     //\u5f53\u524d\u7528\u6237\u7c7b\u578b  1: \u7c7b\u522b\u7528\u6237  2:\u5916\u90e8\u7528\u6237  
        int detachable=Util.getIntValue(String.valueOf(session.getAttribute("detachable")),0);
        hrmdetachable=Util.getIntValue(String.valueOf(session.getAttribute("hrmdetachable")),0);
        int operatelevel=0;
        if(hrmdetachable==1 && user.getUID()!=1){
            String deptid=ResourceComInfo.getDepartmentID(id);
            String subcompanyid=DepartmentComInfo.getSubcompanyid1(deptid)  ; 
			if(subcompanyid==null||"".equals(subcompanyid)){
				rs.executeSql("select Subcompanyid1 from hrmresource where id = "+id);
				if(rs.next()) subcompanyid = Util.null2String(rs.getString("Subcompanyid1"));
			}
			if(subcompanyid!=null&&!"".equals(subcompanyid))
			operatelevel = CheckSubCompanyRight.ChkComRightByUserRightCompanyId(user.getUID(),"ResourcesInformationSystem:All",Integer.parseInt(subcompanyid));
        }else{
            if(HrmUserVarify.checkUserRight("ResourcesInformationSystem:All", user))
                operatelevel=2;
        }
        if("2".equals(logintype)||!(iss || operatelevel>0)){  
           rs.writeLog("illegal attack user"); response.sendRedirect("/hrm/resource/HrmResourceSystemView.jsp?id="+id+"&isView="+isView);
            return ;
        }

      //String loginid = Util.null2String(fu.getParameter("loginid"));
      
      int passwordlock = Util.getIntValue(Util.null2String(fu.getParameter("passwordlock")),0);
      //String account = Util.null2String(fu.getParameter("account"));
     // if("ldap".equals(mode)) {
      //	account = adaccount;
     // }
     
      if(logintype.equals("1") && !loginid.equalsIgnoreCase("")){//\u5982\u679c\u662f\u5185\u90e8\u7528\u6237\uff0c\u4e14\u672c\u6b21\u7684loginid\u4e0d\u4e3a\u7a7a

        	String oldLoginId = "";
  			rs.executeSql("select loginid from HrmResource where id ="+id);//\u67e5\u8be2\u8fd9\u4e2a\u7528\u6237\u4e4b\u524d\u7684loginid
  			if(rs.next()){
  				oldLoginId = Util.null2String(rs.getString(1));
  			}
  			if("".equals(oldLoginId)) {//\u5982\u679c\u65e7loginid\u4e3a\u7a7a\uff0c\u68c0\u67e5license\u6570\u91cf
  				if(LN.CkHrmnum() >= 0){
  		    		response.sendRedirect("HrmResourceSystemEdit.jsp?isfromtab="+isfromtab+"&id="+id+"&isView="+isView+"&errmsg=2");
  		    		return;
  				}
  			}
  		}
     

      String enc_account="";
      if(!loginid.equals(""))
      enc_account=Util.getEncrypt(loginid);
     // String password = Util.fromScreen3(fu.getParameter("password"),user.getLanguage());
      if(!password.equals("qwertyuiop"))  password = Util.getEncrypt(password);
      else password = "0" ;
      String systemlanguage = Util.null2String(fu.getParameter("systemlanguage"));
      if(systemlanguage.equals("")||systemlanguage.equals("0")) systemlanguage = "7";

      int seclevel = Util.getIntValue(fu.getParameter("seclevel"),0);
      String email = Util.null2String(fu.getParameter("email"));
      String needdynapass= String.valueOf(Util.null2String(fu.getParameter("needdynapass"))); 
	  String passwordstate= String.valueOf(Util.null2String(fu.getParameter("passwordstate"))); 	
      //int passwordstate = Util.getIntValue(fu.getParameter("passwordstate"),1);
	  //System.out.println(passwordstate.equals("0")||passwordstate.equals("2"));
	  if(passwordstate.equals("0")||passwordstate.equals("2")){
	        needdynapass = "1";
	  }else{
	        needdynapass="0";  
	  }

		//Start \u624b\u673a\u63a5\u53e3\u529f\u80fd by alan
		rs.executeSql("DELETE FROM workflow_mgmsusers WHERE userid="+id);
		if(!Util.null2String(request.getParameter("isMgmsUser")).equals("")){
			rs.executeSql("INSERT INTO workflow_mgmsusers(userid) VALUES ("+id+")");
		}	
		//End \u624b\u673a\u63a5\u53e3\u529f\u80fd by alan
	  	
      //xiaofeng
      String needusb= Util.null2String(fu.getParameter("needusb"));
      if(!needusb.equals("1"))
      needusb="0";
      String old_needusb= Util.null2String(fu.getParameter("old_needed"));
      if(!old_needusb.equals("1"))
      old_needusb="0";
      String serial= Util.null2String(fu.getParameter("serial"));
	  String username = Util.null2String(fu.getParameter("username"));

	  RemindSettings settings=(RemindSettings)application.getAttribute("hrmsettings");
	  String usbType = settings.getUsbType();
	  String userUsbType=Util.null2String(fu.getParameter("userUsbType"));
	  String tokenkey=Util.null2String(fu.getParameter("tokenKey"));
	  
	  String serial21 =Util.null2String(fu.getParameter("serial21")) ;
      if("21".equals(userUsbType) && StringUtils.isNotBlank(serial21)){
    	  rs.execute("select 1 from hrmresource where id !="+id+" and userUsbType='21' and serial='"+serial21+"'") ;
    	  if(rs.next()){
    		  response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=-21");
    		  return ;
    	  }
      }
      
	  //if(loginid.equals("")&&needusb.equals("0")&&!userUsbType.equals("2")){
	  		
		//	loginid=account;
		//  }
	  //if("".equals(account)||(needusb.equals("1") && userUsbType.equals("2"))){
		//  account = username;
	  //}
	  
      if((needusb.equals("1")&&old_needusb.equals("1")&&serial.equals(""))||(!needusb.equals("1")&&!old_needusb.equals("1"))) serial="0"; //\u5982\u679c\u8be5\u7528\u6237\u7684\u5e8f\u5217\u53f7\u4e0d\u505a\u53d8\u66f4

		String usbstate = Util.null2String(fu.getParameter("usbstate"));
		StringBuffer upSql = new StringBuffer("update HrmResource set");
		if(userUsbType.equals("4")){
			needdynapass = "1";
			needusb = "0";
		}else if(userUsbType.equals("2") || userUsbType.equals("3")){
			needdynapass = "0";
			needusb = "1";
		}else{
			//\u89e3\u7ed1\u8f85\u52a9\u9a8c\u8bc1\u65b9\u5f0f
			needdynapass = "0" ;
			needusb="0" ;
		}
	if(!"".equals(usbstate) && !"".equals(userUsbType)){
	 upSql.append(" needusb = ").append(needusb)
	 .append(" ,usbstate = ").append(usbstate)
	 .append(" ,needdynapass = ").append(needdynapass)
	 .append(" ,userUsbType = ").append(userUsbType)
	 .append(" where id = ").append(id);
	 rs.executeSql(upSql.toString());
	}
      
      String oldLoginid="";
      //if(mode.equals("ldap")){
      //\u4e0d\u8986\u76d6loginid
    	  //loginid=account;
    	  
     // }
      //para = ""+id+	separator+loginid+separator+password+separator+systemlanguage+separator+seclevel+separator+email+separator+needusb+separator+serial+separator+account+separator+enc_account+separator+needdynapass+separator+passwordstate;
      if("1".equals(isADAccount)) {//\u4fee\u6539AD\u8d26\u6237\u7684\u5bc6\u7801\u4e0d\u540c\u6b65\u5230\u4eba\u5458\u4fe1\u606f\u8868\u4e2d,\u6240\u4ee5\u628a\u65e7\u5bc6\u7801\u8d4b\u7ed9password
      	password = oldpassword;
      }
      para = ""+id+	separator+loginid+separator+password+separator+systemlanguage+separator+seclevel+separator+email+separator+needusb+separator+serial+separator+""+separator+enc_account+separator+needdynapass+separator+passwordstate;
      //System.out.println("para = " + para);
      ResourceComInfo.setTofirstRow();
      //while(!account.equals("")&&ResourceComInfo.next()){
      //    if(ResourceComInfo.getAccount().equals(account)&&!ResourceComInfo.getResourceid().equals(id)){
      //        response.sendRedirect("HrmResourceSystemEdit.jsp?id="+id+"&isView="+isView+"&errmsg=1");
      //       return ;
      //    }
      //}
//      HrmResourceManagerDAO dao = new HrmResourceManagerDAO();
       if(!loginid.equals("") && dao.ifHaveSameLoginId(loginid,id)){  //\u68c0\u6d4bloginid\u91cd\u540d
       	  rs.executeSql("select id from hrmresource where loginid='"+loginid+"'"); 
       	  if(rs.next()) {
       	  	String theid = rs.getString("id");
       	  	response.sendRedirect("HrmResourceSystemEdit.jsp?isfromtab="+isfromtab+"&id="+id+"&isView="+isView+"&errmsg=1&&usingid="+theid);
         	return ;
       	  }
          
      }else{

		rs.executeSql("select * from HrmResource where id = "+Util.getIntValue(id));
		String olddepartmentid = "";
		String oldmanagerid = "";
		String oldsubcompanyid1 = "";
		String oldseclevel = "";
		String oldmanagerstr = "";
		
		String lastname="";
		String oldTokenKey="";
		
		while(rs.next()){
		olddepartmentid = rs.getString("departmentid");
		oldmanagerid = rs.getString("managerid");
		oldsubcompanyid1 = rs.getString("subcompanyid1");
		oldseclevel = rs.getString("seclevel");
		oldmanagerstr = rs.getString("managerstr");
    /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 begin***********/
    if(!oldmanagerstr.startsWith(","))oldmanagerstr=","+oldmanagerstr;
    if(!oldmanagerstr.endsWith(","))oldmanagerstr=oldmanagerstr+",";
    /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 end ***********/
		lastname=rs.getString("lastname");
		
		oldLoginid = rs.getString("loginid");
		oldTokenKey = rs.getString("tokenKey");
		}
		
		String falgtmp = "1";//"1"\u8868\u793a\u4fee\u6539,"0"\u8868\u793a\u65b0\u589e
		if("".equals(oldLoginid) && !"".equals(loginid)) {  //\u4f7f\u7528\u767b\u9646\u540d\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u4f1a\u5728Rtx\u4e2d\u65b0\u589e\u4e00\u7528\u6237
			falgtmp = "0";
			if(!loginid.equals(oldLoginid)) {//\u4fee\u6539\u7528\u6237\u540d\u7684\u60c5\u51b5\u4e0b\u65b0\u6dfb\u52a0\u7528\u6237
				//OrganisationCom.deleteUser2(oldLoginid);
				new Thread(new OrganisationComRunnable("user","del2",id)).start();
			}
		}

		//\u4fee\u6539\u7528\u6237\u540d\u7684\u60c5\u51b5\u4e0bRtx\u4e2d\u53bb\u9664\u8fd9\u4e00\u7528\u6237\u7528\u6237
		if(!"".equals(oldLoginid) && !"".equals(loginid) && !oldLoginid.equals(loginid)) {
			//OrganisationCom.deleteUser2(oldLoginid);
			new Thread(new OrganisationComRunnable("user","del2",id)).start();
		}

		boolean ret = false;
		RecordSetTrans rst=new RecordSetTrans();
		rst.setAutoCommit(false);
		try{
	   		 //if(mode.equals("ldap")){  //\u5f00\u542fad\u57df

	    		//System.out.println(para);
			//	ret=rst.executeProc("HrmResourceSystemInfo_Insert1",para);  //\u4e0d\u68c0\u6d4b loginid\u91cd\u540d
			// }
			// else{
			 //  ret=rst.executeProc("HrmResourceSystemInfo_Insert",para);
			// }
			
			 ret=rst.executeProc("HrmResourceSystemInfo_Insert",para);
			//\u4fdd\u5b58\u6307\u5b9a\u7684usbType\u548ctokenkey
			if(userUsbType.equals("2")){
				rst.execute("update hrmresource set userUsbType="+userUsbType+",serial='"+(serial.equals("0")?"":serial)+"' where id="+id);
			} else if(userUsbType.equals("3")){
				rst.execute("update hrmresource set userUsbType="+userUsbType+",tokenkey='"+tokenkey+"' where id="+id);
			}else if("21".equals(userUsbType)){
				rst.execute("update hrmresource set userUsbType="+userUsbType+",serial='"+serial21+"' where id="+id);
			}
			
			if(user.getLoginid().equals(loginid)){
				String languid = String.valueOf(systemlanguage); 
				Cookie syslanid = new Cookie("Systemlanguid",languid);
				syslanid.setMaxAge(-1);
				syslanid.setPath("/");
				response.addCookie(syslanid);
			}

			//String p_para = id + separator + olddepartmentid + separator + oldsubcompanyid1 + separator + oldmanagerid + separator + seclevel + separator + oldmanagerstr + separator + olddepartmentid + separator + oldsubcompanyid1 + separator + oldmanagerid + separator + oldseclevel + separator + oldmanagerstr + separator + falgtmp;

			//System.out.println(p_para);
			//rst.executeProc("HrmResourceShare", p_para);
			rst.commit();
		}catch(Exception e){
			rst.rollback();
			e.printStackTrace();
		}
		VerifyPasswdCheck.unlockOrLockPassword(id,passwordlock);
      if(ret){
          if(needdynapass.equals("1")){
            rs.executeSql("select id from hrmpassword where id='"+id+"'") ;
              if(rs.next()) ;
              else{                 
              rs.executeSql("insert into hrmpassword(id,loginid) values("+id+",'"+loginid+"')") ;
              }
          }

      }else{

      }
      }
      //db2
      //rsdb2.executeProc("Tri_UMMInfo_ByHrmResourceManager",""+id);
      if (RecordSetDB.getDBType().equals("db2")){
        rsdb2.executeProc("Tri_UMMInfo_ByHrmResource",""+id); //\u4e3b\u83dc\u5355


        String departmentid=ResourceComInfo.getDepartmentID(id);

        //System.out.println(""+id+separator+loginid+separator+departmentid+separator+seclevel);
        //rsdb2.executeProc("Tri_U_workflow_createlist_1",""+id+separator+loginid+separator+departmentid+separator+seclevel); //\u5de5\u4f5c\u6d41\u83dc\u5355

        /*

        CREATE procedure Tri_U_W_createl
        (
        in id int,
        in loginid varchar(60),
        in departmentid int ,
        in seclevel int
        )*/


		//\u6587\u6863\u83dc\u5355
		/*
		CREATE procedure Tri_U_HrmresourceShare_ini
		(
		in id integer ,
		in departmentid integer,
		in olddepartmentid integer,
		in subcompanyid1 integer,
		in seclevel integer,
		in oldseclevel integer,
		in managerstr varchar(200)
		)
		*/
		String oldSeclevel =ResourceComInfo.getSeclevel(id);
		String managerid=ResourceComInfo.getManagerID(id);

		String sql = "select managerstr from HrmResource where id = "+Util.getIntValue(managerid);
		rs.executeSql(sql);
		String managerstr = "";
		while(rs.next()){
			String tmp_managerstr = rs.getString("managerstr");
	     /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 begin***********/
      if(!tmp_managerstr.startsWith(","))tmp_managerstr=","+tmp_managerstr;
      if(!tmp_managerstr.endsWith(","))tmp_managerstr=tmp_managerstr+",";
      /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 end ***********/
		managerstr += tmp_managerstr;
			
		managerstr +=   managerid + "," ;
		};

	//rsdb2.executeProc("Tri_U_HrmresourceShare_ini",""+id+separator+departmentid+separator+departmentid+DepartmentComInfo.getSubcompanyid1(ResourceComInfo.getDepartmentID(id))+separator+seclevel+separator+oldSeclevel+separator+managerstr);




      }


      rs.executeProc("HrmResource_ModInfo",""+id+separator+userpara);
      rs.executeProc("HrmInfoStatus_UpdateSystem",""+id);

      para = ""+id+	separator+loginid+separator+"1";
      rs.executeProc("Ycuser_Insert",para);

      para = ""+seclevel+separator+ResourceComInfo.getDepartmentID(id)+separator+DepartmentComInfo.getSubcompanyid1(ResourceComInfo.getDepartmentID(id))+separator+id;
      rs.executeProc("MailShare_InsertByUser",para);
      //log usb setting
      if(!old_needusb.equals("1")&&needusb.equals("1")){
      SysMaintenanceLog.resetParameter();
      SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
      SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
      SysMaintenanceLog.setOperateItem("89");
      SysMaintenanceLog.setOperateUserid(user.getUID());
      SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
      SysMaintenanceLog.setOperateType("7");
      SysMaintenanceLog.setOperateDesc("HrmResourceSystemInfo_USB");
      SysMaintenanceLog.setSysLogInfo();
      }
      if(old_needusb.equals("1")&&!needusb.equals("1")){
      SysMaintenanceLog.resetParameter();
      SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
      SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
      SysMaintenanceLog.setOperateItem("89");
      SysMaintenanceLog.setOperateUserid(user.getUID());
      SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
      SysMaintenanceLog.setOperateType("8");
      SysMaintenanceLog.setOperateDesc("HrmResourceSystemInfo_USB");
      SysMaintenanceLog.setSysLogInfo();
      }
      //add by wjy
      //\u540c\u6b65RTX\u7aef\u7684\u7528\u6237\u4fe1\u606f.
      boolean isAdd = false;
      //OrganisationCom.checkUser(Integer.parseInt(id));
      if(("".equals(oldLoginid) && !"".equals(loginid))||(!loginid.equals(oldLoginid)&&!"".equals(loginid))) {  //\u4f7f\u7528\u767b\u9646\u540d\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u4f1a\u5728Rtx\u4e2d\u65b0\u589e\u4e00\u7528\u6237
			if(!loginid.equals(oldLoginid)) {//\u4fee\u6539\u7528\u6237\u540d\u7684\u60c5\u51b5\u4e0b\u65b0\u6dfb\u52a0\u7528\u6237
				//OrganisationCom.addUser(Util.getIntValue(id));
				new Thread(new OrganisationComRunnable("user","add",id)).start();
				isAdd = true;
			}

		} else if(!"".equals(oldLoginid) && "".equals(loginid)) {  //\u53bb\u9664\u767b\u9646\u540d\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u4f1a\u5728Rtx\u4e2d\u53bb\u9664\u8fd9\u4e00\u7528\u6237
			new Thread(new OrganisationComRunnable("user","del2",id)).start();
		}
      if(!isAdd && !"".equals(loginid))
      {
      	//OrganisationCom.editUser(Integer.parseInt(id));
		new Thread(new OrganisationComRunnable("user","edit",id)).start();
      }
	// \u6539\u4e3a\u81ea\u8fdb\u884c\u4fee\u6b63

      ResourceComInfo.updateResourceInfoCache(id);

      PluginUserCheck.clearPluginUserCache("messager");

	  //OA\u4e0e\u7b2c\u4e09\u65b9\u63a5\u53e3\u5355\u6761\u6570\u636e\u540c\u6b65\u65b9\u6cd5\u5f00\u59cb

	  HrmServiceManager.SynInstantHrmResource(id,"1");  
	  //OA\u4e0e\u7b2c\u4e09\u65b9\u63a5\u53e3\u5355\u6761\u6570\u636e\u540c\u6b65\u65b9\u6cd5\u7ed3\u675f

      SysMaintenanceLog.resetParameter();
      SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
      SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
      SysMaintenanceLog.setOperateItem("29");
      SysMaintenanceLog.setOperateUserid(user.getUID());
      SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
      if("1".equals(isEdit)){
	      SysMaintenanceLog.setOperateType("2");
      }else{
		  SysMaintenanceLog.setOperateType("1");
      }
      SysMaintenanceLog.setOperateDesc("HrmResourceSystemInfo_Insert");
      SysMaintenanceLog.setSysLogInfo();

	//if("ldap".equals(mode)) {
	//	rs.executeSql("update HrmResource set account='"+adaccount+"',loginid='"+oldloginid+"' where id='"+id+"'");
	//}
	//\u66f4\u65b0\u8d26\u6237\u7684\u72b6\u6001 \u662f\u5426\u4e3aAD\u7684\u8d26\u6237

	if("ldap".equals(mode)) {
		if("1".equals(isADAccount)) {
			rs.executeSql("update HrmResource set isADAccount='1' where id='"+id+"'");
		} else {
			rs.executeSql("update HrmResource set isADAccount=NULL where id='"+id+"'");
		}
	}
		SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
        SysMaintenanceLog.setOperateItem("421");
        SysMaintenanceLog.setOperateUserid(user.getUID());
        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("2");
    	SysMaintenanceLog.setOperateDesc("HrmResourceSystemInfo_Insert");
    	SysMaintenanceLog.setSysLogInfo();

		
		//BBS\u96c6\u6210\u76f8\u5173
		if (!password.equals("0")) {
			if (!bbsLingUrl.equals("")) {
				/*\u53d6\u6d88\u539fBBS\u540c\u6b65\u65b9\u5f0f\uff0c\u6539\u7528\u7ebf\u7a0b\u7c7b
				try{
					Class s=Class.forName("weaver.bbs.UserOAToBBS");
						
					if (s!=null) {
						Class partypes[] = new Class[2];
						partypes[0]=String.class;
						partypes[1] = String.class;
						Method  meh=s.getMethod("changBBSUser",partypes);
				
						Object arglist[] = new Object[2];
						arglist[0] = new String(loginid);
						arglist[1] = new String(password); 
						Boolean bbsStatus =(Boolean) meh.invoke(s.newInstance(), arglist);
						if(!bbsStatus){
							response.sendRedirect("HrmResourceSystemEdit.jsp?isfromtab="+isfromtab+"&id="+id+"&isView="+isView+"&errmsg=bbserror");
							//response.sendRedirect("HrmResourceSystemEdit.jsp?isfromtab="+isfromtab+"&id="+id+"&isView="+isView+"&errmsg=1&&usingid="+theid);
					        return ;
						}
					}
				}catch (Exception e){
				}
				*/
				new Thread(new weaver.bbs.BBSRunnable(loginid,password)).start();
			}
		}
 
        CoreMailAPI coremailapi = CoreMailAPI.getInstance();
	    coremailapi.synUser(id);
	    //CoreMailTestAPI testapi = CoreMailTestAPI.getInstance();
	    //testapi.synUser(id);

      response.sendRedirect("/hrm/resource/HrmResourceSystemView.jsp?isfromtab="+isfromtab+"&id="+id+"&isView="+isView);
      return;
    }

	//\u4fee\u6539\u57fa\u672c\u4fe1\u606fxiao
    if(operation.equalsIgnoreCase("editbasicinfo")){
	    	if(!HrmUserVarify.checkUserRight("HrmResourceEdit:Edit",user)) {
	    		response.sendRedirect("/notice/noright.jsp") ;
	    		return ;
	    	}
    		String isDialog = Util.null2String(fu.getParameter("isDialog"));
    		String urlFrom = Util.null2String(fu.getParameter("urlFrom"));
        String id = Util.null2String(fu.getParameter("id"));
        String workcode = Util.fromScreen3(fu.getParameter("workcode"),user.getLanguage());
        String lastname = Util.fromScreen3(fu.getParameter("lastname"),user.getLanguage()).trim();
        String sex = Util.fromScreen3(fu.getParameter("sex"),user.getLanguage());

        String resourceimageid= Util.null2String(fu.uploadFiles("photoid"));
        String oldresourceimageid= Util.null2String(fu.getParameter("oldresourceimage"));
        if(resourceimageid.equals("")) resourceimageid=oldresourceimageid ;

        String departmentid = Util.fromScreen3(fu.getParameter("departmentid"),user.getLanguage());
        String costcenterid = Util.fromScreen3(fu.getParameter("costcenterid"),user.getLanguage());
        String jobtitle = Util.fromScreen3(fu.getParameter("jobtitle"),user.getLanguage());
        String joblevel = Util.fromScreen3(fu.getParameter("joblevel"),user.getLanguage());
        String jobactivitydesc = Util.fromScreen3(fu.getParameter("jobactivitydesc"),user.getLanguage());
        String managerid = Util.fromScreen3(fu.getParameter("managerid"),user.getLanguage());
        String assistantid = Util.fromScreen3(fu.getParameter("assistantid"),user.getLanguage());
        String status = Util.fromScreen3(fu.getParameter("status"),user.getLanguage());
        String locationid = Util.fromScreen3(fu.getParameter("locationid"),user.getLanguage());
        String workroom = Util.fromScreen3(fu.getParameter("workroom"),user.getLanguage());
        String telephone = Util.fromScreen3(fu.getParameter("telephone"),user.getLanguage());
        String mobile = Util.fromScreen3(fu.getParameter("mobile"),user.getLanguage());
        String mobileshowtype = Util.fromScreen3(fu.getParameter("mobileshowtype"),user.getLanguage());
        String mobilecall = Util.fromScreen3(fu.getParameter("mobilecall"),user.getLanguage());
        String fax = Util.fromScreen3(fu.getParameter("fax"),user.getLanguage());
        String email = Util.fromScreen3(fu.getParameter("email"),user.getLanguage());
        String dsporder = Util.fromScreen3(fu.getParameter("dsporder"),user.getLanguage());
        String jobcall = Util.fromScreen3(fu.getParameter("jobcall"),user.getLanguage());
        String systemlanguage = Util.fromScreen3(fu.getParameter("systemlanguage"),user.getLanguage());
        if(systemlanguage.equals("")||systemlanguage.equals("0")){
         systemlanguage = "7";
        }
				String accounttype = Util.fromScreen3(fu.getParameter("accounttype"),user.getLanguage());
        String belongto = Util.fromScreen3(fu.getParameter("belongto"),user.getLanguage());
				if(accounttype.equals("0")){
				belongto="-1";
				}
		
		//Td9325,\u89e3\u51b3\u591a\u8d26\u53f7\u6b21\u8d26\u53f7\u6ca1\u6709\u767b\u9646Id\u5728\u6d4f\u89c8\u6846\u7ec4\u7ec7\u7ed3\u6784\u4e2d\u65e0\u6cd5\u663e\u793a\u7684\u95ee\u9898\u3002

		String oldbelongto ="";
	    boolean falg = false;
		String loginid = "";
		rs3.executeSql("select * from HrmResource where id ="+id);
		if(rs3.next()){
					loginid = rs3.getString("loginid");
					float idsporder = rs3.getFloat("dsporder");
					if(idsporder<=0){
						dsporder = rs3.getString("id");
					}else{
						dsporder = ""+idsporder;
					}

					String thisAccounttype = rs3.getString("accounttype");
					if(thisAccounttype.equals("1")&&accounttype.equals("0")){
						oldbelongto = rs3.getString("belongto");
					}
		}
		
		if(accounttype.equals("1") && loginid.equalsIgnoreCase("")){
				rs.executeSql("select loginid from HrmResource where id ="+belongto);
				if(rs.next()){
					loginid = rs.getString(1);
				}
				if(LN.CkHrmnum() >= 0){
		    		response.sendRedirect("HrmResourceBasicEdit.jsp?id="+id+"&ifinfo=y&isfromtab=true");
		    		return;
				}
				if(!loginid.equals("")){
					//String maxidsql = "select max(id) as id from HrmResource where loginid like '"+loginid+"%'";
					//rs.executeSql(maxidsql);
					//if(rs.next()){
						loginid = loginid+(id + 1);
						falg = true;
					//}
				}
		}	
		String sql = "select * from HrmResource where id = "+Util.getIntValue(id);
		rs.executeSql(sql);
		String olddepartmentid = "";
		String oldmanagerid = "";
		String oldsubcompanyid1 = "";
		String oldseclevel = "";
		String oldmanagerstr = "";
		while(rs.next()){
		olddepartmentid = rs.getString("departmentid");
		oldmanagerid = rs.getString("managerid");
		oldsubcompanyid1 = rs.getString("subcompanyid1");
		oldseclevel = rs.getString("seclevel");
		oldmanagerstr = rs.getString("managerstr");
    /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 begin***********/
    if(!oldmanagerstr.startsWith(","))oldmanagerstr=","+oldmanagerstr;
    if(!oldmanagerstr.endsWith(","))oldmanagerstr=oldmanagerstr+",";
    /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 end ***********/
		}
        para =""+id+separator+workcode+separator+lastname+separator+sex+separator+resourceimageid
          +separator+ departmentid+separator+ costcenterid+separator+jobtitle+separator+joblevel
          +separator+jobactivitydesc+separator+managerid+separator+assistantid+separator+status
          +separator+locationid+separator+workroom+separator+telephone+separator+mobile
          +separator+mobilecall+separator+fax+separator+jobcall+separator+systemlanguage
          +separator+accounttype+separator+belongto+separator+email+separator+dsporder+separator+mobileshowtype;
		String basicPara = para;
		RecordSetTrans rst=new RecordSetTrans();
		rst.setAutoCommit(false);
		try{

			rst.executeProc("HrmResourceBasicInfo_Update",para);
			rst.executeSql("update hrmresource set countryid=(select countryid from HrmLocations where id="+locationid+") where id="+id);
			if(falg){
				String logidsql = "update HrmResource set loginid = '"+loginid+"' where id = "+id;
				rst.executeSql(logidsql);
			}
			//String p_para = id + separator + departmentid + separator + oldsubcompanyid1 + separator + managerid + separator + oldseclevel + separator + oldmanagerstr + separator + olddepartmentid + separator + oldsubcompanyid1 + separator + oldmanagerid + separator + oldseclevel + separator + oldmanagerstr + separator + "1";

			//System.out.println(p_para);
			//rst.executeProc("HrmResourceShare", p_para);
			rst.commit();
		}catch(Exception e){
			rst.rollback();
			e.printStackTrace();
		}

        rs.executeProc("HrmResource_ModInfo",""+id+separator+userpara);
        String managerstr = "";
        if(!id.equals(managerid)){
	        sql = "select managerstr from HrmResource where id = "+Util.getIntValue(managerid);
	        rs.executeSql(sql);
	        while(rs.next()){
	          managerstr = rs.getString("managerstr");
	          /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 begin***********/
	          if(!managerstr.startsWith(","))managerstr=","+managerstr;
	          if(!managerstr.endsWith(","))managerstr=managerstr+",";
	          /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 end ***********/
		      managerstr =","+managerid+managerstr; 
		      managerstr =managerstr.endsWith(",")?managerstr:(managerstr+",");
	        }
        }else{
        	managerstr =","+managerid+",";
        }
        
        
		rst=new RecordSetTrans();
		rst.setAutoCommit(false);
		try{
			para = ""+id+separator+ managerstr;
			rst.executeProc("HrmResource_UpdateManagerStr",para);
			//String p_para = id + separator + departmentid + separator + oldsubcompanyid1 + separator + managerid + separator + oldseclevel + separator + managerstr + separator + departmentid + separator + oldsubcompanyid1 + separator + managerid + separator + oldseclevel + separator + oldmanagerstr + separator + "1";

			//System.out.println(p_para);
			//rst.executeProc("HrmResourceShare", p_para);
			rst.commit();
		}catch(Exception e){
			rst.rollback();
			e.printStackTrace();
		}

		String temOldmanagerstr=","+id +oldmanagerstr;
		temOldmanagerstr=temOldmanagerstr.endsWith(",")?temOldmanagerstr:(temOldmanagerstr+",");
        sql = "select id,departmentid,subcompanyid1,managerid,seclevel,managerstr from HrmResource where managerstr like '%"+temOldmanagerstr+ "'";
        rs.executeSql(sql);
        while(rs.next()){
			String nowmanagerstr = Util.null2String(rs.getString("managerstr"));
      /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 begin***********/
      if(!nowmanagerstr.startsWith(","))nowmanagerstr=","+nowmanagerstr;
      if(!nowmanagerstr.endsWith(","))nowmanagerstr=nowmanagerstr+",";
      /*********\u5904\u7406managerstr \u4e0d\u4ee5\u9017\u53f7\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u7684\u60c5\u51b5 \u5f62\u5982 managerstr\uff1a8 end ***********/
			String resourceid = rs.getString("id");
			//\u6307\u5b9a\u4e0a\u7ea7\u4e3a\u81ea\u8eab\u7684\u60c5\u51b5\uff0c\u4e0d\u66f4\u65b0\u81ea\u8eab\u4e0a\u7ea7
			if(id.equals(resourceid))
				continue;
			//String nowmanagerstr2 = Util.StringReplaceOnce(nowmanagerstr,oldmanagerstr ,managerstr);
			String nowmanagerstr2="";
			int index=nowmanagerstr.lastIndexOf(oldmanagerstr);
			if(index!=-1){
				if(!"".equals(managerstr)){
				       nowmanagerstr2=nowmanagerstr.substring(0,index)+("".equals(oldmanagerstr)?managerstr.substring(1):managerstr);
				}   
				else{
				   nowmanagerstr2=nowmanagerstr.substring(0,index)+("".equals(oldmanagerstr)?"":",");
				} 
				
			}
			String nowdepartmentid = rs.getString("departmentid");
			String nowsubcompanyid1 = rs.getString("subcompanyid1");
			String nowmanagerid = rs.getString("managerid");
			String nowseclevel = rs.getString("seclevel");
			rst=new RecordSetTrans();
			rst.setAutoCommit(false);
			try{
				para = resourceid + separator + nowmanagerstr2;
				rst.executeProc("HrmResource_UpdateManagerStr",para);
				//String p_para = resourceid + separator + nowdepartmentid + separator + nowsubcompanyid1 + separator + nowmanagerid + separator + nowseclevel + separator + nowmanagerstr2 + separator + nowdepartmentid + separator + nowsubcompanyid1 + separator + nowmanagerid + separator + nowseclevel + separator + nowmanagerstr + separator + "1";

				//System.out.println(p_para);
				//rst.executeProc("HrmResourceShare", p_para);
				rst.commit();
				ResourceComInfo.updateResourceInfoCache(resourceid); //\u66f4\u65b0\u7f13\u5b58
			}catch(Exception e){
				rst.rollback();
				e.printStackTrace();
			}

        }

        String subcmpanyid1 = DepartmentComInfo.getSubcompanyid1(departmentid);
        para = ""+id+separator+subcmpanyid1;
		rst=new RecordSetTrans();
		rst.setAutoCommit(false);
		try{
			 rst.executeProc("HrmResource_UpdateSubCom",para);

			//String p_para = id + separator + departmentid + separator + subcmpanyid1 + separator + managerid + separator + oldseclevel + separator + managerstr + separator + departmentid + separator + oldsubcompanyid1 + separator + managerid + separator + oldseclevel + separator + managerstr + separator + "1";

			//System.out.println(p_para);
			//rst.executeProc("HrmResourceShare", p_para);
			rst.commit();
		}catch(Exception e){
			rst.rollback();
			e.printStackTrace();
		}
		
		if(!oldmanagerid.equals(managerid)){//\u4fee\u6539\u4eba\u529b\u8d44\u6e90\u7ecf\u7406\uff0c\u5bf9\u5ba2\u6237\u548c\u65e5\u7a0b\u5171\u4eab\u91cd\u65b0\u8ba1\u7b97

		    CrmShareBase.setShareForNewManager(id);
		    //WorkPlanShareBase.setShareForNewManager(id);
		}

        para = ""+id;
        for(int i = 0;i<5;i++){
        	int idx = i;
        	if(formdefined) idx++;
	        String datefield = Util.null2String(fu.getParameter("datefield"+idx));
	        String numberfield = ""+Util.getDoubleValue(fu.getParameter("numberfield"+idx),0);
	        String textfield = Util.null2String(fu.getParameter("textfield"+idx));
	        String tinyintfield = ""+Util.getIntValue(fu.getParameter("tinyintfield"+idx),0);
	        para += separator+datefield + separator+numberfield+separator+textfield+separator+tinyintfield;
        }
        rs.executeProc("HrmResourceDefine_Update",para);


    if (RecordSetDB.getDBType().equals("db2")){
        //db2 trigger
        int seclevel = Util.getIntValue(fu.getParameter("seclevel"),0);
        String nowmanagerstr = Util.null2String(rs.getString("managerstr"));
        //rs.executeProc("Tri_U_HrmresourceShare",""+id+separator+departmentid+separator+subcmpanyid1+separator+seclevel+separator+nowmanagerstr);
    }

        /*
        CREATE procedure Tri_U_HrmresourceShare
        (
        in id integer ,
        in departmentid integer,
        in subcompanyid1 integer,
        in seclevel integer,
        in managerstr varchar(200)
        )
        */
		String oldloginid = "";
		rs.executeSql("select loginid from HrmResource where id = "+id);
		if(rs.next())
		{
			oldloginid = Util.null2String(rs.getString("loginid"));
			if(mode.equals("ldap")) {
				//loginid \u3001account\u5b57\u6bb5\u6574\u5408
				oldloginid= Util.null2String(rs.getString("loginid"));
				//oldloginid= Util.null2String(rs.getString("account"));
			}
		}
        //add by wjy
        //\u540c\u6b65RTX\u7aef\u7684\u7528\u6237\u4fe1\u606f.
	    /*\u53d6\u6d88\u539f\u540c\u6b65\u65b9\u5f0f\uff0c\u6539\u4e3a\u7528\u7ebf\u7a0b\u65b9\u5f0f
		boolean checkrtxuser = OrganisationCom.checkUser(Integer.parseInt(id));//\u68c0\u6d4b\u7528\u6237\u662f\u5426\u5b58\u5728

        if(checkrtxuser){   //\u5b58\u5728\u5c31\u7f16\u8f91\uff0c\u4e0d\u5b58\u5728\u5c31\u65b0\u589e
        	OrganisationCom.editUser(Integer.parseInt(id));//\u7f16\u8f91
        } else {
			if(Integer.parseInt(status)<4){  //\u5982\u679c\u8fd9\u4e2a\u4eba\u72b6\u6001\u4e0d\u662f 0\uff1a\u8bd5\u75281\uff1a\u6b63\u5f0f2\uff1a\u4e34\u65f63\uff1a\u8bd5\u7528\u5ef6\u671f\uff0c\u6216\u8005\u6ca1\u6709OA\u767b\u5f55\u540d,\u5219\u4e0d\u8fdb\u884c\u4eba\u5458\u540c\u6b65\u64cd\u4f5c
        		OrganisationCom.addUser(Integer.parseInt(id));//\u65b0\u589e
			}
        }
		*/
		new Thread(new OrganisationComRunnable("user","editbasicinfo",id+"-"+status)).start();
        // \u6539\u4e3a\u81ea\u8fdb\u884c\u4fee\u6b63

        ResourceComInfo.updateResourceInfoCache(id);

		//OA\u4e0e\u7b2c\u4e09\u65b9\u63a5\u53e3\u5355\u6761\u6570\u636e\u540c\u6b65\u65b9\u6cd5\u5f00\u59cb

		HrmServiceManager.SynInstantHrmResource(id,"2");  
		//OA\u4e0e\u7b2c\u4e09\u65b9\u63a5\u53e3\u5355\u6761\u6570\u636e\u540c\u6b65\u65b9\u6cd5\u7ed3\u675f

		//\u5904\u7406\u81ea\u5b9a\u4e49\u5b57\u6bb5 add by wjy
    CustomFieldTreeManager.editCustomData("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0), fu, Util.getIntValue(id,0));

	//\u5904\u7406\u6b21\u8d26\u53f7\u4fee\u6539\u4e3a\u4e3b\u8d26\u53f7\u65f6\uff0c\u68c0\u67e5\u6b21\u8d26\u53f7\u6240\u5c5e \u4e3b\u8d26\u53f7\u7684 \u5176\u4ed6\u8bbe\u7f6e\u662f\u5426\u9700\u8981\u4fee\u6539 add by kzw QC159888
		try{
		if(!oldbelongto.equals("")){
			HrmUserSettingComInfo userSetting = new HrmUserSettingComInfo();
			String belongtoshow = userSetting.getBelongtoshowByUserId(oldbelongto);
			if(belongtoshow.equals("1")){
				rs.executeSql("select id from hrmresource where belongto = "+oldbelongto);
				if(!rs.next()){
					String setId =userSetting.getId(oldbelongto);
					rs.executeSql("update HrmUserSetting set belongtoshow=0  where id="+setId);
					userSetting.removeHrmUserSettingComInfoCache();
				}
			}
		}
		}catch(Exception e){
			rs.writeLog(e.getMessage());
		}

		SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
        SysMaintenanceLog.setOperateItem("29");
        SysMaintenanceLog.setOperateUserid(user.getUID());
        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("2");
    	SysMaintenanceLog.setOperateDesc("HrmResourceBasicInfo_Update"+":"+basicPara);
    	SysMaintenanceLog.setSysLogInfo();

        CoreMailAPI coremailapi = CoreMailAPI.getInstance();
	    coremailapi.synUser(id);
	    //CoreMailTestAPI testapi = CoreMailTestAPI.getInstance();
	    //testapi.synUser(id);

        if(isView == 0){
        	if(isDialog.equals("1")){
        		if(urlFrom.equals("departmentList")){
        			response.sendRedirect("/hrm/company/HrmResourceBasicEdit.jsp?isclose=1&id="+id);
        		}
        		else{
        			response.sendRedirect("HrmResourceBasicInfo.jsp?isclose=1&id="+id);
        		}
        	}
        	else{
            response.sendRedirect("HrmResourceBasicInfo.jsp?id="+id);
        	}
        }else{
        	//response.sendRedirect("HrmResource.jsp?id="+id);
        	response.sendRedirect("HrmResourceBase.jsp?id="+id);
            
        }
        return;
    }

    if(operation.equalsIgnoreCase("editcontactinfo")){
        String id = Util.null2String(fu.getParameter("id"));
        if(user.getUID()!=Util.getIntValue(id)){//\u672c\u4eba\u624d\u80fd\u4fee\u6539
        	response.sendRedirect("/notice/noright.jsp") ;
	    		return;
				}
        String locationid = Util.fromScreen3(fu.getParameter("locationid"),user.getLanguage());
        String workroom = Util.fromScreen3(fu.getParameter("workroom"),user.getLanguage());
        String telephone = Util.fromScreen3(fu.getParameter("telephone"),user.getLanguage());
        String mobile = Util.fromScreen3(fu.getParameter("mobile"),user.getLanguage());
        String mobileshowtype = Util.fromScreen3(fu.getParameter("mobileshowtype"),user.getLanguage());
        String mobilecall = Util.fromScreen3(fu.getParameter("mobilecall"),user.getLanguage());
        String fax = Util.fromScreen3(fu.getParameter("fax"),user.getLanguage());
        String systemlanguage = Util.fromScreen3(fu.getParameter("systemlanguage"),user.getLanguage());
		String resourceimageid= Util.null2String(fu.uploadFiles("photoid"));
		String oldresourceimageid= Util.null2String(fu.getParameter("oldresourceimage"));
		if(resourceimageid.equals("")) resourceimageid=oldresourceimageid ;
        if(systemlanguage.equals("")||systemlanguage.equals("0")){
         systemlanguage = "7";
        }
        String email = Util.fromScreen3(fu.getParameter("email"),user.getLanguage());

        para =""+id    +separator+locationid+separator+workroom  +separator+
            telephone+separator+ mobile  +separator+mobilecall+separator+
            fax+separator+systemlanguage+separator+email+separator+ mobileshowtype;
        rs.executeProc("HrmResourceContactInfo_Update",para);
		//added by zfh 
		//\u589e\u52a0\u4e0a\u4f20\u5934\u50cf\u7684\u529f\u80fd

		String sql="update HrmResource set resourceimageid='"+resourceimageid+"' where id="+id;
		rs.execute(sql);
		Date dt=new Date();    
	    SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd"); 
		String logidsql = "update HrmResource set lastmodid = '"+user.getUID()+"' ,lastmoddate='"+sdf.format(dt)+"' where id = "+id;
		rs.executeSql(logidsql);
        //add by wjy
        //\u540c\u6b65RTX\u7aef\u7684\u7528\u6237\u4fe1\u606f.
		/*\u53d6\u6d88\u539f\u540c\u6b65\u65b9\u5f0f\uff0c\u6539\u4e3a\u7528\u7ebf\u7a0b\u65b9\u5f0f
        boolean checkrtxuser = OrganisationCom.checkUser(Integer.parseInt(id));//\u68c0\u6d4b\u7528\u6237\u662f\u5426\u5b58\u5728

        if(checkrtxuser){   //\u5b58\u5728\u5c31\u7f16\u8f91\uff0c\u4e0d\u5b58\u5728\u5c31\u65b0\u589e
        	OrganisationCom.editUser(Integer.parseInt(id));//\u7f16\u8f91
        } else {
        	OrganisationCom.addUser(Integer.parseInt(id));//\u65b0\u589e
        }
        */
		new Thread(new OrganisationComRunnable("user","editcontactinfo",id)).start();
        // \u6539\u4e3a\u81ea\u8fdb\u884c\u4fee\u6b63

        ResourceComInfo.updateResourceInfoCache(id);

		//OA\u4e0e\u7b2c\u4e09\u65b9\u63a5\u53e3\u5355\u6761\u6570\u636e\u540c\u6b65\u65b9\u6cd5\u5f00\u59cb

		HrmServiceManager.SynInstantHrmResource(id,"2");  
		//OA\u4e0e\u7b2c\u4e09\u65b9\u63a5\u53e3\u5355\u6761\u6570\u636e\u540c\u6b65\u65b9\u6cd5\u7ed3\u675f

      	SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
        SysMaintenanceLog.setOperateItem("29");
        SysMaintenanceLog.setOperateUserid(user.getUID());
        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("2");
    	SysMaintenanceLog.setOperateDesc("HrmResourceContactInfo_Update");
    	SysMaintenanceLog.setSysLogInfo();

        CoreMailAPI coremailapi = CoreMailAPI.getInstance();
	    coremailapi.synUser(id);
	    //CoreMailTestAPI testapi = CoreMailTestAPI.getInstance();
	    //testapi.synUser(id);

      if(isView == 0){
        response.sendRedirect("HrmResourceBasicInfo.jsp?id="+id);
      }else{
    	if(isfromtab){
    		response.sendRedirect("HrmResourceBase.jsp?id="+id);
    	}else{  
    		response.sendRedirect("HrmResourceBase.jsp?id="+id);
    	}
      }
      return;
    }

    if(operation.equalsIgnoreCase("editpersonalinfo")){
	    	if(!HrmUserVarify.checkUserRight("HrmResourceEdit:Edit",user)) {
	    		response.sendRedirect("/notice/noright.jsp") ;
	    		return ;
	    	}
        String id = Util.null2String(fu.getParameter("id"));
        String birthday = Util.fromScreen3(fu.getParameter("birthday"),user.getLanguage());
        String folk = Util.fromScreen3(fu.getParameter("folk"),user.getLanguage()) ;	 /*\u6c11\u65cf*/
        String nativeplace = Util.fromScreen3(fu.getParameter("nativeplace"),user.getLanguage()) ;	/*\u7c4d\u8d2f*/
        String regresidentplace = Util.fromScreen3(fu.getParameter("regresidentplace"),user.getLanguage()) ;	/*\u6237\u53e3\u6240\u5728\u5730*/
        String maritalstatus = Util.fromScreen3(fu.getParameter("maritalstatus"),user.getLanguage());
        String policy = Util.fromScreen3(fu.getParameter("policy"),user.getLanguage()) ; /*\u653f\u6cbb\u9762\u8c8c*/
        String bememberdate = Util.fromScreen3(fu.getParameter("bememberdate"),user.getLanguage()) ;	/*\u5165\u56e2\u65e5\u671f*/
        String bepartydate = Util.fromScreen3(fu.getParameter("bepartydate"),user.getLanguage()) ;	/*\u5165\u515a\u65e5\u671f*/
        String islabourunion = Util.fromScreen3(fu.getParameter("islabouunion"),user.getLanguage()) ;
        String educationlevel = Util.fromScreen3(fu.getParameter("educationlevel"),user.getLanguage()) ;/*\u5b66\u5386*/
        String degree = Util.fromScreen3(fu.getParameter("degree"),user.getLanguage()) ; /*\u5b66\u4f4d*/
        String healthinfo = Util.fromScreen3(fu.getParameter("healthinfo"),user.getLanguage()) ;/*\u5065\u5eb7\u72b6\u51b5*/
        String height = Util.null2o(fu.getParameter("height")) ;/*\u8eab\u9ad8*/
        String weight = Util.null2o(fu.getParameter("weight")) ;
        String residentplace = Util.fromScreen3(fu.getParameter("residentplace"),user.getLanguage()) ;	/*\u73b0\u5c45\u4f4f\u5730*/
        String homeaddress = Util.fromScreen3(fu.getParameter("homeaddress"),user.getLanguage()) ;
        String tempresidentnumber = Util.fromScreen3(fu.getParameter("tempresidentnumber"),user.getLanguage()) ;
        String certificatenum = Util.fromScreen3(fu.getParameter("certificatenum"),user.getLanguage()) ;/*\u8bc1\u4ef6\u53f7\u7801*/
        int iscreate = Util.getIntValue(fu.getParameter("iscreate"),0);    
	HrmFieldManager hfm = new HrmFieldManager("HrmCustomFieldByInfoType",Util.getIntValue(fu.getParameter("scopeid"),0));
	String sql = "select * from HrmResource where id="+id;
	rs.executeSql(sql);
	if(rs.next()){
	    if(!hfm.isUse("birthday"))birthday = rs.getString("birthday");
		if(!hfm.isUse("folk"))folk = rs.getString("folk");
		if(!hfm.isUse("nativeplace"))nativeplace = rs.getString("nativeplace");
		if(!hfm.isUse("regresidentplace"))regresidentplace = rs.getString("regresidentplace");
		if(!hfm.isUse("maritalstatus"))maritalstatus = rs.getString("maritalstatus");
		if(!hfm.isUse("policy"))policy = rs.getString("policy");
		if(!hfm.isUse("bememberdate"))bememberdate = rs.getString("bememberdate");
		if(!hfm.isUse("bepartydate"))bepartydate = rs.getString("bepartydate");
		if(!hfm.isUse("islabouunion"))islabourunion = rs.getString("islabourunion");
		if(!hfm.isUse("educationlevel"))educationlevel = rs.getString("educationlevel");
		if(!hfm.isUse("degree"))degree = rs.getString("degree");
		if(!hfm.isUse("healthinfo"))healthinfo = rs.getString("healthinfo");
		if(!hfm.isUse("height"))height = rs.getString("height");
		if(!hfm.isUse("weight"))weight = rs.getString("weight");
		if(!hfm.isUse("residentplace"))residentplace = rs.getString("residentplace");
		if(!hfm.isUse("homeaddress"))homeaddress = rs.getString("homeaddress");
		if(!hfm.isUse("tempresidentnumber"))tempresidentnumber = rs.getString("tempresidentnumber");
		if(!hfm.isUse("certificatenum"))certificatenum = rs.getString("certificatenum");
	}
        certificatenum = certificatenum.trim();
        String tempcertificatenum = certificatenum;
        int msg=0;
        if(!certificatenum.equals("")){
			rs.executeSql("select accounttype,certificatenum from HrmResource where id="+id);
			String accountType = "", tempCertificatenum = "";
			if(rs.next()){
				accountType = Util.null2String(rs.getString("accounttype"));
				tempCertificatenum = Util.null2String(rs.getString("certificatenum"));
			}
			if(!accountType.equals("1")) {
				rs.executeSql("select id from HrmResource where id<>"+id+" and certificatenum='"+certificatenum+"' and accounttype != '1'");
				if(rs.next()){
					msg=1;
					tempcertificatenum = tempCertificatenum;
				}
			}			
        }
        para = ""+id+	separator+birthday+separator+folk+separator+nativeplace+separator+regresidentplace+separator+
             maritalstatus+	separator+policy+separator+bememberdate+separator+bepartydate+separator+islabourunion+
             separator+educationlevel+separator+degree+separator+healthinfo+separator+height+separator+weight+
             separator+residentplace+separator+homeaddress+separator+tempresidentnumber+separator+tempcertificatenum;

        rs.executeProc("HrmResourcePersonalInfo_Insert",para);
        rs.executeProc("HrmResource_ModInfo",""+id+separator+userpara);

        int rownum = Util.getIntValue(fu.getParameter("rownum"),user.getLanguage()) ;
        rs.executeProc("HrmFamilyInfo_Delete",""+id);
        for(int i = 0;i<rownum;i++){
            String member = Util.fromScreen3(fu.getParameter("member_"+i),user.getLanguage());
            String title = Util.fromScreen3(fu.getParameter("title_"+i),user.getLanguage());
            String company = Util.fromScreen3(fu.getParameter("company_"+i),user.getLanguage());
            String jobtitle = Util.fromScreen3(fu.getParameter("jobtitle_"+i),user.getLanguage());
            String address = Util.fromScreen3(fu.getParameter("address_"+i),user.getLanguage());
            String info = member+title+company+jobtitle+address;
            if(!info.trim().equals("")){
                para = ""+id+separator+member+separator+title+separator+company+separator+jobtitle+separator+address;

                rs.executeProc("HrmFamilyInfo_Insert",para);
            }
        }

        //\u5904\u7406\u81ea\u5b9a\u4e49\u5b57\u6bb5 add by wjy
        CustomFieldTreeManager.editCustomData("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0), fu, Util.getIntValue(id,0));
        CustomFieldTreeManager.editMutiCustomData("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0), fu, Util.getIntValue(id,0));

        // \u4e2a\u4eba\u4fe1\u606f\u4e0d\u9700\u8981\u6e05\u7406\u4eba\u529b\u8d44\u6e90\u7f13\u5b58 ResourceComInfo.removeResourceCache();

      	SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
        SysMaintenanceLog.setOperateItem("29");
        SysMaintenanceLog.setOperateUserid(user.getUID());
        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("2");
    	SysMaintenanceLog.setOperateDesc("HrmResourcePersonalInfo_Insert");
    	SysMaintenanceLog.setSysLogInfo();
        if(msg==1)
            response.sendRedirect("HrmResourcePersonalEdit.jsp?id="+id+"&isView="+isView+"&msg=1&iscreate="+iscreate+"&certificatenum="+certificatenum);
        else if(iscreate==1)
            response.sendRedirect("HrmResourceAddThree.jsp?id="+id);
        else
            response.sendRedirect("HrmResourcePersonalView.jsp?isfromtab="+isfromtab+"&id="+id+"&isView="+isView);
        return;
    }

    if(operation.equalsIgnoreCase("editwork")){
	    	if(!HrmUserVarify.checkUserRight("HrmResourceEdit:Edit",user)) {
	    		response.sendRedirect("/notice/noright.jsp") ;
	    		return ;
	    	}
        String id = Util.null2String(fu.getParameter("id"));
		//System.out.println("id:"+id);
        String name = "";
        String sql = "select lastname from HrmResource where id ="+id;
        rs.executeSql(sql);
        while(rs.next()){
            name = rs.getString("lastname");
        }

        String usekind = Util.fromScreen3(fu.getParameter("usekind"),user.getLanguage()) ;
        String startdate = Util.fromScreen3(fu.getParameter("startdate"),user.getLanguage()) ;
        String probationenddate = Util.fromScreen3(fu.getParameter("probationenddate"),user.getLanguage()) ;
        String enddate = Util.fromScreen3(fu.getParameter("enddate"),user.getLanguage()) ;

        HrmFieldManager hfm = new HrmFieldManager("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0));
        sql = "select * from HrmResource where id="+id;
        rs.executeSql(sql);
        if(rs.next()){
            if(!hfm.isUse("usekind"))usekind = rs.getString("usekind");
	    if(!hfm.isUse("startdate"))startdate = rs.getString("startdate");
	    if(!hfm.isUse("probationenddate"))probationenddate = rs.getString("probationenddate");
	    if(!hfm.isUse("enddate"))enddate = rs.getString("enddate");
	}

        para = ""+id+	separator+usekind+separator+startdate+separator+probationenddate+separator+ enddate;
        rs.executeProc("HrmResourceWorkInfo_Insert",para);
        rs.executeProc("HrmResource_ModInfo",""+id+separator+userpara);
        
		String contracttypeid = "";
		String ishirecontract = "";
		String contractid = "";
		String sqltype = "select * from hrmcontract where exists (select * from HrmContractType where hrmcontract.contracttypeid=HrmContractType.id and HrmContractType.ishirecontract=1) and contractman="+id+" order by contractenddate desc,contractstartdate desc";
		rs.executeSql(sqltype);
		if(rs.next()){
			contracttypeid = rs.getString("contracttypeid");
			contractid = rs.getString("id");
   		//\u6839\u636eqc212896 \u4eba\u4e8b\u5361\u7247\u5408\u540c\u65e5\u671f\u4fee\u6539\u7684\u65f6\u5019 \u540c\u6b65\u66f4\u65b0\u5408\u540c\u7c7b\u578b\u4e3a\u5165\u804c\u5408\u540c\u4e2d \u6700\u65b0\u7684\u4e00\u4e2a\u5408\u540c\u7684\u65e5\u671f 
			sqltype = "update HrmContract set contractstartdate = '"+startdate+"',contractenddate = '"+enddate+"',proenddate = '"+probationenddate+"' where id = "+contractid; 
			rs.execute(sqltype);
		}
		
        sql = "delete from HrmLanguageAbility where resourceid = "+id;
        rs.executeSql(sql);
        int lanrownum = Util.getIntValue(fu.getParameter("lanrownum"),0);
        for(int i = 0;i<lanrownum;i++){
            String language = Util.fromScreen3(fu.getParameter("language_"+i),user.getLanguage()) ;
            String level = Util.fromScreen3(fu.getParameter("level_"+i),user.getLanguage()) ;
            String memo = Util.fromScreen3(fu.getParameter("memo_"+i),user.getLanguage()) ;
            String info = language+memo;
            if(!info.trim().equals("")){
                para = ""+id+separator+language+separator+level+separator+memo;
                rs.executeProc("HrmLanguageAbility_Insert",para);
            }
        }

        sql = "delete from HrmEducationInfo where resourceid = "+id;
        rs.executeSql(sql);
        int edurownum = Util.getIntValue(fu.getParameter("edurownum"),0);
        for(int i = 0;i<edurownum;i++){
            String school = Util.fromScreen3(fu.getParameter("school_"+i),user.getLanguage()) ;
            String speciality = Util.fromScreen3(fu.getParameter("speciality_"+i),user.getLanguage()) ;
            String edustartdate = Util.fromScreen3(fu.getParameter("edustartdate_"+i),user.getLanguage()) ;
            String eduenddate = Util.fromScreen3(fu.getParameter("eduenddate_"+i),user.getLanguage()) ;
            String educationlevel = Util.fromScreen3(fu.getParameter("educationlevel_"+i),user.getLanguage()) ;
            String studydesc = Util.fromScreen3(fu.getParameter("studydesc_"+i),user.getLanguage()) ;
            String info = school+speciality+edustartdate+eduenddate+studydesc;
            if(!info.trim().equals("")){
                para = ""+id+separator+edustartdate+separator+eduenddate+separator+school+separator+speciality+
                        separator+educationlevel+separator+studydesc;
                rs.executeProc("HrmEducationInfo_Insert",para);
            }
        }

        int workrownum = Util.getIntValue(fu.getParameter("workrownum"));
        sql = "delete from HrmWorkResume where resourceid = "+id;
        rs.executeSql(sql);
        for(int i = 0;i<workrownum;i++){
            String company = Util.fromScreen3(fu.getParameter("company_"+i),user.getLanguage()) ;
            String workstartdate = Util.fromScreen3(fu.getParameter("workstartdate_"+i),user.getLanguage()) ;
            String workenddate = Util.fromScreen3(fu.getParameter("workenddate_"+i),user.getLanguage()) ;
            String jobtitle = Util.fromScreen3(fu.getParameter("jobtitle_"+i),user.getLanguage()) ;
            String workdesc = Util.fromScreen3(fu.getParameter("workdesc_"+i),user.getLanguage()) ;
            String leavereason = Util.fromScreen3(fu.getParameter("leavereason_"+i),user.getLanguage()) ;
            String info = company+workstartdate+workenddate+jobtitle+workdesc+leavereason;
            if(!info.trim().equals("")){
                para = ""+id+separator+workstartdate+separator+workenddate+separator+company+separator+jobtitle+
                        separator+workdesc+separator+leavereason;
                rs.executeProc("HrmWorkResume_Insert",para);
            }
        }

        int trainrownum = Util.getIntValue(fu.getParameter("trainrownum"),0);
        sql = "delete from HrmTrainBeforeWork where resourceid = "+id;
        rs.executeSql(sql);
        for(int i = 0;i<trainrownum;i++){
            String trainname = Util.fromScreen3(fu.getParameter("trainname_"+i),user.getLanguage()) ;
            String trainstartdate = Util.fromScreen3(fu.getParameter("trainstartdate_"+i),user.getLanguage()) ;
            String trainenddate = Util.fromScreen3(fu.getParameter("trainenddate_"+i),user.getLanguage()) ;
            String trainresource = Util.fromScreen3(fu.getParameter("trainresource_"+i),user.getLanguage()) ;
            String trainmemo = Util.fromScreen3(fu.getParameter("trainmemo_"+i),user.getLanguage()) ;
            String info = trainname+trainstartdate+trainenddate+trainresource+trainmemo;
            if(!info.trim().equals("")){
                para = ""+id+separator+trainname+separator+trainresource+separator+trainstartdate+separator+trainenddate+
                        separator+trainmemo;
                rs.executeProc("HrmTrainBeforeWork_Insert",para);
            }
        }

        int cerrownum = Util.getIntValue(fu.getParameter("cerrownum"),0);

        sql = "delete from HrmCertification where resourceid = "+id;
        rs.executeSql(sql);
        for(int i = 0;i<cerrownum;i++){
            String cername = Util.fromScreen3(fu.getParameter("cername_"+i),user.getLanguage()) ;
            String cerstartdate = Util.fromScreen3(fu.getParameter("cerstartdate_"+i),user.getLanguage()) ;
            String cerenddate = Util.fromScreen3(fu.getParameter("cerenddate_"+i),user.getLanguage()) ;
            String cerresource = Util.fromScreen3(fu.getParameter("cerresource_"+i),user.getLanguage()) ;

            String info = cername+cerstartdate+cerenddate+cerresource;
            if(!info.trim().equals("")){
                para = ""+id+separator+cerstartdate+separator+cerenddate +separator+cername+separator+cerresource;

                rs.executeProc("HrmCertification_Insert",para);
            }
        }

        int rewardrownum = Util.getIntValue(fu.getParameter("rewardrownum"),0);
        sql = "delete from HrmRewardBeforeWork where resourceid = "+id;
        rs.executeSql(sql);
        for(int i = 0;i<rewardrownum;i++){
            String rewardname = Util.fromScreen3(fu.getParameter("rewardname_"+i),user.getLanguage()) ;
            String rewarddate = Util.fromScreen3(fu.getParameter("rewarddate_"+i),user.getLanguage()) ;
            String rewardmemo = Util.fromScreen3(fu.getParameter("rewardmemo_"+i),user.getLanguage()) ;
            String info = rewardname+rewarddate+rewardmemo;
            if(!info.trim().equals("")){
                para = ""+id+separator+rewardname+separator+rewarddate+separator+rewardmemo;
                rs.executeProc("HrmRewardBeforeWork_Insert",para);
            }
        }

        // \u5de5\u4f5c\u4fe1\u606f\u4e0d\u9700\u8981\u6e05\u7406\u7f13\u5b58 ResourceComInfo.removeResourceCache();

        //\u5904\u7406\u81ea\u5b9a\u4e49\u5b57\u6bb5 add by wjy
        CustomFieldTreeManager.editCustomData("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0), fu, Util.getIntValue(id,0));
        CustomFieldTreeManager.editMutiCustomData("HrmCustomFieldByInfoType", Util.getIntValue(fu.getParameter("scopeid"),0), fu, Util.getIntValue(id,0));

     	SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
        SysMaintenanceLog.setOperateItem("29");
        SysMaintenanceLog.setOperateUserid(user.getUID());
        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("2");
    	SysMaintenanceLog.setOperateDesc("HrmResourceWorkInfo_Insert");
    	SysMaintenanceLog.setSysLogInfo();
		
        response.sendRedirect("HrmResourceWorkView.jsp?isfromtab="+isfromtab+"&id="+id+"&isView="+isView);
        return;
    }

    if(operation.equalsIgnoreCase("finish")) {
        String id = Util.null2String(fu.getParameter("id")) ;
        String Sql=("select lastname from HrmResource where id="+id);
        RecordSet.executeSql(Sql);
        RecordSet.next();
        String CurrentUser = ""+user.getUID();
        String logintype = user.getLogintype();     //\u5f53\u524d\u7528\u6237\u7c7b\u578b  1: \u7c7b\u522b\u7528\u6237  2:\u5916\u90e8\u7528\u6237
        //\u5224\u65ad\u767b\u9646\u8005\uff0d\uff0d\uff0d\uff0d//
        String sql_10="select hrmid from HrmInfoMaintenance where id =10 ";
        RecordSet.executeSql(sql_10);
        RecordSet.next();
        String hrmid_10= RecordSet.getString("hrmid");
        boolean canedit_10=false;
        if(CurrentUser.equals(hrmid_10)){
            canedit_10=true;
        }
        String sql_1="select hrmid from HrmInfoMaintenance where id =1 ";
        RecordSet.executeSql(sql_1);
        RecordSet.next();
        String hrmid_1= RecordSet.getString("hrmid");
        boolean canedit_1=false;
        if(CurrentUser.equals(hrmid_1)){
            canedit_1=true;
        }
        String sql_2="select hrmid from HrmInfoMaintenance where id =2 ";
        RecordSet.executeSql(sql_2);
        RecordSet.next();
        String hrmid_2= RecordSet.getString("hrmid");
        boolean canedit_2=false;
        if(CurrentUser.equals(hrmid_2)){
            canedit_2=true;
        }
        String sql_3="select hrmid from HrmInfoMaintenance where id =3 ";
        RecordSet.executeSql(sql_3);
        RecordSet.next();
        String hrmid_3= RecordSet.getString("hrmid");
        boolean canedit_3=false;
        if(CurrentUser.equals(hrmid_3)){
            canedit_3=true;
        }
        String sql_4="select hrmid from HrmInfoMaintenance where id =4 ";
        RecordSet.executeSql(sql_4);
        RecordSet.next();
        String hrmid_4= RecordSet.getString("hrmid");
        boolean canedit_4=false;
        if(CurrentUser.equals(hrmid_4)){
            canedit_4=true;
        }
        String sql_5="select hrmid from HrmInfoMaintenance where id =5 ";
        RecordSet.executeSql(sql_5);
        RecordSet.next();
        String hrmid_5= RecordSet.getString("hrmid");
        boolean canedit_5=false;
        if(CurrentUser.equals(hrmid_5)){
            canedit_5=true;
        }
        String sql_6="select hrmid from HrmInfoMaintenance where id =6 ";
        RecordSet.executeSql(sql_6);
        RecordSet.next();
        String hrmid_6= RecordSet.getString("hrmid");
        boolean canedit_6=false;
        if(CurrentUser.equals(hrmid_6)){
            canedit_6=true;
        }
        String sql_7="select hrmid from HrmInfoMaintenance where id =7 ";
        RecordSet.executeSql(sql_7);
        RecordSet.next();
        String hrmid_7= RecordSet.getString("hrmid");
        boolean canedit_7=false;
        if(CurrentUser.equals(hrmid_7)){
            canedit_7=true;
        }
        String sql_8="select hrmid from HrmInfoMaintenance where id =8 ";
        RecordSet.executeSql(sql_8);
        RecordSet.next();
        String hrmid_8= RecordSet.getString("hrmid");
        boolean canedit_8=false;
        if(CurrentUser.equals(hrmid_8)){
            canedit_8=true;
        }
        String sql_9="select hrmid from HrmInfoMaintenance where id =9 ";
        RecordSet.executeSql(sql_9);
        RecordSet.next();
        String hrmid_9= RecordSet.getString("hrmid");
        boolean canedit_9=false;
        if(CurrentUser.equals(hrmid_9)){
            canedit_9=true;
        }
        if((HrmUserVarify.checkUserRight("HrmResourceAdd:Add",user))||canedit_1||canedit_2||canedit_3||canedit_4||canedit_5||canedit_6||canedit_7||canedit_8||canedit_9||canedit_10){//\u6743\u9650\u5224\u65ad

        }else{//\u6ca1\u6709\u6743\u9650
        	response.sendRedirect("/hrm/employee/EmployeeManage.jsp?hrmid="+id);
          return;
        }
        rs.executeProc("HrmInfoStatus_Finish",id);

        SysMaintenanceLog.resetParameter();
    	SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
    	SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
        SysMaintenanceLog.setOperateItem("29");
        SysMaintenanceLog.setOperateUserid(user.getUID());
        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
    	SysMaintenanceLog.setOperateType("2");
    	SysMaintenanceLog.setOperateDesc("HrmInfoStatus_Finish");
    	SysMaintenanceLog.setSysLogInfo();

        response.sendRedirect("/hrm/employee/EmployeeManage.jsp?hrmid="+id);
        return;
    }

    if(operation.equalsIgnoreCase("info")) {
        String id = Util.null2String(fu.getParameter("id"));
        String probationenddate = Util.fromScreen3(fu.getParameter("probationenddate"),user.getLanguage()) ;
        String enddate = Util.fromScreen3(fu.getParameter("enddate"),user.getLanguage()) ;
        String name = ResourceComInfo.getResourcename(id);
        String infoman = HrmDateCheck.getHrmId(id);

        String accepter="";
        String title="";
        String remark="";
        String submiter="";
        String subject="";

        if(!HrmDateCheck.hasContract(id)){
          if(Util.dayDiff(today,enddate)==3){
              ArrayList al = Util.TokenizerString(infoman,",");
              for(int i = 0; i<al.size();i++){
                accepter = (String)al.get(i);
                subject= SystemEnv.getHtmlLabelName(15783,user.getLanguage()) ;
                subject += ":"+name;
                title = SystemEnv.getHtmlLabelName(15783,user.getLanguage());
                title += ":System Remind ";
    //          title += "-"+ResourceComInfo.getResourcename(accepter);
                title += "-"+name;
                title += "-"+today;
                remark="<a href=/hrm/resource/HrmResource.jsp?id="+id+">"+Util.fromScreen2(subject,7)+"</a>";
                submiter="0";
                SysRemindWorkflow.setPrjSysRemind(title,0,Util.getIntValue(submiter),accepter,remark);
              }
            }
            if(Util.dayDiff(today,probationenddate)==3){
              ArrayList al = Util.TokenizerString(infoman,",");
              for(int i = 0; i<al.size();i++){
                accepter = (String)al.get(i);
                subject= SystemEnv.getHtmlLabelName(15784,user.getLanguage()) ;
                subject += ":"+name;
                title = SystemEnv.getHtmlLabelName(15784,user.getLanguage()) ;
                title += ":System Remind ";
    //          title += "-"+ResourceComInfo.getResourcename(accepter);
                title += "-"+name;
                title += "-"+today;
                remark="<a href=/hrm/resource/HrmResource.jsp?id="+id+">"+Util.fromScreen2(subject,7)+"</a>";
                submiter="0";
                SysRemindWorkflow.setPrjSysRemind(title,0,Util.getIntValue(submiter),accepter,remark);
            }
        }
      }
      response.sendRedirect("/hrm/resource/HrmResource.jsp?id="+id);
    }

    if(operation.equalsIgnoreCase("delete")) {
    		
        String id = Util.null2String(fu.getParameter("id"));
        /*
        String sql = "update HrmResource set status = 10 where id = "+id;
        rs.executeSql(sql);

        //add by wjy
        //\u540c\u6b65RTX\u7aef\u7684\u7528\u6237\u4fe1\u606f.
        //OrganisationCom.checkUser(Integer.parseInt(id));

        // \u6539\u4e3a\u81ea\u8fdb\u884c\u4fee\u6b63

        ResourceComInfo.deleteResourceInfoCache(id);

        SysMaintenanceLog.resetParameter();
        SysMaintenanceLog.setRelatedId(Util.getIntValue(id));
        SysMaintenanceLog.setRelatedName(ResourceComInfo.getResourcename(id));
        SysMaintenanceLog.setOperateItem("29");
        SysMaintenanceLog.setOperateUserid(user.getUID());
        SysMaintenanceLog.setClientAddress(request.getRemoteAddr());
        SysMaintenanceLog.setOperateType("3");
        SysMaintenanceLog.setOperateDesc("HrmResource_Delete");
        SysMaintenanceLog.setSysLogInfo();
				*/
        response.sendRedirect("/hrm/resource/HrmResource.jsp?id="+id);
    }
    
    //\u4eba\u5458\u9501\u5b9a
    if(operation.equalsIgnoreCase("lock")) {
    	/*String[] resourceids=Util.null2o(fu.getParameter("resourceids")).split(",");
    	String createdate=TimeUtil.getCurrentDateString();
    	String createtime=TimeUtil.getOnlyCurrentTimeString();
    	for(int i=0;i<resourceids.length;i++){
    		String resourceid=resourceids[i];
    		if(!resourceid.equals("")){
    		   String sql="select id from HrmResource_lock where userid="+resourceid;
    		   rs.execute(sql);
    		   if(!rs.next()){
    			   sql="insert into HrmResource_lock(userid,createdate,createtime) values("+resourceid+",'"+createdate+"','"+createtime+"')";
    			   rs.execute(sql);
    		   }
    		}
    	}*/
    	response.sendRedirect("/hrm/resource/HrmResourceLock.jsp");
    }else if(operation.equalsIgnoreCase("unlock")||operation.equalsIgnoreCase("unlocksearch")){
    	/*
    	if(operation.equalsIgnoreCase("unlock")){
	    	String[] ids=fu.getParameters("lockid");
	    	for(int i=0;i<ids.length;i++){
	    		String resourceid=ids[i];
	    		if(!resourceid.equals("")){
	    		   String sql="delete from HrmResource_lock where id="+ids[i];
	    		   rs.execute(sql);
	    		}
	    	}
    	}
    	String name=Util.null2String(fu.getParameter("name"));
    	String departmentids=Util.null2String(fu.getParameter("departmentids"));
    	//System.out.println("name1================="+name);
    	request.setAttribute("name",name);
    	request.setAttribute("departmentids",departmentids);*/
    	response.sendRedirect("/hrm/resource/HrmResourceUnlock.jsp");
    }


      out.write(_jsp_string54, 0, _jsp_string54.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("hrm/resource/HrmResourceOperation.jsp"), -2826739592670833384L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("systeminfo/init_wev8.jsp"), 8775654873609053482L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("wui/common/page/initWui.jsp"), 3390533274175540290L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string21;
  private final static char []_jsp_string67;
  private final static char []_jsp_string22;
  private final static char []_jsp_string64;
  private final static char []_jsp_string9;
  private final static char []_jsp_string0;
  private final static char []_jsp_string33;
  private final static char []_jsp_string49;
  private final static char []_jsp_string39;
  private final static char []_jsp_string44;
  private final static char []_jsp_string55;
  private final static char []_jsp_string20;
  private final static char []_jsp_string17;
  private final static char []_jsp_string19;
  private final static char []_jsp_string13;
  private final static char []_jsp_string73;
  private final static char []_jsp_string57;
  private final static char []_jsp_string18;
  private final static char []_jsp_string71;
  private final static char []_jsp_string62;
  private final static char []_jsp_string45;
  private final static char []_jsp_string7;
  private final static char []_jsp_string47;
  private final static char []_jsp_string68;
  private final static char []_jsp_string6;
  private final static char []_jsp_string52;
  private final static char []_jsp_string15;
  private final static char []_jsp_string28;
  private final static char []_jsp_string58;
  private final static char []_jsp_string65;
  private final static char []_jsp_string35;
  private final static char []_jsp_string12;
  private final static char []_jsp_string66;
  private final static char []_jsp_string26;
  private final static char []_jsp_string10;
  private final static char []_jsp_string43;
  private final static char []_jsp_string8;
  private final static char []_jsp_string34;
  private final static char []_jsp_string46;
  private final static char []_jsp_string31;
  private final static char []_jsp_string1;
  private final static char []_jsp_string4;
  private final static char []_jsp_string72;
  private final static char []_jsp_string32;
  private final static char []_jsp_string37;
  private final static char []_jsp_string27;
  private final static char []_jsp_string53;
  private final static char []_jsp_string48;
  private final static char []_jsp_string56;
  private final static char []_jsp_string38;
  private final static char []_jsp_string16;
  private final static char []_jsp_string59;
  private final static char []_jsp_string63;
  private final static char []_jsp_string42;
  private final static char []_jsp_string2;
  private final static char []_jsp_string14;
  private final static char []_jsp_string36;
  private final static char []_jsp_string5;
  private final static char []_jsp_string51;
  private final static char []_jsp_string24;
  private final static char []_jsp_string70;
  private final static char []_jsp_string54;
  private final static char []_jsp_string11;
  private final static char []_jsp_string50;
  private final static char []_jsp_string69;
  private final static char []_jsp_string41;
  private final static char []_jsp_string23;
  private final static char []_jsp_string30;
  private final static char []_jsp_string61;
  private final static char []_jsp_string60;
  private final static char []_jsp_string29;
  private final static char []_jsp_string25;
  private final static char []_jsp_string40;
  private final static char []_jsp_string3;
  static {
    _jsp_string21 = "&f_weaver_belongto_usertype=".toCharArray();
    _jsp_string67 = "\r\n	".toCharArray();
    _jsp_string22 = "\";\r\n	    xmlhttp.open(\"GET\",URL, false);\r\n	    xmlhttp.send(null);\r\n	    var result = xmlhttp.status;\r\n	    if(result==200) {\r\n		    isconn = true;\r\n	    	var response_flag = xmlhttp.responseText;\r\n	    	if(response_flag!='0') {\r\n	    		var flag_msg = '';\r\n	    		if(response_flag=='1') {\r\n	    			var diag = new Dialog();\r\n					diag.Width = 300;\r\n					diag.Height = 180;\r\n					diag.ShowCloseButton=false;\r\n					diag.Title = \"".toCharArray();
    _jsp_string64 = "\";\r\n//\u5f53\u524d\u4e3b\u9898\u4f7f\u7528\u7684\u76ae\u80a4\r\nvar GLOBAL_SKINS_FOLDER = \"".toCharArray();
    _jsp_string9 = "\r\n<script type=\"text/javascript\" src=\"/js/select/script/jquery-1.8.3.min_wev8.js\"></script>	    \r\n".toCharArray();
    _jsp_string0 = "   \r\n   \r\n    \r\n	\r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n	\r\n	\r\n   \r\n\r\n	\r\n\r\n\r\n    ".toCharArray();
    _jsp_string33 = "\", function () {\r\n						    formElementFocus(tempElement);						\r\n							});\r\n						}\r\n						return false;\r\n					}else{\r\n						if(window.__oriAlert__){\r\n							try{\r\n								window.top.Dialog.alert(\"".toCharArray();
    _jsp_string49 = "\";\r\ndoCheckusb();\r\n</script>\r\n".toCharArray();
    _jsp_string39 = "\");\r\n						}else{\r\n							window.top.Dialog.alert(\"".toCharArray();
    _jsp_string44 = "\";\r\n\r\n  if(companyname.length >0 ){\r\n  	window.status = str1+companyname;\r\n  }\r\n</script>\r\n<!-- \u5220\u9664 -->\r\n</head></html>\r\n\r\n<!--USB \u9a8c\u8bc1 -->\r\n".toCharArray();
    _jsp_string55 = "\r\n<!--For wui-->\r\n<link type='text/css' rel='stylesheet'  href='/wui/theme/".toCharArray();
    _jsp_string20 = "&time=\"+new Date()+\"&f_weaver_belongto_userid=".toCharArray();
    _jsp_string17 = "');\r\n}\r\n\r\nfunction _onViewLog(operateitem,sqlwhere,id){\r\n	if(!sqlwhere)sqlwhere = \"\";\r\n	var dialog = new window.top.Dialog();\r\n	dialog.currentWindow = window;\r\n	dialog.Title = \"".toCharArray();
    _jsp_string19 = "\";\r\n		}\r\n	}\r\n	dialog.Width = jQuery(window).width();\r\n	dialog.Height = 610;\r\n	dialog.Drag = true;\r\n	dialog.checkDataChange = false;\r\n	dialog.maxiumnable = true;\r\n	dialog.URL = url;\r\n	dialog.show();\r\n}\r\n\r\n\r\nfunction check_form(thiswins,items)\r\n{\r\n	/* added by cyril on 2008-08-14 for td:8521 */\r\n	var isconn = false;\r\n	try {\r\n		var xmlhttp;\r\n	    if (window.XMLHttpRequest) {\r\n	    	xmlhttp = new XMLHttpRequest();\r\n	    }  \r\n	    else if (window.ActiveXObject) {\r\n	    	xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\");  \r\n	    }\r\n	    var URL = \"/systeminfo/CheckConn.jsp?userid=".toCharArray();
    _jsp_string13 = "\r\n<!-- js \u6574\u5408\u5230 init_wev8.js -->\r\n<script type=\"text/javascript\" src=\"/js/jquery.table_wev8.js\"></script>\r\n<script language=\"javascript\" type=\"text/javascript\" src=\"/js/init_wev8.js\"></script>\r\n<script language=\"javascript\"  src=\"/js/wbusb_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/jquery/plugins/client/jquery.client_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/ecology8/jNice/jNice/jquery.jNice_wev8.js\"></script>\r\n<script type='text/javascript' src='/js/jquery-autocomplete/jquery.autocomplete_wev8.js'></script>\r\n<script type='text/javascript' src='/js/jquery-autocomplete/browser_wev8.js'></script>\r\n<script language=javascript src=\"/wui/theme/ecology8/jquery/js/zDialog_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/ecology8/request/hoverBtn_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/ecology8/lang/weaver_lang_".toCharArray();
    _jsp_string73 = "');\r\n				</script>\r\n				".toCharArray();
    _jsp_string57 = "/wui_wev8.css'/>\r\n".toCharArray();
    _jsp_string18 = "\";\r\n	var url = \"/docs/tabs/DocCommonTab.jsp?_fromURL=3&operateitem=\"+operateitem+\"&sqlwhere=\"+sqlwhere;\r\n	if(id){\r\n		url = \"/docs/tabs/DocCommonTab.jsp?_fromURL=3&relatedid=\"+id+\"&operateitem=\"+operateitem+\"&sqlwhere=\"+sqlwhere;\r\n		if(operateitem==418||operateitem==419||operateitem==420){\r\n			dialog.Title = \"".toCharArray();
    _jsp_string71 = "');\r\n							</script>\r\n							".toCharArray();
    _jsp_string62 = ")\">\r\n".toCharArray();
    _jsp_string45 = "\r\n<script language=javascript>\r\nubsfirmcode0 = ".toCharArray();
    _jsp_string7 = "\r\n\r\n\r\n<script language=javascript>;\r\ntop.Dialog.alert(\"".toCharArray();
    _jsp_string47 = ";\r\nusbserial0 = \"".toCharArray();
    _jsp_string68 = "\r\n    \r\n   \r\n   ".toCharArray();
    _jsp_string6 = "\";\r\n		});		\r\n	</script>\r\n	".toCharArray();
    _jsp_string52 = "\r\n}\r\n\r\nfunction doScannerEscape(ev, obj){\r\n	IMCarousel.doScannerEscape(ev, obj);\r\n}\r\n\r\nfunction scaleImg(obj, tag){\r\n	IMCarousel.scaleImg(obj, tag);\r\n}\r\n\r\nfunction rotateImg(obj){\r\n	IMCarousel.rotateImg(obj);\r\n}\r\n\r\nfunction downloadImg(obj){\r\n	IMCarousel.downloadImg(obj);\r\n}\r\n\r\nfunction slideImg(obj, direction){\r\n	IMCarousel.slideImg(obj, direction);\r\n}\r\n\r\nfunction showImgScanner(ev, isShow, id){\r\n	IMCarousel.showImgScanner(ev, isShow, id);\r\n}\r\n\r\nfunction downloads(id){\r\n	document.location.href=\"/weaver/weaver.file.FileDownload?fileid=\"+id+\"&download=1\";\r\n}\r\n</script>\r\n".toCharArray();
    _jsp_string15 = "\";\r\nfunction check_conn() {\r\n	return confirm('".toCharArray();
    _jsp_string28 = "\r\n	    try {\r\n		    var lenck = true;\r\n		    var tempfieldvlaue = document.getElementById(\"htmlfieldids\").value;\r\n		    while(true) {\r\n			    var tempfield = tempfieldvlaue.substring(0, tempfieldvlaue.indexOf(\",\"));\r\n			    tempfieldvlaue = tempfieldvlaue.substring(tempfieldvlaue.indexOf(\",\")+1);\r\n			    var fieldid = tempfield.substring(0, tempfield.indexOf(\";\"));\r\n			    var fieldname = tempfield.substring(tempfield.indexOf(\";\")+1);\r\n			    if(fieldname=='') break;\r\n			    if(!checkLengthOnly(fieldid,'4000',fieldname,'".toCharArray();
    _jsp_string58 = "\r\n\r\n\r\n<!-- \u5b57\u4f53\u8bbe\u7f6e\uff0cwin7\u3001vista\u7cfb\u7edf\u4f7f\u7528\u96c5\u9ed1\u5b57\u4f53,\u5176\u4ed6\u7cfb\u7edf\u4f7f\u7528\u5b8b\u4f53 Start -->\r\n<!--\r\n\u6dfb\u52a0\u81f3init_wev8.css \r\n<link type='text/css' rel='stylesheet'  href='/wui/common/css/w7OVFont_wev8.css' id=\"FONT2SYSTEMF\">\r\n -->\r\n<script language=\"javascript\"> \r\n/*\r\nif (jQuery.client.version< 6) {\r\n	document.getElementById('FONT2SYSTEMF').href = \"/wui/common/css/notW7AVFont_wev8.css\";\r\n}\r\n*/\r\n</script> \r\n<!-- \u5b57\u4f53\u8bbe\u7f6e\uff0cwin7\u3001vista\u7cfb\u7edf\u4f7f\u7528\u96c5\u9ed1\u5b57\u4f53,\u5176\u4ed6\u7cfb\u7edf\u4f7f\u7528\u5b8b\u4f53 End -->\r\n\r\n<!-- \u9875\u9762\u5207\u6362\u6548\u679cStart -->\r\n".toCharArray();
    _jsp_string65 = "\";\r\n</script>\r\n\r\n<!--For wuiForm-->\r\n<script type=\"text/javascript\" src=\"/wui/common/jquery/plugin/wuiform/jquery.wuiform_wev8.js\"></script>\r\n<script language=\"javascript\">\r\njQuery(document).ready(function(){\r\n	wuiform.init();\r\n});\r\n</script>\r\n".toCharArray();
    _jsp_string35 = "\");\r\n							}\r\n						}else{\r\n							try{\r\n								window.top.Dialog.alert(\"".toCharArray();
    _jsp_string12 = "\r\n<!-- IE\u4e0b\u4e13\u7528vbs\uff08\u4e34\u65f6\uff09 -->\r\n<script language=\"vbs\" src=\"/js/string2VbArray.vbs\"></script>        \r\n        ".toCharArray();
    _jsp_string66 = "\r\n\r\n    ".toCharArray();
    _jsp_string26 = "';\r\n	   \r\n	    			return false;\r\n	    		}\r\n	    		flag_msg += '\\r\\n\\r\\n".toCharArray();
    _jsp_string10 = "\r\n<script type=\"text/javascript\" src=\"/wui/common/jquery/jquery.min_wev8.js\"></script>\r\n".toCharArray();
    _jsp_string43 = "\";\r\n  var str1 = \"".toCharArray();
    _jsp_string8 = "\",function(){\r\n	window.top.location=\"/login/Login.jsp\";\r\n});\r\n</script>\r\n".toCharArray();
    _jsp_string34 = "\");\r\n							}catch(e){\r\n								Dialog.alert(\"".toCharArray();
    _jsp_string46 = ";\r\nusbusercode0 = ".toCharArray();
    _jsp_string31 = "\r\n	}\r\n	catch(e) {\r\n		return check_conn();\r\n	}\r\n	if(!isconn)\r\n		return check_conn();\r\n    /* end by cyril on 2008-08-14 for td:8521 */\r\n	\r\n	thiswin = thiswins\r\n	items = \",\"+items + \",\";\r\n	\r\n	var tempfieldvlaue1 = \"\";\r\n	try{\r\n		tempfieldvlaue1 = document.getElementById(\"htmlfieldids\").value;\r\n	}catch (e) {\r\n	}\r\n\r\n	for(i=1;i<=thiswin.length;i++){\r\n		tmpname = thiswin.elements[i-1].name;\r\n		tmpvalue = thiswin.elements[i-1].value;\r\n	    if(tmpvalue==null){\r\n	        continue;\r\n	    }\r\n\r\n		if(tmpname!=\"\" && items.indexOf(\",\"+tmpname+\",\")!=-1){		\r\n			var __fieldhtmltype = jQuery(\"input[name=\" + tmpname + \"]\").attr(\"__fieldhtmltype\");\r\n		    if (__fieldhtmltype == '9') {\r\n		        continue;\r\n		    }\r\n		\r\n			var href = location.href;\r\n			if(href && href.indexOf(\"Ext.jsp\")!=-1){\r\n				window.__oriAlert__ = true;\r\n			}\r\n			if(tempfieldvlaue1.indexOf(tmpname+\";\") == -1){\r\n				while(tmpvalue.indexOf(\" \") >= 0){\r\n					tmpvalue = tmpvalue.replace(\" \", \"\");\r\n				}\r\n				while(tmpvalue.indexOf(\"\\r\\n\") >= 0){\r\n					tmpvalue = tmpvalue.replace(\"\\r\\n\", \"\");\r\n				}\r\n\r\n				if(tmpvalue == \"\"){\r\n					if(thiswin.elements[i-1].getAttribute(\"temptitle\")!=null && thiswin.elements[i-1].getAttribute(\"temptitle\")!=\"\"){\r\n						if(window.__oriAlert__){\r\n							window.top.Dialog.alert(\"\\\"\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"\\\"\"+\"".toCharArray();
    _jsp_string1 = "\r\n    ".toCharArray();
    _jsp_string4 = "\r\n	<script language=\"javascript\">\r\n		window.top.Dialog.alert(\"".toCharArray();
    _jsp_string72 = "\r\n				<script>\r\n					parent.parent.getParentWindow(parent).closeDialog('".toCharArray();
    _jsp_string32 = "\");\r\n						}else{\r\n							var tempElement = thiswin.elements[i-1];\r\n							//ueditor\u5fc5\u586b\u9a8c\u8bc1\r\n							if (checkueditorContent(tempElement)) {\r\n								continue;\r\n							}\r\n							\r\n							window.top.Dialog.alert(\"&quot;\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"&quot;\"+\"".toCharArray();
    _jsp_string37 = "\");\r\n						}else{\r\n							var tempElement = thiswin.elements[i-1];\r\n							\r\n							//ueditor\u5fc5\u586b\u9a8c\u8bc1\r\n							if (checkueditorContent(tempElement)) {\r\n								continue;\r\n							}\r\n							\r\n							window.top.Dialog.alert(\"&quot;\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"&quot;\"+\"".toCharArray();
    _jsp_string27 = "';\r\n	        	//alert(xmlhttp.responseText);\r\n	        	return confirm(flag_msg);\r\n	        }\r\n	    }\r\n	    xmlhttp = null;\r\n\r\n	  	//\u68c0\u67e5\u591a\u884c\u6587\u672c\u6846 oracle\u4e0b\u68c0\u67e5HTML\u4e0d\u80fd\u8d85\u8fc74000\u4e2a\u5b57\u7b26\r\n	    ".toCharArray();
    _jsp_string53 = "\r\n\r\n\r\n<!--For wui-->\r\n".toCharArray();
    _jsp_string48 = "\";\r\nusblanguage = \"".toCharArray();
    _jsp_string56 = "/skins/".toCharArray();
    _jsp_string38 = "\", function () {\r\n								formElementFocus(tempElement);\r\n							});\r\n							\r\n						}\r\n						return false;\r\n					}else{\r\n						if(window.__oriAlert__){\r\n							window.top.Dialog.alert(\"".toCharArray();
    _jsp_string16 = "\\r\\n\\r\\n".toCharArray();
    _jsp_string59 = "\r\n    <meta http-equiv=\"".toCharArray();
    _jsp_string63 = "\r\n<!-- \u9875\u9762\u5207\u6362\u6548\u679cEnd -->\r\n\r\n\r\n<script language=\"javascript\">\r\n\r\n//------------------------------\r\n// the folder of current skins \r\n//------------------------------\r\n//\u5f53\u524d\u4f7f\u7528\u7684\u4e3b\u9898\r\nvar GLOBAL_CURRENT_THEME = \"".toCharArray();
    _jsp_string42 = "\";\r\n   if(!confirm(str)){\r\n       return false;\r\n   }\r\n       return true;\r\n   } \r\n\r\n///*\u6d41\u7a0b\u91cc\u9762\u4f7f\u7528\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u6d41\u7a0b\u5185\u5bb9\u653e\u5230iframe\u91cc\u9762\uff0c\u901a\u8fc7response\u8fd4\u56de\u7684\u65f6\u5019\uff0c\u8981\u8fd4\u56de\u7684\u5230\u5176\u7236\u7a97\u53e3*/\r\nfunction wfforward(wfurl){\r\n	parent.location.href = wfurl;\r\n}\r\n\r\nfunction myescapecode(str)\r\n{\r\n	return encodeURIComponent(str);\r\n}\r\n</script>\r\n\r\n\r\n\r\n<meta http-equiv=Content-Type content=\"text/html; charset=UTF-8\">\r\n<script language=JavaScript> \r\n  var companyname = \"".toCharArray();
    _jsp_string2 = "\r\n<!DOCTYPE HTML>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<html>\r\n<head>\r\n<!-- \r\n\u6dfb\u52a0\u81f3init.css\r\n<style type=\"text/css\">\r\n	html{height:100%;}\r\n</style>\r\n -->\r\n".toCharArray();
    _jsp_string14 = "_wev8.js\"></script>\r\n<script type=\"text/javascript\" src=\"/js/messagejs/highslide/highslide-full_wev8.js\"></script>\r\n<script type=\"text/javascript\">\r\n    hs.graphicsDir = '/js/messagejs/highslide/graphics/';\r\n    hs.align = 'center';\r\n    hs.transitions = ['expand', 'crossfade'];\r\n    hs.outlineType = 'rounded-white';\r\n    hs.fadeInOut = true;\r\n</script>\r\n<!-- init.css, \u6240\u6709css\u6587\u4ef6\u90fd\u5728\u6b64\u6587\u4ef6\u4e2d\u5f15\u5165 -->\r\n<link rel=\"stylesheet\" href=\"/css/init_wev8.css\" type=\"text/css\" />\r\n\r\n\r\n<script language=javascript>\r\nwindow[\"_jsessionid\"] = \"".toCharArray();
    _jsp_string36 = "\");\r\n							}\r\n						}\r\n						return false;\r\n					}\r\n				}\r\n			} else {\r\n				var divttt=document.createElement(\"div\");\r\n				divttt.innerHTML = tmpvalue;\r\n				var tmpvaluettt = jQuery.trim(jQuery(divttt).text());\r\n				if(tmpvaluettt == \"\"){\r\n					if(thiswin.elements[i-1].getAttribute(\"temptitle\")!=null && thiswin.elements[i-1].getAttribute(\"temptitle\")!=\"\"){\r\n						if(window.__oriAlert__){\r\n							window.top.Dialog.alert(\"\\\";\"+thiswin.elements[i-1].getAttribute(\"temptitle\")+\"\\\"\"+\"".toCharArray();
    _jsp_string5 = "\",function(){\r\n			window.top.location=\"".toCharArray();
    _jsp_string51 = "\r\n<LINK href=\"/js/jquery/jquery_dialog_wev8.css\" type=text/css rel=STYLESHEET>\r\n<script type=\"text/javascript\" src=\"/wui/common/jquery/jquery.min_wev8.js\"></script>\r\n<script type=\"text/javascript\" language=\"javascript\" src=\"/js/jquery/jquery_dialog_wev8.js\"></script>\r\n\r\n<script src=\"/social/js/drageasy/drageasy.js\"></script>\r\n<script type=\"text/javascript\" src=\"/social/js/bootstrap/js/bootstrap.js\"></script>\r\n<script type=\"text/javascript\" src=\"/social/im/js/IMUtil_wev8.js\"></script>\r\n\r\n<script type=\"text/javascript\" src=\"/social/js/imcarousel/imcarousel.js\"></script>\r\n<script type=\"text/javascript\" language=\"javascript\">\r\nfunction ReloadOpenerByDialogClose() {\r\n    ".toCharArray();
    _jsp_string24 = "\";\r\n					diag.show();\r\n			        return false;\r\n	    		}\r\n	    		else if(response_flag=='2') {\r\n	    			flag_msg = '".toCharArray();
    _jsp_string70 = "\r\n							<script>\r\n								parent.parent.getParentWindow(parent).closeDialog('".toCharArray();
    _jsp_string54 = "\r\n".toCharArray();
    _jsp_string11 = "\r\n<script language=\"javascript\" type=\"text/javascript\" src=\"/FCKEditor/swfobject_wev8.js\"></script>\r\n\r\n".toCharArray();
    _jsp_string50 = "\r\n\r\n<!--WUI -->\r\n".toCharArray();
    _jsp_string69 = "\r\n    \r\n	\r\n    ".toCharArray();
    _jsp_string41 = "\";\r\n   if(!confirm(str)){\r\n       return false;\r\n   }\r\n       return true;\r\n } \r\n\r\nfunction issubmit(){\r\n	var str = \"".toCharArray();
    _jsp_string23 = "\";\r\n					//diag.InvokeElementId=\"pageOverlay\"\r\n					diag.URL = \"/wui/theme/ecology7/page/loginSmall.jsp?username=".toCharArray();
    _jsp_string30 = "')) {\r\n				    lenck = false;\r\n				    break;\r\n			    }\r\n		    }\r\n		    if(lenck==false) return false;\r\n	    }\r\n	    catch(e) {}\r\n	    ".toCharArray();
    _jsp_string61 = ",transition=".toCharArray();
    _jsp_string60 = "\" content=\"revealTrans(duration=".toCharArray();
    _jsp_string29 = "','".toCharArray();
    _jsp_string25 = "';\r\n	    		}\r\n	    		//\u4e3b\u4ece\u5e10\u6237\u7279\u6b8a\u5904\u7406 by alan for TD10156\r\n	    		if(response_flag=='3') {\r\n	    			flag_msg = '".toCharArray();
    _jsp_string40 = "\");\r\n						}\r\n						return false;\r\n					}\r\n				}\r\n			}\r\n		}\r\n	}\r\n	return true;\r\n}\r\n\r\nfunction isdel(){\r\n	var str = \"".toCharArray();
    _jsp_string3 = "\r\n\r\n".toCharArray();
  }
}
