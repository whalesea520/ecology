/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._hrm._area;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import weaver.general.Util;
import weaver.hrm.*;
import net.sf.json.*;
import java.util.ArrayList;
import weaver.hrm.country.CountryComInfo;
import weaver.hrm.province.ProvinceComInfo;
import weaver.hrm.city.CityComInfo;
import weaver.hrm.city.CitytwoComInfo;
import java.util.Map;
import java.util.HashMap;
import weaver.systeminfo.SystemEnv;

public class _area_0json__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;

  
  public ArrayList getCountryTreeList() throws Exception {
  	ArrayList list = new ArrayList();
  	CountryComInfo rs = new CountryComInfo();
  	rs.setTofirstRow();
  	while (rs.next()) {
  		String id = rs.getCountryid();
  		String name = rs.getCountryname();
  		if(Util.null2String(rs.getCountryiscanceled()).equals("1")){
  			continue;
  		}
  		Map map = new HashMap();
  		map.put("id",id);
  		map.put("name",name);
  		map.put("type","country");
  		list.add(map);
  	}
  	return list;
  }
  
  public ArrayList getProvinceTreeList(String subId) throws Exception {
  	ArrayList list = new ArrayList();
  	ProvinceComInfo rs = new ProvinceComInfo();
  	rs.setTofirstRow();
      while (rs.next()) {
          if (rs.getProvincecountryid().equals(subId) && !"1".equals(rs.getProvinceiscanceled())){
  	        String id = rs.getProvinceid();
  	        String name = rs.getProvincename();
  	        Map map = new HashMap();
  			map.put("id",id);
  			map.put("name",name);
  			map.put("type","province");
  			list.add(map);
          }
      }
        return list;
    }
  
  public ArrayList getCityTreeList(String subId) throws Exception {
  	ArrayList list = new ArrayList();
  	CityComInfo rs = new CityComInfo();
  	rs.setTofirstRow();
      while (rs.next()) {
          if (rs.getCityprovinceid().equals(subId) && !"1".equals(rs.getCitycanceled())){
  	        String id = rs.getCityid();
  	        String name = rs.getCityname();
  	        Map map = new HashMap();
  			map.put("id",id);
  			map.put("name",name);
  			map.put("type","city");
  			list.add(map);
          }
      }
        return list;
    }
  
  public ArrayList getCityTwoTreeList(String subId) throws Exception {
  	ArrayList list = new ArrayList();
  	CitytwoComInfo rs = new CitytwoComInfo();
  	rs.setTofirstRow();
      while (rs.next()) {
          if (rs.getCitypid().equals(subId) && !"1".equals(rs.getCitycanceled())){
  	        String id = rs.getCityid();
  	        String name = rs.getCityname();
  	        Map map = new HashMap();
  			map.put("id",id);
  			map.put("name",name);
  			map.put("type","citytwo");
  			list.add(map);
          }
      }
        return list;
    }
  
  
  /**
   * \u6307\u5b9a\u8282\u70b9\u4e0b\u662f\u5426\u6709\u5b50\u8282\u70b9
   * @param type  com:\u5206\u90e8;dept:\u90e8\u95e8
   * @param id   \u8282\u70b9id
   * @return  boolean
   * @throws Exception
   */
  private int hasChild(String type, String id) throws Exception {
  	int hasChild = 0;
    if (type.equals("country")) {
  	  ProvinceComInfo rs = new ProvinceComInfo();
  		rs.setTofirstRow();
  		while (rs.next()) {
  			if (rs.getProvincecountryid().equals(id) && !"1".equals(rs.getProvinceiscanceled()))
  				hasChild++;
  		}
  	} else if (type.equals("province")) {
  		CityComInfo rs = new CityComInfo();
  		rs.setTofirstRow();
  		while (rs.next()) {
  			if ( rs.getCityprovinceid().equals(id) && !"1".equals(rs.getCitycanceled()))
  				hasChild++;
  		}
  	}else if (type.equals("city")) {
  		CitytwoComInfo rs = new CitytwoComInfo();
  		rs.setTofirstRow();
  		while (rs.next()) {
  			if ( rs.getCitypid().equals(id) && !"1".equals(rs.getCitycanceled()))
  				hasChild++;
  		}
  	}
  	return hasChild;
  }
  

  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      
response.setHeader("cache-control", "no-cache");
response.setHeader("pragma", "no-cache");
response.setHeader("expires", "Mon 1 Jan 1990 00:00:00 GMT");
User user = HrmUserVarify.getUser (request , response) ;
if(user == null)  return ;
String id=Util.null2String(request.getParameter("id"));
String type=Util.null2String(request.getParameter("type"));
String opt=Util.null2String(request.getParameter("opt"));

ArrayList selectList = new ArrayList();
JSONArray jObject = null;
if(opt.equals("findSubid")){
	CountryComInfo counrs = new CountryComInfo();
	ProvinceComInfo provincers = new ProvinceComInfo();
	if(type.equals("province")){
		String countryId = provincers.getProvincecountryid(id);
		Map map = new HashMap();
		map.put("id",countryId);
		map.put("name",counrs.getCountryname(countryId));
		map.put("type","country");
		selectList.add(map);
	}else if(type.equals("city")){
		CityComInfo rs = new CityComInfo();
		String countryId = rs.getCitycountryid(id);
		Map map = new HashMap();
		map.put("id",countryId);
		map.put("name",counrs.getCountryname(countryId));
		map.put("type","country");
		selectList.add(map);
		Map map2 = new HashMap();
		String provinceid = rs.getCityprovinceid(id);
		map2.put("id",provinceid);
		map2.put("name",provincers.getProvincename(provinceid));
		map2.put("type","province");
		selectList.add(map2);
	}else if(type.equals("citytwo")){
		CitytwoComInfo rs = new CitytwoComInfo();
		String citypid=rs.getCitypid(id);
		CityComInfo rs1 = new CityComInfo();
		String countryId = rs1.getCitycountryid(citypid);
		Map map = new HashMap();
		map.put("id",countryId);
		map.put("name",counrs.getCountryname(countryId));
		map.put("type","country");
		selectList.add(map);
		Map map2 = new HashMap();
		String provinceid = rs1.getCityprovinceid(citypid);
		map2.put("id",provinceid);
		map2.put("name",provincers.getProvincename(provinceid));
		map2.put("type","province");
		selectList.add(map2);
		Map map3 = new HashMap();
		map3.put("id",citypid);
		map3.put("name",rs1.getCityname(citypid));
		map3.put("type","city");
		selectList.add(map3);
	}
	jObject = JSONArray.fromObject(selectList);		
	out.println(jObject.toString());
}else if("getTitle".equals(opt)){

		Map map = new HashMap();
		
		map.put("countryName",SystemEnv.getHtmlLabelName(377,user.getLanguage()));
		map.put("provinceName",SystemEnv.getHtmlLabelName(800,user.getLanguage()));
		map.put("cityName",SystemEnv.getHtmlLabelName(493,user.getLanguage()));
		map.put("district",SystemEnv.getHtmlLabelName(81764,user.getLanguage()));
		selectList.add(map);
		jObject = JSONArray.fromObject(selectList);	
		out.println(jObject.toString());	
		
}else{
	if(id.equals("")){
		//\u521d\u59cb\u5316
		selectList=getCountryTreeList();
	}else if(type.equals("country")){
		selectList=getProvinceTreeList(id);
	}else if(type.equals("province")){
		selectList=getCityTreeList(id);
	}else if(type.equals("city")){
		selectList=getCityTwoTreeList(id);
	}
	jObject = JSONArray.fromObject(selectList);		
	out.println(jObject.toString());
}

    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("hrm/area/Area_json.jsp"), 1653153874823655837L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string0;
  static {
    _jsp_string0 = "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
  }
}
