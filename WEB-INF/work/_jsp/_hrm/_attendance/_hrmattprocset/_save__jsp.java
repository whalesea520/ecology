/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._hrm._attendance._hrmattprocset;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import java.util.*;
import weaver.hrm.attendance.domain.*;
import org.json.JSONObject;

public class _save__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      weaver.conn.RecordSet rs;
      rs = (weaver.conn.RecordSet) pageContext.getAttribute("rs");
      if (rs == null) {
        rs = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs", rs);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.common.DateUtil dateUtil;
      dateUtil = (weaver.common.DateUtil) pageContext.getAttribute("dateUtil");
      if (dateUtil == null) {
        dateUtil = new weaver.common.DateUtil();
        pageContext.setAttribute("dateUtil", dateUtil);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.common.StringUtil strUtil;
      strUtil = (weaver.common.StringUtil) pageContext.getAttribute("strUtil");
      if (strUtil == null) {
        strUtil = new weaver.common.StringUtil();
        pageContext.setAttribute("strUtil", strUtil);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.attendance.manager.HrmAttProcSetManager attProcSetManager;
      attProcSetManager = (weaver.hrm.attendance.manager.HrmAttProcSetManager) pageContext.getAttribute("attProcSetManager");
      if (attProcSetManager == null) {
        attProcSetManager = new weaver.hrm.attendance.manager.HrmAttProcSetManager();
        pageContext.setAttribute("attProcSetManager", attProcSetManager);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.attendance.manager.HrmAttProcActionManager attProcActionManager;
      attProcActionManager = (weaver.hrm.attendance.manager.HrmAttProcActionManager) pageContext.getAttribute("attProcActionManager");
      if (attProcActionManager == null) {
        attProcActionManager = new weaver.hrm.attendance.manager.HrmAttProcActionManager();
        pageContext.setAttribute("attProcActionManager", attProcActionManager);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.attendance.manager.HrmAttProcRelationManager attProcRelationManager;
      attProcRelationManager = (weaver.hrm.attendance.manager.HrmAttProcRelationManager) pageContext.getAttribute("attProcRelationManager");
      if (attProcRelationManager == null) {
        attProcRelationManager = new weaver.hrm.attendance.manager.HrmAttProcRelationManager();
        pageContext.setAttribute("attProcRelationManager", attProcRelationManager);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.attendance.manager.WorkflowBillfieldManager workflowBillfieldManager;
      workflowBillfieldManager = (weaver.hrm.attendance.manager.WorkflowBillfieldManager) pageContext.getAttribute("workflowBillfieldManager");
      if (workflowBillfieldManager == null) {
        workflowBillfieldManager = new weaver.hrm.attendance.manager.WorkflowBillfieldManager();
        pageContext.setAttribute("workflowBillfieldManager", workflowBillfieldManager);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      
	int id = strUtil.parseToInt(request.getParameter("id"), 0);
	String cmd = strUtil.vString(request.getParameter("cmd"), "save");
	JSONObject obj = new JSONObject();
	if(cmd.equals("save")) {
		int field001 = strUtil.parseToInt(request.getParameter("field001"), 0);
		int field002 = strUtil.parseToInt(request.getParameter("field002"), 0);
		int field003 = strUtil.parseToInt(request.getParameter("field003"), 0);
		int field004 = strUtil.parseToInt(request.getParameter("field004"), 0);
		int field005 = strUtil.parseToInt(request.getParameter("field005"), 1);
		int field006 = strUtil.parseToInt(request.getParameter("field006"));
		int field007 = strUtil.parseToInt(request.getParameter("field007"), 0);
		String field008 = strUtil.vString(request.getParameter("field008"), dateUtil.getCurrentDate());
		String field009 = strUtil.vString(request.getParameter("field009"), dateUtil.getCurrentDate());
		String field010 = strUtil.vString(request.getParameter("field010"));
		
		rs.executeSql("select * from view_workflowForm_selectAll where isoldornew = 1 and id > 0 and id = "+field002);
		if(rs.next()) field003 = 1;
		HrmAttProcSet bean = null;
		if(id > 0) bean = attProcSetManager.get(id);
		bean = bean == null ? new HrmAttProcSet(true) : bean;
		bean.setField001(field001);
		bean.setField002(field002);
		bean.setField003(field003);
		bean.setField004(field004);
		bean.setField005(field005);
		bean.setField006(field006);
		if(id <= 0) {
			bean.setField007(field007);
			bean.setField008(field008);
		} else {
			bean.setField010(field010);
		}
		bean.setField009(field009);
		obj.put("id", String.valueOf(attProcSetManager.save(bean)));
		
		if(field002 < 0 && field003 == 0 && (field006 == 0 || field006 == 3)) attProcSetManager.welcomeToSet(field001, field006);
	} else if(cmd.equals("changeStatus")) {
		HrmAttProcSet bean = attProcSetManager.get(id);
		if(bean != null) {
			bean.setField005(strUtil.parseToInt(request.getParameter("field005"), 1));
			bean.setField009(dateUtil.getCurrentDate());
			attProcSetManager.update(bean);
			obj.put("status", "true");
		} else obj.put("status", "false");
	} else if(cmd.equals("delete")) {
		attProcSetManager.delete(strUtil.vString(request.getParameter("ids")));
	} else if(cmd.equals("getSelectValue")) {
		String _type = strUtil.vString(request.getParameter("type"));
		String fType = strUtil.vString(request.getParameter("fType"));
		String billId = strUtil.vString(request.getParameter("billId"));
		String languageid = strUtil.vString(request.getParameter("languageid"));
		Boolean ck = Boolean.valueOf(strUtil.vString(request.getParameter("ck")));
		List fieldList = workflowBillfieldManager.find(workflowBillfieldManager.getMapParam("billid:"+billId+";languageid:"+languageid+";sql_id:and t.id not in(654,655)"));
		WorkflowBillfield wfBean = null;
		StringBuffer keys = new StringBuffer(), values = new StringBuffer();
		for(int i=0; i<(fieldList == null ? 0 : fieldList.size()); i++){
			wfBean = (WorkflowBillfield)fieldList.get(i);
			if(!ck && (!wfBean.getFieldhtmltype().equals(_type) || !String.valueOf(wfBean.getType()).equals(fType))) continue;
			keys.append(keys.length() == 0 ? "" : ",").append(wfBean.getFieldname()+"___"+wfBean.getId());
			values.append(values.length() == 0 ? "" : ",").append(wfBean.getLabelName());
		}
		obj.put("keys", keys.toString());
		obj.put("values", values.toString());
	} else if(cmd.equals("saveRelation")) {
		HrmAttProcSet bean = attProcSetManager.get(strUtil.parseToInt(request.getParameter("field001"), 0));
		if(bean != null) {
			bean.setField009(dateUtil.getCurrentDate());
			attProcSetManager.update(bean);
		}
		attProcRelationManager.save(request);
	} else if(cmd.equals("saveSet")) {
		attProcActionManager.save(request, response);
	}
	out.print(obj.toString());

    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("hrm/attendance/hrmAttProcSet/save.jsp"), -5632194305892848602L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string0;
  private final static char []_jsp_string1;
  static {
    _jsp_string0 = "\r\n\r\n\r\n".toCharArray();
    _jsp_string1 = "\r\n".toCharArray();
  }
}
