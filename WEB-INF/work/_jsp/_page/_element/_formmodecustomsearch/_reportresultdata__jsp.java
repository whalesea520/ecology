/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._page._element._formmodecustomsearch;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import weaver.formmode.service.CustomSearchService;
import weaver.formmode.tree.CustomTreeUtil;
import com.weaver.formmodel.util.StringHelper;
import weaver.formmode.customjavacode.CustomJavaCodeRun;
import weaver.formmode.service.CommonConstant;
import weaver.servicefiles.DataSourceXML;
import weaver.formmode.virtualform.VirtualFormHandler;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import weaver.docs.docs.DocComInfo;
import net.sf.json.JSONObject;
import weaver.interfaces.workflow.browser.Browser;
import weaver.interfaces.workflow.browser.BrowserBean;
import weaver.formmode.tree.CustomTreeData;
import java.util.*;
import weaver.hrm.*;
import weaver.systeminfo.*;
import weaver.general.StaticObj;
import weaver.general.Util;
import weaver.hrm.settings.RemindSettings;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import weaver.file.*;
import java.math.BigDecimal;
import weaver.workflow.report.ReportCompositorOrderBean;
import weaver.workflow.report.ReportCompositorListBean;
import weaver.workflow.report.ReportUtilComparator;

public class _reportresultdata__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;

  
  	String maintableAlias="t1";
  	String detailtableAlias="d1";
  	String detailfieldAlias="d_";
  	private String getSplitPageString(int pageSize, int currentPage,
  			int rowcount, int pageCount, String position,User user) {
  		String sbf = "";
  		int z_index = currentPage - 2;
  		int y_num = currentPage + 2;
  		String tempCent = "";
  		String tempLeft = "";
  		String tempRight = "";
  		if (z_index > 1) {
  			tempLeft += "<a style=\"position:relative;cursor:hand;TEXT-DECORATION:none;height:21px;border:1px solid #6ec8ff;margin-right:5px;padding:0 5px 0 5px;\" _jumpTo=\"1\" onClick=\"jumpTo(1)\">"
  					+ 1 + "</a>";
  		}
  		if (z_index > 2) {
  			tempLeft += "<span style=\"height:21px;padding-top:1px;text-align:center;\">&nbsp;...&nbsp;</span>";
  		}
  
  		if (y_num < (pageCount - 1)) {
  			tempRight += "<span style=\"height:21px;padding-top:1px;text-align:center;\">&nbsp;...&nbsp;</span>";
  		}
  
  		if (y_num < pageCount) {
  			tempRight += "<a style=\"position:relative;cursor:hand;TEXT-DECORATION:none;height:21px;border:1px solid #6ec8ff;margin-right:5px;padding:0 5px 0 5px;\" _jumpTo=\"1\" onClick=\"jumpTo("
  					+ pageCount + ")\">" + pageCount + "</a>";
  		}
  
  		for (; z_index <= y_num; z_index++) {
  			if (z_index > 0 && z_index <= pageCount) {
  				if (z_index == currentPage) {
  					tempCent += "<a style=\"position:relative;TEXT-DECORATION:none;height:21px;border:1px solid #6ec8ff;margin-right:5px;padding:0 5px 0 5px;\" _jumpTo=\""
  							+ z_index
  							+ "\" class=\"weaverTableCurrentPageBg\" >"
  							+ z_index + "</a>";
  				} else {
  					tempCent += "<a style=\"position:relative;cursor:hand;TEXT-DECORATION:none;height:21px;border:1px solid #6ec8ff;margin-right:5px;padding:0 5px 0 5px;\" _jumpTo=\""
  							+ z_index
  							+ "\" onClick=\"jumpTo("
  							+ z_index
  							+ ")\">" + z_index + "</a>";
  				}
  			}
  		}
  
  		sbf = tempLeft + tempCent + tempRight;
  
  		String str = "";
  		if (currentPage > 1) {
  			str += "<a class=\"weaverTablePrevPage\" style=\"position:relative;top:0px;bottom:0;cursor:hand;TEXT-DECORATION:none;height:21px;width:21px;margin-right:5px;font-size:11px;\" id=\""
  					+ position
  					+ "-pre\" onClick=\"jumpTo("
  					+ (currentPage - 1)
  					+ ")\" onmouseover=\"pmouseover(this, true)\" onmouseout=\"pmouseover(this, false)\">&nbsp;</a>";
  		} else {
  			str += "<span class=\"weaverTablePrevPageOfDisabled\" style=\"position:relative;top:0px;TEXT-DECORATION:none;height:21px;width:21px;margin-right:5px;color:#c6c6c6;font-size:11px;display:inline-block;\">&nbsp;</span>";
  		}
  		str += sbf;
  		if (currentPage < pageCount) {
  			str += "<a class=\"weaverTableNextPage\" style=\"position:relative;top:0px;cursor:hand;TEXT-DECORATION:none;height:21px;width:21px;margin-right:10px;font-size:11px;\" id=\""
  					+ position
  					+ "-next\" onClick=\"jumpTo("
  					+ (currentPage + 1)
  					+ ")\" onmouseover=\"pmouseover(this, true)\" onmouseout=\"pmouseover(this, false)\">&nbsp;</a>";
  		} else {
  			str += "<span class=\"weaverTableNextPageOfDisabled\" style=\"position:relative;top:0px;TEXT-DECORATION:none;height:21px;width:21px;margin-right:10px;font-size:11px;display:inline-block;\">&nbsp;</span>";
  		}
  
  		String result = "";
  		result += "<span style=\"TEXT-DECORATION:none;height:21px;padding-top:1px;\">"+SystemEnv.getHtmlLabelName(15323,user.getLanguage())+"&nbsp;</span>";
  
  		result += "<input id=\"jumpTo"
  				+ position
  				+ "\" type=\"text\" value=\""
  				+ currentPage
  				+ "\" size=\"3\" class=\"text\" onMouseOver=\"this.select()\" style=\"text-align:right;height:20px;widht:30px;border:1px solid #6ec8ff;background:none;position:relative;margin-right:5px;padding-right:2px;\"/>";
  		result += "<span style=\"TEXT-DECORATION:none;height:21px;padding-top:1px;\">"+SystemEnv.getHtmlLabelName(30642,user.getLanguage())+"</span>";
  		result += "&nbsp;<button id=\"jumpTo-goPage\" onClick=\"jumpTo(document.getElementById('jumpTo"
  				+ position
  				+ "').value, document.getElementById('jumpTo"
  				+ position
  				+ "'))\" style=\"cursor:hand;background:url(/wui/theme/ecology7/skins/default/table/jump_wev8.png) no-repeat;height:21px;width:38px;margin-right:5px;text-align:center;border:none;\">"+SystemEnv.getHtmlLabelName(81304,user.getLanguage())+"</button>";
  
  		str += result;
  		return str;
  	}
  
  	private String delHtml(final String inputString) {
  
  		String htmlStr = new weaver.workflow.mode.FieldInfo()
  				.toExcel(inputString); // \u542bhtml\u6807\u7b7e\u7684\u5b57\u7b26\u4e32
  		htmlStr = Util.StringReplace(htmlStr, "&dt;&at;", "<br>");
  
  		String textStr = "";
  		java.util.regex.Pattern p_script;
  		java.util.regex.Matcher m_script;
  		java.util.regex.Pattern p_html;
  		java.util.regex.Matcher m_html;
  
  		try {
  			String regEx_html = "<[^>]+>"; // \u5b9a\u4e49HTML\u6807\u7b7e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f
  
  			String regEx_script = "<[/s]*?script[^>]*?>[/s/S]*?<[/s]*?//[/s]*?script[/s]*?>"; // \u5b9a\u4e49script\u7684\u6b63\u5219\u8868\u8fbe\u5f0f{\u6216<script[^>]*?>[/s/S]*?<//script>
  
  			p_script = java.util.regex.Pattern.compile(regEx_script,
  					java.util.regex.Pattern.CASE_INSENSITIVE);
  			m_script = p_script.matcher(htmlStr);
  			htmlStr = m_script.replaceAll(""); // \u8fc7\u6ee4script\u6807\u7b7e
  
  			p_html = java.util.regex.Pattern.compile(regEx_html,
  					java.util.regex.Pattern.CASE_INSENSITIVE);
  			m_html = p_html.matcher(htmlStr);
  			htmlStr = m_html.replaceAll(""); // \u8fc7\u6ee4html\u6807\u7b7e
  
  			textStr = htmlStr;
  
  		} catch (Exception e) {
  		}
  
  		String returnstr = Util.HTMLtoTxt(textStr).replaceAll("%nbsp;", "").trim();
  		returnstr = returnstr.replaceAll("%nbsp", "").trim();
  		returnstr = returnstr.replaceAll("&amp;nbs","").trim();
  		returnstr = returnstr.replaceAll("&amp;nbsp","").trim();
  		return returnstr.equals("")?"&nbsp":returnstr;
  	}
  
  	private String formatData(String inData) {
  		if (inData == null || inData.equals("")) {
  			return "";
  		}
  		try {
  			return new BigDecimal(Util.null2String(inData).equals("") ? "0"
  					: Util.null2String(inData)).setScale(2,
  					BigDecimal.ROUND_HALF_UP).toString();
  		} catch (Exception e) {
  			return inData;
  		}
  	}
      //\u662f -3  \u5347\u5e8f -1 \u964d\u5e8f-2
  	private String getOrderSql(int o){
  		if(o==1){
  			return "asc";
  	    }else{
  	    	return "d";
  	    }
      }
      //\u83b7\u53d6sql
      private String getQuerySql(String tablename,String detailtablename,List fieldnames,List fielddbtypes,String sqlwhere,int perpage,String dbtype,String ordersql,String rightsql,String norightlist,String pkfieldname){
      	String sql = "select ";
      	String perpagesql  = "";
      	//\u5206\u9875
      	if(dbtype.indexOf("sqlserver")>-1){
      		sql = " select top "+perpage+"  ";
      	}else{
      	    perpagesql = " rownum<"+(perpage+1);
      	}
      	if(!fieldnames.contains(maintableAlias+"."+pkfieldname)){
      	   fieldnames.add(maintableAlias+"."+pkfieldname);
      	   fielddbtypes.add("varchar");
      	}
      	
      	String strfieldname="";
          for(int i=0;i<fieldnames.size();i++){
              String tmpfieldname = Util.null2String(fieldnames.get(i));
          	if(!tmpfieldname.equals("")){
          	   if("text,clob,".indexOf(Util.null2String(fielddbtypes.get(i)))>-1){
          		 int index = tmpfieldname.indexOf(" ");
          		 if(dbtype.equals("oracle")){
          	    	 if(index>-1){
          	        	strfieldname+=",to_char("+tmpfieldname.substring(0,index)+") "+tmpfieldname.substring(index);
          	         }else{
          	        	strfieldname+=",to_char("+tmpfieldname+") as "+tmpfieldname.replace(maintableAlias+".", "");
          	         }
          	     }else{
          	    	 if(index>-1){
          	        	strfieldname+=",convert(varchar(4000),"+tmpfieldname.substring(0,index)+") "+tmpfieldname.substring(index);
          	         }else{
          	        	strfieldname+=",convert(varchar(4000),"+tmpfieldname+") as "+tmpfieldname.replace(maintableAlias+".", "");
          	         }
          	     }
          	   }else{
          	   	  strfieldname+=","+tmpfieldname;
          	   }
          	   
          	}
          }
          if(!strfieldname.equals("")){
             strfieldname = strfieldname.substring(1);
          }
          //sql = sql+strfieldname+" from "+tablename+" where "+(sqlwhere.equals("")?" 1=1 ":sqlwhere) +ordersql;
          if(!StringHelper.isEmpty(detailtablename)){
              strfieldname+=","+detailtableAlias+".id as "+detailfieldAlias+"id";  
  	        if("1".equals(norightlist)){
  	        	sql = sql+strfieldname+" from "+tablename+" "+maintableAlias+" left join "+detailtablename+" "+detailtableAlias
  	        			+" on "+maintableAlias+".id="+detailtableAlias+".mainid "+" where 1=1 ";
  	        	if(!StringHelper.isEmpty(sqlwhere)){
  	        		sql+=(sqlwhere.trim().toLowerCase().startsWith("and")?sqlwhere:" and "+sqlwhere) ;
  	        	}
  	        	sql+=ordersql;
  	        }else{
  	        	sql = sql+strfieldname+" from "+tablename+" "+maintableAlias
  	        			+" left join "+detailtablename+" "+detailtableAlias+" "
  	        			+" on "+maintableAlias+".id="+detailtableAlias+".mainid ";
  	    		if(!StringHelper.isEmpty(rightsql)){
  	        		sql+=","+rightsql +" t2 ";
  	      		}
  	        	sql+=" where 1=1 ";
  	        	if(!StringHelper.isEmpty(sqlwhere)){
  	        		sql+=(sqlwhere.trim().toLowerCase().startsWith("and")?sqlwhere:" and "+sqlwhere) ;
  	        	}
  	        	if(!StringHelper.isEmpty(rightsql)){
  	        		sql+=" and "+maintableAlias+".id = t2.sourceid ";
  	        	}
  	        	sql+=ordersql;	
  	        }
          }else{
          	if("1".equals(norightlist)){
  	        	sql = sql+strfieldname+" from "+tablename+" "+maintableAlias+" where 1=1 ";
  	        	if(!StringHelper.isEmpty(sqlwhere)){
  	        		sql+=(sqlwhere.trim().toLowerCase().startsWith("and")?sqlwhere:" and "+sqlwhere);
  	        	}
  	        	sql+=ordersql;
  	        }else{
  	        	sql = sql+strfieldname+" from "+tablename+" "+maintableAlias;
  	    		if(!StringHelper.isEmpty(rightsql)){
  	        		sql+=","+rightsql +" t2 ";
  	      		}
  	        	sql+=" where 1=1 ";
  	        	if(!StringHelper.isEmpty(sqlwhere)){
  	        		sql+=(sqlwhere.trim().toLowerCase().startsWith("and")?sqlwhere:" and "+sqlwhere);
  	        	}
  	        	if(!StringHelper.isEmpty(rightsql)){
  	        		sql+=" and "+maintableAlias+".id = t2.sourceid ";
  	        	}
  	        	sql+=ordersql;	
  	        }
          }
          if(dbtype.equals("oracle")){
              if(!ordersql.equals(""))
          	  sql = "select * from ("+sql+") where "+perpagesql;
          	else{
          	  sql=sql+" and "+perpagesql;
          	}           
          }
          return sql;
      }
      
     	private String changehreflink(String hreflink,String tablename,String datasource,String billid,String formID){
     		weaver.conn.RecordSet RecordSet = new weaver.conn.RecordSet();
     		String requestid = "0";
  		String datesql ="select * from "+tablename +" where id='"+billid+"'";
  		if(!"".equals(datasource)){
  			RecordSet.executeSql(datesql,datasource);
  		}else{
  			RecordSet.executeSql(datesql);
  		}
  		if(RecordSet.next()){
  			requestid = RecordSet.getString("requestId");
  			hreflink = Util.replaceString(hreflink, "$requestId$", requestid);
  			weaver.conn.RecordSet RecordSetfield = new weaver.conn.RecordSet();
  			String fieldsql = "select * from workflow_billfield where billid="+formID+" and (detailtable ='' or detailtable is null)";
  			RecordSetfield.executeSql(fieldsql);
  			while(RecordSetfield.next()){
  				String fieldhtype = RecordSetfield.getString("fieldhtmltype");
  				String type = RecordSetfield.getString("type");
  				String fieldname = RecordSetfield.getString("fieldname");
  				if("2".equals(fieldhtype)&&"2".equals(type)){
  					continue;
  				}
  				hreflink = Util.replaceString(hreflink, "$"+fieldname+"$", RecordSet.getString(fieldname));
  				hreflink = Util.replaceString(hreflink, "$billid$", RecordSet.getString("id"));
  			}
  		}
  		return hreflink;
     	}
     	private String addFontAttributeForHrefText(String src) {
     		String regex1 = "<a.*?/a>";
  		String regex2 = ">.*?</a>";
  		Pattern pt1 = Pattern.compile(regex1);
  		Pattern pt2 = Pattern.compile(regex2);
  		Matcher match1 = pt1.matcher(src);
  		String result = "";
  		while(match1.find()) {
  			StringBuilder sb = new StringBuilder();
  			String href = match1.group();
  			sb.append(href.substring(0, href.indexOf(">") + 1));
  			
  			Matcher match2 = pt2.matcher(href);
  			while(match2.find()) {
  				String content = match2.group();
  				String temp = content.substring(content.indexOf(">") + 1, content.indexOf("<"));
  				sb.append("<font class=font>" + temp + "</font></a>");
  			}
  			result += sb.toString();
  		}
     		return result.isEmpty() ? src : result;
     	}
     	
     	public String getDoc(String muliDocId,DocComInfo docComInfo){
     		muliDocId = Util.null2String(muliDocId);
  		String returnStr = "";
  		if (muliDocId.equals(""))
  			return "";
  		String[] tempArray = Util.TokenizerString2(muliDocId, ",");
  		for (int i = 0; i < tempArray.length; i++) {
  			String docname =  "<font class=font>" + docComInfo.getDocname(tempArray[i]) + "</font>";		
  			returnStr += "<a href='/docs/docs/DocDsp.jsp?id="+tempArray[i]+"' target='_blank'>"+docname + "</a><br>";
  		}
  		return returnStr;
  	}	
   
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      
	request.setCharacterEncoding("UTF-8");

      out.write(_jsp_string1, 0, _jsp_string1.length);
      
	User user = HrmUserVarify.getUser (request , response) ;
	if(user == null)  return ;
	Log logger= LogFactory.getLog(this.getClass());
	String isIE = (String)session.getAttribute("browser_isie");

      out.write(_jsp_string2, 0, _jsp_string2.length);
      weaver.formmode.view.ModeShareManager ModeShareManager;
      ModeShareManager = (weaver.formmode.view.ModeShareManager) pageContext.getAttribute("ModeShareManager");
      if (ModeShareManager == null) {
        ModeShareManager = new weaver.formmode.view.ModeShareManager();
        pageContext.setAttribute("ModeShareManager", ModeShareManager);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.conn.RecordSet rs1;
      rs1 = (weaver.conn.RecordSet) pageContext.getAttribute("rs1");
      if (rs1 == null) {
        rs1 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs1", rs1);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.conn.RecordSet rs2;
      rs2 = (weaver.conn.RecordSet) pageContext.getAttribute("rs2");
      if (rs2 == null) {
        rs2 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs2", rs2);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.conn.RecordSet rs3;
      rs3 = (weaver.conn.RecordSet) pageContext.getAttribute("rs3");
      if (rs3 == null) {
        rs3 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs3", rs3);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.conn.RecordSet rs4;
      rs4 = (weaver.conn.RecordSet) pageContext.getAttribute("rs4");
      if (rs4 == null) {
        rs4 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs4", rs4);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.conn.RecordSet rs_Setting;
      rs_Setting = (weaver.conn.RecordSet) pageContext.getAttribute("rs_Setting");
      if (rs_Setting == null) {
        rs_Setting = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs_Setting", rs_Setting);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.conn.RecordSet RecordSet;
      RecordSet = (weaver.conn.RecordSet) pageContext.getAttribute("RecordSet");
      if (RecordSet == null) {
        RecordSet = new weaver.conn.RecordSet();
        pageContext.setAttribute("RecordSet", RecordSet);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.conn.RecordSet rs;
      rs = (weaver.conn.RecordSet) pageContext.getAttribute("rs");
      if (rs == null) {
        rs = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs", rs);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.formmode.search.FormModeRightInfo FormModeRightInfo;
      FormModeRightInfo = (weaver.formmode.search.FormModeRightInfo) pageContext.getAttribute("FormModeRightInfo");
      if (FormModeRightInfo == null) {
        FormModeRightInfo = new weaver.formmode.search.FormModeRightInfo();
        pageContext.setAttribute("FormModeRightInfo", FormModeRightInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.workflow.field.BrowserComInfo BrowserComInfo;
      BrowserComInfo = (weaver.workflow.field.BrowserComInfo) pageContext.getAttribute("BrowserComInfo");
      if (BrowserComInfo == null) {
        BrowserComInfo = new weaver.workflow.field.BrowserComInfo();
        pageContext.setAttribute("BrowserComInfo", BrowserComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.hrm.company.DepartmentComInfo DepartmentComInfo;
      DepartmentComInfo = (weaver.hrm.company.DepartmentComInfo) pageContext.getAttribute("DepartmentComInfo");
      if (DepartmentComInfo == null) {
        DepartmentComInfo = new weaver.hrm.company.DepartmentComInfo();
        pageContext.setAttribute("DepartmentComInfo", DepartmentComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.hrm.resource.ResourceComInfo ResourceComInfo;
      ResourceComInfo = (weaver.hrm.resource.ResourceComInfo) pageContext.getAttribute("ResourceComInfo");
      if (ResourceComInfo == null) {
        ResourceComInfo = new weaver.hrm.resource.ResourceComInfo();
        pageContext.setAttribute("ResourceComInfo", ResourceComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.hrm.company.CostCenterComInfo CostcenterComInfo;
      CostcenterComInfo = (weaver.hrm.company.CostCenterComInfo) pageContext.getAttribute("CostcenterComInfo");
      if (CostcenterComInfo == null) {
        CostcenterComInfo = new weaver.hrm.company.CostCenterComInfo();
        pageContext.setAttribute("CostcenterComInfo", CostcenterComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.hrm.job.JobTitlesComInfo JobTitlesComInfo;
      JobTitlesComInfo = (weaver.hrm.job.JobTitlesComInfo) pageContext.getAttribute("JobTitlesComInfo");
      if (JobTitlesComInfo == null) {
        JobTitlesComInfo = new weaver.hrm.job.JobTitlesComInfo();
        pageContext.setAttribute("JobTitlesComInfo", JobTitlesComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.docs.docs.DocComInfo DocComInfo;
      DocComInfo = (weaver.docs.docs.DocComInfo) pageContext.getAttribute("DocComInfo");
      if (DocComInfo == null) {
        DocComInfo = new weaver.docs.docs.DocComInfo();
        pageContext.setAttribute("DocComInfo", DocComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.cpt.maintenance.CapitalAssortmentComInfo CapitalAssortmentComInfo;
      CapitalAssortmentComInfo = (weaver.cpt.maintenance.CapitalAssortmentComInfo) pageContext.getAttribute("CapitalAssortmentComInfo");
      if (CapitalAssortmentComInfo == null) {
        CapitalAssortmentComInfo = new weaver.cpt.maintenance.CapitalAssortmentComInfo();
        pageContext.setAttribute("CapitalAssortmentComInfo", CapitalAssortmentComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.cpt.capital.CapitalComInfo CapitalComInfo;
      CapitalComInfo = (weaver.cpt.capital.CapitalComInfo) pageContext.getAttribute("CapitalComInfo");
      if (CapitalComInfo == null) {
        CapitalComInfo = new weaver.cpt.capital.CapitalComInfo();
        pageContext.setAttribute("CapitalComInfo", CapitalComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.crm.Maint.CustomerInfoComInfo CustomerInfoComInfo;
      CustomerInfoComInfo = (weaver.crm.Maint.CustomerInfoComInfo) pageContext.getAttribute("CustomerInfoComInfo");
      if (CustomerInfoComInfo == null) {
        CustomerInfoComInfo = new weaver.crm.Maint.CustomerInfoComInfo();
        pageContext.setAttribute("CustomerInfoComInfo", CustomerInfoComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.proj.Maint.ProjectInfoComInfo ProjectInfoComInfo;
      ProjectInfoComInfo = (weaver.proj.Maint.ProjectInfoComInfo) pageContext.getAttribute("ProjectInfoComInfo");
      if (ProjectInfoComInfo == null) {
        ProjectInfoComInfo = new weaver.proj.Maint.ProjectInfoComInfo();
        pageContext.setAttribute("ProjectInfoComInfo", ProjectInfoComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.workflow.request.RequestComInfo RequestComInfo;
      RequestComInfo = (weaver.workflow.request.RequestComInfo) pageContext.getAttribute("RequestComInfo");
      if (RequestComInfo == null) {
        RequestComInfo = new weaver.workflow.request.RequestComInfo();
        pageContext.setAttribute("RequestComInfo", RequestComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.workflow.report.ReportComInfo ReportComInfo;
      ReportComInfo = (weaver.workflow.report.ReportComInfo) pageContext.getAttribute("ReportComInfo");
      if (ReportComInfo == null) {
        ReportComInfo = new weaver.workflow.report.ReportComInfo();
        pageContext.setAttribute("ReportComInfo", ReportComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.fna.maintenance.CurrencyComInfo CurrencyComInfo;
      CurrencyComInfo = (weaver.fna.maintenance.CurrencyComInfo) pageContext.getAttribute("CurrencyComInfo");
      if (CurrencyComInfo == null) {
        CurrencyComInfo = new weaver.fna.maintenance.CurrencyComInfo();
        pageContext.setAttribute("CurrencyComInfo", CurrencyComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.fna.maintenance.LedgerComInfo LedgerComInfo;
      LedgerComInfo = (weaver.fna.maintenance.LedgerComInfo) pageContext.getAttribute("LedgerComInfo");
      if (LedgerComInfo == null) {
        LedgerComInfo = new weaver.fna.maintenance.LedgerComInfo();
        pageContext.setAttribute("LedgerComInfo", LedgerComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.fna.maintenance.ExpensefeeTypeComInfo ExpensefeeTypeComInfo;
      ExpensefeeTypeComInfo = (weaver.fna.maintenance.ExpensefeeTypeComInfo) pageContext.getAttribute("ExpensefeeTypeComInfo");
      if (ExpensefeeTypeComInfo == null) {
        ExpensefeeTypeComInfo = new weaver.fna.maintenance.ExpensefeeTypeComInfo();
        pageContext.setAttribute("ExpensefeeTypeComInfo", ExpensefeeTypeComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.workflow.report.ReportShare MDCompanyNameInfo;
      MDCompanyNameInfo = (weaver.workflow.report.ReportShare) pageContext.getAttribute("MDCompanyNameInfo");
      if (MDCompanyNameInfo == null) {
        MDCompanyNameInfo = new weaver.workflow.report.ReportShare();
        pageContext.setAttribute("MDCompanyNameInfo", MDCompanyNameInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.file.ExcelFile ExcelFile;
      synchronized (pageContext.getSession()) {
        ExcelFile = (weaver.file.ExcelFile) pageContext.getSession().getAttribute("ExcelFile");
        if (ExcelFile == null) {
          ExcelFile = new weaver.file.ExcelFile();
          pageContext.getSession().setAttribute("ExcelFile", ExcelFile);
        }
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.workflow.request.ResourceConditionManager resourceConditionManager;
      resourceConditionManager = (weaver.workflow.request.ResourceConditionManager) pageContext.getAttribute("resourceConditionManager");
      if (resourceConditionManager == null) {
        resourceConditionManager = new weaver.workflow.request.ResourceConditionManager();
        pageContext.setAttribute("resourceConditionManager", resourceConditionManager);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.docs.senddoc.DocReceiveUnitComInfo DocReceiveUnitComInfo;
      DocReceiveUnitComInfo = (weaver.docs.senddoc.DocReceiveUnitComInfo) pageContext.getAttribute("DocReceiveUnitComInfo");
      if (DocReceiveUnitComInfo == null) {
        DocReceiveUnitComInfo = new weaver.docs.senddoc.DocReceiveUnitComInfo();
        pageContext.setAttribute("DocReceiveUnitComInfo", DocReceiveUnitComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.docs.category.DocTreeDocFieldComInfo DocTreeDocFieldComInfo;
      DocTreeDocFieldComInfo = (weaver.docs.category.DocTreeDocFieldComInfo) pageContext.getAttribute("DocTreeDocFieldComInfo");
      if (DocTreeDocFieldComInfo == null) {
        DocTreeDocFieldComInfo = new weaver.docs.category.DocTreeDocFieldComInfo();
        pageContext.setAttribute("DocTreeDocFieldComInfo", DocTreeDocFieldComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.hrm.company.SubCompanyComInfo SubCompanyComInfo;
      SubCompanyComInfo = (weaver.hrm.company.SubCompanyComInfo) pageContext.getAttribute("SubCompanyComInfo");
      if (SubCompanyComInfo == null) {
        SubCompanyComInfo = new weaver.hrm.company.SubCompanyComInfo();
        pageContext.setAttribute("SubCompanyComInfo", SubCompanyComInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.workflow.request.WorkflowJspBean WorkflowJspBean;
      WorkflowJspBean = (weaver.workflow.request.WorkflowJspBean) pageContext.getAttribute("WorkflowJspBean");
      if (WorkflowJspBean == null) {
        WorkflowJspBean = new weaver.workflow.request.WorkflowJspBean();
        pageContext.setAttribute("WorkflowJspBean", WorkflowJspBean);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.workflow.mode.FieldInfo FieldInfo;
      FieldInfo = (weaver.workflow.mode.FieldInfo) pageContext.getAttribute("FieldInfo");
      if (FieldInfo == null) {
        FieldInfo = new weaver.workflow.mode.FieldInfo();
        pageContext.setAttribute("FieldInfo", FieldInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.formmode.search.FormModeTransMethod FormModeTransMethod;
      FormModeTransMethod = (weaver.formmode.search.FormModeTransMethod) pageContext.getAttribute("FormModeTransMethod");
      if (FormModeTransMethod == null) {
        FormModeTransMethod = new weaver.formmode.search.FormModeTransMethod();
        pageContext.setAttribute("FormModeTransMethod", FormModeTransMethod);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.formmode.FormModeConfig FormModeConfig;
      FormModeConfig = (weaver.formmode.FormModeConfig) pageContext.getAttribute("FormModeConfig");
      if (FormModeConfig == null) {
        FormModeConfig = new weaver.formmode.FormModeConfig();
        pageContext.setAttribute("FormModeConfig", FormModeConfig);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.formmode.setup.ModeRightInfo ModeRightInfo;
      ModeRightInfo = (weaver.formmode.setup.ModeRightInfo) pageContext.getAttribute("ModeRightInfo");
      if (ModeRightInfo == null) {
        ModeRightInfo = new weaver.formmode.setup.ModeRightInfo();
        pageContext.setAttribute("ModeRightInfo", ModeRightInfo);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.conn.RecordSet rsm;
      rsm = (weaver.conn.RecordSet) pageContext.getAttribute("rsm");
      if (rsm == null) {
        rsm = new weaver.conn.RecordSet();
        pageContext.setAttribute("rsm", rsm);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.general.BaseBean baseBean;
      baseBean = (weaver.general.BaseBean) pageContext.getAttribute("baseBean");
      if (baseBean == null) {
        baseBean = new weaver.general.BaseBean();
        pageContext.setAttribute("baseBean", baseBean);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.page.style.ElementStyleCominfo esc;
      esc = (weaver.page.style.ElementStyleCominfo) pageContext.getAttribute("esc");
      if (esc == null) {
        esc = new weaver.page.style.ElementStyleCominfo();
        pageContext.setAttribute("esc", esc);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.homepage.cominfo.HomepageElementCominfo hpec;
      hpec = (weaver.homepage.cominfo.HomepageElementCominfo) pageContext.getAttribute("hpec");
      if (hpec == null) {
        hpec = new weaver.homepage.cominfo.HomepageElementCominfo();
        pageContext.setAttribute("hpec", hpec);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      
    //\u62a5\u8868id
	String customid = "";
	String fieldsWidth = "";
	String sqlBizListView = "";
	String formid = "";
	String strfields = "";
	String maintableAlias="t1";
	String detailtableAlias="d1";
	String detailfieldAlias="d_";
	HashMap hmEleSetting = new HashMap();
	String eid = Util.null2String(request.getParameter("eid"));
	String searchid = Util.null2String(request.getParameter("searchid"));
	String linkmode = Util.null2String(request.getParameter("linkmode"));
	String searchinfosql="select * from formmodeelement where id='"+searchid+"'";
	RecordSet.executeSql(searchinfosql);
	int countsearchinfosql = RecordSet.getCounts();
	String fe_fields="";
	String fe_fieldsWidth="";
	String fe_reportId="";
	int fe_isshowunread=0;
	String fe_isautoomit = "";
	while(RecordSet.next()){
		fe_reportId = Util.null2String(RecordSet.getString("reportId"));
		fe_fields = Util.null2String(RecordSet.getString("fields"));
		fe_fieldsWidth = Util.null2String(RecordSet.getString("fieldsWidth"));
		fe_isshowunread = Util.getIntValue(Util.null2String(RecordSet.getString("fieldsWidth")),0);
		fe_isautoomit = Util.null2String(RecordSet.getString("isautoomit"));
	}
	
	//modify by huguomin QC:263819   start
	String sqlhgm = "select a.fieldid, b.fieldname from mode_CustomDspField a left join workflow_billfield b on a.fieldid=b.id  where a.customid='"+fe_reportId+"' and isshow=1";
	RecordSet.executeSql(sqlhgm);
	Map idnameMap = new HashMap();		
	while (RecordSet.next()) {
		idnameMap.put(RecordSet.getString("fieldid"),RecordSet.getString("fieldname"));
	}
	String fe_fields_new = "";
	String fe_fieldsWidth_new = "";
	String [] fe_fieldslist = fe_fields.split(",");
	String [] fe_fieldsWidthlist = fe_fieldsWidth.split(",");
	for(int i = 0; i< fe_fieldslist.length; i++){
		if(!"".equals(idnameMap.get(fe_fieldslist[i])) || fe_fieldslist[i].indexOf("-") != -1){
			fe_fields_new += ","+fe_fieldslist[i];
			fe_fieldsWidth_new += ","+fe_fieldsWidthlist[i];
		}
	}
	if(fe_fields_new.indexOf(",") != -1){
		fe_fields = fe_fields_new.substring(1);
		fe_fieldsWidth = fe_fieldsWidth_new.substring(1);
	}else{
		fe_fields = fe_fields_new;
		fe_fieldsWidth = fe_fieldsWidth_new;
	}
	//modify by huguomin QC:263819   end
	sqlBizListView = "select * from hpElementSetting where eid='" + eid+ "'";
	
	RecordSet.executeSql(sqlBizListView);
	while (RecordSet.next()) {
		hmEleSetting.put(RecordSet.getString("name"),RecordSet.getString("value"));
	}
	
	int perpage = 0;
	perpage = Util.getIntValue(request.getParameter("perpage"),5);
	if(perpage<=0){
		perpage = 5;
	}
// 	customid = Util.null2String("" + hmEleSetting.get("reportId"));
	customid = fe_reportId;
	if(StringHelper.isEmpty(customid)){
		return;
	}
	session.setAttribute("page_formmode"+eid, customid);
	session.setAttribute("page_formmodeelementid"+eid, searchid);
	//\u67e5\u770b\u6743\u9650\u5224\u65ad==============================start
	boolean isRight = false;
	//\u81ea\u5b9a\u4e49\u9875\u9762\u67e5\u770b\u6743\u9650
	rs.executeSql("select * from mode_searchPageshareinfo where righttype=1 and pageid = " + customid);
	if(rs.next()){
		FormModeRightInfo.setUser(user);
		isRight = FormModeRightInfo.checkUserRight(Util.getIntValue(customid),1);
	}else{  //\u6ca1\u6709\u8bbe\u7f6e\u4efb\u4f55\u67e5\u770b\u6743\u9650\u6570\u636e\uff0c\u5219\u8ba4\u4e3a\u6709\u6743\u9650\u67e5\u770b
		isRight = true;
	}
	if(!isRight){
		
      out.write(_jsp_string4, 0, _jsp_string4.length);
      out.print((SystemEnv.getHtmlLabelName(2012,user.getLanguage())));
      out.write(_jsp_string5, 0, _jsp_string5.length);
      
		return;
	}
	//\u67e5\u770b\u6743\u9650\u5224\u65ad================================end
	
// 	strfields = Util.null2String("" + hmEleSetting.get("fields"));
	strfields = fe_fields;
	fieldsWidth = fe_fieldsWidth;
	int isshowtitle = Util.getIntValue(Util.null2String(hmEleSetting.get("isshowtitle")),1);
	String rolltype = Util.null2String(hmEleSetting.get("rolltype"));
	ArrayList<String> fields = new ArrayList<String>();
	String[] fieldsArray = strfields.split(",");
	String isbill = "1";
	String customname = "";
	String modeid = "0";
	String defaultsql = "";
	String detailtablename = "";
	String sql = "select a.modeid,a.defaultsql,a.formid,a.customname,a.norightlist,javafilename,searchConditionType,detailtable from mode_customsearch a where a.id = "+ customid;
	RecordSet.executeSql(sql);
	int countsql = RecordSet.getCounts();
	//modify by huguomin 20170828 QC:263819   start


	//modify by huguomin 20170828 QC:263819   end
	String norightlist="";
	while (RecordSet.next()) {
		detailtablename = Util.null2String(RecordSet.getString("detailtable"));
		formid = Util.null2String(RecordSet.getString("formid"));
		customname = Util
				.null2String(RecordSet.getString("customname"));
		modeid = Util.null2String(RecordSet.getString("modeid"));
		defaultsql = Util.null2String(RecordSet.getString("defaultsql"));
		if(!defaultsql.equals("")){
			defaultsql = FormModeTransMethod.getDefaultSql(user,"","",defaultsql);
		}
		String javafilename = Util.null2String(RecordSet.getString("javafilename"));
		String searchConditionType = Util.null2String(RecordSet.getString("searchConditionType"));
		if(searchConditionType.equals("2")&&!StringHelper.isEmpty(javafilename)){
			Map<String, String> sourceCodePackageNameMap = CommonConstant.SOURCECODE_PACKAGENAME_MAP;
			String sourceCodePackageName = sourceCodePackageNameMap.get("2");
			String classFullName = sourceCodePackageName + "." + javafilename;
			
			Map<String, Object> param = new HashMap<String, Object>();
			param.put("user", user);
			Object result = CustomJavaCodeRun.run(classFullName, param);
			defaultsql = Util.null2String(result);
		}
		
		norightlist = Util.null2String(RecordSet.getString("norightlist"));
	}
	//\u662f\u5426\u5f00\u542f\u5217\u8868\u672a\u8bfb\uff0c\u53cd\u9988\u6807\u8bc6\u529f\u80fd,1\u672a\u8bfb\u30012\u53cd\u9988\u548c3\u5df2\u8bfb
	boolean isenabled = FormModeConfig.isEnabled();
	boolean isVirtualForm = VirtualFormHandler.isVirtualForm(formid);
	String vdatasource = "";
	String vdatasourceDBtype = RecordSet.getDBType();
	String tablename = "";
	String vprimarykey = "";
	String vpkgentype = "";
	if (isVirtualForm) {
		Map<String, Object> vFormInfo = VirtualFormHandler
				.getVFormInfo(formid);
		vdatasource = Util.null2String(vFormInfo.get("vdatasource"));
		vprimarykey = Util.null2String(vFormInfo.get("vprimarykey"));
		vpkgentype = Util.null2String(vFormInfo.get("vpkgentype"));
		DataSourceXML dataSourceXML = new DataSourceXML();
		vdatasourceDBtype = dataSourceXML
				.getDataSourceDBType(vdatasource);
		
	}else{
		vprimarykey = "id";
		if(!StringHelper.isEmpty(modeid)&&!"0".equals(modeid)){
			if(StringHelper.isEmpty(defaultsql)){
				defaultsql +=  maintableAlias+".formmodeid="+modeid;
			}else{
				defaultsql += " and "+maintableAlias+".formmodeid="+modeid;
			}
		}
	}
	RecordSet.executeSql("select tablename from workflow_bill where id = "+formid);
	if(RecordSet.next())
		tablename = RecordSet.getString(1);
	if(isVirtualForm)
		tablename = VirtualFormHandler.getRealFromName(tablename);
	List fieldids = new ArrayList();
	List fieldnames = new ArrayList();
	List fieldLabels = new ArrayList();
	List fielddbtypes = new ArrayList();
	List htmltypes = new ArrayList();
	List types = new ArrayList();
	List viewtypes = new ArrayList();
	List isstats = new ArrayList();
	List statvalues = new ArrayList();
	List tempstatvalues = new ArrayList();
	List isdetails = new ArrayList();
	String requestid = "";
	boolean isnew = true;
	List isdborders = new ArrayList();

	ArrayList compositorOrderList = new ArrayList();
	ArrayList compositorColList = new ArrayList();
	ArrayList compositorColList2 = new ArrayList();

	List ids = new ArrayList();
	List isMains = new ArrayList();
	List isShows = new ArrayList();
	List isCheckConds = new ArrayList();
	List colnames = new ArrayList();
	List htmlTypes = new ArrayList();
	List typeTemps = new ArrayList();
	List opts = new ArrayList();
	List values = new ArrayList();
	List names = new ArrayList();
	List opt1s = new ArrayList();
	List value1s = new ArrayList();
	List hreflinks = new ArrayList();
	List istitles = new ArrayList();
	List detailtablefieldnames = new ArrayList();
	
	int ordercount=0;
	String detailkeyfield = "";
	String fieldname = "";
	String orderbystr ="";

	ReportCompositorOrderBean reportCompositorOrderBean = new ReportCompositorOrderBean();
	ReportCompositorListBean rcListBean = new ReportCompositorListBean();
	ReportCompositorListBean rcColListBean = new ReportCompositorListBean();
	Map<String, Integer> fieldShowingTransferedStatusMap = new HashMap<String, Integer>();

	sql = " select a.fieldname , c.labelname, a.fieldhtmltype, a.type,a.fielddbtype, "
			+ " b.isstat , a.viewtype , a.id ,a.detailtable,"
			+ " b.queryorder,b.isorder,b.priorder,a.fielddbtype,b.ordertype, b.showmethod "
			+ " from  workflow_billfield a, mode_CustomDspField b , HtmlLabelInfo c "
			+ " where a.id = b.fieldid and a.fieldlabel = c.indexid "
			+ " and b.customid = "
			+ customid
			+ " and  c.languageid = "
			+ user.getLanguage() +" order by priorder ";
	RecordSet.executeSql(sql);
	while (RecordSet.next()) {
		if (strfields.indexOf(Util.null2String(RecordSet
				.getString("id"))) == -1) {
			continue;
		}
		fieldShowingTransferedStatusMap.put(RecordSet.getString("id"), RecordSet.getInt("showmethod"));
		
		String viewtype = Util.null2String(RecordSet
				.getString("viewtype"));
		if (viewtype.equals("1")) {
			viewtype = detailtableAlias;
			//detailtablename = Util.null2String(RecordSet.getString("detailtable"));
			detailtablefieldnames.add(Util.null2String(RecordSet.getString("fieldname")));
		} else {
			viewtype = maintableAlias;
		}
		rcListBean = new ReportCompositorListBean();
		rcListBean.setCompositorList(strfields.indexOf(RecordSet
				.getString("id")));
		rcListBean.setSqlFlag(viewtype);
		rcListBean.setFieldName(Util.null2String(RecordSet
				.getString("fieldname")));
		rcListBean.setFieldId(Util.null2String(RecordSet
				.getString("id")));
		rcListBean.setColName(Util.toScreen(
				RecordSet.getString("labelname"), user.getLanguage()));
		compositorColList.add(rcListBean);
		fields.add(Util.null2String(RecordSet.getString("fieldname")));
		if (RecordSet.getInt("isorder") != 0&&!StringHelper.isEmpty(RecordSet.getString("isorder"))) {
			reportCompositorOrderBean = new ReportCompositorOrderBean();
			reportCompositorOrderBean.setCompositorOrder(RecordSet
					.getInt("priorder"));
			reportCompositorOrderBean.setOrderType(Util
					.null2String(RecordSet
							.getString("ordertype")));
			String ordertmpfieldname = Util.null2String(RecordSet.getString("fieldname"));
			reportCompositorOrderBean.setFieldName(ordertmpfieldname);
			reportCompositorOrderBean.setSqlFlag(viewtype);
			compositorOrderList.add(reportCompositorOrderBean);
		}

	}
	
	//\u53ea\u6709\u663e\u793a\u8bf7\u6c42\u8bf4\u660e\u65f6\u624d\u6267\u884c\u4e0b\u9762\u7684\u64cd\u4f5c
	if (strfields.indexOf("-1") != -1) {
		RecordSet
				.executeSql("select * from mode_CustomDspField where customid = "
						+ customid + " and fieldid = -1");
		if (RecordSet.next()) {
			rcListBean = new ReportCompositorListBean();
			rcListBean.setCompositorList(strfields.indexOf("-1"));
			
			rcListBean.setSqlFlag(maintableAlias);
			rcListBean.setFieldName("modedatacreatedate");
			rcListBean.setFieldId("-1");
			rcListBean.setColName(SystemEnv.getHtmlLabelName(722,
					user.getLanguage()));
			compositorColList.add(rcListBean);
			fields.add("modedatacreatedate");
			//fielddbtypes.add("char(10)");
			if (RecordSet.getInt("isorderfield") > 0) {
				reportCompositorOrderBean = new ReportCompositorOrderBean();
				reportCompositorOrderBean.setCompositorOrder(RecordSet
						.getInt("priorder"));
				reportCompositorOrderBean.setOrderType(Util
						.null2String(getOrderSql(RecordSet
								.getInt("isorderfield"))));
				reportCompositorOrderBean
						.setFieldName("modedatacreatedate");
				reportCompositorOrderBean.setSqlFlag(maintableAlias);
				compositorOrderList.add(reportCompositorOrderBean);
			}
		}
	}

	if (strfields.indexOf("-2") != -1) {
		RecordSet
				.executeSql("select * from mode_CustomDspField where customid = "
						+ customid + " and fieldid = -2");
		if (RecordSet.next()) {
			rcListBean = new ReportCompositorListBean();
			rcListBean.setCompositorList(strfields.indexOf("-2"));
			rcListBean.setSqlFlag(maintableAlias);
			rcListBean.setFieldName("modedatacreater");
			rcListBean.setFieldId("-2");
			rcListBean.setColName(SystemEnv.getHtmlLabelName(882,
					user.getLanguage()));
			compositorColList.add(rcListBean);
			fields.add("modedatacreater");
			//fielddbtypes.add("char(10)");
			if (RecordSet.getInt("isorderfield") > 0) {
				reportCompositorOrderBean = new ReportCompositorOrderBean();
				reportCompositorOrderBean.setCompositorOrder(RecordSet
						.getInt("priorder"));
				reportCompositorOrderBean.setOrderType(Util
						.null2String(getOrderSql(RecordSet
								.getInt("isorderfield"))));
				reportCompositorOrderBean
						.setFieldName("modedatacreater");
				reportCompositorOrderBean.setSqlFlag(maintableAlias);
				compositorOrderList.add(reportCompositorOrderBean);
			}
		}
	}
	
	
	compositorColList2 = ReportComInfo
			.getCompositorList(compositorColList);
	List<String> titlefields = new ArrayList<String>();
	for (int a = 0; a < fieldsArray.length; a++) {
		String tempfieldid = fieldsArray[a];
		RecordSet
				.executeSql("select * from mode_CustomDspField where customid = "
						+ customid
						+ " and fieldid = "
						+ tempfieldid);
		if (RecordSet.next()) {
			String istitle = RecordSet.getString("istitle");
			String hreflink = RecordSet.getString("hreflink");
			if(!"0".equals(istitle)){
				titlefields.add(tempfieldid);
			}
			
			if ("-1".equals(tempfieldid) || "-2".equals(tempfieldid)) {
				fieldShowingTransferedStatusMap.put(tempfieldid, RecordSet.getInt("showmethod"));
				htmltypes.add(tempfieldid);
				hreflinks.add("");
				istitles.add("0");
				types.add(tempfieldid);
				viewtypes.add("0");
				isdetails.add("");
				if("-1".equals(tempfieldid)){
					fieldnames.add(maintableAlias+".modedatacreatedate");
					fieldLabels.add(SystemEnv.getHtmlLabelName(722,user.getLanguage()));
					fieldids.add(tempfieldid);
					fielddbtypes.add("varchar");
				}else{
					fieldnames.add(maintableAlias+".modedatacreater");
					fieldLabels.add(SystemEnv.getHtmlLabelName(882,user.getLanguage()));
					fieldids.add(tempfieldid);
					fielddbtypes.add("varchar");
				}
			} else {
				if (!formid.equals("")) {
					rs2.executeSql("select * from workflow_billfield where id = "
							+ tempfieldid
							+ " and billid="
							+ formid);
					if (rs2.next()) {
						htmltypes.add(Util.null2String(rs2
								.getString("fieldhtmltype")));
						types.add(Util.null2String(rs2
								.getString("type")));
						viewtypes.add(Util.null2String(rs2.getString("viewtype")));
						
						String detailtabletmp = Util.null2String(rs2
								.getString("detailtable"));
						hreflinks.add(hreflink);
						istitles.add(istitle);
						if (!"".equals(detailtabletmp)) {
							isdetails.add("1");
							fieldnames.add(detailtableAlias+"."+Util.null2String(rs2.getString("fieldname"))+" as "+detailfieldAlias+Util.null2String(rs2.getString("fieldname")));
						} else {
							isdetails.add("");
							fieldnames.add(maintableAlias+"."+Util.null2String(rs2.getString("fieldname")));
						}
						fieldids.add(tempfieldid);
						fielddbtypes.add(Util.null2String(rs2.getString("fielddbtype")));
						fieldLabels.add(SystemEnv.getHtmlLabelName(Util.getIntValue(rs2.getString("fieldlabel")),user.getLanguage()));
					}
				}
			}
		}
	}
	
	//String ordersql = ReportComInfo.getCompositorOrderByStrs(compositorOrderList);
	String ordersql =  "";
	CustomSearchService CustomSearchService = new CustomSearchService();
	if(isVirtualForm){	//\u865a\u62df\u8868\u5355
		ordersql += CustomSearchService.getOrderSQL(customid);
		if(!ordersql.equals("")){
			ordersql += ",";
		}
		ordersql += "t1." + vprimarykey+" desc";
	} else { //\u5b9e\u9645\u8868\u5355
		ordersql += CustomSearchService.getOrderSQL(customid);
		if(!ordersql.equals("")){
			ordersql += ",";
		}
		ordersql += "t1.id desc";
	}
	
	if(!"".equals(detailtablename)){
		ordersql+=","+detailtableAlias+".id desc";
	}
	ordersql = " order by "+ordersql;
	String rightsql = "";
	List<User> lsUser = ModeRightInfo.getAllUserCountList(user);
	if(!isVirtualForm){
		if(modeid.equals("")||modeid.equals("0")){//\u67e5\u8be2\u4e2d\u6ca1\u6709\u8bbe\u7f6e\u6a21\u5757
			String sqlStr1 = "select id,modename from modeinfo where formid='"+formid+"' order by id";
			rsm.executeSql(sqlStr1);
			while(rsm.next()){
				String mid = rsm.getString("id");
				ModeShareManager.setModeId(Util.getIntValue(mid,0));
				for(int i=0;i<lsUser.size();i++){
					User tempUser = lsUser.get(i);
					String tempRightStr = ModeShareManager.getShareDetailTableByUser("formmode",tempUser);
					if(rightsql.isEmpty()){
						rightsql += tempRightStr;
					}else {
						rightsql += " union  all "+ tempRightStr;
					}
				}
			}
			if(!rightsql.isEmpty()){
				rightsql = " (SELECT  sourceid,MAX(sharelevel) AS sharelevel from ( "+rightsql+" ) temptable group by temptable.sourceid) ";
			}
		}else{
			ModeShareManager.setModeId(Util.getIntValue(modeid,0));
			for(int i=0;i<lsUser.size();i++){
				User tempUser = (User)lsUser.get(i);
				String tempRightStr = ModeShareManager.getShareDetailTableByUser("formmode",tempUser);
				if(rightsql.isEmpty()){
					rightsql += tempRightStr;
				}else {
					rightsql += " union  all "+ tempRightStr;
				}
			}
			if(!rightsql.isEmpty()){
				rightsql = " (SELECT  sourceid,MAX(sharelevel) AS sharelevel from ( "+rightsql+" ) temptable group by temptable.sourceid) ";
			}
		}
}
	//=================
	if(defaultsql.indexOf("PARM(")>-1){
			int beginIndex = defaultsql.indexOf("PARM(");
			while(beginIndex>-1){
				int endIndex = defaultsql.indexOf(")",beginIndex+5);
				int nextIndex = 0;
				if(endIndex>-1){
					String substring = defaultsql.substring(beginIndex+5, endIndex);
					if(request.getParameter(substring)==null){
						beginIndex = defaultsql.indexOf("PARM(",endIndex-nextIndex+1);
					}else{
						String paramvalue = Util.null2String(request.getParameter(substring));
						defaultsql = defaultsql.replace("PARM("+substring+")", paramvalue);
						if(paramvalue.length()<substring.length()){
							nextIndex = substring.length()-paramvalue.length();
						}
						beginIndex = defaultsql.indexOf("PARM(",endIndex-nextIndex+1);
					}
				}else{
					break;
				}
			}
	}
	//=================	
	String querysql = getQuerySql(tablename, detailtablename,fieldnames,fielddbtypes,defaultsql,perpage,vdatasourceDBtype,ordersql,rightsql,norightlist,vprimarykey);
	String[] fieldsWidthArray =  null;
	String tdExtendStyle = "";
	if(!tablename.isEmpty()){
		if(isVirtualForm){
			RecordSet.executeSql(querysql, vdatasource);
		}else{
			RecordSet.executeSql(querysql);
		}
		fieldsWidthArray =  fieldsWidth.split(","); 
		if("1".equals(fe_isautoomit)){
			tdExtendStyle = "overflow:hidden;white-space:nowrap;word-break:keep-all;text-overflow:ellipsis;";
		}
	}

      out.write(_jsp_string6, 0, _jsp_string6.length);
      out.print((isshowtitle==1?"":"none"));
      out.write(_jsp_string7, 0, _jsp_string7.length);
      
			if(countsearchinfosql<2 && countsql == 0){
			
      out.write(_jsp_string8, 0, _jsp_string8.length);
      out.print((SystemEnv.getHtmlLabelName(382469,user.getLanguage()) ));
      out.write(_jsp_string9, 0, _jsp_string9.length);
      out.print((SystemEnv.getHtmlLabelName(382469,user.getLanguage()) ));
      out.write(_jsp_string10, 0, _jsp_string10.length);
      }else if(customid==null || "".equals(customid) || strfields==null || "".equals(strfields)){
      out.write(_jsp_string11, 0, _jsp_string11.length);
      out.print((SystemEnv.getHtmlLabelName(382469,user.getLanguage()) ));
      out.write(_jsp_string9, 0, _jsp_string9.length);
      out.print((SystemEnv.getHtmlLabelName(382469,user.getLanguage()) ));
      out.write(_jsp_string12, 0, _jsp_string12.length);
      }else{
		
				for (int i = 0; i < fieldsArray.length; i++) {
					String fWidth =  fieldsWidthArray[i];
			
      out.write(_jsp_string13, 0, _jsp_string13.length);
      out.print((Util.null2String(fieldLabels.get(i))));
      out.write(_jsp_string14, 0, _jsp_string14.length);
      out.print((fWidth));
      out.write(';');
      out.print((tdExtendStyle));
      out.write(_jsp_string15, 0, _jsp_string15.length);
      out.print((Util.null2String(fieldLabels.get(i))));
      out.write(_jsp_string16, 0, _jsp_string16.length);
      
				}
			}
		
      out.write(_jsp_string17, 0, _jsp_string17.length);
      
double height=18*RecordSet.getCounts();
if("Up".equals(rolltype)||"Down".equals(rolltype)) {
	out.println("<MARQUEE DIRECTION="+rolltype.toLowerCase()+"  id=\"MARQUEE_"+eid+"\" onmouseover=\"MARQUEE_"+eid+".stop()\" onmouseout=\"MARQUEE_"+eid+".start()\"  SCROLLDELAY=200 width=\"100%\" height=\""+height+"\">");
}else if("Left".equals(rolltype)||"Right".equals(rolltype)) {
	out.println("<MARQUEE DIRECTION="+rolltype.toLowerCase()+"  id=\"MARQUEE_"+eid+"\" onmouseover=\"MARQUEE_"+eid+".stop()\" onmouseout=\"MARQUEE_"+eid+".start()\"  SCROLLDELAY=200>");
}

      out.write(_jsp_string18, 0, _jsp_string18.length);
      
		String imgSymbol="";
		if (!"".equals(esc.getIconEsymbol(hpec.getStyleid(eid)))){
 			imgSymbol="<img name='esymbol' src='"+esc.getIconEsymbol(hpec.getStyleid(eid))+"'>";
 		}else{
 			imgSymbol = "<IMG name=esymbol src='/images/homepage/style/style1/esymbol_wev8.gif'>";
 		}
		 while(RecordSet.next()){
		 
      out.write(_jsp_string19, 0, _jsp_string19.length);
      out.print((imgSymbol ));
      out.write(_jsp_string20, 0, _jsp_string20.length);
      
							for (int i = 0; i < fieldsArray.length; i++) {
								String fWidth =  fieldsWidthArray[i];
								String result = Util.null2String(RecordSet
										.getString(i + 1));
										
								String tempFieldId = fieldsArray[i];
								String tempFieldValue = result;
								String tempdbtype = (String)fielddbtypes.get(i);
								String tempviewtype = (String)viewtypes.get(i);
								//customid \u5df2\u7ecf\u6709\u503c
								String htmltype = (String) htmltypes.get(i);
								int type = Util.getIntValue((String) types
										.get(i));
								String hreflink =(String)hreflinks.get(i);
								int istitle = Util.getIntValue((String) istitles
										.get(i),0);
								String results[] = null;
								String billid_id = RecordSet.getString("id");
								if(htmltype.equals("1")){
									result = "<font class=font>"+result+"</font>";
									if(hreflink.indexOf("$")>-1){
										hreflink = changehreflink(hreflink,tablename,vdatasource,billid_id,formid);
									}
									/*if(istitle==1){
										//result = "<a href='javascript:void(0)' onclick=openFullWindowForXtable('"+hreflink+"') >"+result+"</a>";
									}else if(istitle==2){
										if(linkmode.equals("2")){
											result = "<a href=\"javascript:modeopenFullWindowHaveBar('"+hreflink+"','"+eid+"_"+billid_id+"')\" >"+result+"</a>";
										}else{
											result = "<a href='"+hreflink+"' target='_self' >"+result+"</a>";
										}
									}else if(istitle==3){
										if(linkmode.equals("2")){
											result = "<a href=\"javascript:modeopenFullWindowHaveBar('"+hreflink+"','"+eid+"_"+billid_id+"')\" >"+result+"</a>";
										}else{
											result = "<a  href='"+hreflink+"' target='_self'>"+result+"</a>";
										}
									}*/
								}
								if (htmltype.equals("-2")) {
									result = Util.toScreen(ResourceComInfo
											.getResourcename(result), user
											.getLanguage());
									result = "<font class=font>"+result+"</font>";
								}else if (htmltype.equals("3")) {
									switch (type) {
									case 1://\u4eba\u529b\u8d44\u6e90
										if(istitle != 0){
											result = ResourceComInfo.getResourcename(result);
										}else{
											result = Util.toScreen(ResourceComInfo
													.getMulResourcename1(result), user
													.getLanguage());
										}
										break;
									case 23:
										result = Util.toScreen(CapitalComInfo
												.getCapitalname(result), user
												.getLanguage());
										break;
									case 4://\u90e8\u95e8
										if(istitle != 0){
											result = DepartmentComInfo.getDepartmentname(result);
										}else{
											result = Util
													.toScreen(
															DepartmentComInfo
																	.getDepartmentnameToLink(result),
															user.getLanguage());
										}
										break;
									case 6:
										result = Util
												.toScreen(
														CostcenterComInfo
																.getCostCentername(result),
														user.getLanguage());
										break;
									case 7:
										result = Util
												.toScreen(
														CustomerInfoComInfo
																.getCustomerInfoname(result),
														user.getLanguage());
										break;
									case 8:
										result = Util
												.toScreen(
														ProjectInfoComInfo
																.getProjectInfoname(result),
														user.getLanguage());
										break;
									case 9://\u6587\u6863
										if(istitle != 0){
											result = DocComInfo.getDocname(result);
										}else{
											result = Util.toScreen(
													DocComInfo.getMuliDocName2(result),
													user.getLanguage());
										}
										break;
									case 12:
										result = Util.toScreen(CurrencyComInfo
												.getCurrencyname(result), user
												.getLanguage());
										break;
									case 25:
										result = Util
												.toScreen(
														CapitalAssortmentComInfo
																.getAssortmentName(result),
														user.getLanguage());
										break;
									case 14:
									case 15:
										result = Util.toScreen(LedgerComInfo
												.getLedgername(result), user
												.getLanguage());
										break;
									case 16://\u5355\u6d41\u7a0b
										if(istitle == 0){
											result = "<a href=\"/workflow/request/ViewRequest.jsp?requestid="+result+"\" target=\"_new\">"+Util.toScreen(RequestComInfo
												.getRequestname(result), user
												.getLanguage())+"</a>";
										}else{
											result = Util.toScreen(RequestComInfo
												.getRequestname(result), user
												.getLanguage());
										}
										break;
									case 17:
										results = Util.TokenizerString2(result,
												",");
										if (results != null) {
											for (int j = 0; j < results.length; j++) {
												if (j == 0)
													result = Util
															.toScreen(
																	ResourceComInfo
																			.getMulResourcename1(results[j]),
																	user.getLanguage());
												else
													result += ","
															+ Util.toScreen(
																	ResourceComInfo
																			.getMulResourcename1(results[j]),
																	user.getLanguage());
											}
										}
										break;
									case 18:
										results = Util.TokenizerString2(result,
												",");
										if (results != null) {
											for (int j = 0; j < results.length; j++) {
												if (j == 0)
													result = Util
															.toScreen(
																	CustomerInfoComInfo
																			.getCustomerInfoname(results[j]),
																	user.getLanguage());
												else
													result += ","
															+ Util.toScreen(
																	CustomerInfoComInfo
																			.getCustomerInfoname(results[j]),
																	user.getLanguage());
											}
										}
										break;
									case 24:
										result = Util.toScreen(JobTitlesComInfo
												.getJobTitlesname(result), user
												.getLanguage());
										break;
									case 37: // \u589e\u52a0\u591a\u6587\u6863\u5904\u7406
										results = Util.TokenizerString2(result,
												",");
										if (results != null) {
											for (int j = 0; j < results.length; j++) {
												if (j == 0)
													result = Util
															.toScreen(
																	DocComInfo
																			.getMuliDocName2(results[j]),
																	user.getLanguage());
												else
													result += ","
															+ Util.toScreen(
																	DocComInfo
																			.getMuliDocName2(results[j]),
																	user.getLanguage());
											}
										}
										break;
									case 57: // \u589e\u52a0\u591a\u90e8\u95e8\u5904\u7406
										results = Util.TokenizerString2(result,
												",");
										if (results != null) {
											for (int j = 0; j < results.length; j++) {
												if (j == 0)
													result = Util
															.toScreen(
																	DepartmentComInfo
																			.getDepartmentnameToLink(results[j]),
																	user.getLanguage());
												else
													result += ","
															+ Util.toScreen(
																	DepartmentComInfo
																			.getDepartmentnameToLink(results[j]),
																	user.getLanguage());
											}
										}
										break;
									case 2:
										break;
									case 19:
										break;
									case 42: //\u5206\u90e8
										result = Util
												.toScreen(
														SubCompanyComInfo
																.getSubCompanynameToLink(result),
														user.getLanguage());
										break;
										
									case 164: //\u589e\u52a0\u5206\u90e8
										if(istitle != 0){
											result = SubCompanyComInfo.getSubCompanyname(result);
										}else{
											result = Util
													.toScreen(
															SubCompanyComInfo
																	.getSubCompanynameToLink(result),
															user.getLanguage());
										}
										break;
									case 194: //\u589e\u52a0\u591a\u5206\u90e8
										results = Util.TokenizerString2(result,
										",");
											if (results != null) {
												for (int j = 0; j < results.length; j++) {
													if (j == 0)
														result = Util
																.toScreen(
																		SubCompanyComInfo
																			.getSubCompanynameToLink(results[j]),
																		user.getLanguage());
													else
														result += ","
																+ Util.toScreen(
																		SubCompanyComInfo
																			.getSubCompanynameToLink(results[j]),
																		user.getLanguage());
												}
											}
										break;
									case 65: //\u591a\u89d2\u8272\u5904\u7406 added xwj for td2127 on 2005-06-20
										Map roleMap = new HashMap();
										String sql_ = "select ID,RolesName from HrmRoles";
										rs.executeSql(sql_);
										while (rs.next()) {
											roleMap.put(rs.getString("ID"),
													rs.getString("RolesName"));
										}
										results = Util.TokenizerString2(result,
												",");
										if (results != null) {
											for (int j = 0; j < results.length; j++) {
												if (j == 0)
													result = Util
															.toScreen(
																	(String) roleMap
																			.get(results[j]),
																	user.getLanguage());
												else
													result += ","
															+ Util.toScreen(
																	(String) roleMap
																			.get(results[j]),
																	user.getLanguage());
											}
										}
										break;
									case 141:
										//\u4eba\u529b\u8d44\u6e90\u6761\u4ef6
										result = resourceConditionManager
												.getFormShowName(result,
														user.getLanguage());
										break;
									case 142:
										//\u6536\u53d1\u6587\u5355\u4f4d
										results = Util.TokenizerString2(result,
												",");
										if (results != null) {
											for (int j = 0; j < results.length; j++) {
												if (j == 0)
													result = Util
															.toScreen(
																	DocReceiveUnitComInfo
																			.getReceiveUnitName(results[j]),
																	user.getLanguage());
												else
													result += ","
															+ Util.toScreen(
																	DocReceiveUnitComInfo
																			.getReceiveUnitName(results[j]),
																	user.getLanguage());
											}
										}
										break;
									case 143:
										//\u6811\u72b6\u6587\u6863
										results = Util.TokenizerString2(result,
												",");
										if (results != null) {
											for (int j = 0; j < results.length; j++) {
												if (j == 0)
													result = Util
															.toScreen(
																	DocTreeDocFieldComInfo
																			.getTreeDocFieldName(results[j]),
																	user.getLanguage());
												else
													result += ","
															+ Util.toScreen(
																	DocTreeDocFieldComInfo
																			.getTreeDocFieldName(results[j]),
																	user.getLanguage());
											}
										}
										break;
									case 152:
										//\u591a\u8bf7\u6c42
										results = Util.TokenizerString2(result,
												",");
										if (results != null) {
											result = "";
											for (int j = 0; j < results.length; j++) {
												String sql2 = "select "
														+ BrowserComInfo
																.getBrowsercolumname(""
																		+ type)
														+ " from "
														+ BrowserComInfo
																.getBrowsertablename(""
																		+ type)
														+ " where "
														+ BrowserComInfo
																.getBrowserkeycolumname(""
																		+ type)
														+ "=" + results[j];
												rs.executeSql(sql2);
												while (rs.next()) {
													result += "<a href=\"/workflow/request/ViewRequest.jsp?requestid="+results[j]+"\" target=\"_new\">"+Util.toScreen(
															rs.getString(1),
															user.getLanguage())+"</a>"
															+ ",";
												}
											}
											if (!result.equals(""))
												result = result.substring(0,
														result.length() - 1);
										}
										break;
									case 135:
										//\u591a\u9879\u76ee
										results = Util.TokenizerString2(result,
												",");
										if (results != null) {
											result = "";
											for (int j = 0; j < results.length; j++) {
												String sql2 = "select "
														+ BrowserComInfo
																.getBrowsercolumname(""
																		+ type)
														+ " from "
														+ BrowserComInfo
																.getBrowsertablename(""
																		+ type)
														+ " where "
														+ BrowserComInfo
																.getBrowserkeycolumname(""
																		+ type)
														+ "=" + results[j];
												rs.executeSql(sql2);
												while (rs.next()) {
													result += Util.toScreen(
															rs.getString(1),
															user.getLanguage())
															+ ",";
												}
											}
											if (!result.equals(""))
												result = result.substring(0,
														result.length() - 1);
										}
										break;
									case 161://\u81ea\u5b9a\u4e49\u5355\u9009
									case 162:
										//\u81ea\u5b9a\u4e49\u5355\u9009,\u591a\u9009
										if (!result.equals("")) {
											//\u83b7\u53d6\u5b57\u6bb5\u7684\u6570\u636e\u5e93\u7c7b\u578b
											String tempfid = (String) fieldids
													.get(i);
											String tempfdbtype = "";
											rs1.execute("select fielddbtype from workflow_billfield where id="
													+ tempfid);
											if (rs1.next())
												tempfdbtype = rs1
														.getString("fielddbtype");
											//modify by huguomin QC:292207 \u67e5\u8be2\u5217\u8868\u4e2d\u7684\u94fe\u63a5\u5b57\u6bb5\u652f\u6301\u6d4f\u89c8\u6846\u7c7b\u578b\uff0c\u9664\u591a\u9009\u4ee5\u5916  ---\u6b64\u529f\u80fd\u5728\u95e8\u6237\u5efa\u6a21\u4e2d\u5fc3\u4f7f\u7528\u4e0d\u751f\u6548 start
											if(istitle!=0){
												 Browser browser=(Browser) StaticObj.getServiceByFullname(tempfdbtype, Browser.class);
										         BrowserBean bb=browser.searchById(result);
											     String name=Util.null2String(bb.getName());
												 result = name;
												break;
											}
											//modify by huguomin QC:292207 \u67e5\u8be2\u5217\u8868\u4e2d\u7684\u94fe\u63a5\u5b57\u6bb5\u652f\u6301\u6d4f\u89c8\u6846\u7c7b\u578b\uff0c\u9664\u591a\u9009\u4ee5\u5916  ---\u6b64\u529f\u80fd\u5728\u95e8\u6237\u5efa\u6a21\u4e2d\u5fc3\u4f7f\u7528\u4e0d\u751f\u6548 start
											result = WorkflowJspBean
													.getWorkflowBrowserShowName(
															result, "" + type,
															"", "", tempfdbtype);
										}
										if (type == 162) {
											if (!result.equals(""))
												result = result.substring(0,
														result.length() - 1);
										}
										break;
									case 256://\u6811\u5f62\u5355\u9009
										if(istitle!=0){
											String [] browserValArray = result.split("_");
											String sqlStr = "select b.tablename,b.tablekey,b.showfield,b.datacondition from mode_customtree a,mode_customtreedetail b"+
												" where a.id=b.mainid and a.id="+tempdbtype+"  and b.id="+browserValArray[0];
											rs1.executeSql(sqlStr);
											if(rs1.next()){
												String tablenameStr = rs1.getString("tablename");//\u8868\u540d
												String tablekey = rs1.getString("tablekey");//\u4e3b\u5b57\u6bb5
												String showfield = rs1.getString("showfield");//\u663e\u793a\u540d\u79f0
												String shownamesql = "select "+showfield.toLowerCase()+" from "+tablenameStr+" where "+tablekey+" in ('"+browserValArray[1]+"')";
												CustomTreeData customTreeData = new CustomTreeData();
												String treedatasource =  customTreeData.getVdatasourceByNodeId(browserValArray[0]);
												if(vdatasource.equals("")){
													rs1.executeSql(shownamesql);
												}else{
													rs1.executeSql(shownamesql,vdatasource);
												}
												if(rs1.next()){
													result = rs1.getString(showfield.toLowerCase());
													break;
												}
											}
											
										}
									
									
									case 257:
						                	CustomTreeUtil customTreeUtil = new CustomTreeUtil();
						                	//\u83b7\u53d6\u5b57\u6bb5\u7684\u6570\u636e\u5e93\u7c7b\u578b
											String tempfid = (String) fieldids.get(i);
											String tempfdbtype = "";
											rs1.execute("select fielddbtype from workflow_billfield where id="+ tempfid);
											if (rs1.next())
												tempfdbtype = rs1.getString("fielddbtype");
											result = customTreeUtil.getTreeFieldShowName(result,tempfdbtype);
											//String result2 = "";
											//String[] tmpresult = result.split("</a>");
											//result = "";
											//for(int h=0;h<tmpresult.length;h++){
											//	String tmpresult2 = tmpresult[h].replaceAll("<a.*>", "");
											//	tmpresult2 = tmpresult2.replaceAll("&nbsp", "");
											//	if(StringHelper.isEmpty(tmpresult2)){
											//		continue;
											//	}
											//	result+=","+tmpresult2;
											//}
											//if(!StringHelper.isEmpty(result)){
											//	result = result.substring(1);
											//}
											break;
									case 171:
										results = Util.TokenizerString2(result,
										",");
										if (results != null) {
											result = "";
											for (int j = 0; j < results.length; j++) {
												String sql2 = "select "
														+ BrowserComInfo
																.getBrowsercolumname(""
																		+ type)
														+ " from "
														+ BrowserComInfo
																.getBrowsertablename(""
																		+ type)
														+ " where "
														+ BrowserComInfo
																.getBrowserkeycolumname(""
																		+ type)
														+ "=" + results[j];
												rs.executeSql(sql2);
												while (rs.next()) {
													result += "<a href=\"/workflow/request/ViewRequest.jsp?requestid="+results[j]+"\" target=\"_new\">"+Util.toScreen(
															rs.getString(1),
															user.getLanguage())+"</a>"
															+ ",";
												}
											}
											if (!result.equals(""))
												result = result.substring(0,
														result.length() - 1);
										}
										break;
									default:
										results = Util.TokenizerString2(result,
												",");
										if (results != null) {
											result = "";
											for (int j = 0; j < results.length; j++) {
												String sql2 = "select "
														+ BrowserComInfo
																.getBrowsercolumname(""
																		+ type)
														+ " from "
														+ BrowserComInfo
																.getBrowsertablename(""
																		+ type)
														+ " where "
														+ BrowserComInfo
																.getBrowserkeycolumname(""
																		+ type)
														+ "=" + results[j];
												rs.executeSql(sql2);
												while (rs.next()) {
													result += Util.toScreen(
															rs.getString(1),
															user.getLanguage())
															+ ",";
												}
											}
											if (!result.equals(""))
												result = result.substring(0,
														result.length() - 1);
										}
									}
									result = addFontAttributeForHrefText(result);
									
									result = "<font class=font>"+result+"</font>";
									
								}else if (htmltype.equals("5"))
								// \u9009\u62e9\u6846\u5b57\u6bb5
								{
									char flag = Util.getSeparator();
									if (!result.equals("")) {
										rs.executeProc(
												"workflow_SelectItemSByvalue",
												(String) fieldids.get(i) + flag
														+ isbill + flag
														+ result);
										if (rs.next()) {
											result = Util.toScreen(
													rs.getString("selectname"),
													user.getLanguage());
											/*if(istitle==1){
												
											}else if(istitle==2){
												if(linkmode.equals("2")){
													result = "<a href=\"javascript:modeopenFullWindowHaveBar('"+hreflink+"','"+eid+"_"+billid_id+"')\" >"+result+"</a>";
												}else{
													result = "<a href='"+hreflink+"' target='_self' >"+result+"</a>";
												}
											}else if(istitle==3){
												if(linkmode.equals("2")){
													result = "<a href=\"javascript:modeopenFullWindowHaveBar('"+hreflink+"','"+eid+"_"+billid_id+"')\" >"+result+"</a>";
												}else{
													result = "<a  href='"+hreflink+"' target='_self'>"+result+"</a>";
												}
											}*/
										} else {
											result = "";
										}
									} else {
										result = "";
									}
									result = "<font class=font>"+result+"</font>";
								}else if (htmltype.equals("6")) {
									switch (type) {
									case 1:
										result = Util.toScreen(getDoc(result,DocComInfo), user.getLanguage());										
										break;
									case 2:
										result = Util.toScreen(getDoc(result,DocComInfo), user.getLanguage());
										break;
									default:
									}
																		
								}

			String tempTdTextValue = "";
			tempTdTextValue =result;
			String realModeid = modeid;
			if(titlefields.contains(fieldsArray[i])){
				String billid = RecordSet.getString(vprimarykey);
				JSONObject otherParam = new JSONObject();
				otherParam.put("billid", billid);
				otherParam.put("customid", customid);
				otherParam.put("modeid", modeid);
				otherParam.put("formid", formid);
				otherParam.put("fieldid", tempFieldId);
				otherParam.put("fieldhtmltype", htmltype);
				otherParam.put("istitle", istitle);
				otherParam.put("viewtype", "0");
				otherParam.put("opentype", "0");
				otherParam.put("viewfrom", "fromsearchlist");
				otherParam.put("userid", user.getUID());
				otherParam.put("enabled", 0);
				otherParam.put("isenabled", isenabled);
				//\u6807\u9898\u5b57\u6bb5\u94fe\u63a5\u5730\u5740\u89e3\u6790
				otherParam.put("isportal","1");
				otherParam.put("linkmode",linkmode);
				otherParam.put("detailtablename",detailtablename);
                otherParam.put("detaildateId",RecordSet.getString(detailfieldAlias+"id"));
				tempTdTextValue = FormModeTransMethod.analyzeTitleFieldUrl(tempTdTextValue, otherParam);
				if(isenabled&&!isVirtualForm){
					//\u67e5\u8be2\u6570\u636e\u72b6\u6001\u672a\u9009\u65f6\uff0c\u5219\u9700\u8981\u5224\u65ad\u6570\u636e\u72b6\u6001
					int isnewimage = FormModeTransMethod.isNewimage(realModeid,billid,user.getUID());
					if(isnewimage==1){
						tempTdTextValue +="&nbsp;<span id=\"span"+eid+"_"+billid+"\"><img title='"+SystemEnv.getHtmlLabelName(83818,user.getLanguage())+"' src=\"/images/ecology8/statusicon/BDNew_wev8.png\" complete=\"complete\"/></span>";
					}else if(isnewimage==2){
						tempTdTextValue +="&nbsp;<span id=\"span"+eid+"_"+billid+"\"><img title='"+SystemEnv.getHtmlLabelName(83821,user.getLanguage())+"' src=\"/images/ecology8/statusicon/BDNew2_wev8.png\" complete=\"complete\"/></span>";
					}
				}
			}
			//\u5904\u7406\u663e\u793a\u8f6c\u6362\u5b57\u6bb5
			boolean isShowTransferField = (fieldShowingTransferedStatusMap.get(fieldsArray[i]) != null && fieldShowingTransferedStatusMap.get(fieldsArray[i]).intValue() == 1) ;
			String opentype = "";
			String enabled = "0";
			String showmethod = isShowTransferField ? "1": "0";
			String para3="column:"+(isVirtualForm?vprimarykey:"id")+"+"+tempFieldId+"+"+htmltype+"+"+type+"+"+user.getLanguage()+"+"+isbill+"+"+tempdbtype+"+"+istitle+"+"+modeid+"+"+formid+"+"+tempviewtype+"+"+opentype+"+"+customid+"+fromsearchlist"+"+"+showmethod+"+"+user.getUID()+"+"+enabled;
			if ((htmltype.equals("-1")||htmltype.equals("-2")||htmltype.equals("1") || htmltype.equals("4")|| htmltype.equals("5")|| htmltype.equals("8")||(htmltype.equals("3")&&(type+"").equals("2"))) && 
				istitle!=1&& istitle!=2&& istitle!=3) {
				if(isShowTransferField) {
					if(htmltype.equals("5") || htmltype.equals("8")){
						tempTdTextValue = FormModeTransMethod.changeShowmethod(Integer.valueOf(customid).intValue() , tempFieldId, tempFieldValue, tempTdTextValue, para3);
					}else {
						tempTdTextValue = FormModeTransMethod.changeShowmethod(Integer.valueOf(customid).intValue(), tempFieldId, tempFieldValue, tempFieldValue, para3);
					}
				}
			}
			
			String tempTdTextValue4Show = tempTdTextValue;
			
			// \u5982\u679c\u662f\u591a\u884c\u6587\u672c\u4e14\u52fe\u9009\u4e86\u591a\u884c\u6587\u672c\u5355\u884c\u663e\u793a\u5219\u663e\u793a\u5185\u5bb9\u4e3a\u591a\u884c\u6587\u672c\u7684\u7b2c\u4e00\u884c
			if(htmltype.equals("2")&&"1".equals(fe_isautoomit)) { // \u591a\u884c\u663e\u793a\u4e3a\u5355\u884c
				if(type == 1) {
					int nextLineIndex = tempTdTextValue4Show.indexOf("\n");
					nextLineIndex = nextLineIndex == -1 ? tempTdTextValue4Show.indexOf("<br"):nextLineIndex;
					nextLineIndex = nextLineIndex == -1 ? tempTdTextValue4Show.length()-1:nextLineIndex;
					nextLineIndex = nextLineIndex == -1 ? 0:nextLineIndex;
					tempTdTextValue4Show = tempTdTextValue4Show.substring(0,nextLineIndex);
				} else if(type==2) {
					tempTdTextValue4Show = Util.delHtml(tempTdTextValue);
				} else {
					tempTdTextValue4Show = tempTdTextValue;
				}
			}
		
      out.write(_jsp_string21, 0, _jsp_string21.length);
      out.print((fWidth));
      out.write(';');
      out.print((tdExtendStyle));
      out.write(_jsp_string22, 0, _jsp_string22.length);
      if("1".equals(fe_isautoomit)){out.print("title='"+Util.delHtml(tempTdTextValue)+"'");} 
      out.write(_jsp_string23, 0, _jsp_string23.length);
      out.print((tempTdTextValue4Show));
      out.write(_jsp_string24, 0, _jsp_string24.length);
      
			}
		
      out.write(_jsp_string25, 0, _jsp_string25.length);
      out.print((fieldsArray.length+1 ));
      out.write(_jsp_string26, 0, _jsp_string26.length);
      } 
      out.write(_jsp_string27, 0, _jsp_string27.length);
      if("Left".equals(rolltype)||"Right".equals(rolltype)||"Up".equals(rolltype)||"Down".equals(rolltype)) 
	out.println("</MARQUEE>");

      out.write(_jsp_string28, 0, _jsp_string28.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("page/element/FormModeCustomSearch/ReportResultData.jsp"), -3759515614717536488L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("page/maint/common/init.jsp"), -6701264299254985277L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string22;
  private final static char []_jsp_string15;
  private final static char []_jsp_string19;
  private final static char []_jsp_string12;
  private final static char []_jsp_string14;
  private final static char []_jsp_string7;
  private final static char []_jsp_string23;
  private final static char []_jsp_string17;
  private final static char []_jsp_string21;
  private final static char []_jsp_string0;
  private final static char []_jsp_string24;
  private final static char []_jsp_string18;
  private final static char []_jsp_string26;
  private final static char []_jsp_string16;
  private final static char []_jsp_string20;
  private final static char []_jsp_string1;
  private final static char []_jsp_string28;
  private final static char []_jsp_string8;
  private final static char []_jsp_string2;
  private final static char []_jsp_string3;
  private final static char []_jsp_string11;
  private final static char []_jsp_string25;
  private final static char []_jsp_string9;
  private final static char []_jsp_string27;
  private final static char []_jsp_string6;
  private final static char []_jsp_string5;
  private final static char []_jsp_string4;
  private final static char []_jsp_string13;
  private final static char []_jsp_string10;
  static {
    _jsp_string22 = "\" ".toCharArray();
    _jsp_string15 = "\"><font class='font'><font class='font'>".toCharArray();
    _jsp_string19 = "\r\n		 <tr style=\"height: 18;width:100%\" >\r\n		 	<TD style=\"width: 1%\">".toCharArray();
    _jsp_string12 = "</TH>\r\n			".toCharArray();
    _jsp_string14 = "\" style=\"text-align:left;width:".toCharArray();
    _jsp_string7 = ";table-layout:fixed;\">\r\n	<TR style=\"width:100%;\">\r\n		<TH style=\"width: 1%\">&nbsp;</TH>\r\n		".toCharArray();
    _jsp_string23 = "><font class='font'><font class='font'>".toCharArray();
    _jsp_string17 = "\r\n	</TR>\r\n</TABLE>\r\n".toCharArray();
    _jsp_string21 = "\r\n		<TD style=\"width: ".toCharArray();
    _jsp_string0 = "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string24 = "</font></font></TD>\r\n		".toCharArray();
    _jsp_string18 = "\r\n<TABLE class=\"elementdatatable\"  style=\"width:100%;table-layout:fixed;\">\r\n		".toCharArray();
    _jsp_string26 = " style='padding:0px'></TD>\r\n		</TR>\r\n	".toCharArray();
    _jsp_string16 = "</font></font></TH>\r\n		".toCharArray();
    _jsp_string20 = "</TD>\r\n		  ".toCharArray();
    _jsp_string1 = "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string28 = "\r\n<script type=\"text/javascript\">\r\nfunction modeopenFullWindowHaveBar(url,obj){\r\n	$(\"[id=span\"+obj+\"]\").remove();\r\n	openFullWindowHaveBar(url);\r\n}\r\n</script>\r\n".toCharArray();
    _jsp_string8 = "	\r\n			    	<TH title=\"".toCharArray();
    _jsp_string2 = "\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string3 = "\r\n".toCharArray();
    _jsp_string11 = "\r\n					<TH title=\"".toCharArray();
    _jsp_string25 = "\r\n	</TR>\r\n	<TR class=sparator style=\"height:1px\" height=1 >\r\n			<TD colSpan=".toCharArray();
    _jsp_string9 = "\" style=\"text-align:left;width:100%;color:red\">".toCharArray();
    _jsp_string27 = "\r\n</TABLE>\r\n".toCharArray();
    _jsp_string6 = "\r\n<TABLE style=\"width: 100%;display: ".toCharArray();
    _jsp_string5 = "</th></tr>\r\n			</tbody>\r\n		</table>\r\n		".toCharArray();
    _jsp_string4 = "\r\n		<table>\r\n			<tbody>\r\n				<tr class=\"Section\"><th style=\"font-size:8pt\"> ".toCharArray();
    _jsp_string13 = "\r\n				<TH title=\"".toCharArray();
    _jsp_string10 = "</TH>\r\n		    ".toCharArray();
  }
}
