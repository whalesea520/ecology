/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import weaver.general.BaseBean;
import weaver.fna.maintenance.FnaCostCenter;
import org.json.JSONObject;
import net.sf.json.JSONArray;
import weaver.general.browserData.FieldBrowser;
import weaver.general.browserData.CategoryBrowser;
import java.util.*;
import weaver.general.Util;
import weaver.hrm.*;
import weaver.ldap.LdapUtil;
import java.net.URLDecoder;
import weaver.general.browserData.WfFormBrowser;
import weaver.general.browserData.MdFormBrowser;
import weaver.workflow.request.Browsedatadefinition;
import java.text.SimpleDateFormat;
import weaver.crm.CrmShareBase;
import weaver.workflow.browserdatadefinition.ConditionField;
import weaver.meeting.MeetingBrowser;
import weaver.meeting.MeetingShareUtil;
import weaver.workflow.request.todo.RequestUtil;

public class _data__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      weaver.hrm.resource.ResourceComInfo ResourceComInfo;
      ResourceComInfo = (weaver.hrm.resource.ResourceComInfo) pageContext.getAttribute("ResourceComInfo");
      if (ResourceComInfo == null) {
        ResourceComInfo = new weaver.hrm.resource.ResourceComInfo();
        pageContext.setAttribute("ResourceComInfo", ResourceComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.general.browserData.BrowserManager browserManager;
      browserManager = (weaver.general.browserData.BrowserManager) pageContext.getAttribute("browserManager");
      if (browserManager == null) {
        browserManager = new weaver.general.browserData.BrowserManager();
        pageContext.setAttribute("browserManager", browserManager);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet rs;
      rs = (weaver.conn.RecordSet) pageContext.getAttribute("rs");
      if (rs == null) {
        rs = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs", rs);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet rs2;
      rs2 = (weaver.conn.RecordSet) pageContext.getAttribute("rs2");
      if (rs2 == null) {
        rs2 = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs2", rs2);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.workflow.workflow.WorkflowComInfo WorkflowComInfo;
      WorkflowComInfo = (weaver.workflow.workflow.WorkflowComInfo) pageContext.getAttribute("WorkflowComInfo");
      if (WorkflowComInfo == null) {
        WorkflowComInfo = new weaver.workflow.workflow.WorkflowComInfo();
        pageContext.setAttribute("WorkflowComInfo", WorkflowComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.cpt.util.CommonShareManager CommonShareManager;
      CommonShareManager = (weaver.cpt.util.CommonShareManager) pageContext.getAttribute("CommonShareManager");
      if (CommonShareManager == null) {
        CommonShareManager = new weaver.cpt.util.CommonShareManager();
        pageContext.setAttribute("CommonShareManager", CommonShareManager);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.systeminfo.systemright.CheckSubCompanyRight CheckSubCompanyRight;
      CheckSubCompanyRight = (weaver.systeminfo.systemright.CheckSubCompanyRight) pageContext.getAttribute("CheckSubCompanyRight");
      if (CheckSubCompanyRight == null) {
        CheckSubCompanyRight = new weaver.systeminfo.systemright.CheckSubCompanyRight();
        pageContext.setAttribute("CheckSubCompanyRight", CheckSubCompanyRight);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.share.ShareManager ShareManager;
      ShareManager = (weaver.share.ShareManager) pageContext.getAttribute("ShareManager");
      if (ShareManager == null) {
        ShareManager = new weaver.share.ShareManager();
        pageContext.setAttribute("ShareManager", ShareManager);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.cpt.util.CptWfUtil CptWfUtil;
      CptWfUtil = (weaver.cpt.util.CptWfUtil) pageContext.getAttribute("CptWfUtil");
      if (CptWfUtil == null) {
        CptWfUtil = new weaver.cpt.util.CptWfUtil();
        pageContext.setAttribute("CptWfUtil", CptWfUtil);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.appdetach.AppDetachComInfo appDetachComInfo;
      appDetachComInfo = (weaver.hrm.appdetach.AppDetachComInfo) pageContext.getAttribute("appDetachComInfo");
      if (appDetachComInfo == null) {
        appDetachComInfo = new weaver.hrm.appdetach.AppDetachComInfo();
        pageContext.setAttribute("appDetachComInfo", appDetachComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.moduledetach.ManageDetachComInfo manageDetachComInfo;
      manageDetachComInfo = (weaver.hrm.moduledetach.ManageDetachComInfo) pageContext.getAttribute("manageDetachComInfo");
      if (manageDetachComInfo == null) {
        manageDetachComInfo = new weaver.hrm.moduledetach.ManageDetachComInfo();
        pageContext.setAttribute("manageDetachComInfo", manageDetachComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.workflow.monitor.Monitor Monitor;
      Monitor = (weaver.workflow.monitor.Monitor) pageContext.getAttribute("Monitor");
      if (Monitor == null) {
        Monitor = new weaver.workflow.monitor.Monitor();
        pageContext.setAttribute("Monitor", Monitor);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.fna.maintenance.BudgetfeeTypeComInfo BudgetfeeTypeComInfo;
      BudgetfeeTypeComInfo = (weaver.fna.maintenance.BudgetfeeTypeComInfo) pageContext.getAttribute("BudgetfeeTypeComInfo");
      if (BudgetfeeTypeComInfo == null) {
        BudgetfeeTypeComInfo = new weaver.fna.maintenance.BudgetfeeTypeComInfo();
        pageContext.setAttribute("BudgetfeeTypeComInfo", BudgetfeeTypeComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.fna.general.FnaCommon FnaCommon;
      FnaCommon = (weaver.fna.general.FnaCommon) pageContext.getAttribute("FnaCommon");
      if (FnaCommon == null) {
        FnaCommon = new weaver.fna.general.FnaCommon();
        pageContext.setAttribute("FnaCommon", FnaCommon);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.fna.maintenance.FnaCostCenter FnaCostCenter;
      FnaCostCenter = (weaver.fna.maintenance.FnaCostCenter) pageContext.getAttribute("FnaCostCenter");
      if (FnaCostCenter == null) {
        FnaCostCenter = new weaver.fna.maintenance.FnaCostCenter();
        pageContext.setAttribute("FnaCostCenter", FnaCostCenter);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.company.SubCompanyComInfo SubCompanyComInfo;
      SubCompanyComInfo = (weaver.hrm.company.SubCompanyComInfo) pageContext.getAttribute("SubCompanyComInfo");
      if (SubCompanyComInfo == null) {
        SubCompanyComInfo = new weaver.hrm.company.SubCompanyComInfo();
        pageContext.setAttribute("SubCompanyComInfo", SubCompanyComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.moduledetach.ManageDetachComInfo ManageDetachComInfo;
      ManageDetachComInfo = (weaver.hrm.moduledetach.ManageDetachComInfo) pageContext.getAttribute("ManageDetachComInfo");
      if (ManageDetachComInfo == null) {
        ManageDetachComInfo = new weaver.hrm.moduledetach.ManageDetachComInfo();
        pageContext.setAttribute("ManageDetachComInfo", ManageDetachComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.odoc.workflow.workflow.utils.FormSignatureConfigUtil FormSignatureConfigUtil;
      FormSignatureConfigUtil = (weaver.odoc.workflow.workflow.utils.FormSignatureConfigUtil) pageContext.getAttribute("FormSignatureConfigUtil");
      if (FormSignatureConfigUtil == null) {
        FormSignatureConfigUtil = new weaver.odoc.workflow.workflow.utils.FormSignatureConfigUtil();
        pageContext.setAttribute("FormSignatureConfigUtil", FormSignatureConfigUtil);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      
	int pagenum = 30;

	String f_weaver_belongto_userid=Util.null2String(request.getParameter("f_weaver_belongto_userid"));
	String f_weaver_belongto_usertype=Util.null2String(request.getParameter("f_weaver_belongto_usertype"));
	User user = HrmUserVarify.getUser(request, response, f_weaver_belongto_userid, f_weaver_belongto_usertype) ;//
	String type = Util.null2String(request.getParameter("type"));
	String whereClause =  URLDecoder.decode(Util.null2String(request.getParameter("whereClause")), "UTF-8");
	if(whereClause.length()==0){
		whereClause =  URLDecoder.decode(Util.null2String(request.getParameter("sqlwhere")), "UTF-8");
	}
	String result = "";
	String selectids = Util.null2String(request.getParameter("selectids"));
	browserManager.setType(type);
	if(type.equals("4") || type.equals("57")||type.equals("167")||type.equals("168")){//\u90e8\u95e8
		if(whereClause.length()>0)whereClause+="and";
		whereClause += " hrmdepartment.subcompanyid1=hrmsubcompany.id and (hrmdepartment.canceled = '0' or hrmdepartment.canceled is null) ";
  if(type.equals("167") ||type.equals("168") ){
    	/*
			String rightLevel = HrmUserVarify.getRightLevel("HrmResourceEdit:Edit",user);
	    int departmentID = user.getUserDepartment();
	    int subcompanyID = user.getUserSubCompany1();
	    if(rightLevel.equals("2") ){
	      //\u603b\u90e8\u7ea7\u522b\u7684\uff0c\u4ec0\u4e48\u4e5f\u4e0d\u8fd4\u56de
	    }else if (rightLevel.equals("1")){ //\u5206\u90e8\u7ea7\u522b\u7684
	    	whereClause = " subcompanyid1="+subcompanyID ;
	    }else if (rightLevel.equals("0")){ //\u90e8\u95e8\u7ea7\u522b
	    	whereClause = " id="+departmentID ;
	    }*/
		
		rs.executeSql("select detachable from SystemSet");
		int detachable=0;
		if(rs.next()){
			detachable=rs.getInt("detachable");
		}
		
		boolean isUseHrmManageDetach=ManageDetachComInfo.isUseHrmManageDetach();
		if(isUseHrmManageDetach){
			detachable = 1;
		}else{
			detachable = 0;
		}
		String rightStr = Util.null2String(request.getParameter("rightStr"));
		if(detachable == 1){
				String companyid = "";
				int[] companyids = CheckSubCompanyRight.getSubComByUserRightId(user.getUID(),rightStr,1);
				for(int i=0;companyids!=null&&i<companyids.length;i++){
					companyid += ","+companyids[i];
				}
				if(companyid.length() > 0){
					companyid = companyid.substring(1);	
					whereClause += " and ( hrmdepartment.subcompanyid1 in("+companyid+"))";
				}else{
					whereClause += " and ( hrmdepartment.subcompanyid1 in(0)";//\u5206\u6743\u800c\u4e14\u6ca1\u6709\u9009\u62e9\u673a\u6784\u6743\u9650
				}
		}else{
			if(rightStr.length()>0){
				String rightLevel = HrmUserVarify.getRightLevel(rightStr,user);
				int departmentID = user.getUserDepartment();
				int subcompanyID = user.getUserSubCompany1();
				if(rightLevel.equals("2") ){
				  //\u603b\u90e8\u7ea7\u522b\u7684\uff0c\u4ec0\u4e48\u4e5f\u4e0d\u8fd4\u56de
				}else if (rightLevel.equals("1")){ //\u5206\u90e8\u7ea7\u522b\u7684
					whereClause += " and hrmdepartment.subcompanyid1="+subcompanyID ;
				}else if (rightLevel.equals("0")){ //\u90e8\u95e8\u7ea7\u522b
					whereClause += " and hrmdepartment.id="+departmentID ;
				}
			}
		}
	    int beagenter = Util.getIntValue((String)session.getAttribute("beagenter_"+user.getUID()));
	    if(beagenter <= 0){
	    	beagenter = user.getUID();
	    }
	    int fieldid=Util.getIntValue(request.getParameter("fieldid"));
	    int isdetail=Util.getIntValue(request.getParameter("isdetail"));
	    int isbill=Util.getIntValue(request.getParameter("isbill"),1);
	    if(fieldid!=-1){
		    CheckSubCompanyRight.setDetachable(1);
		  	CheckSubCompanyRight.setIsbill(isbill);
		  	CheckSubCompanyRight.setFieldid(fieldid);
		  	CheckSubCompanyRight.setIsdetail(isdetail);
		    boolean onlyselfdept=CheckSubCompanyRight.getDecentralizationAttr(beagenter,"Departments:decentralization",fieldid,isdetail,isbill);
		    boolean isall=CheckSubCompanyRight.getIsall();
		    String departments=Util.null2String(CheckSubCompanyRight.getDepartmentids());
		    String subcompanyids=Util.null2String(CheckSubCompanyRight.getSubcompanyids());
		    if(!isall){
		        if(onlyselfdept){
		        		if(departments.length()>0&&!departments.equals("0")){
		        			whereClause+=" and hrmdepartment.id in("+departments+")";
		        		}
		        }else{
		        		if(subcompanyids.length()>0&&!subcompanyids.equals("0")){
		        			whereClause+=" and subcompanyid1 in("+subcompanyids+")";
		        		}
		        }
		    }
	    }
		}
		//Added by wcd 2014-11-28 \u589e\u52a0\u5206\u6743\u63a7\u5236 start
		String tempSql = appDetachComInfo.getScopeSqlByHrmResourceSearch(String.valueOf(user.getUID()), true, "department");
		whereClause += (whereClause==null||whereClause.length()==0) ? tempSql : ( tempSql.equals("")?" ":" and "+tempSql);
		
		//Added by wcd 2014-11-28 \u589e\u52a0\u5206\u6743\u63a7\u5236 end
		browserManager.setOrderKey("hrmdepartment.showorder");
		browserManager.setOrderWay("asc");
		if(Util.null2String(request.getParameter("show_virtual_org")).equals("-1")){
			result = browserManager.getResult(request,"hrmdepartment.id,departmentname,subcompanyname","hrmdepartment , hrmsubcompany ",whereClause,pagenum,"hrmdepartment");
		}else{
			result = browserManager.getResult(request,"hrmdepartment.id,departmentname,subcompanyname","hrmdepartmentallView hrmdepartment, hrmsubcompanyallview hrmsubcompany",whereClause,pagenum,"hrmdepartment");
		}
	}else if(type.equals("hrmdepartmentvirtual")||type.equals("261")){//\u865a\u62df\u90e8\u95e8
		browserManager.setOrderKey("showorder");
		browserManager.setOrderWay("asc");
		String virtualtype = Util.null2String(request.getParameter("virtualtype"));
		if(whereClause.length()>0)
  		whereClause += " and virtualtype="+virtualtype ;
  	else
  		whereClause += " virtualtype="+virtualtype ;
		result = browserManager.getResult(request,"id,departmentname","hrmdepartmentvirtual",whereClause,pagenum);
	}else if(type.equals("12")){//\u5e01\u79cd
		result = browserManager.getResult(request,"id,currencyname","FnaCurrency"," activable=1 ",pagenum);
	}else if(type.equals("137")){//\u8f66\u8f86
		rs.executeSql("select carsdetachable from SystemSet");
		int detachable=0;
		if(rs.next()){
		    detachable=rs.getInt(1);
		}
		int subCompanyId = 0;
		String sqlwhere  = " 1=1 ";
		if(detachable==1){
			if(!"".equals(Util.null2String(request.getParameter("subCompanyId")))){
				subCompanyId = Util.getIntValue(request.getParameter("subCompanyId"));
			}
			//operatelevel= CheckSubCompanyRight.ChkComRightByUserRightCompanyId(user.getUID(),"Car:Maintenance",subCompanyId);
			if(user.getUID()!=1){
				String sqltmp = "";
				String blonsubcomid="";
				char flag=Util.getSeparator();
				rs2.executeProc("HrmRoleSR_SeByURId", ""+user.getUID()+flag+"Car:Maintenance");
				while(rs2.next()){
					blonsubcomid=rs2.getString("subcompanyid");
					sqltmp += (", "+blonsubcomid);
				}
				if(!"".equals(sqltmp)){//\u89d2\u8272\u8bbe\u7f6e\u7684\u6743\u9650
					sqltmp = sqltmp.substring(1);
					sqlwhere += " and subcompanyid in ("+sqltmp+") ";
				}else{
					sqlwhere += " and subcompanyid="+user.getUserSubCompany1() ;
				}
			}
		}else{
			subCompanyId = -1;
		}
		result = browserManager.getResult(request,"id,carNo","CarInfo",sqlwhere,pagenum);
	}else if(type.equals("1111")){//\u56fd\u5bb6
		result = browserManager.getResult(request,"id,countryname","HrmCountry",pagenum);
	}else if(type.equals("2222")){//\u7701\u4efd
		result = browserManager.getResult(request,"id,provincename","HrmProvince",pagenum);
	}else if(type.equals("142")){//\u6536\u53d1\u6587\u5355\u4f4d
		browserManager.setOrderKey("showOrder");
		browserManager.setOrderWay("asc");
		//result = browserManager.getResult(request,"id,receiveUnitName","DocReceiveUnit",pagenum);
		result = browserManager.getResult(request,"id,receiveUnitName","DocReceiveUnit","( canceled = '0' or canceled is null) and exists (select 1 from hrmsubcompany where hrmsubcompany.id = DocReceiveUnit.subcompanyid and (hrmsubcompany.canceled is null or hrmsubcompany.canceled <> 1)) ",pagenum);
	}else if(type.equals("58")){//\u57ce\u5e02
		result = browserManager.getResult(request,"id,cityname","HrmCity","( canceled = '0' or canceled is null) ",pagenum);
	}else if(type.equals("hrmcitytwo") || type.equals("263")){//\u4e8c\u7ea7\u57ce\u5e02
		result = browserManager.getResult(request,"id,cityname","HrmCityTwo",pagenum);
	}else if(type.equals("55")){//\u53d1\u6587\u5b57\u53f7
		result = browserManager.getResult(request,"id,name","DocSendDocNumber",pagenum);
	}else if(type.equals("52")){//\u516c\u6587\u79cd\u7c7b
		result = browserManager.getResult(request,"id,name","DocSendDocKind",pagenum);
	}else if(type.equals("53")){//\u7d27\u6025\u7a0b\u5ea6
		result = browserManager.getResult(request,"id,name","DocInstancyLevel",pagenum);
	}else if(type.equals("54")){//\u79d8\u5bc6\u7b49\u7ea7
		result = browserManager.getResult(request,"id,name","DocSecretLevel",pagenum);
	}else if(type.equals("182")){//\u7f51\u4e0a\u8c03\u67e5
		result = browserManager.getResult(request,"id,subject","voting","(status=1 or status=2)",pagenum);
	}else if(type.equals("59")){//\u79f0\u547c
		result = browserManager.getResult(request,"id,fullname","CRM_ContacterTitle",pagenum);
	}else if(type.equals("7") || type.equals("18")){//\u5ba2\u6237
		CrmShareBase crmShareBase=new CrmShareBase();
		String leftjointable = crmShareBase.getTempTable(""+user.getUID());
		String sqlFrom=" CRM_CustomerInfo t1 left join "+leftjointable+" t2 on t1.id = t2.relateditemid ";
		String sqlWhere=" t1.deleted = 0  and t1.id = t2.relateditemid ";
		if(!"".equals(whereClause)){
			sqlWhere +=" and "+whereClause;
		}
		int bdf_wfid = Util.getIntValue(request.getParameter("bdf_wfid"));
		int bdf_fieldid = Util.getIntValue(request.getParameter("bdf_fieldid"));
		int bdf_viewtype = Util.getIntValue(request.getParameter("bdf_viewtype"));
		List<ConditionField> list = null;
		if(-1 != bdf_wfid){
			list = ConditionField.readAll(bdf_wfid,bdf_fieldid,bdf_viewtype);
		}
		if(null != list && 0 != list.size()){ 
			for(ConditionField conditionField : list){
				
				if(!conditionField.isReadonly() && !conditionField.isHide())continue;
				
				String fieldName = conditionField.getFieldName();
				String fieldValue = conditionField.getValue();
				if(conditionField.getValueType().equals("3") && conditionField.isGetValueFromFormField()){ 
					fieldValue = Util.null2String(request.getParameter("bdf_"+fieldName));
					fieldValue = fieldValue.split(",")[0];
				}
				if(conditionField.getValueType().equals("1") && fieldName.equals("crmManager")){
					fieldValue = user.getUID()+"";
				}
				if(conditionField.getValueType().equals("1") && fieldName.equals("departmentid")){
					fieldValue = user.getUserDepartment()+"";
				}
				if(conditionField.getValueType().equals("3") && fieldName.equals("departmentid")){//\u90e8\u95e8\u9009\u62e9\u8868\u5355\u5b57\u6bb5\u4e3a\u4f46
					fieldValue = Util.null2String(request.getParameter("bdf_"+fieldName));
					fieldValue = conditionField.getDepartmentIds(fieldValue).split(",")[0];
				}
				if(fieldValue == null || fieldValue.equals("")){
					continue;
				}
				if(fieldName.equals("name")){
					sqlWhere += " and t1.name like '%" + fieldValue +"%' ";
				}
				if(fieldName.equals("engname")){
					sqlWhere += " and t1.engname like '%" + fieldValue +"%' ";
				}
				if(fieldName.equals("type")){
					sqlWhere += " and t1.type = "+ fieldValue;
				}
				if(fieldName.equals("customerStatus")){
					sqlWhere += " and t1.status = "+ fieldValue;
				}
				if(fieldName.equals("country1")){
					sqlWhere += " and t1.country = "+ fieldValue;
				}
				if(fieldName.equals("City")){
					sqlWhere += " and t1.city = " + fieldValue ;
				}
				if(fieldName.equals("crmManager")){
					sqlWhere += " and t1.manager =" + fieldValue  ;
				}
				if(fieldName.equals("departmentid")){
					sqlWhere += " and t1.department =" + fieldValue +" " ;
				}
				if(fieldName.equals("customerDesc")){
					sqlWhere += " and t1.description = "+ fieldValue;
				}
				if(fieldName.equals("customerSize")){
					sqlWhere += " and t1.size_n = "+ fieldValue;
				}
				if(fieldName.equals("sectorInfo")){
					sqlWhere += " and t1.sector = "+ fieldValue;
				}
			}
		}
		browserManager.setOrderKey("createdate");
		result = browserManager.getResult(request,"id,name",sqlFrom,sqlWhere,pagenum);
	}else if(type.equals("164_1")){//\u8868\u5355\u5efa\u6a21\u5206\u6743
		String rightStr = request.getParameter("rightStr");
		whereClause = appDetachComInfo.getCompanySqlByFromMode(user.getUID(), rightStr);
		browserManager.setOrderKey("showorder");
		browserManager.setOrderWay("asc");
		result = browserManager.getResult(request,"id,subcompanyname","hrmsubcompany",whereClause,pagenum);
	}else if(type.equals("164") || type.equals("194")||type.equals("169") ||type.equals("170")){//\u5206\u90e8
		//Added by wcd 2014-11-28 \u589e\u52a0\u5206\u6743\u63a7\u5236
		whereClause = appDetachComInfo.getScopeSqlByHrmResourceSearch(String.valueOf(user.getUID()), true, "subcompany");
    if(type.equals("169") ||type.equals("170") ){
			String rightLevel = HrmUserVarify.getRightLevel("HrmResourceEdit:Edit",user);
	    int subcompanyID = user.getUserSubCompany1();
	    if(rightLevel.equals("2") ){
	      //\u603b\u90e8\u7ea7\u522b\u7684\uff0c\u4ec0\u4e48\u4e5f\u4e0d\u8fd4\u56de
	    }else if (rightLevel.equals("1")){ //\u5206\u90e8\u7ea7\u522b\u7684
	    	if(whereClause.length()>0)
	    		whereClause += " and id="+subcompanyID ;
	    	else
	    		whereClause += " id="+subcompanyID ;
	    }
    }
    if(whereClause.length()>0)
    	whereClause += " and (canceled = '0' or canceled is null)  ";
  	else
  		whereClause += " (canceled = '0' or canceled is null)  ";
  	
		//\u5982\u679c\u5f00\u542f\u5206\u6743
		if(type.equals("164") 
		        && !"sysadmin".equalsIgnoreCase(user.getLoginid())
		        && "1".equals(session.getAttribute("detachable"))){
	        whereClause += " and id in ("+SubCompanyComInfo.getRightSubCompany(user.getUID(),"WorkflowManage:All",0)+")";
		}
    
		browserManager.setOrderKey("showorder");
		browserManager.setOrderWay("asc");
		if(type.equals("169") ||type.equals("170")||Util.null2String(request.getParameter("show_virtual_org")).equals("-1") ){
			//\u5206\u6743\u4e0d\u8003\u8651 \u591a\u7ef4
			result = browserManager.getResult(request,"id,subcompanyname","hrmsubcompany",whereClause,pagenum);
		}else{
			result = browserManager.getResult(request,"id,subcompanyname","hrmsubcompanyAllview hrmsubcompany",whereClause,pagenum);
		}
	}else if(type.equals("hrmsubcompanyvirtual")){//\u865a\u62df\u5206\u90e8
		browserManager.setOrderKey("showorder");
		browserManager.setOrderWay("asc");
		String virtualtype = Util.null2String(request.getParameter("virtualtype"));
		if(whereClause.length()>0)
  		whereClause += " and virtualtype="+virtualtype ;
  	else
  		whereClause += " virtualtype="+virtualtype ;
		result = browserManager.getResult(request,"id,subcompanyname","hrmsubcompanyvirtual",pagenum);
	}else if(type.equals("-99999")){//\u865a\u62df\u76ee\u5f55
		browserManager.setOrderKey("showOrder");
		browserManager.setOrderWay("asc");
		result = browserManager.getResult(request,"id,treeDocFieldName","DocTreeDocField",pagenum);
	}else if(type.equals("-99998")){//\u8bed\u8a00
		result = browserManager.getResult(request,"id,language","syslanguage","activable='1'",pagenum);
	}else if(type.equals("-99997")){//\u7269\u54c1\u7c7b\u522b
		result = browserManager.getResult(request,"id,assortmentname","LgcAssetAssortment", pagenum);
	}else if(type.equals("-99996")){//\u6587\u6863\u663e\u793a\u6a21\u677f
		String doctype = Util.null2String(request.getParameter("docType"));
		String mouldType = Util.null2String(request.getParameter("mouldType"));
		if(doctype.equals("") || doctype.equals(".htm")) doctype = "0";
		else if(doctype.equals(".doc")) doctype = "2";
		else if(doctype.equals(".xls")) doctype = "3";
		else if(doctype.equals(".wps")) doctype = "4";
		String isWorkflowDoc = Util.null2String(request.getParameter("isWorkflowDoc"));
		if(isWorkflowDoc.equals("1")){
			doctype = "2,4";
		}
		String where = "mouldType in ("+doctype+")";
		if(!"".equals(selectids)){
			where += " and id not in ("+selectids+")";
		}
		String tablename = "DocMould";
		if(mouldType.equals("3")){
			tablename = "DocMouldFile";
		}
		browserManager.setOrderKey("lastModTime");
		result = browserManager.getResult(request,"id,mouldname",tablename,where,pagenum);
	}else if(type.equals("-99990")){//\u4e3b\u76ee\u5f55
		result = browserManager.getResult(request, "id,categoryname", "docmaincategory",pagenum);
	
	}else if("179".equals(type)){//\u8d44\u4ea7\u8d44\u6599
		String sqlwhere = " isdata='1' ";
		//\u6743\u9650\u6761\u4ef6 modify by ds Td:9699
		rs.executeSql("select cptdetachable from SystemSet");
		int detachable=0;
		int userId = user.getUID();
		if(rs.next()){
		    detachable=rs.getInt("cptdetachable");
		}
		String rightStr = "";
		if(HrmUserVarify.checkUserRight("Capital:Maintenance",user)){
			rightStr = "Capital:Maintenance";
		}
		if(detachable == 1 && userId!=1){
			int allsubids[] = CheckSubCompanyRight.getSubComByUserRightId(user.getUID(),rightStr);
			String allsubid = "";
			for(int i=0;i<allsubids.length;i++){
				if(allsubids[i]>0){
					allsubid += (allsubid.equals("")?"":",") + allsubids[i];
				}	
			}
			if(allsubid.equals("")) allsubid = user.getUserSubCompany1() + "";
			sqlwhere += " and blongsubcompany in ("+allsubid+") ";
		}
		result = browserManager.getResult(request, "id,name", "CptCapital",sqlwhere,pagenum);
	}else if(type.equals("23") || type.equals("26") || type.equals("3")){//\u8d44\u4ea7
		int billid = Util.getIntValue(request.getParameter("billid"),-1);
		int isdata = Util.getIntValue(request.getParameter("isdata"),2);
		String cptstateid = Util.null2String(request.getParameter("cptstateid"));
		String cptuse = Util.null2String(request.getParameter("cptuse"));
		String cptsptcount = Util.null2String(request.getParameter("cptsptcount"));
		String wfid = Util.null2String(request.getParameter("wfid"));
		String inculdeNumZero=Util.null2s(request.getParameter("inculdeNumZero"), "1");
		if (billid > 0) {    
			switch (billid) {
				 case 220: //\u8d44\u4ea7\u501f\u7528
				     cptsptcount="1";
					 cptstateid="1";
					 inculdeNumZero = "0";
					 break;
				 case 222: //\u8d44\u4ea7\u9001\u4fee
				     cptsptcount="1";
					 cptstateid="1,2,3";
					 inculdeNumZero = "0";
					 break;
				 case 224: //\u8d44\u4ea7\u5f52\u8fd8
				 	//sptcount="1";
					 cptstateid="4,2,3";
					 inculdeNumZero = "0";
				     break;
			     case 221: //\u8d44\u4ea7\u51cf\u635f
			         cptstateid="1,2,3,4";
			         inculdeNumZero = "0";
				 	 break;
			     case 201: //\u8d44\u4ea7\u62a5\u5e9f
			         cptstateid="1,2,3,4";
			         inculdeNumZero = "0";
				 	 break;
		    }
		}
		if(!"".equals(wfid) ){
			String wftype=CptWfUtil.getWftype(wfid);
			if (!"".equals(wftype)) {
				if("fetch".equalsIgnoreCase(wftype)||billid==19){
					cptuse="1";
					cptstateid="1";
				}else if("lend".equalsIgnoreCase(wftype)||billid==220){
					cptstateid="1";
					cptsptcount="1";
				}else if("move".equalsIgnoreCase(wftype)||billid==18){
					cptstateid="2";
				}else if("back".equalsIgnoreCase(wftype)||billid==224){
					cptstateid="2,3,4";
				}else if("discard".equalsIgnoreCase(wftype)||billid==201){
					cptstateid="1,2,3,4";
				}else if("mend".equalsIgnoreCase(wftype)||billid==222){
					cptstateid="1,2,3";
					cptsptcount="1";
				}else if("loss".equalsIgnoreCase(wftype)||billid==221){
	                cptstateid="1,2,3,4";
				}
				inculdeNumZero = "0";
			}
		}
		String fromSql=" CptCapital t1 ";
		String backfields=" t1.id,t1.name ";
		
		//\u5254\u9664\u6389\u5728\u9014\u7684\u8bf7\u6c42\u81ea\u8eab\u7684\u6570\u91cf===below================
		int reqid = Util.getIntValue(request.getParameter("reqid"),0);
		String includeNumZeroSqlwhere="";
		if(!"1".equals(inculdeNumZero)&& (2==isdata) ){
			if("oracle".equalsIgnoreCase(rs.getDBType())){
				includeNumZeroSqlwhere = " and (nvl(capitalnum,0)-nvl(frozennum,0))>0 ";
			}else{
				includeNumZeroSqlwhere = " and (isnull(capitalnum,0)-isnull(frozennum,0))>0 ";
			}
		}
		if(reqid>0&& isdata==2 ){
			String sql2="select t1.currentnodetype,t1.workflowid,t2.formid from workflow_requestbase t1,workflow_base t2 where t1.workflowid=t2.id and t1.requestid="+reqid;
			int formid=0;
			int mywfid=0;
			int currentnodetype=0;
			
			rs.executeSql(sql2);
			while(rs.next()){
				formid=rs.getInt("formid");
				mywfid=rs.getInt("workflowid");
				currentnodetype=rs.getInt("currentnodetype");
			}
			if(currentnodetype>0&&currentnodetype<3 ){
				String cptsearchsql="";
				if(formid==18||formid==19||formid==201||formid==221){//\u7cfb\u7edf\u8868\u5355\u8d44\u4ea7\u6d41\u7a0b
					if(formid==221){//\u51cf\u635f
						cptsearchsql="select d.lossCpt as as currentzcid,sum(d.losscount) as currentreqnum from bill_cptloss d where d.requestid="+reqid+" group by d.lossCpt " ;
					}else if(formid==18){//\u8c03\u62e8
						cptsearchsql="select d.capitalid as as currentzcid,sum(d.number_n) as currentreqnum from bill_CptAdjustMain m,bill_CptAdjustDetail d where d.cptadjustid=m.id and m.requestid="+reqid+" group by d.capitalid ";
					}else if(formid==201){//\u62a5\u5e9f
						cptsearchsql="select d.capitalid as as currentzcid,sum(d.numbers) as currentreqnum from bill_Discard_Detail d where d.detailrequestid="+reqid+" group by d.capitalid ";
					}else if(formid==19){//\u9886\u7528
						cptsearchsql="SELECT d.capitalid as as currentzcid,sum(d.number_n) as currentreqnum FROM bill_CptFetchDetail d ,bill_CptFetchMain m WHERE d.cptfetchid =m.id AND m.requestid = "+reqid+" group by d.capitalid ";
					}
					
				}else{
					org.json.JSONObject jsonObject= CptWfUtil.getCptwfInfo(""+wfid);
					if(jsonObject.length()>0){//\u81ea\u5b9a\u4e49\u8d44\u4ea7\u6d41\u7a0b
						String cptmaintablename="formtable_main_"+(-formid);
						rs.execute("select tablename from workflow_bill where id="+formid);
						while(rs.next()){
							cptmaintablename=rs.getString("tablename");
						}
						String cptdetailtablename=cptmaintablename;
						String zcname=jsonObject.getString("zcname");
						String zcsl=jsonObject.getString("slname");
						int zcViewtype=Util.getIntValue(""+jsonObject.getInt("zctype"),0);
						if(zcViewtype==1){
							cptdetailtablename+="_dt1";
						}else if(zcViewtype==2){
							cptdetailtablename+="_dt2";
						}else if(zcViewtype==3){
							cptdetailtablename+="_dt3";
						}else if(zcViewtype==4){
							cptdetailtablename+="_dt4";
						}
						
						if(!cptdetailtablename.equals(cptmaintablename)){
							cptsearchsql=" select d."+zcname+" as currentzcid,sum(d."+zcsl+") as currentreqnum from "+cptmaintablename+" m ,"+cptdetailtablename+" d where d.mainid=m.id and m.requestid="+reqid+" group by d."+zcname+" ";
						}else{
							cptsearchsql="select m."+zcname+" as currentzcid,sum(m."+zcsl+") as currentreqnum from "+cptmaintablename+" m  where  m.requestid="+reqid+" group by m."+zcname+" ";
						}
					}
				}
				
				
				if(!"".equals(cptsearchsql) ){
					fromSql  = " CptCapital t1 left outer join ("+cptsearchsql+") tt2 on tt2.currentzcid=t1.id ";
				
					if("oracle".equalsIgnoreCase(rs.getDBType())){
						includeNumZeroSqlwhere = " and  (nvl(capitalnum,0)-nvl(frozennum,0)+nvl(currentreqnum,0))>0 ";
					}else{
						includeNumZeroSqlwhere = " and  (isnull(capitalnum,0)-isnull(frozennum,0)+isnull(currentreqnum,0))>0 ";
					}
				}
				
			}

		}
		//\u5254\u9664\u6389\u5728\u9014\u7684\u8bf7\u6c42\u81ea\u8eab\u7684\u6570\u91cf===up================
		
		
		String sqlwhere = "";
		sqlwhere = " isdata='"+isdata+"' ";
		if(type.equals("26")) sqlwhere = " isdata=2 and capitalgroupid=16 ";
		if(type.equals("3")) sqlwhere = " isdata=2 and capitalgroupid=9 ";
		if(isdata==2){
			sqlwhere+=" and exists(select 1 from CptCapitalShareInfo t2 where t2.relateditemid=t1.id and ( "+CommonShareManager.getShareWhereByUser("cpt", user)+" )  ) ";
			if("1".equals(cptuse)){
				sqlwhere+=" and stateid=1 ";
			}else if(!"".equals(cptstateid)){
				sqlwhere+=" and stateid in("+cptstateid+") ";
			}
			if("1".equals(cptsptcount)){
				sqlwhere+=" and sptcount='1' ";
			}
		}
		
		sqlwhere+=includeNumZeroSqlwhere;
		
		//\u6743\u9650\u6761\u4ef6 modify by ds Td:9699
		rs.executeSql("select cptdetachable from SystemSet");
		int detachable=0;
		if(rs.next()){
		    detachable=rs.getInt("cptdetachable");
		}
		int belid = user.getUserSubCompany1();
		int userId = user.getUID();
		char flag=Util.getSeparator();
		String rightStr = "";
		if(HrmUserVarify.checkUserRight("Capital:Maintenance",user)){
			rightStr = "Capital:Maintenance";
		}
		String blonsubcomid = "";
		
		if(detachable == 1 && userId!=1){
			 if(isdata ==2){
				String sqltmp = "";
				rs2.executeProc("HrmRoleSR_SeByURId", ""+userId+flag+rightStr);
				while(rs2.next()){
				    blonsubcomid=rs2.getString("subcompanyid");
					sqltmp += (", "+blonsubcomid);
				}
				if(!"".equals(sqltmp)){//\u89d2\u8272\u8bbe\u7f6e\u7684\u6743\u9650
					sqltmp = sqltmp.substring(1);
					sqlwhere += " and blongsubcompany in ("+sqltmp+") ";
				}else{
					sqlwhere += " and blongsubcompany in ("+belid+") ";
				}
			}else if(isdata==1){
				int allsubids[] = CheckSubCompanyRight.getSubComByUserRightId(user.getUID(),rightStr);
				String allsubid = "";
				for(int i=0;i<allsubids.length;i++){
					if(allsubids[i]>0){
						allsubid += (allsubid.equals("")?"":",") + allsubids[i];
					}	
				}
				if(allsubid.equals("")) allsubid = user.getUserSubCompany1() + "";
				if(!"".equals(allsubid)){//\u89d2\u8272\u8bbe\u7f6e\u7684\u6743\u9650
					sqlwhere += " and blongsubcompany in ("+allsubid+") ";
				}else{
					sqlwhere += " and blongsubcompany in ("+allsubid+") ";
				}
			}
		}
		
		//\u6d41\u7a0b\u6d4f\u89c8\u5b9a\u4e49\u6761\u4ef6
		int bdf_wfid=Util.getIntValue(request.getParameter("bdf_wfid"),-1);
		int bdf_fieldid=Util.getIntValue(request.getParameter("bdf_fieldid"),-1);
		int bdf_viewtype=Util.getIntValue(request.getParameter("bdf_viewtype"),-1);
		List<ConditionField> lst=null;
		if(request.getParameter("bdf_wfid")!=null && (lst=ConditionField.readAll(bdf_wfid, bdf_fieldid, bdf_viewtype)).size()>0){
			for(int i=0;i<lst.size();i++){
				ConditionField f=lst.get(i);
				String fname=f.getFieldName();
				String fvalue= f.getValue();
				boolean isHide=f.isHide();
				boolean isReadOnly= f.isReadonly();
				if(isHide||isReadOnly){
					if(!"".equals(fvalue) && "mark".equalsIgnoreCase(fname)){
						sqlwhere+=" and t1.mark like '%"+fvalue+"%' ";
					}else if(!"".equals(fvalue) && "fnamark".equalsIgnoreCase(fname)){
						sqlwhere+=" and t1.fnamark like '%"+fvalue+"%' ";
					}else if(!"".equals(fvalue) && "name".equalsIgnoreCase(fname)){
						sqlwhere+=" and t1.name like '%"+fvalue+"%' ";
					}else if(!"".equals(fvalue) && "capitalSpec".equalsIgnoreCase(fname)){
						sqlwhere+=" and t1.capitalSpec like '%"+fvalue+"%' ";
					}else if("departmentid".equalsIgnoreCase(fname)){
						String vtype= f.getValueType();
						if("1".equals(vtype)){//\u5f53\u524d\u64cd\u4f5c\u8005\u7684\u503c
							fvalue=ResourceComInfo.getDepartmentID( ""+user.getUID());
						}else if("3".equals(vtype)){//\u53d6\u8868\u5355\u5b57\u6bb5\u503c
							fvalue="";
							if(f.isGetValueFromFormField()){
								fvalue=Util.null2String( f.getDepartmentIds( Util.null2String(request.getParameter("bdf_"+fname)).split(",")[0]));
							}
						}
						if(!"".equals(fvalue)){
							sqlwhere+=" and t1.departmentid='"+fvalue+"' ";
						}
					}
				}
				
			}
		}
		
		
		result = browserManager.getResult(request, backfields, fromSql ,sqlwhere,pagenum);
	}else if(type.equals("25") ){//\u8d44\u4ea7\u7ec4
		result = browserManager.getResult(request, "id,assortmentname", "CptCapitalAssortment"," subassortmentcount=0 ", pagenum);
	}else if(type.equals("242") ){//\u8d44\u4ea7\u7c7b\u578b
		result = browserManager.getResult(request, "id,name", "CptCapitalType", pagenum);
	}else if(type.equals("243") ){//\u8d44\u4ea7\u72b6\u6001
		result = browserManager.getResult(request, "id,name", "CptCapitalState", pagenum);
	}else if(type.equals("161") || type.equals("162")){//\u81ea\u5b9a\u4e49\u5355\u9009
		result = browserManager.getResultCustom(request, pagenum,user);
	}else if(type.equals("129") ){//\u9879\u76ee\u6a21\u677f
		result = browserManager.getResult(request, "id,templetName", "Prj_Template", pagenum);
	}else if(type.equals("8") || type.equals("135")){//\u9879\u76ee
		String sqlwhere = " ("+CommonShareManager.getPrjShareWhereByUser(user)+")  ";
		if("prjtskimp".equals(request.getParameter("from"))){
			sqlwhere = " ("+CommonShareManager.getPrjShareWhereByUserCanEdit(user)+")  ";
		}
		//\u6d41\u7a0b\u6d4f\u89c8\u5b9a\u4e49\u6761\u4ef6
		int bdf_wfid=Util.getIntValue(request.getParameter("bdf_wfid"),-1);
		int bdf_fieldid=Util.getIntValue(request.getParameter("bdf_fieldid"),-1);
		int bdf_viewtype=Util.getIntValue(request.getParameter("bdf_viewtype"),-1);
		List<ConditionField> lst=null;
		if(request.getParameter("bdf_wfid")!=null && (lst=ConditionField.readAll(bdf_wfid, bdf_fieldid, bdf_viewtype)).size()>0){
			for(int i=0;i<lst.size();i++){
				ConditionField f=lst.get(i);
				String fname=f.getFieldName();
				String fvalue= f.getValue();
				if("status".equalsIgnoreCase(fname)){
					List<String> selLst= f.getCanSelectValueList();
					if(selLst!=null&&selLst.size()>0){
						StringBuffer sb=new StringBuffer(" and status in(");
						for(String s:selLst){
							sb.append(s+",");
						}
						sb.deleteCharAt(sb.length()-1).append(")");
						sqlwhere+=sb.toString();
					}
				}
				boolean isHide=f.isHide();
				boolean isReadOnly= f.isReadonly();
				if(( isHide||isReadOnly)){
					if(!"".equals(fvalue) &&"name".equalsIgnoreCase(fname)){
						sqlwhere+=" and name like '%"+fvalue+"%' ";
					}else if(!"".equals(fvalue) &&"prjtype".equalsIgnoreCase(fname)){
						sqlwhere+=" and prjtype='"+fvalue+"' ";
					}else if(!"".equals(fvalue) &&"worktype".equalsIgnoreCase(fname)){
						sqlwhere+=" and worktype='"+fvalue+"' ";
					}else if(!"".equals(fvalue) &&"status".equalsIgnoreCase(fname)){
						sqlwhere+=" and status='"+fvalue+"' ";
					}else if("manager".equalsIgnoreCase(fname)){
						String vtype= f.getValueType();
						if("1".equals(vtype)){//\u5f53\u524d\u64cd\u4f5c\u8005\u7684\u503c
							fvalue=""+user.getUID();
						}else if("3".equals(vtype)){//\u53d6\u8868\u5355\u5b57\u6bb5\u503c
							fvalue="";
							if(f.isGetValueFromFormField()){
								fvalue=Util.null2String(request.getParameter("bdf_"+fname)).split(",")[0];
							}
						}
						if(!"".equals(fvalue)){
							sqlwhere+=" and manager='"+fvalue+"' ";
						}
					}
				}
				
			}
		}
	
		browserManager.setOrderKey("createdate");
		result = browserManager.getResult(request, "t1.id,t1.name", "Prj_ProjectInfo t1 ", sqlwhere,pagenum);
	}else if(type.equals("prjtsk") ){//\u9879\u76ee\u4efb\u52a1
		String sqlwhere =(whereClause.length()>0?whereClause+" and ":"")+ " tt1.prjid=t1.id and tt1.isdelete =0 and ("+CommonShareManager.getPrjTskShareWhereByUser(user, "tt1")+")  ";
		result = browserManager.getResult(request, "tt1.id,tt1.subject", "Prj_TaskProcess tt1,Prj_ProjectInfo t1 ", sqlwhere,pagenum);
	}
	
	else if(type.equals("244") ){//\u9879\u76ee\u7c7b\u578b
		result = browserManager.getResult(request, "id,fullname", "Prj_ProjectType", pagenum);
	}else if(type.equals("245") ){//\u9879\u76ee\u5de5\u4f5c\u7c7b\u578b
		result = browserManager.getResult(request, "id,fullname", "Prj_WorkType", pagenum);
	}else if(type.equals("246") ){//\u9879\u76ee\u72b6\u6001
		result = browserManager.getResult(request, "id,description", "Prj_ProjectStatus", pagenum);
	}else if(type.equals("65")){//\u89d2\u8272
		result = browserManager.getResult(request, "id,rolesmark", "HrmRoles", pagenum);
	}else if(type.equals("9") || type.equals("37")){//\u6587\u6863
		String sqlwhere = "  docstatus in (1,2,5) and exists(select 1 from ("+ShareManager.getShareDetailTableByUserNew("doc",user)+" )t2 where t2.sourceid=docdetail.id)  ";
		browserManager.setOrderKey("doclastmoddate");
		result = browserManager.getResult(request, "id,docsubject", "docdetail",sqlwhere, pagenum);
	}else if(type.equals("product")){// \u5ba2\u6237-\u4ea7\u54c1
		result = browserManager.getResult(request, "id,assetname", "LgcAssetCountry", pagenum);
	}else if(type.equals("38")){// \u5ba2\u6237-\u4ea7\u54c1
		result = browserManager.getResult(request, "id,assetname", "LgcAssetCountry", pagenum);
	}else if(type.equals("35")){// \u5ba2\u6237-\u5408\u540c
		result = browserManager.getResult(request, "id,name", "CRM_Contract", pagenum);
	}else if(type.equals("-99995")){// \u5ba2\u6237-\u884c\u4e1a
		result = browserManager.getResult(request, "id,fullname", "CRM_SectorInfo", pagenum);
	}else if(type.equals("-99994")){// \u5ba2\u6237-\u4ea7\u54c1-\u7c7b\u522b
		result = browserManager.getResult(request, "id,assortmentname", "LgcAssetAssortment",pagenum);
	}else if(type.equals("69")||type.equals("-99993")){// \u5ba2\u6237-\u4ea7\u54c1-\u8ba1\u91cf\u5355\u4f4d
		result = browserManager.getResult(request, "id,unitname", "LgcAssetUnit",pagenum);
	}else if(type.equals("89")){// \u4f1a\u8bae\u7c7b\u578b
		String approverSql="";
		if(!"".equals(whereClause)){//whereClause \u53ea\u80fd\u4f20 \u6d41\u7a0bworkID
			approverSql=" (approver="+whereClause+" or approver1="+whereClause+")";
		}
	
		if(!"1".equals(Util.null2String(request.getParameter("forall")))){//\u67e5\u8be2\u6240\u6709,\u6ca1\u6709\u6743\u9650\u63a7\u5236
			whereClause=" 1=1 "+MeetingShareUtil.getTypeShareSql(user);;
		}
		if(!"".equals(approverSql)){
			if("".equals(whereClause)){
				whereClause+=approverSql;
			}else{
				whereClause+=" and "+approverSql;
			}
		}
		result = browserManager.getResult(request, "a.id,a.name", "Meeting_Type a",whereClause,pagenum);
	}else if(type.equals("-99991")){//\u7b80\u5355\u6d41\u7a0b
		result = browserManager.getResult(request, "id,workflowname", "workflow_base",whereClause,pagenum);
	}else if(type.equals("87")||type.equals("184")){// \u4f1a\u8bae\u5ba4
		if(!"1".equals(Util.null2String(request.getParameter("forall")))){//\u67e5\u8be2\u6240\u6709,\u6ca1\u6709\u6743\u9650\u63a7\u5236
			whereClause="1=1 and (status=1 or status is null) "+MeetingShareUtil.getRoomShareSql(user);
		}
		result = browserManager.getResult(request, "a.id,a.name", "MeetingRoom a",whereClause,pagenum);
    }else if(type.equals("meetingService")){// \u4f1a\u8bae\u670d\u52a1
		result = browserManager.getResult(request, "a.id,a.name", "Meeting_Service_Type a",whereClause,pagenum);
    }else if(type.equals("meetingCaller")){// \u9884\u8bbe\u4e86\u4f1a\u8bae\u53ec\u96c6\u4eba
    	String meetingtype=Util.null2String(request.getParameter("meetingtype"));
    	if(!meetingtype.equals("")) {
    		//\u53ec\u96c6\u4eba
    		rs2.executeProc("MeetingCaller_SByMeeting",meetingtype) ;
    		String whereclause="(" ;
    		int ishead=0;
    		while(rs2.next()){
    			String callertype=rs2.getString("callertype") ;
    			int seclevel=Util.getIntValue(rs2.getString("seclevel"), 0) ;
    			String rolelevel=rs2.getString("rolelevel") ;
    			String thisuserid=rs2.getString("userid") ;
    			String departmentid=rs2.getString("departmentid") ;
    			String roleid=rs2.getString("roleid") ;
    			String subcompanyid=rs2.getString("subcompanyid") ;
    			int seclevelMax=Util.getIntValue(rs2.getString("seclevelMax"), 0) ;
    		
    			if(callertype.equals("1")){
    				if(ishead==0){
    					whereclause+=" t1.id="+thisuserid ;
    					}
    				if(ishead==1){
    					whereclause+=" or t1.id="+thisuserid ;
    					}
    			}
    			if(callertype.equals("2")){
    				if(ishead==0){
    					whereclause+=" t1.id in (select id from hrmresource where departmentid="+departmentid+" and seclevel >="+seclevel+" and seclevel <= "+seclevelMax+" )" ;
    				}
    				if(ishead==1){
    					whereclause+=" or t1.id in (select id from hrmresource where departmentid="+departmentid+" and seclevel >="+seclevel+" and seclevel <= "+seclevelMax+" )" ;
    				 }
    			}
    			if(callertype.equals("3")){
    				if(ishead==0){
    					whereclause+=" t1.id in (select resourceid from hrmrolemembers join hrmresource on  hrmrolemembers.resourceid=hrmresource.id where roleid="+roleid+" and rolelevel >="+rolelevel+" and seclevel >="+seclevel+" and seclevel <= "+seclevelMax+")" ;
    				}
    				if(ishead==1){
    					whereclause+=" or t1.id in (select resourceid from hrmrolemembers join hrmresource on  hrmrolemembers.resourceid=hrmresource.id where roleid="+roleid+" and rolelevel >="+rolelevel+" and seclevel >="+seclevel+" and seclevel <= "+seclevelMax+")" ;
    				}
    			}
    			if(callertype.equals("4")){
    				if(ishead==0){
    					whereclause+=" t1.id in (select id from hrmresource where seclevel >="+seclevel+" and seclevel <= "+seclevelMax+" )" ;
    				}
    				if(ishead==1){
    					whereclause+=" or t1.id in (select id from hrmresource where seclevel >="+seclevel+" and seclevel <= "+seclevelMax+" )" ;
    				}
    			}
    			if(callertype.equals("5")){
    				if(ishead==0){
    					whereclause+=" t1.id in (select id from hrmresource where subcompanyid1="+subcompanyid+" and seclevel >="+seclevel+" and seclevel <= "+seclevelMax+" )" ;
    				}
    				if(ishead==1){
    					whereclause+=" or t1.id in (select id from hrmresource where subcompanyid1="+subcompanyid+" and seclevel >="+seclevel+" and seclevel <= "+seclevelMax+" )" ;
    				}
    			}
    			if(ishead==0)   ishead=1;
    		}
    		//\u53ec\u96c6\u4eba\u67e5\u8be2\u6761\u4ef6
    		if(!whereclause.equals("( ") && whereclause.length() > 1){  
    			whereclause+=" )" ;
    		}

    		whereClause =whereclause+ " and t1.departmentid = t2.id and (t1.status = 0 or t1.status = 1 or t1.status = 2 or t1.status = 3) ";
    		browserManager.setOrderKey("t1.dsporder");
    		browserManager.setOrderWay("asc");
    		result = browserManager.getResult(request, "t1.id,lastname,departmentname", "hrmresource t1,hrmdepartment t2", whereClause, pagenum,"t1");
    	}

    } else if(type.equals("28")){// \u76f8\u5173\u4f1a\u8bae
    	String allUser=MeetingShareUtil.getAllUser(user);
    	whereClause+=" m1.meetingstatus=2 and m1.repeattype=0";
    	whereClause+=" and m1.id=m2.meetingid and m2.userid in ("+allUser+")";//\u589e\u52a0\u6761\u4ef6\uff1a\u5f53\u524d\u7528\u6237\u5728Meeting_ShareDetail\u6743\u9650\u8868\u4e2d\u6709\u8bb0\u5f55
    	/** \u4f1a\u8bae\u81ea\u5b9a\u4e49\u6d4f\u89c8\u6b3e **/
    	String bdf_wfid = Util.null2String(request.getParameter("bdf_wfid"));
    	String bdf_fieldid = Util.null2String(request.getParameter("bdf_fieldid"));
    	String bdf_viewtype = Util.null2String(request.getParameter("bdf_viewtype"));
    	if(!"".equals(bdf_wfid)&&!"".equals(bdf_fieldid)&&!"".equals(bdf_viewtype)){
    		List<ConditionField> list=ConditionField.readAll(Util.getIntValue(bdf_wfid),Util.getIntValue(bdf_fieldid),Util.getIntValue(bdf_viewtype));
    		if(list!=null&&list.size()>0){
   				String conditionFieldName="";
   				String conditionFieldValue="";
   				for(ConditionField conditionField:list){
   					conditionFieldName=conditionField.getFieldName();
   					conditionFieldValue="";
   					//\u5904\u7406\u540e\u53f0\u8bbe\u7f6e\u9ed8\u8ba4\u503c
   					if("name".equalsIgnoreCase(conditionFieldName)){
   						conditionFieldValue=conditionField.getValue();
   						if(!"".equals(conditionFieldValue)) whereClause+=" and m1.name like '%"+conditionFieldValue+"%' ";
   					}else if("address".equalsIgnoreCase(conditionFieldName)){
   						if("2".equals(conditionField.getValueType())){
   							conditionFieldValue=conditionField.getValue();
   						}else if("3".equals(conditionField.getValueType())){
   							if(conditionField.isGetValueFromFormField()){
   								conditionFieldValue=Util.null2String(request.getParameter("bdf_address"));
   							}
   						}
  						if(!"".equals(conditionFieldValue)) whereClause+=" and  m1.address ="+conditionFieldValue;
   					}else if("begindateselect".equalsIgnoreCase(conditionFieldName)){
   						String begindatefrom="";
   						String begindateto="";
   						if(conditionField.isGetValueFromFormField()){
   							String formDate=Util.null2String(request.getParameter("bdf_begindateselect"));
							begindatefrom="".equals(begindatefrom)?formDate:begindatefrom;
							begindateto="".equals(begindateto)?formDate:begindateto;
   						}else{
   							begindatefrom=conditionField.getStartDate();
   							begindateto=conditionField.getEndDate();
   						}
   						if(!"".equals(begindatefrom)) whereClause += " and m1.begindate>='" + begindatefrom + "'";
   						if(!"".equals(begindateto)) whereClause += " and m1.begindate<='" + begindateto + "'";
   					}
    			}
    		}
    	}
    	/** \u4f1a\u8bae\u81ea\u5b9a\u4e49\u6d4f\u89c8\u6b3e **/		
		result = browserManager.getResult(request, "m1.id,m1.name", "meeting m1,Meeting_ShareDetail m2",whereClause,pagenum);
    }else if("wfFormBrowser".equals(type)){//\u6d41\u7a0b\u8868\u5355
		String isbill = Util.null2String(request.getParameter("isbill"));//0 \u8868\u5355 1 \u5355\u636e  \u7a7a\u503c\u8868\u793a\u6240\u6709\u8868\u5355\u5355\u636e
		WfFormBrowser browserData = new WfFormBrowser();
		result = browserData.getResult(isbill, request, user,pagenum);
	}else if("mdFormBrowser".equals(type)){//\u8868\u5355\u5efa\u6a21\u8868\u5355
		String rightStr = request.getParameter("rightStr");
		String isvirtualform = request.getParameter("isvirtualform");
		whereClause = appDetachComInfo.getCompanyIdByFromMode(user.getUID(), rightStr);
		MdFormBrowser browserData = new MdFormBrowser();
		if(isvirtualform != null && isvirtualform.equals("1")){  
			result = browserData.getResult(request,user,pagenum,whereClause,isvirtualform);
		}else{
			result = browserData.getResult(request,user,pagenum,whereClause,null);
		}
	}else if("worktypeBrowser".equals(type)){
	//result = browserManager.getResult(request, "id,typename", "workflow_type",whereClause,pagenum);
        boolean isopenos = RequestUtil.isOpenOtherSystemToDo();
        String showos = Util.null2String(request.getParameter("showos"));        
        if(isopenos){
            String tablename = "";
            if(showos.equals("1")) {
				String showsysname = new RequestUtil().getOfsSetting().getShowsysname();
				if(showsysname.equals("2")) {
					tablename = "(select id, typename from workflow_type" +
							" union" +
							" select sysid as id, sysfullname as typename from ofs_sysinfo ) a ";
				}else{
					tablename = "(select id, typename from workflow_type" +
                        " union" +
                        " select sysid as id, sysshortname as typename from ofs_sysinfo ) a ";
				}
            }else{
                tablename = "workflow_type";
            }
            result = browserManager.getResult(request, "id,typename", tablename ,whereClause,pagenum);
        }else{
            result = browserManager.getResult(request, "id,typename", "workflow_type",whereClause,pagenum);
        }
	}else if("workflowBrowser".equals(type)){//\u6d41\u7a0b
		String istemplate = Util.null2String(request.getParameter("isTemplate"));
		String reportwfid = Util.null2String(request.getParameter("reportwfid"));
        String iswfec = Util.null2String(request.getParameter("iswfec"));
        String showos = Util.null2String(request.getParameter("showos"));
	    if("1".equals(istemplate)){
	    	whereClause = "isTemplate ='1'";
	    }else{
	    	whereClause = "isvalid='1'";
	    }
	    if(!"".equals(reportwfid)){
	        whereClause = " id in ("+reportwfid+")";
	    }
	    
	    String isWorkflowDoc = Util.null2String(request.getParameter("isWorkflowDoc"));
	    String onlyWfDoc = Util.null2String(request.getParameter("onlyWfDoc"));
	    if(isWorkflowDoc.equals("1")){
	    	String sql = "select distinct billid from workflow_billfield where type = 9";
			String formids = "";
			rs.execute(sql);
			while(rs.next()){
				if(formids.equals("")){
					formids = rs.getString("billid");
				}else{
					formids = formids +","+ rs.getString("billid");
				}
			}
			sql = "select distinct formid from workflow_formfield where fieldid in (select id from workflow_formdict where type=9)";
			rs.execute(sql);
			while(rs.next()){
				if(formids.equals("")){
					formids = rs.getString("formid");
				}else{
					formids = formids +","+ rs.getString("formid");
				}
			}
	    	if(whereClause.equals("")){
	    		whereClause = "where formid in ("+formids+")";
	    	}else{
	    		whereClause += " and formid in ("+formids+")";
	    	}
	    	if(!onlyWfDoc.equals("1")){
	    		whereClause += " and (isWorkflowDoc!=1 or isWorkflowDoc is null) and (formid<0 or isbill=0)";
	    	}
	    }
	    if("prjwf".equalsIgnoreCase(request.getParameter("from"))&&request.getParameter("sqlwhere")!=null){
	    	whereClause=request.getParameter("sqlwhere");
	    }
	    if("htmllayoutchoose".equals(Util.null2String(request.getParameter("from")))){
		whereClause = Util.null2String(request.getParameter("sqlwhere"));
	    }
	    if("1".equals(Util.null2String(request.getParameter("wfRightAdd")))){
	        boolean isUseWfManageDetach = manageDetachComInfo.isUseWfManageDetach();
	        //\u5982\u679c\u5f00\u542f\u5206\u6743\uff0c\u4e14\u4e0d\u662f\u7ba1\u7406\u5458
	        if(isUseWfManageDetach && !user.getLoginid().equalsIgnoreCase("sysadmin")){
	          	String  hasRightSub=SubCompanyComInfo.getRightSubCompany(user.getUID(),"WorkflowManage:All",0);  
		       	if(!"".equals(hasRightSub)){
		       	 	whereClause +=" AND subcompanyid in ("+hasRightSub+")";
		    	}
	        }
	        whereClause += " and (istemplate is null or istemplate<>'1')";
	    }
	    
	    if(iswfec.equals("1")){
		    whereClause += " and formid<0 and isbill=1 ";
	    }
	    String subcompanyids="";
	    int detachable=Util.getIntValue(String.valueOf(session.getAttribute("detachable")),0);
	    int[] subCompanyId=null;

	    if(detachable==1 && "1".equals(istemplate)){  
		    subCompanyId= CheckSubCompanyRight.getSubComByUserRightId(user.getUID(),"WorkflowManage:All");
		    for(int i=0;i<subCompanyId.length;i++){
		    	subcompanyids+=subCompanyId[i]+",";
		    }
		    if(subcompanyids.length()>1){
		    	subcompanyids=subcompanyids.substring(0,subcompanyids.length()-1);
		    }
	    }
	    if(!subcompanyids.equals("")){
	    	whereClause += " and subCompanyId in("+ subcompanyids+")" ;
	    }
	    
	   //System.out.println(whereClause);
		//result = browserManager.getResult(request, "id,workflowname", "workflow_base",whereClause,pagenum);
        boolean isopenos = RequestUtil.isOpenOtherSystemToDo();
        if(isopenos&&showos.equals("1")){//\u5f00\u542f\u5f02\u6784\u7cfb\u7edf
	    String tablename = "(select id,workflowname from workflow_base where 1=1 and "+whereClause+" union select workflowid as id ,workflowname from ofs_workflow where cancel=0)  t";
            result = browserManager.getResult(request, "id,workflowname", tablename, "", pagenum);
        }else {
            result = browserManager.getResult(request, "id,workflowname", "workflow_base", whereClause, pagenum);
        }
	}else if("worktypeBrowser2".equals(type)){
		String sql = Monitor.getwftypeRightSql(user.getUID()+"",rs.getDBType());
		whereClause = " id in ("+sql+")";
		result = browserManager.getResult(request, "id,typename", "workflow_type",whereClause,pagenum);
	}else if("workflowBrowser2".equals(type)){//\u6d41\u7a0b
		String sql = Monitor.getwfidRightSql(user.getUID()+"",rs.getDBType());
		whereClause = " id in ("+sql+")";
		result = browserManager.getResult(request, "id,workflowname", "workflow_base",whereClause,pagenum);
	}else if("178".equals(type)){
		result = browserManager.getResult(request, "yearId,yearName", "Workflow_FieldYear",pagenum);
	}else if("16".equals(type)||"152".equals(type)||"171".equals(type)){//\u8bf7\u6c42\u3001\u591a\u8bf7\u6c42
		String userid = "" + user.getUID();
		String usertype = "0";

		if (user.getLogintype().equals("2"))
			usertype = "1";
        if(rs.getDBType().equals("oracle"))
		 	whereClause=" (nvl(a.currentstatus,-1) = -1 or (nvl(a.currentstatus,-1)=0 and a.creater="+ user.getUID() + ")) ";
        else
        	whereClause=" (isnull(a.currentstatus,-1) = -1 or (isnull(a.currentstatus,-1)=0 and a.creater="+ user.getUID() + ")) ";
        whereClause+= " and b.requestid = a.requestid and b.userid="+userid
		+" and b.usertype="+usertype
		+" and a.workflowid = c.id" 
		+" and c.isvalid in (1,3)";
		
		//\u5f52\u6863\u6d41\u7a0b
		if ("171".equals(type)) {
			whereClause += " AND currentnodetype=3";
		}

		/*begin\uff1a\u5904\u7406\u8d39\u7528\u6d41\u7a0b\u8bf7\u6c42\u6d4f\u89c8\u6309\u94ae\u8fc7\u6ee4\u903b\u8f91\u4ee3\u7801*/
		if("152".equals(type)){
			String fieldid = Util.null2String(request.getParameter("fieldid"));
			String currworkflowid = Util.null2String(request.getParameter("currworkflowid"));
			if ("".equals(currworkflowid)) {
				currworkflowid = Util.null2String(request.getParameter("workflowid"));
			}
			if(!"".equals(fieldid)){
				String newwfs[] = fieldid.split("_");
				fieldid = newwfs[0];
			}
			int _bdf_wfid = Util.getIntValue(request.getParameter("bdf_wfid"));
			int _bdf_fieldid = Util.getIntValue(request.getParameter("bdf_fieldid"));
			int __requestid = Util.getIntValue(request.getParameter("__requestid"));
			int _fna_wfid = Util.getIntValue(request.getParameter("fna_wfid"));
			int _fna_fieldid = Util.getIntValue(request.getParameter("fna_fieldid"));
			if(_bdf_wfid > 0 && _fna_wfid <= 0){
				_fna_wfid = _bdf_wfid;
			}
			if(Util.getIntValue(currworkflowid) > 0 && _fna_wfid <= 0){
				_fna_wfid = Util.getIntValue(currworkflowid);
			}
			if(_bdf_fieldid > 0 && _fna_fieldid <= 0){
				_fna_fieldid = _bdf_fieldid;
			}
			if(Util.getIntValue(fieldid) > 0 && _fna_fieldid <= 0){
				_fna_fieldid = Util.getIntValue(fieldid);
			}
			boolean _isEnableFnaWf = false;
			HashMap<String, String> _isEnableFnaWfHm = FnaCommon.getIsEnableFnaWfHm(_fna_wfid);
			_isEnableFnaWf = "true".equals(_isEnableFnaWfHm.get("isEnableFnaWfE8"));
			int _formId = Util.getIntValue(_isEnableFnaWfHm.get("formId"), 0);
			int _isbill = Util.getIntValue(_isEnableFnaWfHm.get("isbill"), -1);
			if(!_isEnableFnaWf){
				HashMap<String, String> _isEnableFnaRepaymentWfHm = FnaCommon.getIsEnableFnaRepaymentWfHm(_fna_wfid);
				_isEnableFnaWf = "true".equals(_isEnableFnaRepaymentWfHm.get("isEnableFnaRepaymentWf"));
				_formId = Util.getIntValue(_isEnableFnaRepaymentWfHm.get("formId"), 0);
				_isbill = Util.getIntValue(_isEnableFnaRepaymentWfHm.get("isbill"), -1);
			}
			boolean isFnaWfFysqlcReq = false;
			if(_isEnableFnaWf){
				isFnaWfFysqlcReq = FnaCommon.checkFnaWfFieldFnaType(_fna_wfid, _fna_fieldid, 2, 0, "fnaFeeWf");
			}
			if(isFnaWfFysqlcReq){
				String sqlIsNull = "ISNULL";
				String sqlSubString = "SUBSTRING";
				if("oracle".equals(rs.getDBType())){
					sqlIsNull = "NVL";
					sqlSubString = "SUBSTR";
				}
				whereClause += " and exists ( "+
						" select 1 " +
						" from FnaExpenseInfo fei " +
						" where fei.budgetperiodslist is not null " +
						" and fei.sourceRequestid <> "+__requestid+" " +
						" and fei.status = 0 " +
						" and fei.requestid = a.requestid " +
						" GROUP BY fei.organizationid, fei.organizationtype, fei.subject, fei.budgetperiods, fei.budgetperiodslist  " +
						" HAVING SUM("+sqlIsNull+"(fei.amount, 0.00)) > 0.00 " +
						" ) and a.currentnodetype = 3 ";
			}
			
		}else if("16".equals(type)){
			String fieldid = Util.null2String(request.getParameter("fieldid"));
			String currworkflowid = Util.null2String(request.getParameter("currworkflowid"));
			if ("".equals(currworkflowid)) {
				currworkflowid = Util.null2String(request.getParameter("workflowid"));
			}
			if(!"".equals(fieldid)){
				String newwfs[] = fieldid.split("_");
				fieldid = newwfs[0];
			}
			int _bdf_wfid = Util.getIntValue(request.getParameter("bdf_wfid"));
			int _bdf_fieldid = Util.getIntValue(request.getParameter("bdf_fieldid"));
			int __requestid = Util.getIntValue(request.getParameter("__requestid"));
			int _fna_wfid = Util.getIntValue(request.getParameter("fna_wfid"));
			int _fna_fieldid = Util.getIntValue(request.getParameter("fna_fieldid"));
			if(_bdf_wfid > 0 && _fna_wfid <= 0){
				_fna_wfid = _bdf_wfid;
			}
			if(Util.getIntValue(currworkflowid) > 0 && _fna_wfid <= 0){
				_fna_wfid = Util.getIntValue(currworkflowid);
			}
			if(_bdf_fieldid > 0 && _fna_fieldid <= 0){
				_fna_fieldid = _bdf_fieldid;
			}
			if(Util.getIntValue(fieldid) > 0 && _fna_fieldid <= 0){
				_fna_fieldid = Util.getIntValue(fieldid);
			}
			boolean _isEnableFnaWf = false;
			HashMap<String, String> _isEnableFnaWfHm = FnaCommon.getIsEnableFnaWfHm(_fna_wfid);
			_isEnableFnaWf = "true".equals(_isEnableFnaWfHm.get("isEnableFnaWfE8"));
			int _formId = Util.getIntValue(_isEnableFnaWfHm.get("formId"), 0);
			int _isbill = Util.getIntValue(_isEnableFnaWfHm.get("isbill"), -1);
			if(!_isEnableFnaWf){
				HashMap<String, String> _isEnableFnaRepaymentWfHm = FnaCommon.getIsEnableFnaRepaymentWfHm(_fna_wfid);
				_isEnableFnaWf = "true".equals(_isEnableFnaRepaymentWfHm.get("isEnableFnaRepaymentWf"));
				_formId = Util.getIntValue(_isEnableFnaRepaymentWfHm.get("formId"), 0);
				_isbill = Util.getIntValue(_isEnableFnaRepaymentWfHm.get("isbill"), -1);
			}
			boolean isFnaWfFysqlcReq = false;
			boolean isFnaWfRepaymentBorrowReq = false;
			boolean isFnaWfAdvanceRepaymentAdvanceReq = false;//\u662f\u5426\u662f\u8fd8\u6b3e\u6d41\u7a0b\u7684\u51b2\u9500\u9884\u4ed8\u6b3e\u660e\u7ec6\u7684\u9884\u4ed8\u6b3e\u6d41\u7a0b\u6d4f\u89c8\u6309\u94ae
			if(_isEnableFnaWf){
				isFnaWfFysqlcReq = FnaCommon.checkFnaWfFieldFnaType(_fna_wfid, _fna_fieldid, 2, 0, "fnaFeeWf");
				isFnaWfRepaymentBorrowReq = (
						FnaCommon.checkFnaWfFieldFnaType(_fna_wfid, _fna_fieldid, 1, 2, "repayment") 
						|| FnaCommon.checkFnaWfFieldFnaType(_fna_wfid, _fna_fieldid, 1, 2, "fnaFeeWf")
					);
				isFnaWfAdvanceRepaymentAdvanceReq = FnaCommon.checkFnaWfFieldFnaType(_fna_wfid, _fna_fieldid, 1, 4, "fnaFeeWf");
			}
			int borrowType = Util.getIntValue(request.getParameter("borrowType"), -1);
			if(isFnaWfFysqlcReq){
				String sqlIsNull = "ISNULL";
				String sqlSubString = "SUBSTRING";
				if("oracle".equals(rs.getDBType())){
					sqlIsNull = "NVL";
					sqlSubString = "SUBSTR";
				}
				whereClause += " and exists ( "+
						" select 1 " +
						" from FnaExpenseInfo fei " +
						" where fei.budgetperiodslist is not null " +
						" and fei.sourceRequestid <> "+__requestid+" " +
						" and fei.status = 0 " +
						" and fei.requestid = a.requestid " +
						" GROUP BY fei.organizationid, fei.organizationtype, fei.subject, fei.budgetperiods, fei.budgetperiodslist  " +
						" HAVING SUM("+sqlIsNull+"(fei.amount, 0.00)) > 0.00 " +
						" ) and a.currentnodetype = 3 ";
			}else if(isFnaWfRepaymentBorrowReq){
				int controlBorrowingWf_userId = user.getUID();
				int main_fieldIdSqr_controlBorrowingWf = Util.getIntValue(request.getParameter("main_fieldIdSqr_controlBorrowingWf"), -1);
				if(main_fieldIdSqr_controlBorrowingWf==1){
					int ___main_fieldIdSqr_val = Util.getIntValue(request.getParameter("main_fieldIdSqr_val"), -1);
					controlBorrowingWf_userId = ___main_fieldIdSqr_val;
				}
				String _condBorrowType = "";
				if(borrowType==-1 || borrowType==0){
					_condBorrowType += " (fbi1.borrowType0 = 0 and fbi1.applicantid = "+controlBorrowingWf_userId+") \n";
				}
				if(borrowType==-1){
					_condBorrowType += " or \n";
				}
				if(borrowType==-1 || borrowType==1){
					_condBorrowType += " (fbi1.borrowType1 = 1) \n";
				}
				if("".equals(whereClause)){
					whereClause += " where 1=1 ";
				}
				whereClause += " and exists ( \n"+
						" select 1 from ( \n" +
						"	select fbi.borrowRequestId, fbi.borrowRequestIdDtlId, \n" +
						"		SUM(fbi.amountBorrow * fbi.borrowDirection) sum_amountBorrow, \n" +
						"		MAX(CASE WHEN fbi.recordType = 'borrow' THEN fbi.applicantid ELSE 0 END) applicantid, \n" +
						"		MAX(CASE WHEN fbi.recordType = 'borrow' THEN fbi.departmentid ELSE 0 END) departmentid, \n" +
						"		MAX(CASE WHEN fbi.recordType = 'borrow' THEN fbi.subcompanyid1 ELSE 0 END) subcompanyid1, \n" +
						"		MAX(CASE WHEN fbi.borrowType = 0 THEN fbi.borrowType ELSE -99999 END) borrowType0, \n" +
						"		MAX(CASE WHEN fbi.borrowType = 1 THEN fbi.borrowType ELSE -99999 END) borrowType1 \n" +
						"	from FnaBorrowInfo fbi \n" +
						"	where fbi.requestid <> "+__requestid+" \n" +
						"	GROUP BY fbi.borrowRequestId, fbi.borrowRequestIdDtlId \n" +
						" ) fbi1 \n" +
						" where fbi1.sum_amountBorrow > 0 \n" +
						" and fbi1.borrowRequestId = a.requestId \n"+
						" and ("+_condBorrowType+") \n" +
						" ) \n";
			}else if(isFnaWfAdvanceRepaymentAdvanceReq){
				if("".equals(whereClause)){
					whereClause += " where 1=1 ";
				}
				whereClause += " and exists ( \n"+
						" select 1 from ( \n" +
						"	select fbi.advanceRequestId, fbi.advanceRequestIdDtlId, \n" +
						"		SUM(fbi.amountAdvance * fbi.advanceDirection) sum_amountAdvance \n" +
						"	from FnaAdvanceInfo fbi \n" +
						"	where fbi.requestid <> "+__requestid+" \n" +
						"	GROUP BY fbi.advanceRequestId, fbi.advanceRequestIdDtlId \n" +
						" ) fbi1 \n" +
						" where fbi1.sum_amountAdvance > 0 \n" +
						" and fbi1.advanceRequestId = a.requestId \n"+
						" ) \n";
			}
			
		}
		/*end\uff1a\u5904\u7406\u8d39\u7528\u6d41\u7a0b\u8bf7\u6c42\u6d4f\u89c8\u6309\u94ae\u8fc7\u6ee4\u903b\u8f91\u4ee3\u7801*/
		
		String workflowId = Util.null2String(request.getParameter("currworkflowid"));
		String fieldId = Util.null2String(request.getParameter("fieldid"));
		Browsedatadefinition bdf = new Browsedatadefinition();
		if (bdf.read(workflowId, fieldId)) {
			//\u62fc\u63a5\u6d4f\u89c8\u6570\u636e\u81ea\u5b9a\u4e49\u7684\u6761\u4ef6
			if (!"".equals(bdf.getRequestname()) && (bdf.isHide(bdf.getRequestnameopen()) || bdf.isReadonly(bdf.getRequestnamereadonly()))) {
				whereClause += " AND requestname LIKE '%" + Util.fromScreen2(bdf.getRequestname(), user.getLanguage()) + "%'";
			}
			if (!"".equals(bdf.getWorkflowtype()) && (bdf.isHide(bdf.getWorkflowtypeopen()) || bdf.isReadonly(bdf.getWorkflowtypereadonly()))) {
				whereClause += " AND a.workflowid IN (" + bdf.getAllVersionStringByWFIDs() + ")";		
			}
			if (!"".equals(bdf.getProcessnumber()) && (bdf.isHide(bdf.getProcessnumberopen()) || bdf.isReadonly(bdf.getProcessnumberreadonly()))) {
				whereClause += " AND requestmark LIKE '%" + bdf.getProcessnumber() + "%'";	
			}
			if (bdf.isHide(bdf.getCreatetypeidopen()) || bdf.isReadonly(bdf.getCreatetypeidreadonly())) {
				if ("1".equals(bdf.getCreatetype())) {
					//\u5f53\u524d\u64cd\u4f5c\u8005
					whereClause += " AND creater=" + user.getUID() + " AND creatertype=0";
				} else if ("2".equals(bdf.getCreatetype())) {
					//\u6307\u5b9a\u4eba\u5458
					if (!"".equals(bdf.getCreatetypeid())) {
						whereClause += " AND creater IN (" + bdf.getCreatetypeid() + ") AND creatertype=0";
					}
				} else if ("3".equals(bdf.getCreatetype())) {
					//\u8868\u5355\u5b57\u6bb5
					String cre = Util.null2String(request.getParameter("cre"));
					if (!"".equals(cre)) {
						whereClause += " AND creater IN (" + cre + ") AND creatertype=0";
					}
				}
			}
			if (bdf.isHide(bdf.getCreatedeptidopen()) || bdf.isReadonly(bdf.getCreatedeptidreadonly())) {
				if ("1".equals(bdf.getCreatedepttype())) {
					//\u5f53\u524d\u64cd\u4f5c\u8005\u90e8\u95e8
					if (user.getUserDepartment() != 0) {
						whereClause += " AND a.creater IN (SELECT DISTINCT id FROM hrmresource WHERE departmentid=" + user.getUserDepartment() + ")";
					}
				} else if ("2".equals(bdf.getCreatedepttype())) {
					//\u6307\u5b9a\u90e8\u95e8
					if (!"".equals(bdf.getDepartment()) && !"0".equals(bdf.getDepartment()) ) {
						whereClause += " AND a.creater IN (SELECT DISTINCT id FROM hrmresource WHERE departmentid IN (" + bdf.getDepartment() + "))";
					}
				} else if ("3".equals(bdf.getCreatedepttype())) {
					//\u8868\u5355\u5b57\u6bb5
					String dep = Util.null2String(request.getParameter("dep"));
					if (!"".equals(dep)) {
						whereClause += " AND a.creater IN (SELECT DISTINCT id FROM hrmresource WHERE departmentid IN (" + bdf.getDepartmentSQL(dep) + "))";
					}
				}
			}
			if (bdf.isHide(bdf.getCreatesubidopen()) || bdf.isReadonly(bdf.getCreatesubidreadonly())) {
				if ("1".equals(bdf.getCreatesubtype())) {
					//\u5f53\u524d\u64cd\u4f5c\u8005\u5206\u90e8
					if (user.getUserSubCompany1() != 0) {
						whereClause += " AND a.creater IN (SELECT DISTINCT id FROM hrmresource WHERE subcompanyid1=" + user.getUserSubCompany1() + ")";
					}
				} else if ("2".equals(bdf.getCreatesubtype())) {
					//\u6307\u5b9a\u5206\u90e8
					if (!"".equals(bdf.getCreatesubid())) {
						whereClause += " AND a.creater IN (SELECT DISTINCT id FROM hrmresource WHERE subcompanyid1 IN (" + bdf.getCreatesubid() + "))";
					}
				} else if ("3".equals(bdf.getCreatesubtype())) {
					//\u8868\u5355\u5b57\u6bb5
					String sub = Util.null2String(request.getParameter("sub"));
					if (!"".equals(sub)) {
						whereClause += " AND a.creater IN (SELECT DISTINCT id FROM hrmresource WHERE subcompanyid1 IN (" + bdf.getSubcompanySQL(sub) + "))";
					}
				}
			}
			if (bdf.isHide(bdf.getCreatedateopen()) || bdf.isReadonly(bdf.getCreatedatereadonly())) {
				if ("2".equals(bdf.getCreatedatetype())) {//\u4eca\u5929
					SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");//\u8bbe\u7f6e\u65e5\u671f\u683c\u5f0f
					String currentdate = sdf.format(new Date());
					whereClause += " AND createdate>='" + currentdate +"'";
		    	} else if ("3".equals(bdf.getCreatedatetype())) {//\u672c\u5468
		    		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");//\u8bbe\u7f6e\u65e5\u671f\u683c\u5f0f
		    		whereClause += " AND createdate>='" + sdf.format(bdf.getMonday()) +"' AND createdate<='" + sdf.format(bdf.getSunday()) + "'";
		    	} else if ("4".equals(bdf.getCreatedatetype())) {//\u672c\u6708
		    		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");//\u8bbe\u7f6e\u65e5\u671f\u683c\u5f0f
			    	whereClause += " AND createdate>='" + sdf.format(bdf.getFirstDayOfMonth()) +"' AND createdate<='" + sdf.format(bdf.getLastDayOfMonth()) + "'";
		    	} else if ("5".equals(bdf.getCreatedatetype())) {//\u672c\u5b63
		    		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");//\u8bbe\u7f6e\u65e5\u671f\u683c\u5f0f
				    whereClause += " AND createdate>='" + sdf.format(bdf.getFirstDayOfQuarter()) +"' AND createdate<='" + sdf.format(bdf.getLastDayOfQuarter()) +"'";
		    	} else if ("6".equals(bdf.getCreatedatetype())) {//\u672c\u5e74
		    		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");//\u8bbe\u7f6e\u65e5\u671f\u683c\u5f0f
					whereClause += " AND createdate>='" + bdf.getYearDateStart() +"' AND createdate<='" + bdf.getYearDateEnd() +"'";  
		    	} else if ("7".equals(bdf.getCreatedatetype())) {//\u6307\u5b9a\u65e5\u671f
		    		if (!"".equals(bdf.getCreatedatestart())) {
		    			whereClause += " AND createdate>='" + bdf.getCreatedatestart() + "'";
		    		}
		    		if (!"".equals(bdf.getCreatedateend())) {
		    			whereClause += " AND createdate<='" + bdf.getCreatedateend() + "'";
		    		}
		    	} else if ("8".equals(bdf.getCreatedatetype())) {
		    		//\u8868\u5355\u5b57\u6bb5
					String date = Util.null2String(request.getParameter("date"));
					if (!"".equals(date)) {
						whereClause += " AND createdate>='" + date + "'";
					}
		    	}
			}
			if ((bdf.isHide(bdf.getXgxmidopen()) || bdf.isReadonly(bdf.getXgxmidreadonly()))) {
				String xgxmids = "";
				if ("2".equals(bdf.getXgxmtype())) {
					//\u6307\u5b9a\u9879\u76ee
					xgxmids = bdf.getXgxmid();
				} else if ("3".equals(bdf.getXgxmtype())) {
					//\u8868\u5355\u5b57\u6bb5
					xgxmids = Util.null2String(request.getParameter("xgxm"));
				}
				if (!"".equals(xgxmids)) {
					String[] xgxmidAry = xgxmids.split(",");
					if (xgxmidAry.length > 0) {
						whereClause += " AND (";
						if ("oracle".equals(rs.getDBType())) {
							for (int i = 0; i < xgxmidAry.length; i++) {
								if (i > 0) {
									whereClause += " OR ";
								}
								whereClause += "(CONCAT(CONCAT(',' , TO_CHAR(a.prjids)) , ',') LIKE '%," + xgxmidAry[i] + ",%')";
							}
						} else {
							for (int i = 0; i < xgxmidAry.length; i++) {
								if (i > 0) {
									whereClause += " OR ";
								}
								whereClause += "(',' + CONVERT(VARCHAR,a.prjids) + ',' LIKE '%," + xgxmidAry[i] + ",%')";
							}
						}
						whereClause += ") ";
					}
				}
			}
			if ((bdf.isHide(bdf.getXgkhidopen()) || bdf.isReadonly(bdf.getXgkhidreadonly()))) {
				String xgkhids = "";
				if ("2".equals(bdf.getXgkhtype())) {
					//\u6307\u5b9a\u5ba2\u6237
					xgkhids = bdf.getXgkhid();
				} else if ("3".equals(bdf.getXgkhtype())) {
					//\u8868\u5355\u5b57\u6bb5
					xgkhids = Util.null2String(request.getParameter("xgkh"));
				}
				if (!"".equals(xgkhids)) {
					String[] xgkhidAry = xgkhids.split(",");
					if (xgkhidAry.length > 0) {
						whereClause += " AND (";
						if ("oracle".equals(rs.getDBType())) {
							for (int i = 0; i < xgkhidAry.length; i++) {
								if (i > 0) {
									whereClause += " OR ";
								}
								whereClause += "(CONCAT(CONCAT(',' , TO_CHAR(a.crmids)) , ',') LIKE '%," + xgkhidAry[i] + ",%')";
							}
						} else {
							for (int i = 0; i < xgkhidAry.length; i++) {
								if (i > 0) {
									whereClause += " OR ";
								}
								whereClause += "(',' + CONVERT(VARCHAR,a.crmids) + ',' LIKE '%," + xgkhidAry[i] + ",%')";
							}
						}
						whereClause += ") ";
					}
				}
			}
			if ("1".equals(bdf.getGdtype()) && (bdf.isHide(bdf.getGdtypeopen()) || bdf.isReadonly(bdf.getGdtypereadonly()))) {
				whereClause += " AND currentnodetype<3";
			} else if ("2".equals(bdf.getGdtype())) {
				whereClause += " AND currentnodetype=3";
			}
			if (!"".equals(bdf.getJsqjtype()) && !"38".equals(bdf.getJsqjtype()) && (bdf.isHide(bdf.getJsqjtypeopen()) || bdf.isReadonly(bdf.getJsqjtypereadonly()))) {//38\u4e3a\u5168\u90e8
				int date2during = Util.getIntValue(bdf.getJsqjtype(), 0);
				if (date2during > 0) {					
					whereClause += WorkflowComInfo.getDateDuringSql(date2during);
				}
			}
		}
		browserManager.setOrderKey("a.createdate");
		result = browserManager.getResult(request, "a.requestid,a.requestname", "workflow_requestbase a,workflow_currentoperator b,workflow_base c",whereClause,pagenum,"a");
	}else if("workflowChangeBrowser".equals(type)){
		whereClause = " t2.status='1' AND t2.flowDocField>0 AND t1.id=t2.workflowid  and t1.isvalid=1 ";
		/*whereClause += " and t1.id in(select t1.id from workflow_base t1,workflow_fieldLable fieldLable,workflow_formField formField, workflow_formdict formDict"; 
		whereClause += " where fieldLable.formid = formField.formid ";
		whereClause += " and fieldLable.fieldid = formField.fieldid "; 
		whereClause += " and formField.fieldid = formDict.ID and (formField.isdetail<>'1' or formField.isdetail is null) "; 
		whereClause += " and formField.formid = t1.formid and fieldLable.langurageid = "+user.getLanguage(); 
		whereClause += " and formDict.fieldHtmlType = '3' and formDict.type = 9 ";
		whereClause += " group by t1.id) ";*/
		whereClause += " and t1.id not in(select workflowid from DocChangeWorkflow)" ;
		result = browserManager.getResult(request, "t1.id,t1.workflowname", "workflow_base t1,workflow_createdoc t2",whereClause,pagenum,"t1");
	}else if("monitortypeBrowser".equals(type)){//\u6d41\u7a0b\u76d1\u63a7\u7c7b\u578b
		result = browserManager.getResult(request, "id,typename", "Workflow_MonitorType",pagenum);
	}else if("queryTypeBrowser".equals(type)){//\u6d41\u7a0b\u81ea\u5b9a\u4e49\u67e5\u8be2\u79cd\u7c7b
		result = browserManager.getResult(request, "id,typename", "workflow_customQuerytype",pagenum);
	}else if("reportTypeBrowser".equals(type)){//\u6d41\u7a0b\u62a5\u8868\u7c7b\u578b
		result = browserManager.getResult(request, "id,typename", "Workflow_ReportType",pagenum);
	}else if("ruleBrowser".equals(type)){//\u6d41\u7a0b\u89c4\u5219
		whereClause = " rulesrc=3 ";
		result = browserManager.getResult(request, "id,rulename,condit", "rule_base",whereClause,pagenum);
	}else if("workflowNodeBrowser".equals(type)){//\u6d41\u7a0b\u8282\u70b9
	    String wfid = Util.null2String(request.getParameter("wfid"));
	    String whereparas = " (b.IsFreeNode is null or b.IsFreeNode!='1') and a.nodeId=b.id  and a.workflowId='"+wfid+"'";
		result = browserManager.getResult(request, "nodeId,nodeName", "workflow_flownode a,workflow_nodebase b",whereparas,pagenum);
	}else if("WorkflowNodePortalBrowserMulti".equals(type)){//\u591a\u6d41\u7a0b\u51fa\u53e3
	    String wfid = Util.null2String(request.getParameter("wfid"));
	    String whereparas = " wfrequestid is null \n" +
	    		" and not EXISTS(select 1 from workflow_nodebase b where workflow_nodelink.nodeid=b.id and b.IsFreeNode='1') \n" +
	    		" and not EXISTS(select 1 from workflow_nodebase b where workflow_nodelink.destnodeid=b.id and b.IsFreeNode='1') \n" +
	    		" and workflowid="+wfid+" ";
		result = browserManager.getResult(request, 
				"id, linkname", 
				"workflow_nodelink",
				whereparas,
				pagenum);
	}else if("fieldBrowser".equals(type)){//\u6d41\u7a0b\u5b57\u6bb5
		FieldBrowser fieldBrowser = new FieldBrowser();
	    String wfid = Util.null2String(request.getParameter("wfid"));
		result = fieldBrowser.getResult(request, wfid, user, pagenum);
	}else if("categoryBrowser".equals(type)){//\u6587\u6863\u5b50\u76ee\u5f55
		CategoryBrowser categoryBrowser = new CategoryBrowser();
		result = categoryBrowser.getResult(request, user, pagenum);
	}else if(type.equals("hrmjobtitles")||type.equals("24")||type.equals("278")){// \u5c97\u4f4d
		if(whereClause.length()>0)whereClause += " and ";
		whereClause += " t1.jobactivityid = t2.id ";
		result = browserManager.getResult(request,"t1.id,jobtitlename, jobactivityname"," hrmjobtitles t1,HrmJobActivities t2 ",whereClause,pagenum);
	}else if(type.equals("jobactivity")){//\u5c97\u4f4d\u7c7b\u522b
		result = browserManager.getResult(request,"id,jobactivityname","HrmJobActivities",pagenum);
	}else if(type.equals("jobcall")||type.equals("260")){//\u804c\u52a1
		result = browserManager.getResult(request,"id,name","hrmjobcall",pagenum);
	}else if(type.equals("jobgroups")){//\u804c\u52a1\u7c7b\u578b
		result = browserManager.getResult(request,"id,jobgroupname","hrmjobgroups",pagenum);
	}else if(type.equals("location")||type.equals("262")){//\u529e\u516c\u5730\u70b9
		result = browserManager.getResult(request,"id,locationname","hrmlocations",pagenum);
	}else if(type.equals("usekind")||type.equals("31")){//\u7528\u529f\u6027\u8d28
		result = browserManager.getResult(request,"id,name","HrmUseKind",pagenum);
	}else if(type.equals("usedemand")){//\u7528\u5de5\u9700\u6c42
		result = browserManager.getResult(request,"a.id,b.jobtitlename","HrmUseDemand a left join HrmJobTitles b on a.demandjobtitle = b.id",pagenum);
	}else if(type.equals("careerplan")){//\u62db\u8058\u8ba1\u5212
		result = browserManager.getResult(request,"id,topic","HrmCareerPlan",pagenum);
	}else if(type.equals("inviteinfo")){//\u62db\u8058\u4fe1\u606f
		result = browserManager.getResult(request,"a.id,b.jobtitlename","HrmCareerInvite a left join HrmJobTitles b on a.careername = b.id",pagenum);
	}else if(type.equals("city")||type.equals("58")){//\u57ce\u5e02
		result = browserManager.getResult(request,"id,cityname","HrmCity","( canceled = '0' or canceled is null) ",pagenum);
	}else if(type.equals("educationlevel")||type.equals("30")){//\u5b66\u5386
		result = browserManager.getResult(request,"id,name","HrmEducationLevel",pagenum);
	}else if(type.equals("speciality")||type.equals("119")){//\u4e13\u4e1a
		result = browserManager.getResult(request,"id,name","Hrmspeciality",pagenum);
	}else if(type.equals("country")||type.equals("258")){//\u56fd\u5bb6
		result = browserManager.getResult(request,"id,countrydesc","HrmCountry",pagenum);
	}else if(type.equals("hrmbank")){//\u5de5\u8d44\u94f6\u884c
		result = browserManager.getResult(request,"id,bankname","HrmBank",pagenum);
	}else if(type.equals("systemlanguage")||type.equals("259")){//\u7cfb\u7edf\u8bed\u8a00
		result = browserManager.getResult(request,"id,language","syslanguage",pagenum);
	}else if(type.equals("customerStatus")||type.equals("264")){//\u5ba2\u6237\u72b6\u6001
		result = browserManager.getResult(request,"id,fullname","CRM_CustomerStatus",pagenum);
	}else if(type.equals("customerType")||type.equals("60")){//\u5ba2\u6237\u7c7b\u578b
		result = browserManager.getResult(request,"id,fullname","CRM_CustomerType",pagenum);
	}else if(type.equals("customerDesc")||type.equals("61")){//\u5ba2\u6237\u63cf\u8ff0
		result = browserManager.getResult(request,"id,fullname","CRM_CustomerDesc",pagenum);
	}else if(type.equals("customerSize")||type.equals("62")){//\u5ba2\u6237\u89c4\u6a21
		result = browserManager.getResult(request,"id,fullname","CRM_CustomerSize",pagenum);
	}else if(type.equals("debtorNumber")){//\u5ba2\u6237 \u7d2f\u79ef\u5408\u540c\u91d1\u989d
		result = browserManager.getResult(request,"id,fullname","CRM_TradeInfo",pagenum);
	}else if(type.equals("creditorNumber")){//\u5ba2\u6237 \u4fe1\u7528\u7b49\u7ea7
		result = browserManager.getResult(request,"id,fullname","CRM_CreditInfo",pagenum);
	}else if(type.equals("contactWay")||type.equals("265")){//\u5ba2\u6237\u83b7\u5f97\u9014\u5f84
		result = browserManager.getResult(request,"id,fullname","CRM_ContactWay",pagenum);
	}else if(type.equals("sector")||type.equals("63")){//\u5ba2\u6237\u884c\u4e1a
		result = browserManager.getResult(request,"id,fullname","CRM_SectorInfo",pagenum);
	}else if(type.equals("agent")){//\u4e2d\u4ecb\u7ed3\u6784
		result = browserManager.getResult(request,"id,name","CRM_CustomerInfo", "( type in (3,4) )", pagenum);
	}else if(type.equals("customerContacter")||type.equals("67")){//\u5ba2\u6237\u8054\u7cfb\u4eba
		result = browserManager.getResult(request,"id,fullname","CRM_CustomerContacter",whereClause , pagenum);
	}else if(type.equals("sellchance")){//\u5ba2\u6237\u5546\u673a
		result = browserManager.getResult(request,"id,subject","crm_sellchance",pagenum);
	}else if(type.equals("wechatPlatform")){//\u5fae\u4fe1\u5e73\u53f0\u9009\u62e9
		result = browserManager.getResult(request,"id,name","wechat_platform"," isdelete=0 and state=0 " , pagenum);
	}else if(type.equals("reminderMode")){//\u63d0\u9192\u6a21\u5f0f
		result = browserManager.getResult(request,"t2.type,t2.typename","wechat_reminder_type t2 join wechat_reminder_mode t3 on t2.modekey=t3.modekey left JOIN wechat_reminder_set t1 on t2.type=t1.type"," id is null " , pagenum);
	}else if(type.equals("wechatHrm")){//\u5fae\u4fe1\u7ed1\u5b9a\u4eba\u5458
		String publicid = Util.null2String(request.getParameter("publicid"));
		if(!"".equals(publicid)){
			whereClause = " exists (select 1 from wechat_band where publicid='"+publicid+"' and openid is not null and usertype=1 and userid=t1.id ) ";
			result = browserManager.getResult(request, "t1.id,lastname,departmentname", "hrmresource t1 join hrmdepartment t2 on t1.departmentid = t2.id", whereClause, pagenum);
		}
	}else if(type.equals("smsHrm")){//\u6709\u624b\u673a\u53f7\u7801\u7684\u4eba\u5458
		//\u53ea\u663e\u793a\u6709\u624b\u673a\u53f7\u7801\u7684\u5728\u804c\u4eba\u5458
		if(rs.getDBType().equals("oracle")){
			whereClause=" mobile||'1'<>'1' and mobile is not null and (t1.status = 0 or t1.status = 1 or t1.status = 2 or t1.status = 3) ";
		}else{
			whereClause=" mobile<>'' and mobile is not null and (t1.status = 0 or t1.status = 1 or t1.status = 2 or t1.status = 3) ";	
		}
		result = browserManager.getResult(request, "t1.id,lastname", "hrmresource t1", whereClause, pagenum,"t1");
	}else if(type.equals("smsReminderMode")){//\u77ed\u4fe1\u63d0\u9192\u6a21\u5f0f
		result = browserManager.getResult(request,"t2.type,t2.typename","sms_reminder_type t2 join sms_reminder_mode t3 on t2.modekey=t3.modekey left JOIN sms_reminder_set t1 on t2.type=t1.type"," id is null " , pagenum);
	}else if(type.equals("dataSetBrowser")){//\u6570\u636e\u96c6
		result = browserManager.getResult(request,
				"a.id,a.dSetName",
				"fnaDataSet a",
				"", 
				pagenum);
	}else if(type.equals("fnaVoucherBrowser")){//XML\u6a21\u677f
		result = browserManager.getResult(request,
				"a.id,a.xmlName",
				"fnaVoucherXml a",
				"", 
				pagenum);
	}else if(type.equals("22") || type.equals("FnaBudgetfeeType")){//\u62a5\u9500\u8d39\u7528\u7c7b\u578b(\u79d1\u76ee)
		String bdf_wfid = Util.null2String(request.getParameter("bdf_wfid"));
		String bdf_fieldid = Util.null2String(request.getParameter("bdf_fieldid"));

		int isbill = 0;
		int formid = 0;
		if(Util.getIntValue(bdf_wfid) > 0){
			String sql = "select * from workflow_base where id = " + Util.getIntValue(bdf_wfid);
			rs.executeSql(sql);
			if(rs.next()){
				isbill = rs.getInt("isbill");
				formid = Math.abs(rs.getInt("formid"));
			}
		}
		
		Map<String, String> dataMap = new HashMap<String, String>();
		String fnaWfType = FnaCommon.getFnaWfFieldInfo4Expense(Util.getIntValue(bdf_wfid), dataMap);
		
		boolean isFnaFeeWfInfo = false;
		if(Util.getIntValue(bdf_wfid) > 0){
			String sql = "select count(*) cnt from fnaFeeWfInfo where workflowid = "+Util.getIntValue(bdf_wfid);
			rs2.executeSql(sql);
			isFnaFeeWfInfo = (rs2.next() && rs2.getInt("cnt") > 0);
		}
		int fromFnaRequest = Util.getIntValue(request.getParameter("fromFnaRequest"),0);
		if(fromFnaRequest == 1 && isFnaFeeWfInfo){
			boolean subjectFilter = false;
			String sql = "select * from FnaSystemSet";
			rs2.executeSql(sql);
			while(rs2.next()){
				subjectFilter = 1==Util.getIntValue(rs2.getString("subjectFilter"), 0);
			}
			
			if(subjectFilter){
				int orgType = Util.getIntValue(request.getParameter("orgType"),-1);
				int orgId = Util.getIntValue(request.getParameter("orgId"),-1);
				int orgType2 = Util.getIntValue(request.getParameter("orgType2"),-1);
				int orgId2 = Util.getIntValue(request.getParameter("orgId2"),-1);
				String orgClause = " ";
				
				if(orgType > 0 && orgId > 0){
					int sqlCondOrgType4ftRul = orgType;
					int sqlCondOrgId4ftRul = orgId;
					if(orgType==3){
						sqlCondOrgType4ftRul = 2;
						sqlCondOrgId4ftRul = Util.getIntValue(ResourceComInfo.getDepartmentID(orgId+""));
					}
					
					orgClause = " ( \n"+
							" not exists (select 1 from FnabudgetfeetypeRuleSet ftRul \n"+
							" 		where ftRul.type = "+sqlCondOrgType4ftRul+" and ftRul.mainid = a.id ) \n"+
							" or \n"+
							" exists (select 1 from FnabudgetfeetypeRuleSet ftRul \n"+
							" 		where ftRul.type = "+sqlCondOrgType4ftRul+" and ftRul.orgid = "+sqlCondOrgId4ftRul+" and ftRul.mainid = a.id ) \n"+
							" ) \n";
					
					if(orgType2 > 0 && orgId2 > 0){
						int sqlCondOrgType4ftRul2 = orgType2;
						int sqlCondOrgId4ftRul2 = orgId2;
						if(orgType2==3){
							sqlCondOrgType4ftRul2 = 2;
							sqlCondOrgId4ftRul2 = Util.getIntValue(ResourceComInfo.getDepartmentID(orgId2+""));
						}
						
						orgClause += " AND ( \n"+
								" not exists (select 1 from FnabudgetfeetypeRuleSet ftRul \n"+
								" 		where ftRul.type = "+sqlCondOrgType4ftRul2+" and ftRul.mainid = a.id ) \n"+
								" or \n"+
								" exists (select 1 from FnabudgetfeetypeRuleSet ftRul \n"+
								" 		where ftRul.type = "+sqlCondOrgType4ftRul2+" and ftRul.orgid = "+sqlCondOrgId4ftRul2+" and ftRul.mainid = a.id ) \n"+
								" ) \n";
					}
					
				}else{
					orgClause = " 1=1 ";
				}
				if(!"".equals(whereClause)){
					whereClause += " and ";
				}
				whereClause += orgClause;
			}
		}

		String plusChar = "+";
		if("oracle".equalsIgnoreCase(rs.getDBType())){
			plusChar = "||";
		}
		
		//\u8def\u5f84\u8bbe\u7f6e\u6d4f\u89c8\u6309\u94ae\u6570\u636e
		//\u79d1\u76ee\u8fc7\u6ee4
		if(Util.getIntValue(bdf_wfid) > 0 && Util.getIntValue(bdf_fieldid) > 0){
			String sql = " SELECT count(*) cnt \n" +
				" from FnaFeetypeWfbrowdef_dt1 t1 \n" +
				" join FnaFeetypeWfbrowdef t2 on t1.mainid = t2.id \n" +
				" where t2.fieldType = "+BudgetfeeTypeComInfo.FNAFEETYPE_FIELDTYPE+"\n" +
				" and t2.fieldId = "+Util.getIntValue(bdf_fieldid)+"\n" +
				" and t2.workflowid = "+Util.getIntValue(bdf_wfid)+" ";
			rs.executeSql(sql);
			if(rs.next() && rs.getInt("cnt") > 0){
				String wfFeetypeClause = " ( exists ( "+
						" SELECT 1 \n" +
						" from FnaFeetypeWfbrowdef_dt1 t1 \n" +
						" join FnaFeetypeWfbrowdef t2 on t1.mainid = t2.id \n" +
						" join FnaBudgetfeeType t3 on t1.refid = t3.id \n" +
						" where a.allSupSubjectIds like (t3.allSupSubjectIds"+plusChar+"'%') \n"+
						" and t2.fieldType = "+BudgetfeeTypeComInfo.FNAFEETYPE_FIELDTYPE+"\n" +
						" and t2.fieldId = "+Util.getIntValue(bdf_fieldid)+"\n" +
						" and t2.workflowid = "+Util.getIntValue(bdf_wfid)+"\n"+
						" ) ) ";
				if(!"".equals(whereClause)){
					whereClause += " and ";
				}
				whereClause += wfFeetypeClause;
			}
		}
		
		if(!"".equals(whereClause)){
			whereClause += " and ";
		}
		
		whereClause += " (a.Archive is null or a.Archive = 0) and a.isEditFeeTypeId > 0 ";
		
        //\u5982\u679c\u662f\u3010\u9884\u7b97\u53d8\u66f4\u6d41\u7a0b\u3011\u6216\u8005\u662f\u7cfb\u7edf\u8868\u5355\u3010\u9884\u7b97\u53d8\u66f4\u7533\u8bf7\u5355\u3011\u7684\u6d41\u7a0b\uff0c\u90a3\u4e48\u79d1\u76ee\u53ea\u6709\u53ef\u7f16\u5236\u9884\u7b97\u662f\u53ef\u4ee5\u9009\u62e9\u7684
        if("change".equals(fnaWfType) || (isbill == 1 && formid==159)){
        	whereClause += " and a.isEditFeeType = 1 ";
        }

		result = browserManager.getResult(request,
				"a.id, a.name, ' ' name1 ",
				"FnaBudgetfeeType a",
				whereClause, pagenum);
		//\u5224\u65ad\u662f\u5426\u663e\u793a\u79d1\u76ee\u5168\u8def\u5f84
		String sqlSet = "select enableDispalyAll,separator from FnaSystemSet";
		rs.executeSql(sqlSet);
		int enableDispalyAll=0;
		String separator ="";
		while(rs.next()){
			enableDispalyAll = rs.getInt("enableDispalyAll");
			separator = Util.null2String(rs.getString("separator"));
		}
		if(enableDispalyAll==1){//\u9700\u663e\u793a\u4e09\u7ea7\u79d1\u76ee
			JSONArray json = new JSONArray().fromObject(result);
			for(int i=0;i<json.size();i++){
				String id = json.getJSONObject(i).getString("id");
				String name = json.getJSONObject(i).getString("name");
				String fullName = BudgetfeeTypeComInfo.getSubjectFullName(id, separator);;
				json.getJSONObject(i).put("name", fullName);
			}
			result = json.toString();
		}
	}else if(type.equals("FnaBudgetfeeTypeMulti")){//\u591a\u62a5\u9500\u8d39\u7528\u7c7b\u578b(\u591a\u79d1\u76ee) url:/fna/browser/FnaBudgetfeeTypeBrowserMulti.jsp
		if(!"".equals(whereClause)){
			whereClause += " and ";
		}
		whereClause += " and (a.Archive is null or a.Archive = 0) and a.isEditFeeTypeId > 0 ";
		result = browserManager.getResult(request,
				"id, name",
				"FnaBudgetfeeType a",
				whereClause, pagenum);
	}else if(type.equals("FnaBudgetfeeTypeMultiByGroupCtrl")){//\u591a\u62a5\u9500\u8d39\u7528\u7c7b\u578b(\u591a\u79d1\u76ee) \u53ea\u67e5\u8be2\u8fdb\u884c\u8d39\u63a7\u7684\u79d1\u76ee url:/fna/browser/feeTypeByGroupCtrl/FnaBudgetfeeTypeByGroupCtrlBrowserMulti.jsp
		if(!"".equals(whereClause)){
			whereClause += " and ";
		}
		whereClause += " (a.Archive is null or a.Archive = 0) and a.id = a.groupCtrlId ";

		int feeperiod=Util.getIntValue(request.getParameter("feeperiod"), 0);
		if(feeperiod>0){
			whereClause += " and a.feeperiod = "+feeperiod+" ";
		}
		
		
		
		result = browserManager.getResult(request,
				"id, name",
				"FnaBudgetfeeType a",
				whereClause, pagenum);
	}else if(type.equals("FnaBudgetfeeTypeMultiByGroupCtrl")){//\u591a\u62a5\u9500\u8d39\u7528\u7c7b\u578b(\u591a\u79d1\u76ee) \u53ea\u67e5\u8be2\u8fdb\u884c\u8d39\u63a7\u7684\u79d1\u76ee url:/fna/browser/feeTypeByGroupCtrl/FnaBudgetfeeTypeByGroupCtrlBrowserMulti.jsp
		if(!"".equals(whereClause)){
			whereClause += " and ";
		}
		whereClause += " (a.Archive is null or a.Archive = 0) and a.id = a.groupCtrlId ";

		int feeperiod=Util.getIntValue(request.getParameter("feeperiod"), 0);
		if(feeperiod>0){
			whereClause += " and a.feeperiod = "+feeperiod+" ";
		}
		
		
		
		result = browserManager.getResult(request,
				"id, name",
				"FnaBudgetfeeType a",
				whereClause, pagenum);
	}else if(type.equals("FnaFeetypeWfBtnSetting")){//\u8def\u5f84\u8bbe\u7f6e-\u9ad8\u7ea7\u8bbe\u7f6e-\u6d4f\u89c8\u6570\u636e\u5b9a\u4e49-\u79d1\u76ee
		//\u5728\u540e\u53f0\u8def\u5f84\u8bbe\u7f6e\u7684\u5730\u65b9\u53ef\u4ee5\u9009\u62e9\u4e00\u7ea7\u3001\u4e8c\u7ea7\u79d1\u76ee\u3001\u4e09\u7ea7\u79d1\u76ee
		
		result = browserManager.getResult(request,
				"id, name",
				"FnaBudgetfeeType a",
				whereClause, pagenum);
	}else if(type.equals("FnaWfSetMulti")){//\u591a\u8d39\u63a7\u6d41\u7a0b\u9009\u62e9  url:/fna/browser/fnaWfSet/FnaWfSetBrowserMulti.jsp
		result = browserManager.getResult(request,
				"a.id, b.workflowname",
				"fnaFeeWfInfo a join workflow_base b on a.workflowid = b.id",
				"" , pagenum);
	}else if(type.equals("FnaControlSchemeSetMulti")){//\u591a\u8d39\u63a7\u65b9\u6848\u9009\u62e9  url:/fna/browser/fnaControlSchemeSet/FnaControlSchemeSetMulti.jsp
		result = browserManager.getResult(request,
				"id, name",
				"fnaControlScheme",
				"" , pagenum);
	}else if("FnaCostCenter".equals(type) || type.equals("251")){//\u9884\u7b97\u6210\u672c\u4e2d\u5fc3
		if(!"".equals(whereClause)){
			whereClause += " and ";
		}
		whereClause += " "+FnaCostCenter.getDbUserName()+"getFccArchive1(id) = 0 and type = 1 ";
		
		String bdf_wfid = Util.null2String(request.getParameter("bdf_wfid"));
		String bdf_fieldid = Util.null2String(request.getParameter("bdf_fieldid"));
		
		List fccArray = FnaCommon.getWfBrowdefList(bdf_wfid, bdf_fieldid, "251");
		Set fccArray0 = new HashSet();
		Set fccArray1 = new HashSet();
		try{
			if(fccArray!=null && fccArray.size()>0){
				FnaCostCenter.getAllSubCostcenterType(fccArray, fccArray0, fccArray1);
			}
		}catch(Exception e){
			new BaseBean().writeLog(e);
		}
		String supClause = "";
		if(fccArray0!=null && fccArray0.size()>0){
			String ids = "";
			for(Object obj : fccArray0){
				ids += ","+(String)obj;
			}
			if(!ids.equals("")){
				ids = ids.substring(1);
			}
			supClause = " a.supFccId in ("+ids+") ";
			
		}
		String subClause = "";
		if(fccArray1!=null && fccArray1.size()>0){
			String ids = "";
			for(Object obj : fccArray1){
				ids += ","+(String)obj;
			}
			if(!ids.equals("")){
				ids = ids.substring(1);
			}
			subClause = " a.id in ("+ids+") ";
			
		}
		String clause = "";
		if(!supClause.equals("") || !subClause.equals("")){
			if(!"".equals(whereClause)){
				whereClause += " and ";
			}
			whereClause += " ( "+supClause+" or "+subClause+" ) ";
		}
		
		result = browserManager.getResult(request,
				"id, name",
				"FnaCostCenter a",
				whereClause, pagenum);
	}else if("FnaCostCenterType".equals(type)){
		String selectedid=Util.null2String(request.getParameter("selectedid"));
		String fcctype=Util.null2String(request.getParameter("fcctype"));
		if(!"".equals(whereClause)){
			whereClause += " and ";
		}
		whereClause += " "+FnaCostCenter.getDbUserName()+"getFccArchive1(id) = 0 and type = 0 ";
		
		if("0".equals(fcctype) && !"".equals(selectedid)){
			whereClause += " and a.id not in ("+selectedid+")";
		}
		
		result = browserManager.getResult(request,
				"id, name",
				"FnaCostCenter a",
				whereClause, pagenum);
	}else if(type.equals("FnaFccWfBtnSetting")){//\u8def\u5f84\u8bbe\u7f6e-\u9ad8\u7ea7\u8bbe\u7f6e-\u6d4f\u89c8\u6570\u636e\u5b9a\u4e49-\u6210\u672c\u4e2d\u5fc3
		
		result = browserManager.getResult(request,
				"id, name",
				"FnaCostCenter a",
				whereClause, pagenum);
	}else if(type.equals("HpinfoMutiBrowser")){//\u591a\u95e8\u6237  url:/portal/HpinfoMutiBrowser.jsp
		result = browserManager.getResult(request,
				"id, infoname",
				"hpinfo",
				"" , pagenum);
	}else if(type.equals("CoworkTypesMutiBrowser")){//\u591a\u534f\u4f5c\u533a  url:/cowork/type/CoworkTypesMutiBrowser.jsp
		result = browserManager.getResult(request,
				"id, typename",
				"cowork_types",
				"" , pagenum);
    } else if (type.equals("currentnodeBrowser")){
		result = browserManager.getResult(request,
				"id, nodename",
				"workflow_nodebase",
				whereClause , pagenum);
	}
	else if ("".equals(type) || (!"".equals(type) && ( type.equals("1") || type.equals("17")))
			|| "165".equals(type) || "166".equals(type) || "160".equals(type) ){
		String virtualtype = Util.null2String(request.getParameter("virtualtype"));
		//\u4eba\u529b\u8d44\u6e90 165 \u5206\u6743\u5355\u4eba\u529b 166 \u5206\u6743\u591a\u4eba\u529b
		if(whereClause.equals("")){
			whereClause = "t1.departmentid = t2.id";
		}else{
			whereClause += " and t1.departmentid = t2.id";
		}
		if(Util.getIntValue(virtualtype)<-1){
			whereClause += " and t1.virtualtype = "+virtualtype;
		}
		
		if(whereClause.indexOf("status")!=-1){
			//\u5305\u542bstatus \u8bf4\u660e\u5916\u90e8\u5df2\u63a7\u5236\u72b6\u6001
		}else{
			//\u53ea\u663e\u793a\u5728\u804c\u4eba\u5458
			if(whereClause.equals("")){
				whereClause+=" (t1.status = 0 or t1.status = 1 or t1.status = 2 or t1.status = 3) ";
			}else{
				whereClause+=" and (t1.status = 0 or t1.status = 1 or t1.status = 2 or t1.status = 3) ";
			}
		}
		
		/***********\u6d41\u7a0b\u6d4f\u89c8\u6570\u636e\u5b9a\u4e49\u529f\u80fd begin**************/
		String bdf_wfid = Util.null2String(request.getParameter("bdf_wfid"));
		String bdf_fieldid = Util.null2String(request.getParameter("bdf_fieldid"));
		String bdf_viewtype = Util.null2String(request.getParameter("bdf_viewtype"));
		List<ConditionField> lsConditionField = null;
		if(bdf_wfid.length()>0){
			lsConditionField = ConditionField.readAll(Util.getIntValue(bdf_wfid),Util.getIntValue(bdf_fieldid),Util.getIntValue(bdf_viewtype));
		}
		
		if(lsConditionField!=null&&lsConditionField.size()>0){
		for(ConditionField conditionField : lsConditionField ){
			String filedname = conditionField.getFieldName();
			String valuetype = conditionField.getValueType();
			boolean isReadonly = conditionField.isReadonly();
			boolean isHide=conditionField.isHide();
			if(!isReadonly && !isHide)continue;
			
			boolean isGetValueFromFormField = conditionField.isGetValueFromFormField();
			String filedvalue = "";
			if(isGetValueFromFormField){
				//\u8868\u5355\u5b57\u6bb5 bdf_fieldname
				filedvalue = Util.null2String(request.getParameter("bdf_"+filedname));
				if(filedvalue.length()>0){
					if(filedname.equals("subcompanyid")){
						filedvalue = conditionField.getSubcompanyIds(filedvalue);
					}else if(filedname.equals("departmentid")){
						filedvalue = conditionField.getDepartmentIds(filedvalue);
					}
				}
			}else{
				if(valuetype.equals("1")){
					//\u5f53\u524d\u64cd\u4f5c\u8005\u6240\u5c5e
					if(filedname.equals("subcompanyid")){
						filedvalue = ""+ResourceComInfo.getSubCompanyID(""+user.getUID());
					}else if(filedname.equals("departmentid")){
						filedvalue = ""+ResourceComInfo.getDepartmentID(""+user.getUID());
					}
				}else{
					//\u6307\u5b9a\u5b57\u6bb5
					filedvalue = conditionField.getValue();
				}
			}
			
			if(Util.null2String(filedvalue).length()>0){
				if(filedname.equals("lastname")){
				 	whereClause += " and t1.lastname = '"+filedvalue+"' ";
				}else if(filedname.equals("status")){
					if(filedvalue.equals("8") || filedvalue.equals("")){
						whereClause += " and t1.status in ( 0,1,2,3 )";
					}
				}else if(filedname.equals("subcompanyid")){
					whereClause += " and t1.subcompanyid1 in ("+filedvalue+")";
				}else if(filedname.equals("departmentid")){
					whereClause += " and t1.departmentid in ("+filedvalue+") ";
				}else if(filedname.equals("jobtitle")){
					whereClause += " and t1.jobtitle = '"+filedvalue+"' ";
				}else if(filedname.equals("roleid")){
					whereClause += " and t1.ID in (select hrmrolemembers.ResourceID from hrmrolemembers ,hrmroles where hrmrolemembers.roleid = hrmroles.ID and hrmroles.ID="+filedvalue+" ) " ;
				}
			}
		}
		}
		/***********\u6d41\u7a0b\u6d4f\u89c8\u6570\u636e\u5b9a\u4e49\u529f\u80fd end **************/
		if(type.equals("165") || type.equals("166")){
	    int beagenter = Util.getIntValue((String)session.getAttribute("beagenter_"+user.getUID()));
	    if(beagenter <= 0){
	    	beagenter = user.getUID();
	    }
	    int fieldid=Util.getIntValue(request.getParameter("fieldid"));
	    int isdetail=Util.getIntValue(request.getParameter("isdetail"));
	    int isbill=Util.getIntValue(request.getParameter("isbill"),1);
	    if(fieldid!=-1){
		    CheckSubCompanyRight.setDetachable(1);
		  	CheckSubCompanyRight.setIsbill(isbill);
		  	CheckSubCompanyRight.setFieldid(fieldid);
		  	CheckSubCompanyRight.setIsdetail(isdetail);
		    boolean onlyselfdept=CheckSubCompanyRight.getDecentralizationAttr(beagenter,"Resources:decentralization",fieldid,isdetail,isbill);
		    boolean isall=CheckSubCompanyRight.getIsall();
		    String departments=Util.null2String(CheckSubCompanyRight.getDepartmentids());
		    String subcompanyids=Util.null2String(CheckSubCompanyRight.getSubcompanyids());
		    if(!isall){
		        if(onlyselfdept){
		        		if(departments.length()>0&&!departments.equals("0")){
		        			whereClause+=" and t1.departmentid in("+departments+")";
		        		}
		        }else{
		        		if(subcompanyids.length()>0&&!subcompanyids.equals("0")){
		        			whereClause+=" and t1.subcompanyid1 in("+subcompanyids+")";
		        		}
		        }
		    }
	    }
		}else if(type.equals("160")){
			String roleids = Util.null2String(request.getParameter("roleid"));
			ArrayList resourcrole = Util.TokenizerString(roleids,"_");
			String roleid="0";
			int uid = user.getUID();
			if (resourcrole.size()>0) roleid=""+resourcrole.get(0);
			int index = roleid.indexOf("a");
			int rolelevel = 0;
			if(index > -1){
				int roledid_tmp = Util.getIntValue(roleid.substring(0, index), 0);
				String rolelevelStr = roleid.substring(index+1);
				
				roleid = ""+roledid_tmp;
				index = rolelevelStr.indexOf("b");
				if(index > -1){
					rolelevel = Util.getIntValue(rolelevelStr.substring(0, index), 0);
					uid = Util.getIntValue(rolelevelStr.substring(index+1), 0);
					if(uid <= 0){
						uid = user.getUID();
					}
				}else{
					rolelevel= Util.getIntValue(rolelevelStr);
				}
			}

			if(roleid.length()==0){
				whereClause+=" and 1=2 ";
			}else{
				whereClause+=" and t1.ID in (select ResourceID from hrmrolemembers a,hrmroles b where a.roleid = b.ID and b.ID="+roleid+")";
			}
			
			if(rolelevel != 0){
				if(rolelevel == 1){
					int subcomid = Util.getIntValue(ResourceComInfo.getSubCompanyID(""+uid), 0);
					whereClause += " and t1.subcompanyid1="+subcomid+" ";
				}else if(rolelevel == 2){
					int subcomid = Util.getIntValue(ResourceComInfo.getSubCompanyID(""+uid), 0);
					int supsubcomid = Util.getIntValue(SubCompanyComInfo.getSupsubcomid(""+subcomid), 0);
					whereClause += " and t1.subcompanyid1="+supsubcomid+" ";
				}else if(rolelevel == 3){
					int departid = Util.getIntValue(ResourceComInfo.getDepartmentID(""+uid), 0);
					whereClause += " and t1.departmentid="+departid+" ";
				}
			}
		}
		//Added by wcd 2014-11-28 \u589e\u52a0\u5206\u6743\u63a7\u5236 start
		String tempSql = appDetachComInfo.getScopeSqlByHrmResourceSearch(String.valueOf(user.getUID()), true, "resource_t1");
		whereClause += (tempSql==null||tempSql.length()==0) ? "" : (" and "+tempSql);
		//Added by wcd 2014-11-28 \u589e\u52a0\u5206\u6743\u63a7\u5236 end
		browserManager.setOrderKey("t1.dsporder");
		browserManager.setOrderWay("asc");
		if(Util.getIntValue(virtualtype)<-1){
			result = browserManager.getResult(request, "t1.id,lastname,departmentname", "HrmResourcevirtualview t1,hrmdepartmentvirtual t2", whereClause, pagenum,"t1");
		}else{
			result = browserManager.getResult(request, "t1.id,lastname,departmentname", "hrmresource t1,hrmdepartment t2", whereClause, pagenum,"t1");
		}
    } else if (type.equals("MutiJobTitlesTemplet")){
		result = browserManager.getResult(request,"c.id,c.jobtitlename, b.jobactivityname ", " HrmJobGroups a, HrmJobActivities b, HrmJobTitlesTemplet c ",pagenum);
    } else if (type.equals("sysadmin")){
		result = browserManager.getResult(request,"id,lastname", "hrmresourcemanager",pagenum);
    } else if (type.equals("multisysadmin")){
		String sqlwhere = "";
		if(!manageDetachComInfo.isUseWfManageDetach()) //\u5982\u679c\u7cfb\u7edf\u672a\u542f\u7528\u7ba1\u7406\u5206\u6743\uff0c\u5219\u7ba1\u7406\u5458\u6d4f\u89c8\u6846\u4e2d\u4e0d\u51fa\u73b0\u5206\u6743\u7ba1\u7406\u5458\uff0c\u53ea\u6709\u7cfb\u7edf\u7ba1\u7406\u5458
			sqlwhere = " id = 1";
		result = browserManager.getResult(request,"id,lastname", "hrmresourcemanager",sqlwhere,pagenum,"");
	} else if ("matrix".equals(type)) {
		result = browserManager.getResult(request, "id,name", "MatrixInfo", pagenum);
	} else if ("matrixfield".equals(type)) {
		String matrixid = Util.null2String(request.getParameter("matrixid"));
		String fieldtype = Util.null2String(request.getParameter("fieldtype"));
		if ("".equals(whereClause)) {
			whereClause = "m.matrixid='"+matrixid+"'";
		} else {
			whereClause += " AND m.matrixid='"+matrixid+"'";
		}
		whereClause += " AND m.fieldtype='"+fieldtype+"'";
		result = browserManager.getResult(request, "m.id,m.displayname", "MatrixFieldInfo m", whereClause, pagenum);
	}else if("requestbrowserright".equals(type)){//\u901a\u8fc7\u6d41\u7a0bid\u5f97\u5230\u6240\u6709\u8bf7\u6c42
		String wfid = Util.null2String(request.getParameter("wfid"));
		whereClause += " wr.workflowid = '"+wfid+"'";
		result = browserManager.getResult(request, "wr.requestid,wr.requestname", "workflow_requestbase wr", whereClause, pagenum);
	}else if("reportform".equals(type)){//\u901a\u8fc7\u8868\u5355formid\u5f97\u5230\u6240\u6709\u6d41\u7a0b
		String formid = Util.null2String(request.getParameter("formid"));
		String isbill = Util.null2String(request.getParameter("isbill"));
		whereClause += " wb.formid = '"+formid+"'";
		whereClause += " and wb.isvalid = '1' ";
		whereClause += " and wb.isbill = '"+isbill+"'";
		int detachable=Util.getIntValue(String.valueOf(session.getAttribute("detachable")),0);
		if(detachable == 1){
		    String hasRightSubcompanyids=SubCompanyComInfo.getRightSubCompany(user.getUID(),"WorkflowManage:All",-1);
		    if(!"".equals(hasRightSubcompanyids)){
		        whereClause += " and wb.subcompanyid in ("+hasRightSubcompanyids+") ";
		    }
		}
		result = browserManager.getResult(request, " wb.id,wb.workflowname ", " workflow_base wb ", whereClause, pagenum);
	}else if("hrmOrgGroup".equals(type)){//\u7fa4\u7ec4
		whereClause += " (isDelete is null or isDelete='0')";
		result = browserManager.getResult(request, "id,orgGroupName", "HrmOrgGroup", whereClause, pagenum);
	} else if ("adaccount".equals(type)) {
		String nameKey = Util.null2String(request.getParameter("q"));
		LdapUtil ldap = LdapUtil.getInstance();
	 	result = ldap.getAccoutsJson(nameKey);
	}else if("HrmRoleRight".equals(type)){//\u6743\u9650\u540d\u79f0
		whereClause += " a.id = b.id AND languageid = "+user.getLanguage();
		browserManager.setOrderKey("b.rightdesc");
		result = browserManager.getResult(request, "a.id,b.rightname", "SystemRights a, SystemRightsLanguage b", whereClause, pagenum);
	}else if("268".equals(type)){//\u661f\u671f\u591a\u9009
		result = new MeetingBrowser().getResultWeek(request,user);
	}else if("269".equals(type)){//\u63d0\u9192\u591a\u9009
		result = new MeetingBrowser().getResultRemind(request,user);
	}else if("270".equals(type)){//\u670d\u52a1\u9879\u76ee\u591a\u9009
		result = browserManager.getResult(request, "id,itemname", "meeting_service_item", whereClause, pagenum);
	}else if(type.equals("Hrm_WorkflowBill")) {//\u6d41\u7a0b\u8868\u5355
		String wfid = Util.null2String(request.getParameter("wfid"));
		String onlystateform = Util.null2String(request.getParameter("onlystateform"), "false");
		String fWhere = "";
		if(onlystateform.equals("true")) {
			fWhere = " t.id in (select field002 from hrm_state_proc_set group by field002)";
		}
		if(wfid.length() != 0) {
			fWhere += (fWhere.length() > 0 ? " and " : "") + " exists (select 1 from workflow_base t3 where t3.formid = t.id and t3.id = "+wfid+")";
		}
		result = browserManager.getResult(request, "t.id, t2.labelname", "workflow_bill t left join HtmlLabelInfo t2 on t.namelabel = t2.indexid and languageid = "+user.getLanguage(), fWhere, pagenum);
	}else if(type.equals("Hrm_HrmLeaveTypeColor")) {
		String fields = "field00"+(user.getLanguage() <= 9 && user.getLanguage() >= 7 ? user.getLanguage() : 1);
		String conSql = rs.getDBType().equals("oracle") ? ("t."+fields+" is null") : ("t."+fields+" is null or t."+fields+" = ''");
		result = browserManager.getResult(request, "t.id, t.field001", "(select t.field004 as id, (case when ("+conSql+") then t.field001 else t."+fields+" end) field001 from hrmLeaveTypeColor t where t.field002 = 1) t", pagenum);
	}else if(type.equals("Hrm_HrmContract") || type.equals("279")) {
		result = browserManager.getResult(request, "t.id, t.contractname", "HrmContract t", pagenum);
	}else if("pubChoice".equals(type)){//\u516c\u5171\u9009\u62e9\u6846
		result = new weaver.workflow.selectItem.SelectItemPubBrowser().getResult(request,user);
	} else if(type.equals("Hrm_HrmScheduleShiftsSet")) {
		result = browserManager.getResult(request, "t2.id, t.field001", "hrm_schedule_shifts_set t left join hrm_schedule_shifts_set_id t2 on t.id = t2.field001", "t.delflag = 0", pagenum);
	}else if(type.equals("HrmAwardType")){//\u5956\u60e9\u79cd\u7c7b
		result = browserManager.getResult(request,"id,name","HrmAwardType",pagenum);
	}else if(type.equals("hrmgroup")){
		browserManager.setOrderKey("type,sn ");
		browserManager.setOrderWay("asc");
		result = browserManager.getResult(request, "id,name,(CASE WHEN type = 1 THEN '\u516c\u5171\u7ec4' ELSE '\u79c1\u4eba\u7ec4' END) ", "hrmgroup", whereClause, pagenum);
	}else if(type.equals("HrmSeal")){//\u7535\u5b50\u7b7e\u7ae0
		result = browserManager.getResult(request,"id,enterpriseName","esignaturedetail",whereClause,pagenum);
	
	} else if("odoc_font".equalsIgnoreCase(type)) {
        String fontName = Util.null2String(request.getParameter("q"));
        result = FormSignatureConfigUtil.queryFontInfo(fontName);
	}
	
	//System.out.println("====data.jsp===\u7ed3\u679c\uff1a"+result);
	out.print(result);

      out.write(_jsp_string1, 0, _jsp_string1.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("data.jsp"), -2337833324661066968L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string0;
  private final static char []_jsp_string1;
  static {
    _jsp_string0 = "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string1 = "\r\n".toCharArray();
  }
}
