/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._homepage._maint;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import java.util.*;
import weaver.hrm.*;
import weaver.systeminfo.*;
import weaver.general.StaticObj;
import weaver.general.Util;
import weaver.hrm.settings.RemindSettings;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import weaver.page.menu.*;
import net.sf.json.JSONObject;
import weaver.conn.RecordSet;

public class _loginpageoperation__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      
	User user = HrmUserVarify.getUser (request , response) ;
	if(user == null)  return ;
	Log logger= LogFactory.getLog(this.getClass());
	String isIE = (String)session.getAttribute("browser_isie");

      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet rs;
      rs = (weaver.conn.RecordSet) pageContext.getAttribute("rs");
      if (rs == null) {
        rs = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs", rs);
      }
      out.write(_jsp_string2, 0, _jsp_string2.length);
      weaver.page.menu.MenuCenterCominfo MenuCenterCominfo;
      MenuCenterCominfo = (weaver.page.menu.MenuCenterCominfo) pageContext.getAttribute("MenuCenterCominfo");
      if (MenuCenterCominfo == null) {
        MenuCenterCominfo = new weaver.page.menu.MenuCenterCominfo();
        pageContext.setAttribute("MenuCenterCominfo", MenuCenterCominfo);
      }
      out.write(_jsp_string2, 0, _jsp_string2.length);
      weaver.page.maint.MenuUtil menuUtil;
      menuUtil = (weaver.page.maint.MenuUtil) pageContext.getAttribute("menuUtil");
      if (menuUtil == null) {
        menuUtil = new weaver.page.maint.MenuUtil();
        pageContext.setAttribute("menuUtil", menuUtil);
      }
      out.write(_jsp_string2, 0, _jsp_string2.length);
      
	String id = Util.null2String(request.getParameter("id"));
	String menuId = Util.null2String(request.getParameter("menuId"));
	String parentid=Util.null2String(request.getParameter("parentid"));
	String menu_type=Util.null2String(request.getParameter("menu_type"));
	StringBuffer sb = new StringBuffer();
	MenuH menuh = null;
	if("weavertabs-left".equals(id))
	{
		menuh = MenuHFactory.creatorMenuH("left");
		sb.append(menuh.getMenuStr("left", user));
	}else if("weavertabs-cus".equals(id)){
	    StringBuffer treeStr = new StringBuffer();
        treeStr.append("[");
        String sqlWhere = "";
        if(parentid.equals("0")){
            sqlWhere=" where menuparentid=0 ";
        }else if(!parentid.equals("0")&&!menu_type.equals("")){
            sqlWhere=" where menuparentid="+parentid+" and menutype="+menu_type; 
        }
        String sql = "select *  from menucustom "+sqlWhere;
         rs.executeSql(sql);
         while (rs.next()) {
             if(!menuUtil.hasShareRight(user, rs.getString("sharetype"), rs.getString("sharevalue"),rs.getInt("id"),menu_type)){
                 continue;
             }
             JSONObject json = new JSONObject ();
             String menu_id = rs.getString("id");
             String menuname = rs.getString("menuname");
             String menuhref = rs.getString("menuhref");
             String menuparentid=rs.getString("menuparentid");
             String menutype=rs.getString("menutype");
             json.put("id",menu_id);
             int count=0;
             RecordSet rst=new RecordSet();
             String sqlCount="select count(*) as count  from menucustom where menuparentid="+menu_id+" and menutype="+menutype; 
             rst.executeSql(sqlCount);
             while(rst.next()){
                 count=Integer.valueOf(rst.getString("count"));
             }
             json.put("isParent",count>0); 
             json.put("name",menuname);
             json.put("linkAddress",menuhref);
             json.put("parentId",menuparentid);
             json.put("menu_type",menutype);
             treeStr.append(json.toString());
             treeStr.append(",");
         }
         if(treeStr.length()==1){
             out.print("[]");
         }else{
             out.print(treeStr.toString().substring(0,treeStr.toString().length()-1)+"]");
         }
	}
	else if("weavertabs-cus-old".equals(id))
	{
		sb.append("<ul>");
		MenuCenterCominfo.setTofirstRow();		
		
		while(MenuCenterCominfo.next())
		{
			
			String pid = MenuCenterCominfo.getId();
			String menuname = MenuCenterCominfo.getMenuname();
			String mmenutype = MenuCenterCominfo.getMenutype();
			if("sys".equals(mmenutype))
			{
				continue;
			}
			if(pid.equals(menuId))
			{
				continue;
			}
			sb.append("<li style=\"list-style-type: none;\"><a style=\"text-decoration: none;\" href=\"javascript:void(null);\" onclick=\"openNextUl(this);\">"+menuname+"</a>");
		
			menuh = MenuHFactory.creatorMenuH(pid);
			sb.append(menuh.getMenuStr(pid, user));
		
			sb.append("</li>");
		}
		sb.append("</ul>");
	}
	else if("weavertabs-top".equals(id))
	{
		menuh = MenuHFactory.creatorMenuH("top");
		sb.append(menuh.getMenuStr("top", user));
	}
	else if("weavertabs-hpmenus".equals(id))
	{
		menuh = MenuHFactory.creatorMenuH("hp");
		sb.append(menuh.getMenuStr("hp", user));
	}
	else if("weavertabs-hp".equals(id)){
	    StringBuffer treeStr = new StringBuffer();
        treeStr.append("[");
        String sqlWhere = "";
         if ("sqlserver".equals(rs.getDBType()))
         {
             if (user.getUID()==1)
             {  //sysadmin
                 sqlWhere = " where  (creatortype=4  or creatortype=3  ) and  infoname != ''";
             } else 
             {
                 sqlWhere = " where   (creatortype=3) and  infoname != ''";
             }
         } 
         else 
         {
             if (user.getUID()==1)
             {  //sysadmin
                 sqlWhere = " where  (creatortype=4  or creatortype=3) and  infoname is not null";
             } 
             else 
             {
                 sqlWhere = " where   (creatortype=3) and  infoname is not null";
             }
         }
         sqlWhere+=" and pid="+parentid;
         String sql = "select *  from hpinfo "+sqlWhere;
         rs.executeSql(sql);
         while (rs.next()) {
             JSONObject json = new JSONObject ();
             String hpid = rs.getString("id");
             String subCompanyId = rs.getString("subcompanyid");
             String infoname = rs.getString("infoname");
             String pid=rs.getString("pid");
             String linkAddress="/homepage/Homepage.jsp?hpid="+hpid+"&subCompanyId="+subCompanyId;
             json.put("id",hpid);
             int count=0;
             RecordSet rst=new RecordSet();
             String sqlCount="select count(*) as count  from hpinfo where pid="+hpid; 
             rst.executeSql(sqlCount);
             while(rst.next()){
                 count=Integer.valueOf(rst.getString("count"));
             }
             json.put("isParent",count>0); 
             json.put("name",infoname);
             json.put("linkAddress",linkAddress);
             json.put("parentid",pid);
             treeStr.append(json.toString());
             treeStr.append(",");
         }
         if(treeStr.length()==1){
             out.print("[]");
         }else{
             out.print(treeStr.toString().substring(0,treeStr.toString().length()-1)+"]");
         }
	}
	else if("weavertabs-hp-old".equals(id))
	{
		sb.append("<ul>");
		String sqlWhere = "";
		if ("sqlserver".equals(rs.getDBType()))
		{
			if (user.getUID()==1)
			{  //sysadmin
				sqlWhere = " where  (creatortype=4  or creatortype=3  ) and  infoname != ''";
			} else 
			{
				sqlWhere = " where   (creatortype=3) and  infoname != ''";
			}
		} 
		else 
		{
			if (user.getUID()==1)
			{  //sysadmin
				sqlWhere = " where  (creatortype=4  or creatortype=3) and  infoname is not null";
			} 
			else 
			{
				sqlWhere = " where   (creatortype=3) and  infoname is not null";
			}
		}
		String sql = "select *  from hpinfo "+sqlWhere;
		rs.executeSql(sql);
		while(rs.next())
		{
			String hpid = rs.getString("id");
			String subCompanyId = rs.getString("subcompanyid");
			String infoname = rs.getString("infoname");
			String htmlli = "<li><a href='/homepage/Homepage.jsp?hpid="+hpid+"&subCompanyId="+subCompanyId+"' class='main'>"+infoname+"</a>\n";
			sb.append(htmlli);
		}
		sb.append("</ul>");
	}
	else if("weavertabs-sys".equals(id))
	{
		sb.append("test");
	}
	out.println(sb.toString());

    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("homepage/maint/LoginPageOperation.jsp"), 4615785590766345107L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("page/maint/common/init.jsp"), -6701264299254985277L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string1;
  private final static char []_jsp_string2;
  private final static char []_jsp_string0;
  static {
    _jsp_string1 = "\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string2 = "\r\n".toCharArray();
    _jsp_string0 = "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
  }
}
