/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._workplan._calendar._data;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import java.util.List;
import weaver.Constants;
import weaver.general.Util;
import weaver.general.TimeUtil;
import weaver.conn.RecordSet;
import weaver.hrm.User;
import weaver.domain.workplan.WorkPlan;
import weaver.systeminfo.SystemEnv;
import java.text.*;
import java.util.*;
import weaver.WorkPlan.WorkPlanShareUtil;
import java.net.URLDecoder;
import net.sf.json.JSONObject;
import net.sf.json.JSONArray;

public class _workplanviewoperation__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;

  
  // \u6839\u636e\u65e5\u671f\u53d6\u661f\u671f\uff08TD20444\uff09
  public String getWeekByDate(String date){
  	String week=""; 
  	DateFormat format1 = new SimpleDateFormat("yyyy-MM-dd"); 
  	   Date d=null;
  	  try {
  	   d = format1.parse(date);
  	  } catch (Exception e) {
  	   e.printStackTrace();
  	  }
  	   Calendar   c   =   Calendar.getInstance();   
  	   c.setTime(d);
  	   week = c.getTime().toString().substring(0,3).toLowerCase();
  	   return week;    	
  }

  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      weaver.conn.RecordSet rs;
      rs = (weaver.conn.RecordSet) pageContext.getAttribute("rs");
      if (rs == null) {
        rs = new weaver.conn.RecordSet();
        pageContext.setAttribute("rs", rs);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet rsc;
      rsc = (weaver.conn.RecordSet) pageContext.getAttribute("rsc");
      if (rsc == null) {
        rsc = new weaver.conn.RecordSet();
        pageContext.setAttribute("rsc", rsc);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet rcs;
      rcs = (weaver.conn.RecordSet) pageContext.getAttribute("rcs");
      if (rcs == null) {
        rcs = new weaver.conn.RecordSet();
        pageContext.setAttribute("rcs", rcs);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.resource.ResourceComInfo resourceComInfo;
      resourceComInfo = (weaver.hrm.resource.ResourceComInfo) pageContext.getAttribute("resourceComInfo");
      if (resourceComInfo == null) {
        resourceComInfo = new weaver.hrm.resource.ResourceComInfo();
        pageContext.setAttribute("resourceComInfo", resourceComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.crm.Maint.CustomerInfoComInfo customerInfoComInfo;
      customerInfoComInfo = (weaver.crm.Maint.CustomerInfoComInfo) pageContext.getAttribute("customerInfoComInfo");
      if (customerInfoComInfo == null) {
        customerInfoComInfo = new weaver.crm.Maint.CustomerInfoComInfo();
        pageContext.setAttribute("customerInfoComInfo", customerInfoComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.proj.Maint.ProjectInfoComInfo projectInfoComInfo;
      projectInfoComInfo = (weaver.proj.Maint.ProjectInfoComInfo) pageContext.getAttribute("projectInfoComInfo");
      if (projectInfoComInfo == null) {
        projectInfoComInfo = new weaver.proj.Maint.ProjectInfoComInfo();
        pageContext.setAttribute("projectInfoComInfo", projectInfoComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.workflow.request.RequestComInfo requestComInfo;
      requestComInfo = (weaver.workflow.request.RequestComInfo) pageContext.getAttribute("requestComInfo");
      if (requestComInfo == null) {
        requestComInfo = new weaver.workflow.request.RequestComInfo();
        pageContext.setAttribute("requestComInfo", requestComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.docs.docs.DocComInfo docComInfo;
      docComInfo = (weaver.docs.docs.DocComInfo) pageContext.getAttribute("docComInfo");
      if (docComInfo == null) {
        docComInfo = new weaver.docs.docs.DocComInfo();
        pageContext.setAttribute("docComInfo", docComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.company.DepartmentComInfo departmentComInfo;
      departmentComInfo = (weaver.hrm.company.DepartmentComInfo) pageContext.getAttribute("departmentComInfo");
      if (departmentComInfo == null) {
        departmentComInfo = new weaver.hrm.company.DepartmentComInfo();
        pageContext.setAttribute("departmentComInfo", departmentComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.roles.RolesComInfo rolesComInfo;
      rolesComInfo = (weaver.hrm.roles.RolesComInfo) pageContext.getAttribute("rolesComInfo");
      if (rolesComInfo == null) {
        rolesComInfo = new weaver.hrm.roles.RolesComInfo();
        pageContext.setAttribute("rolesComInfo", rolesComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.hrm.company.SubCompanyComInfo subCompanyComInfo;
      subCompanyComInfo = (weaver.hrm.company.SubCompanyComInfo) pageContext.getAttribute("subCompanyComInfo");
      if (subCompanyComInfo == null) {
        subCompanyComInfo = new weaver.hrm.company.SubCompanyComInfo();
        pageContext.setAttribute("subCompanyComInfo", subCompanyComInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.meeting.Maint.MeetingComInfo meetingComInfo;
      meetingComInfo = (weaver.meeting.Maint.MeetingComInfo) pageContext.getAttribute("meetingComInfo");
      if (meetingComInfo == null) {
        meetingComInfo = new weaver.meeting.Maint.MeetingComInfo();
        pageContext.setAttribute("meetingComInfo", meetingComInfo);
      }
      out.write(_jsp_string2, 0, _jsp_string2.length);
      weaver.workflow.msg.PoppupRemindInfoUtil PoppupRemindInfoUtil;
      PoppupRemindInfoUtil = (weaver.workflow.msg.PoppupRemindInfoUtil) pageContext.getAttribute("PoppupRemindInfoUtil");
      if (PoppupRemindInfoUtil == null) {
        PoppupRemindInfoUtil = new weaver.workflow.msg.PoppupRemindInfoUtil();
        pageContext.setAttribute("PoppupRemindInfoUtil", PoppupRemindInfoUtil);
      }
      out.write(_jsp_string2, 0, _jsp_string2.length);
      weaver.WorkPlan.WorkPlanExchange exchange;
      exchange = (weaver.WorkPlan.WorkPlanExchange) pageContext.getAttribute("exchange");
      if (exchange == null) {
        exchange = new weaver.WorkPlan.WorkPlanExchange();
        pageContext.setAttribute("exchange", exchange);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.proj.Maint.ProjectTaskApprovalDetail ProjectTaskApprovalDetail;
      ProjectTaskApprovalDetail = (weaver.proj.Maint.ProjectTaskApprovalDetail) pageContext.getAttribute("ProjectTaskApprovalDetail");
      if (ProjectTaskApprovalDetail == null) {
        ProjectTaskApprovalDetail = new weaver.proj.Maint.ProjectTaskApprovalDetail();
        pageContext.setAttribute("ProjectTaskApprovalDetail", ProjectTaskApprovalDetail);
      }
      out.write(_jsp_string2, 0, _jsp_string2.length);
      weaver.hrm.HrmUserVarify hrmUserVarify;
      hrmUserVarify = (weaver.hrm.HrmUserVarify) pageContext.getAttribute("hrmUserVarify");
      if (hrmUserVarify == null) {
        hrmUserVarify = new weaver.hrm.HrmUserVarify();
        pageContext.setAttribute("hrmUserVarify", hrmUserVarify);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.WorkPlan.WorkPlanService workPlanService;
      workPlanService = (weaver.WorkPlan.WorkPlanService) pageContext.getAttribute("workPlanService");
      if (workPlanService == null) {
        workPlanService = new weaver.WorkPlan.WorkPlanService();
        pageContext.setAttribute("workPlanService", workPlanService);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.WorkPlan.WorkPlanHandler workPlanHandler;
      workPlanHandler = (weaver.WorkPlan.WorkPlanHandler) pageContext.getAttribute("workPlanHandler");
      if (workPlanHandler == null) {
        workPlanHandler = new weaver.WorkPlan.WorkPlanHandler();
        pageContext.setAttribute("workPlanHandler", workPlanHandler);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.WorkPlan.WorkPlanShare workPlanShare;
      workPlanShare = (weaver.WorkPlan.WorkPlanShare) pageContext.getAttribute("workPlanShare");
      if (workPlanShare == null) {
        workPlanShare = new weaver.WorkPlan.WorkPlanShare();
        pageContext.setAttribute("workPlanShare", workPlanShare);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.WorkPlan.WorkPlanViewer workPlanViewer;
      workPlanViewer = (weaver.WorkPlan.WorkPlanViewer) pageContext.getAttribute("workPlanViewer");
      if (workPlanViewer == null) {
        workPlanViewer = new weaver.WorkPlan.WorkPlanViewer();
        pageContext.setAttribute("workPlanViewer", workPlanViewer);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.WorkPlan.WorkPlanExchange workPlanExchange;
      workPlanExchange = (weaver.WorkPlan.WorkPlanExchange) pageContext.getAttribute("workPlanExchange");
      if (workPlanExchange == null) {
        workPlanExchange = new weaver.WorkPlan.WorkPlanExchange();
        pageContext.setAttribute("workPlanExchange", workPlanExchange);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.WorkPlan.WorkPlanLogMan workPlanLogMan;
      workPlanLogMan = (weaver.WorkPlan.WorkPlanLogMan) pageContext.getAttribute("workPlanLogMan");
      if (workPlanLogMan == null) {
        workPlanLogMan = new weaver.WorkPlan.WorkPlanLogMan();
        pageContext.setAttribute("workPlanLogMan", workPlanLogMan);
      }
      out.write(_jsp_string3, 0, _jsp_string3.length);
      weaver.conn.RecordSet recordSet;
      recordSet = (weaver.conn.RecordSet) pageContext.getAttribute("recordSet");
      if (recordSet == null) {
        recordSet = new weaver.conn.RecordSet();
        pageContext.setAttribute("recordSet", recordSet);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet recordSet1;
      recordSet1 = (weaver.conn.RecordSet) pageContext.getAttribute("recordSet1");
      if (recordSet1 == null) {
        recordSet1 = new weaver.conn.RecordSet();
        pageContext.setAttribute("recordSet1", recordSet1);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet recordSet2;
      recordSet2 = (weaver.conn.RecordSet) pageContext.getAttribute("recordSet2");
      if (recordSet2 == null) {
        recordSet2 = new weaver.conn.RecordSet();
        pageContext.setAttribute("recordSet2", recordSet2);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.system.SysRemindWorkflow sysRemindWorkflow;
      sysRemindWorkflow = (weaver.system.SysRemindWorkflow) pageContext.getAttribute("sysRemindWorkflow");
      if (sysRemindWorkflow == null) {
        sysRemindWorkflow = new weaver.system.SysRemindWorkflow();
        pageContext.setAttribute("sysRemindWorkflow", sysRemindWorkflow);
      }
      out.write(_jsp_string2, 0, _jsp_string2.length);
      
	response.setHeader("cache-control", "no-cache");
	response.setHeader("pragma", "no-cache");
	response.setHeader("expires", "Mon 1 Jan 1990 00:00:00 GMT");
	request.setCharacterEncoding("UTF-8");
	User user = hrmUserVarify.getUser(request, response);	
	if(user == null)  return ;
	String userId = String.valueOf(user.getUID());  //\u5f53\u524d\u7528\u6237Id
	String userType = user.getLogintype();

	String method = request.getParameter("method");
	String operation =Util.null2String(request.getParameter("operation"));
	 
	String color = "";
    WorkPlan workPlan = new WorkPlan();

    workPlan.setCreaterId(Integer.parseInt(userId));
    workPlan.setCreateType(Integer.parseInt(userType));
    
    char sep = Util.getSeparator();
    
    //\u5224\u65ad\u662f\u5426\u4e3a\u7cfb\u7edf\u7ba1\u7406\u5458sysadmin 
    int isSysadmin=0;
    RecordSet rssysadminmenu=new RecordSet();
    rssysadminmenu.executeSql("select count(*) from hrmresourcemanager where id="+userId);	
    if(rssysadminmenu.next()){
	     isSysadmin=rssysadminmenu.getInt(1);
    }    
	if("addCalendarItem".equals(method))
	{	    	    
	    String workPlanType = request.getParameter("workPlanType");  //\u65e5\u7a0b\u7c7b\u578bp
	    String workPlanName=Util.null2String(URLDecoder.decode(request.getParameter("planName"),"UTF-8"));  //\u6807\u9898p
	    String urgentLevel=Util.null2String(request.getParameter("urgentLevel"));//\u7d27\u6025\u7a0b\u5ea6p
	    urgentLevel="".equals(urgentLevel)?"1":urgentLevel;
	    String remindType = Util.null2String(request.getParameter("remindType"));  //\u63d0\u9192\u7c7b\u578b
	    remindType="".equals(remindType)?"1":remindType;
	    String remindBeforeStart = Util.null2String(request.getParameter("remindBeforeStart"));  //\u662f\u5426\u5f00\u59cb\u524d\u63d0\u9192p
	    if(!"".equals(workPlanType) && null != workPlanType)
	    {
	        workPlan.setWorkPlanType(Integer.parseInt(workPlanType));  //\u65e5\u7a0b\u7c7b\u578b	
	    }else{
	    	workPlanType="0";
	    	 workPlan.setWorkPlanType(0);
	    }
	    workPlan.setWorkPlanName(workPlanName);
	    workPlan.setUrgentLevel(urgentLevel);  
	    workPlan.setRemindType(remindType);
	    //workPlan.setRemindType(remindBeforeStart);
	    if(!"".equals(remindBeforeStart) && null != remindBeforeStart)
	    {
	        workPlan.setRemindBeforeStart(remindBeforeStart);  //\u662f\u5426\u5f00\u59cb\u524d\u63d0\u9192
	    }
	    else
	    {
	        workPlan.setRemindBeforeStart("0");
	    }
	   
	    String remindBeforeEnd = Util.null2String(request.getParameter("remindBeforeEnd"));  //\u662f\u5426\u7ed3\u675f\u524d\u63d0\u9192p
	    if(!"".equals(remindBeforeEnd) && null != remindBeforeEnd)
	    {
	        workPlan.setRemindBeforeEnd(remindBeforeEnd);  //\u662f\u5426\u7ed3\u675f\u524d\u63d0\u9192



	    }
	    else
	    {
	        workPlan.setRemindBeforeEnd("0");
	    }
	    
	    if(!"".equals(remindBeforeStart) && null != remindBeforeStart)
	    {
	    	workPlan.setRemindTimesBeforeStart(Util.getIntValue(request.getParameter("remindDateBeforeStart"),0)*60+Util.getIntValue(Util.null2String(request.getParameter("remindTimesBeforeStart")),0));  //\u5f00\u59cb\u524d\u63d0\u9192\u65f6\u95f4p
	    }
	    else
	    {
	        workPlan.setRemindTimesBeforeStart(0);
	    }
	    
	     if(!"".equals(remindBeforeEnd) && null != remindBeforeEnd)
	    {
	    	workPlan.setRemindTimesBeforeEnd(Util.getIntValue(request.getParameter("remindDateBeforeEnd"),0)*60+Util.getIntValue(Util.null2String(request.getParameter("remindTimesBeforeEnd")),0));  //\u7ed3\u675f\u524d\u63d0\u9192\u65f6\u95f4p
	    }
	    else
	    {
	        workPlan.setRemindTimesBeforeEnd(0);
	    }
	    
	    workPlan.setResourceId(Util.null2String(request.getParameter("memberIDs")).equals("")?""+user.getUID():Util.null2String(request.getParameter("memberIDs")));  //\u7cfb\u7edf\u53c2\u4e0e\u4ebap
	    
	    String beginDate = Util.null2String(request.getParameter("beginDate"));  //\u5f00\u59cb\u65e5\u671fp
	    workPlan.setBeginDate(beginDate);  //\u5f00\u59cb\u65e5\u671f
	    String beginTime = request.getParameter("beginTime");  //\u5f00\u59cb\u65f6\u95f4p
	    if("00".equals(beginTime) || "".equals(beginTime) || null == beginTime){
	    	//\u8003\u8651\u5230\u65b0\u5efa\u65e5\u7a0b\u7684\u8d77\u59cb\u65f6\u95f4\u548c\u7ed3\u675f\u65f6\u95f4\u4e0d\u540c
		    String validedatefrom = beginDate.substring(0,4)+"-01-01";
		    String validedateto = beginDate.substring(0,4)+"-12-31";
		    String startSql="select * from HrmSchedule  where validedatefrom <= '"+validedatefrom+"' and validedateto >= '"+validedateto+"' ";
		    String startweek = getWeekByDate(beginDate)+"starttime1";
		    if(isSysadmin>0){//\u82e5\u4e3a\u7cfb\u7edf\u7ba1\u7406\u5458\u5219\u76f4\u63a5\u53d6\u603b\u90e8\u65f6\u95f4
		    	startSql+=" and scheduletype = '3' ";
		    }else{
		    	startSql+=" and relatedid = (select m.subcompanyid1 from hrmresource m where m.id='"+userId+"')";
		    }
	    	rs.execute(startSql);
	    	if(rs.next()){
	              beginTime = rs.getString(startweek);
	              workPlan.setBeginTime(beginTime.equals("")?"00:00":beginTime);  //\u5f00\u59cb\u65f6\u95f4
	    	}else{//\u82e5\u65e0\u8003\u52e4\u65f6\u95f4\u8bb0\u5f55\u53d6 00:00
	    		  workPlan.setBeginTime("00:00");  //\u5f00\u59cb\u65f6\u95f4
	    	}	    	
	    }else{
	    	workPlan.setBeginTime(beginTime);  //\u5f00\u59cb\u65f6\u95f4
	    }
	    
	    String endDate = Util.null2String(request.getParameter("endDate"));  //\u7ed3\u675f\u65e5\u671fp
	    workPlan.setEndDate(endDate);  //\u7ed3\u675f\u65e5\u671f
	    String endTime = request.getParameter("endTime");  //\u7ed3\u675f\u65f6\u95f4p
	    if(!"".equals(workPlan.getEndDate()) && null != workPlan.getEndDate() && ("".equals(endTime) || null == endTime || "00".equals(endTime)))
	    {	    	
		    String validedatefrom = endDate.substring(0,4)+"-01-01";
		    String validedateto = endDate.substring(0,4)+"-12-31";
		    String endSql="select * from HrmSchedule  where validedatefrom <= '"+validedatefrom+"' and validedateto >= '"+validedateto+"' ";		    
		    String endweek = getWeekByDate(endDate)+"endtime2";
		    if(isSysadmin>0){//\u82e5\u4e3a\u7cfb\u7edf\u7ba1\u7406\u5458\u5219\u76f4\u63a5\u53d6\u603b\u90e8\u65f6\u95f4
		    	endSql+=" and scheduletype = '3' ";
		    }else{
		    	endSql+=" and relatedid = (select m.subcompanyid1 from hrmresource m where m.id='"+userId+"')";
		    }
		    rsc.execute(endSql);
	    	if(rsc.next()){		    
	                endTime = rsc.getString(endweek);
	                workPlan.setEndTime(endTime.equals("")?"00:00":endTime);  //\u7ed3\u675f\u65f6\u95f4
	    	}else{  //\u82e5\u65e0\u8003\u52e4\u65f6\u95f4\u8bb0\u5f55\u53d6 00:00
	    		    workPlan.setEndTime("00:00");  //\u7ed3\u675f\u65f6\u95f4
	    	}
	    	
	    }
	    else
	    {
	        workPlan.setEndTime(endTime);  //\u7ed3\u675f\u65f6\u95f4
	    }
	    workPlan.setDescription(URLDecoder.decode(Util.null2String(request.getParameter("description")),"UTF-8"));  //\u5185\u5bb9p
	    workPlan.setCustomer(Util.null2String(request.getParameter("crmIDs")));  //\u76f8\u5173\u5ba2\u6237p
	    workPlan.setDocument(Util.null2String(request.getParameter("docIDs")));  //\u76f8\u5173\u6587\u6863p
	    workPlan.setProject(Util.null2String(request.getParameter("projectIDs")));  //\u76f8\u5173\u9879\u76eep
	    workPlan.setTask(Util.null2String(request.getParameter("taskIDs")));  //\u76f8\u5173\u9879\u76ee\u4efb\u52a1
	    workPlan.setWorkflow(Util.null2String(request.getParameter("requestIDs")));  //\u76f8\u5173\u6d41\u7a0bp    
	    
	    if(!"".equals(workPlan.getBeginDate()) && null != workPlan.getBeginDate())
	    {	    	
	    	List beginDateTimeRemindList = Util.processTimeBySecond(workPlan.getBeginDate(), workPlan.getBeginTime(), workPlan.getRemindTimesBeforeStart() * -1 * 60);
	    	workPlan.setRemindDateBeforeStart((String)beginDateTimeRemindList.get(0));  //\u5f00\u59cb\u524d\u63d0\u9192\u65e5\u671f
	    	workPlan.setRemindTimeBeforeStart((String)beginDateTimeRemindList.get(1));  //\u5f00\u59cb\u524d\u63d0\u9192\u65f6\u95f4
	    }
	    if(!"".equals(workPlan.getEndDate()) && null != workPlan.getEndDate())
	    {
	    	List endDateTimeRemindList = Util.processTimeBySecond(workPlan.getEndDate(), workPlan.getEndTime(), workPlan.getRemindTimesBeforeEnd() * -1 * 60);
	    	workPlan.setRemindDateBeforeEnd((String)endDateTimeRemindList.get(0));  //\u7ed3\u675f\u524d\u63d0\u9192\u65e5\u671f
	    	workPlan.setRemindTimeBeforeEnd((String)endDateTimeRemindList.get(1));  //\u7ed3\u675f\u524d\u63d0\u9192\u65f6\u95f4
	    }

		StringBuffer stringBuffer = new StringBuffer();
		stringBuffer.append("SELECT * FROM WorkPlanType WHERE workPlanTypeId = ");
		stringBuffer.append(workPlanType);

	    recordSet.executeSql(stringBuffer.toString());
	    if(recordSet.next())
	    {
	        color = recordSet.getString("workPlanTypeColor");
	    }
	    
	    workPlanService.insertWorkPlan(workPlan);
	    workPlanShare.setDefaultShareDetail(user,String.valueOf(workPlan.getWorkPlanID()),workPlanType);
	    
    	//\u63d2\u5165\u65e5\u5fd7
    	String logParams[] = new String[]
		{ String.valueOf(workPlan.getWorkPlanID()), workPlanLogMan.TP_CREATE, userId, request.getRemoteAddr() };
		workPlanLogMan.writeViewLog(logParams);
    	
       	out.clearBuffer();
       	/*
	    out.println("<item>");
    	out.print("<id>");
    	out.print(workPlan.getWorkPlanID());
    	out.println("</id>");
    	out.print("<color>");
    	out.print(color);
    	out.println("</color>");
    	out.print("<starttime>");
    	out.print(workPlan.getBeginTime());
    	out.println("</starttime>");
    	out.print("<endtime>");
    	out.print(workPlan.getEndTime());
    	out.println("</endtime>");    	
    	out.println("</item>");
    	*/
    	SimpleDateFormat format1=new SimpleDateFormat("MM/dd/yyyy HH:mm");
    	SimpleDateFormat format2=new SimpleDateFormat("yyyy-MM-dd HH:mm");
    	Date startDateTime=new Date();
    	Date endDateTime=new Date();
    	Map result=new HashMap();
   		List data=new ArrayList();
   		boolean isAllDay=false;
    	result.put("IsSuccess","true");
    	
    	data.add(""+workPlan.getWorkPlanID());
    	data.add(workPlan.getWorkPlanName());
    	if(!"".equals(workPlan.getBeginDate())){
    		startDateTime=format2.parse(workPlan.getBeginDate()+" "+workPlan.getBeginTime());
    		data.add(workPlan.getBeginDate()+" "+workPlan.getBeginTime());
    	}else{
    		data.add("");
    	}
    	if(!"".equals(workPlan.getEndDate())){
    		endDateTime=format2.parse(workPlan.getEndDate()+" "+workPlan.getEndTime());
    		data.add(workPlan.getEndDate()+" "+workPlan.getEndTime());
    		if(endDateTime.getDate()-startDateTime.getDate()>=1){
    			isAllDay=true;
    		}
    	}else{
    		data.add("");
    	}
    	data.add("0");
    	if(isAllDay){
    		data.add("1");//\u662f\u4e0d\u662f\u5168\u5929
    	}else{
    		data.add("0");
    	}
    	data.add("0");//,0,1,0,-1,1,
    	data.add(color);//\u989c\u8272
    	data.add("1");//editable
    	data.add("1");
    	data.add("1");
    	result.put("Data",data);
    	//["92","\u738b\u4f01\u9e45\u5168\u6587","12/29/2011 01:30","12/29/2011 05:00","0","0","0","1","1","Belion",""]
    	JSONObject jsonObj=JSONObject.fromObject(result);
    	out.print(jsonObj.toString());
    	out.flush();
	}
	else if("editCalendarItemQuick".equals(method))
	{
		String id =(String) request.getAttribute("id");
		
		String startDate = (String)request.getAttribute("startDate");
		String startTime = (String)request.getAttribute("startTime");
		String endDate =(String) request.getAttribute("endDate");
		String endTime = (String)request.getAttribute("endTime");
		
		StringBuffer stringBuffer = new StringBuffer();
		//stringBuffer.append("SELECT 1 FROM workPlanShareDetail WHERE workId = ");
		//stringBuffer.append(id);
		//stringBuffer.append(" AND userId = ");
		//stringBuffer.append(userId);
		//stringBuffer.append(" AND userType = 1");
		//stringBuffer.append(" AND shareLevel > 1");
			
		//recordSet.executeSql(stringBuffer.toString());
		int sharelevel = WorkPlanShareUtil.getShareLevel(id,user);
		if(sharelevel==2){//\u5224\u65ad\u662f\u5426\u5bf9\u63d0\u4ea4\u7684\u6570\u636e\u6709\u7f16\u8f91\u6743\u9650
		    recordSet1.executeSql("SELECT * FROM WorkPlan WHERE id = " + id);
		    if(recordSet1.next()) {
		        String remindBeforeStart = recordSet1.getString("remindBeforeStart");
		        String remindBeforeEnd = recordSet1.getString("remindBeforeEnd");
		        int remindTimesBeforeStart = recordSet1.getInt("remindTimesBeforeStart");
		        int remindTimesBeforeEnd = recordSet1.getInt("remindTimesBeforeEnd");
		        
		        String remindDateBeforeStart = "";
		        String remindTimeBeforeStart = "";
		        String remindDateBeforeEnd = "";
		        String remindTimeBeforeEnd = "";

		        if(null != startDate && !"".equals(startDate) && "1".equals(remindBeforeStart))
		        {
			        List beginDateTimeRemindList = Util.processTimeBySecond(startDate, startTime, remindTimesBeforeStart * -1 * 60);
			    	remindDateBeforeStart = (String)beginDateTimeRemindList.get(0);  //\u5f00\u59cb\u524d\u63d0\u9192\u65e5\u671f
			    	remindTimeBeforeStart = (String)beginDateTimeRemindList.get(1);  //\u5f00\u59cb\u524d\u63d0\u9192\u65f6\u95f4
		        }
		        
		        if(null != endDate && !"".equals(endDate) && "1".equals(remindBeforeEnd))
		        {
			    	List endDateTimeRemindList = Util.processTimeBySecond(endDate, endTime, remindTimesBeforeEnd * -1 * 60);
			    	remindDateBeforeEnd = (String)endDateTimeRemindList.get(0);  //\u7ed3\u675f\u524d\u63d0\u9192\u65e5\u671f



			    	remindTimeBeforeEnd = (String)endDateTimeRemindList.get(1);  //\u7ed3\u675f\u524d\u63d0\u9192\u65f6\u95f4



		        }
		        if(!"".equals(endDate) && null != endDate && ("".equals(endTime) || null == endTime || "00".equals(endTime))){
		        	String validedatefrom = endDate.substring(0,4)+"-01-01";
		        	String validedateto = endDate.substring(0,4)+"-12-31";
		        	String endSql="select * from HrmSchedule  where validedatefrom <= '"+validedatefrom+"' and validedateto >= '"+validedateto+"' ";		    
		        	String endweek = getWeekByDate(endDate)+"endtime2";
				    if(isSysadmin>0){//\u82e5\u4e3a\u7cfb\u7edf\u7ba1\u7406\u5458\u5219\u76f4\u63a5\u53d6\u603b\u90e8\u65f6\u95f4
				    	endSql+=" and scheduletype = '3' ";
				    }else{
				    	endSql+=" and relatedid = (select m.subcompanyid1 from hrmresource m where m.id='"+userId+"')";
				    }
				    rcs.execute(endSql);
			    	if(rcs.next()){		    
		                endTime = rcs.getString(endweek);
		                endTime = endTime.equals("")?"00:00":endTime;  //\u7ed3\u675f\u65f6\u95f4
		    	    }else{  //\u82e5\u65e0\u8003\u52e4\u65f6\u95f4\u8bb0\u5f55\u53d6 00:00
		    		    endTime = "00:00";  //\u7ed3\u675f\u65f6\u95f4
		    	    }		        	
		        }		        		        
		        stringBuffer = new StringBuffer();
				stringBuffer.append("UPDATE WorkPlan SET beginDate = '");
				stringBuffer.append(startDate);
				stringBuffer.append("', beginTime = '");
				stringBuffer.append(startTime);
				stringBuffer.append("', endDate = '");
				stringBuffer.append(endDate);
				stringBuffer.append("', endTime = '");
				stringBuffer.append(endTime);
				stringBuffer.append("'");
				
				if(null != startDate && !"".equals(startDate) && "1".equals(remindBeforeStart))
		        {
					stringBuffer.append(", remindDateBeforeStart = '");
					stringBuffer.append(remindDateBeforeStart);
					stringBuffer.append("', remindTimeBeforeStart = '");
					stringBuffer.append(remindTimeBeforeStart);
					stringBuffer.append("'");
		        }
				
				if(null != endDate && !"".equals(endDate) && "1".equals(remindBeforeEnd))
				{
					stringBuffer.append(", remindDateBeforeEnd = '");
					stringBuffer.append(remindDateBeforeEnd);
					stringBuffer.append("', remindTimeBeforeEnd = '");
					stringBuffer.append(remindTimeBeforeEnd);
					stringBuffer.append("'");
				}
				
				stringBuffer.append(" WHERE id = ");
				stringBuffer.append(id);
						        
		        recordSet2.executeSql(stringBuffer.toString());
		        
				workPlanExchange.exchangeAdd(Integer.parseInt(id), userId, userType);  //\u6807\u8bc6\u65e5\u7a0b\u5df2\u88ab\u7f16\u8f91
				out.clearBuffer();
		    	out.print("{\"IsSuccess\":true}");
		    }else{
				out.clearBuffer();
		    	out.print("{\"IsSuccess\":false}");
			}
		}else{
			out.clearBuffer();
	    	out.print("{\"IsSuccess\":false}");
		}
		
	}
	else if("editCalendarItem".equals(method))
	{
	    String id = request.getParameter("id");
	    
		StringBuffer stringBuffer = new StringBuffer();
		//stringBuffer.append("SELECT 1 FROM workPlanShareDetail WHERE workId = ");
		//stringBuffer.append(id);
		//stringBuffer.append(" AND userId = ");
		//stringBuffer.append(userId);
		//stringBuffer.append(" AND userType = 1");
		//stringBuffer.append(" AND shareLevel > 1");
			
		//recordSet.executeSql(stringBuffer.toString());
		//if(recordSet.next())
		//\u5224\u65ad\u662f\u5426\u5bf9\u63d0\u4ea4\u7684\u6570\u636e\u6709\u7f16\u8f91\u6743\u9650
		int sharelevel = WorkPlanShareUtil.getShareLevel(id,user);
		if(sharelevel==2)


		{
		    String workPlanType = request.getParameter("workPlanType");  //\u65e5\u7a0b\u7c7b\u578bp
		    if(!"".equals(workPlanType) && null != workPlanType)
		    {
		        workPlan.setWorkPlanType(Integer.parseInt(workPlanType));  //\u65e5\u7a0b\u7c7b\u578b	
		    }
		    	    
		    workPlan.setWorkPlanName(Util.null2String(URLDecoder.decode(request.getParameter("planName"),"UTF-8")));  //\u6807\u9898p
		    
		    workPlan.setUrgentLevel(Util.null2String(request.getParameter("urgentLevel")));  //\u7d27\u6025\u7a0b\u5ea6p
		    
		    workPlan.setRemindType(Util.null2String(request.getParameter("remindType")));  //\u65e5\u7a0b\u63d0\u9192\u65b9\u5f0fp
		    
		    String remindBeforeStart = Util.null2String(request.getParameter("remindBeforeStart"));  //\u662f\u5426\u5f00\u59cb\u524d\u63d0\u9192p
		    if(!"".equals(remindBeforeStart) && null != remindBeforeStart)
		    {
		        workPlan.setRemindBeforeStart(remindBeforeStart);  //\u662f\u5426\u5f00\u59cb\u524d\u63d0\u9192
		    }
		    else
		    {
		        workPlan.setRemindBeforeStart("0");
		    }
		    
		    String remindBeforeEnd = Util.null2String(request.getParameter("remindBeforeEnd"));  //\u662f\u5426\u7ed3\u675f\u524d\u63d0\u9192p
		    if(!"".equals(remindBeforeEnd) && null != remindBeforeEnd)
		    {
		        workPlan.setRemindBeforeEnd(remindBeforeEnd);  //\u662f\u5426\u7ed3\u675f\u524d\u63d0\u9192

		    }
		    else
		    {
		        workPlan.setRemindBeforeEnd("0");
		    }
		    
		    if(!"".equals(remindBeforeStart) && null != remindBeforeStart)
		    {
		    	workPlan.setRemindTimesBeforeStart(Util.getIntValue(request.getParameter("remindDateBeforeStart"),0)*60+Util.getIntValue(Util.null2String(request.getParameter("remindTimesBeforeStart")),0));  //\u5f00\u59cb\u524d\u63d0\u9192\u65f6\u95f4p
		    }
		    else
		    {
		        workPlan.setRemindTimesBeforeStart(0);
		    }
		    
		     if(!"".equals(remindBeforeEnd) && null != remindBeforeEnd)
		    {
		    	workPlan.setRemindTimesBeforeEnd(Util.getIntValue(request.getParameter("remindDateBeforeEnd"),0)*60+Util.getIntValue(Util.null2String(request.getParameter("remindTimesBeforeEnd")),0));  //\u7ed3\u675f\u524d\u63d0\u9192\u65f6\u95f4p
		    }
		    else
		    {
		        workPlan.setRemindTimesBeforeEnd(0);
		    }
		    
		    workPlan.setResourceId(Util.null2String(request.getParameter("memberIDs")));  //\u7cfb\u7edf\u53c2\u4e0e\u4ebap
		    
		    String beginDate = Util.null2String(request.getParameter("beginDate"));  //\u5f00\u59cb\u65e5\u671fp
		    workPlan.setBeginDate(beginDate);  //\u5f00\u59cb\u65e5\u671f

		    String beginTime = request.getParameter("beginTime");  //\u5f00\u59cb\u65f6\u95f4p
		    if("00".equals(beginTime) || "".equals(beginTime) || null == beginTime){
		    	//\u8003\u8651\u5230\u65b0\u5efa\u65e5\u7a0b\u7684\u8d77\u59cb\u65f6\u95f4\u548c\u7ed3\u675f\u65f6\u95f4\u4e0d\u540c
			    String validedatefrom = beginDate.substring(0,4)+"-01-01";
			    String validedateto = beginDate.substring(0,4)+"-12-31";
			    String startSql="select * from HrmSchedule  where validedatefrom = '"+validedatefrom+"' and validedateto= '"+validedateto+"' ";
			    if(isSysadmin>0){//\u82e5\u4e3a\u7cfb\u7edf\u7ba1\u7406\u5458\u5219\u76f4\u63a5\u53d6\u603b\u90e8\u65f6\u95f4
			    	startSql+=" and scheduletype = '3' ";
			    }else{
			    	startSql+=" and relatedid = (select m.subcompanyid1 from hrmresource m where m.id='"+userId+"')";
			    }
			    String startweek = getWeekByDate(beginDate)+"starttime1";
		    	rs.execute(startSql);
		    	if(rs.next()){
		              beginTime = rs.getString(startweek);		
		              workPlan.setBeginTime(beginTime.equals("")?"00:00":beginTime);  //\u5f00\u59cb\u65f6\u95f4
		    	}else{  //\u82e5\u65e0\u8003\u52e4\u65f6\u95f4 \u5219\u53d6 00:00
		    		  workPlan.setBeginTime("00:00");
		    	}		        	    	
		    }else{
		    	workPlan.setBeginTime(beginTime);  //\u5f00\u59cb\u65f6\u95f4
		    }
		    String endDate = Util.null2String(request.getParameter("endDate"));  //\u7ed3\u675f\u65e5\u671fp
		    workPlan.setEndDate(endDate);  //\u7ed3\u675f\u65e5\u671f
		    
		    String endTime = request.getParameter("endTime");  //\u7ed3\u675f\u65f6\u95f4p
		    if(!"".equals(workPlan.getEndDate()) && null != workPlan.getEndDate() && ("".equals(endTime) || null == endTime || "00".equals(endTime)))
		    {		    	
			    String validedatefrom = endDate.substring(0,4)+"-01-01";
			    String validedateto = endDate.substring(0,4)+"-12-31";
			    String endSql="select * from HrmSchedule  where validedatefrom = '"+validedatefrom+"' and validedateto= '"+validedateto+"' ";		    
			    String endweek = getWeekByDate(endDate)+"endtime2";
			    if(isSysadmin>0){//\u82e5\u4e3a\u7cfb\u7edf\u7ba1\u7406\u5458\u5219\u76f4\u63a5\u53d6\u603b\u90e8\u65f6\u95f4
			    	endSql+=" and scheduletype = '3' ";
			    }else{
			    	endSql+=" and relatedid = (select m.subcompanyid1 from hrmresource m where m.id='"+userId+"')";
			    }
			    rsc.execute(endSql);
		    	if(rsc.next()){		    
		                endTime = rsc.getString(endweek);
		                workPlan.setEndTime(endTime.equals("")?"00:00":endTime);  //\u7ed3\u675f\u65f6\u95f4
		    	}else{  //\u82e5\u65e0\u8003\u52e4\u65f6\u95f4 \u5219\u53d6 00:00
		    		    workPlan.setEndTime("00:00");  //\u7ed3\u675f\u65f6\u95f4
		    	}		    	
		    }
		    else
		    {
		        workPlan.setEndTime(endTime);  //\u7ed3\u675f\u65f6\u95f4
		    }
		    workPlan.setDescription(Util.null2String(URLDecoder.decode(request.getParameter("description"),"UTF-8")));  //\u5185\u5bb9p		    
		    workPlan.setCustomer(Util.null2String(request.getParameter("crmIDs")));  //\u76f8\u5173\u5ba2\u6237p
		    workPlan.setDocument(Util.null2String(request.getParameter("docIDs")));  //\u76f8\u5173\u6587\u6863p
		    workPlan.setProject(Util.null2String(request.getParameter("projectIDs")));  //\u76f8\u5173\u9879\u76eep
		    workPlan.setTask(Util.null2String(request.getParameter("taskIDs")));  //\u76f8\u5173\u9879\u76ee\u4efb\u52a1
		    workPlan.setWorkflow(Util.null2String(request.getParameter("requestIDs")));  //\u76f8\u5173\u6d41\u7a0bp    
		    workPlan.setMeeting(Util.null2String(request.getParameter("meetingIDs")));  //\u76f8\u5173\u4f1a\u8bae
		    if(!"".equals(workPlan.getBeginDate()) && null != workPlan.getBeginDate())
		    {	    	
		    	List beginDateTimeRemindList = Util.processTimeBySecond(workPlan.getBeginDate(), workPlan.getBeginTime(), workPlan.getRemindTimesBeforeStart() * -1 * 60);
		    	workPlan.setRemindDateBeforeStart((String)beginDateTimeRemindList.get(0));  //\u5f00\u59cb\u524d\u63d0\u9192\u65e5\u671f
		    	workPlan.setRemindTimeBeforeStart((String)beginDateTimeRemindList.get(1));  //\u5f00\u59cb\u524d\u63d0\u9192\u65f6\u95f4
		    }
		    if(!"".equals(workPlan.getEndDate()) && null != workPlan.getEndDate())
		    {
		    	List endDateTimeRemindList = Util.processTimeBySecond(workPlan.getEndDate(), workPlan.getEndTime(), workPlan.getRemindTimesBeforeEnd() * -1 * 60);
		    	workPlan.setRemindDateBeforeEnd((String)endDateTimeRemindList.get(0));  //\u7ed3\u675f\u524d\u63d0\u9192\u65e5\u671f
		    	workPlan.setRemindTimeBeforeEnd((String)endDateTimeRemindList.get(1));  //\u7ed3\u675f\u524d\u63d0\u9192\u65f6\u95f4
 

		    }
			
		    
			//\u66f4\u65b0
		    WorkPlan oldWorkPlan = new WorkPlan();
	        oldWorkPlan.setWorkPlanID(Integer.parseInt(id));
	        
	        workPlan.setWorkPlanID(oldWorkPlan.getWorkPlanID());	        
	        
	        String ip = request.getRemoteAddr();
	        
	        List workPlanList = workPlanService.getWorkPlanList(oldWorkPlan);
	        
	        for(int i = 0; i < workPlanList.size(); i++)
	        {
	            oldWorkPlan = (WorkPlan)workPlanList.get(i);
	            
		        workPlan.setTask(oldWorkPlan.getTask());
	            workPlanService.updateWorkPlan(oldWorkPlan, workPlan);
	            
	            workPlanLogMan.insertEditLog(oldWorkPlan, workPlan, userId, ip);	            
	        }
			
	        workPlanExchange.exchangeAdd(Integer.parseInt(id), userId, userType);  //\u6807\u8bc6\u65e5\u7a0b\u5df2\u88ab\u7f16\u8f91
	        out.clearBuffer();
	        out.print("{\"IsSuccess\":true}");
		   // response.sendRedirect("WorkPlanViewOperation.jsp?method=getCalendarItem&id=" + id);
		}else{
			out.clearBuffer();
	        out.print("{\"IsSuccess\":false}");
		}
	}


	else if("overCalendarItem".equals(method))
	{
		
		String planID = Util.null2String(request.getParameter("id"));
		boolean isPass=false;
	    String[] creater = workPlanHandler.getCreater(planID);
	    String createrID = "";
	    if (creater != null) createrID = creater[0];
	    
	    if(createrID.equals(userId)){ //\u63d0\u4ea4\u4eba\u5b8c\u6210
		    String planStatus =workPlanHandler.getWorkPlanStatus(planID);
		
		    if (planStatus.equals("0"))
		    {
		    	isPass=workPlanHandler.finishWorkPlan(planID);
		    }
		
		    if (planStatus.equals("1"))
		    {
		    	isPass=workPlanHandler.closeWorkPlan(planID);
		    }
	    }else{ //\u975e\u63d0\u4ea4\u4eba\u5b8c\u6210
	    	String planName = workPlanHandler.getWorkPlanName(planID);
	    	
		    String accepter = createrID;
		    String wfTitle = "";
		    String wfRemark = "";
		    Calendar current = Calendar.getInstance();
		    String currentDate = Util.add0(current.get(Calendar.YEAR), 4) + "-" + Util.add0(current.get(Calendar.MONTH) + 1, 2) + "-" + Util.add0(current.get(Calendar.DAY_OF_MONTH), 2);
		
		    wfTitle = SystemEnv.getHtmlLabelName(16653,user.getLanguage())+":";
		    wfTitle += planName;
		    wfTitle += "-" + resourceComInfo.getResourcename(userId);
		    wfTitle += "-" + currentDate;
		    wfRemark = SystemEnv.getHtmlLabelName(18170,user.getLanguage()) + ":<A href=/workplan/data/WorkPlan.jsp?workid=" + planID + ">" + Util.fromScreen2(planName, user.getLanguage()) + "</A>";
		    sysRemindWorkflow.setCRMSysRemind(wfTitle, 0, Util.getIntValue(userId), accepter, wfRemark);
		
		    isPass=workPlanHandler.memberFinishWorkPlan(planID);
	    }
		
		Map result=new HashMap();
		result.put("IsSuccess",""+isPass);
		out.clearBuffer();
		out.print(JSONObject.fromObject(result).toString());
	}

	else if("getCalendarItem".equals(method))
	{  
		String shareSql=WorkPlanShareUtil.getShareSql(user);
		String id = request.getParameter("id");

		StringBuffer stringBuffer = new StringBuffer();
		stringBuffer.append("SELECT workPlan.*, workPlanType.workPlanTypeName, workPlanType.workPlanTypeColor, workPlanShareDetail.shareLevel");
		stringBuffer.append(" FROM WorkPlan workPlan, WorkPlanType workPlanType, ("+shareSql+") workPlanShareDetail");
		stringBuffer.append(" WHERE workPlan.type_n = workPlanType.workPlanTypeId");
		stringBuffer.append(" AND workPlan.id = workPlanShareDetail.workId");
		stringBuffer.append(" AND workPlan.id = ");
		stringBuffer.append(id);
		//stringBuffer.append(" AND workPlanShareDetail.userId = ");
		//stringBuffer.append(userId);
		//stringBuffer.append(" AND userType = ");
		//stringBuffer.append(userType);
		stringBuffer.append(" order by sharelevel desc ");		
		recordSet.executeSql(stringBuffer.toString());
		PoppupRemindInfoUtil.updatePoppupRemindInfo(Util.getIntValue(userId),12,"0",Util.getIntValue(id));
		PoppupRemindInfoUtil.updatePoppupRemindInfo(Util.getIntValue(userId),13,"0",Util.getIntValue(id));
		if(recordSet.next())
		{
			Map result=new HashMap();
		    //\u8bbe\u4e3a\u5df2\u770b
		    int[] viewParams = new int[] {Integer.parseInt(id), Integer.parseInt(userId)};			
		    workPlanExchange.exchangeView(viewParams);
		    
		    //\u8fd4\u56de\u4fe1\u606f		    
		    String urgentLevel = recordSet.getString("urgentLevel");
		    String remindType = recordSet.getString("remindType");
		    String remindBeforeStart = recordSet.getString("remindBeforeStart");
		    String remindBeforeEnd = recordSet.getString("remindBeforeEnd");
		    String remindTimesBeforeStart = recordSet.getString("remindTimesBeforeStart");
		    String remindTimesBeforeEnd = recordSet.getString("remindTimesBeforeEnd");

			int temmhourb=Util.getIntValue(remindTimesBeforeStart,0)/60;
		    int temptimeb=Util.getIntValue(remindTimesBeforeStart,0)%60;
			int temmhoure=Util.getIntValue(remindTimesBeforeEnd,0)/60;
		    int temptimee=Util.getIntValue(remindTimesBeforeEnd,0)%60;

		    String executeId = recordSet.getString("resourceId");
		    String crmId = recordSet.getString("crmId");
		    String docId = recordSet.getString("docId");
		    String projectId = recordSet.getString("projectId");
		    String workFlowId = recordSet.getString("requestId");
		    String taskId = recordSet.getString("taskId");
		    String meetingId = recordSet.getString("meetingId");
			if (userId.equals(recordSet.getString("createrId"))) 
			{
				result.put("canShare","true");
			}
			else
			{
				result.put("canShare","false");
			}
	    	result.put("type",""+recordSet.getInt("type_n"));
	    	result.put("id",""+recordSet.getInt("id"));
	    	result.put("planName",(Util.null2String((recordSet.getString("name")))));
	    	result.put("itemName",Util.null2String((recordSet.getString("name"))).replaceAll("&lt;","<").replaceAll("&gt;",">"));
	    	result.put("color",recordSet.getString("workPlanTypeColor"));
	    	result.put("urgent",urgentLevel);
	    	result.put("remindType",remindType);
	    	result.put("remindBeforeStart",""+remindBeforeStart);
	    	result.put("remindBeforeStartMinute",""+temptimeb);
	    	result.put("remindBeforeStartHour",""+temmhourb);
	    	result.put("remindBeforeEnd",remindBeforeEnd);
	    	result.put("remindBeforeEndMinute",""+temptimee);
	    	result.put("remindBeforeEndHour",""+temmhoure);
	    	result.put("executeId",executeId);
	    	result.put("startDate",recordSet.getString("beginDate"));
	    	result.put("startTime",recordSet.getString("beginTime"));
	    	result.put("endDate",recordSet.getString("endDate"));
	    	result.put("endTime",recordSet.getString("endTime"));
	    	result.put("desc",Util.convertInput2DB2(Util.null2String(recordSet.getString("description"))));
	    	String description=Util.convertDB2Input(Util.StringReplace(Util.null2String(recordSet.getString("description")),"&nbsp;"," "));
	    	String location=Util.null2String(recordSet.getString("location"));
	    	if(!location.equals("")&&operation.equals("view")) //\u67e5\u770b\u72b6\u6001\u4e0b\u624d\u663e\u793a\u5730\u56fe
	    		description=description+"&nbsp;&nbsp;<a href='javascript:void(0)' onclick=\"showLocation('"+location+"','"+recordSet.getString("begintime")+"')\"><img src='/blog/images/location_icon_1_wev8.png' border='0'/>"+SystemEnv.getHtmlLabelName(126784,user.getLanguage())+"</a>";
	    	result.put("description",description);
	    	result.put("relatedCustomer",crmId);    	
	    	result.put("relatedDocument",docId);   
	    	result.put("relatedProject",projectId);
	    	result.put("relatedWorkFlow",workFlowId);
	    	result.put("relatedTask",taskId);
	    	result.put("relatedMeeting",meetingId);
	    	result.put("status",recordSet.getString("status"));	    	
	    	result.put("shareLevel",""+recordSet.getInt("shareLevel"));
	    	result.put("exchangeCount","0");
	    	result.put("workPlanTypeName",Util.toHtml(Util.null2String(recordSet.getString("workPlanTypeName"))));
	    	
	    	if ("1".equals(urgentLevel)) 
      		{
	    		result.put("urgentLevelName",SystemEnv.getHtmlLabelName(154,user.getLanguage()));
      		}
      		else if (urgentLevel.equals("2")) 
      		{
      			result.put("urgentLevelName",SystemEnv.getHtmlLabelName(15533,user.getLanguage()));
	  		}
      		else 
      		{
      			result.put("urgentLevelName",SystemEnv.getHtmlLabelName(2087,user.getLanguage()));
	  		}
	    	
	    	if("1".equals(remindType))
			{
	    		result.put("remindTypeName",SystemEnv.getHtmlLabelName(19782,user.getLanguage()));
			}
			else if("2".equals(remindType))
			{
				result.put("remindTypeName",SystemEnv.getHtmlLabelName(17586,user.getLanguage()));
			}
			else if("3".equals(remindType))
			{
				result.put("remindTypeName",SystemEnv.getHtmlLabelName(18845,user.getLanguage()));
			}
	    	String remindTimeDescription="";
 			if("1".equals(remindBeforeStart))
 			{	
 				remindTimeDescription+=(SystemEnv.getHtmlLabelName(19784,user.getLanguage()) + String.valueOf(temmhourb) + SystemEnv.getHtmlLabelName(391,user.getLanguage())+String.valueOf(temptimeb) + SystemEnv.getHtmlLabelName(15049,user.getLanguage()));
 			}
     		if("1".equals(remindBeforeEnd))
 			{
     			
				remindTimeDescription+=" "+(SystemEnv.getHtmlLabelName(19785,user.getLanguage()) + String.valueOf(temmhoure) + SystemEnv.getHtmlLabelName(391,user.getLanguage())+String.valueOf(temptimee) + SystemEnv.getHtmlLabelName(15049,user.getLanguage()));
 			}
     		result.put("remindTimeDescription",remindTimeDescription);
	    	String executeName="";
	    	if (null != executeId && !"".equals(executeId)) 
			{
				List executeList = Util.TokenizerString(executeId,",");
				for (int i = 0; i < executeList.size(); i++) 
				{
					executeName+="<a href='/hrm/resource/HrmResource.jsp?id="+((String)executeList.get(i))+"'  target='_blank'>"+resourceComInfo.getResourcename((String)executeList.get(i))+"</a>";
					executeName+=" ";
				}
			}
	    	result.put("executeName",executeName);
	    	String crmIdName="";
	    	if (null != crmId && !"".equals(crmId))
			{
				List crmIdList = Util.TokenizerString(crmId, ",");
				for (int i = 0; i < crmIdList.size(); i++) 
				{
					crmIdName += "<a href='/CRM/data/ViewCustomer.jsp?CustomerID="+((String)crmIdList.get(i))+"' target='_blank'>"+customerInfoComInfo.getCustomerInfoname((String)crmIdList.get(i))+"</a>";
					crmIdName += " ";
				}
			}
	    	result.put("crmIdName",crmIdName);
	    	String docIdName="";
	    	if (null != docId && !"".equals(docId))
			{
				List docIdList = Util.TokenizerString(docId, ",");
				for (int i = 0; i < docIdList.size(); i++) 
				{
					docIdName += "<a href='/docs/docs/DocDsp.jsp?id="+((String)docIdList.get(i))+"' target='_blank'>"+(docComInfo.getDocname((String)docIdList.get(i)))+"</a>";
					
					docIdName += (" ");
				}
			}
	    	result.put("docIdName",docIdName);
	    	String projectIdName="";
	    	if (null != projectId && !"".equals(projectId))
			{
				List projectIdList = Util.TokenizerString(projectId, ",");
				for (int i = 0; i < projectIdList.size(); i++) 
				{
					projectIdName += "<a href='/proj/data/ViewProject.jsp?ProjID="+((String)projectIdList.get(i))+"' target='_blank'>"+(projectInfoComInfo.getProjectInfoname((String)projectIdList.get(i)))+"</a>";
					projectIdName +=(" ");
				}
			}
	    	result.put("projectIdName",projectIdName);
	    	String taskIdName="";
	    	if (null != taskId && !"".equals(taskId) && !"0".equals(taskId))
			{
				List taskIdList = Util.TokenizerString(taskId, ",");
				for (int i = 0; i < taskIdList.size(); i++) 
				{
					taskIdName +=(ProjectTaskApprovalDetail.getTaskSuject((String)taskIdList.get(i)) + "(" + SystemEnv.getHtmlLabelName(101,user.getLanguage()) + ":" + ProjectTaskApprovalDetail.getProjectNameByTaskId((String)taskIdList.get(i)) + ")");
					taskIdName +=(" ");
				}
			}
	    	result.put("taskIdName",taskIdName);
	    	String requestIdName="";
	    	if (null != workFlowId && !"".equals(workFlowId))
			{
				List workFlowIdList = Util.TokenizerString(workFlowId, ",");
				for (int i = 0; i < workFlowIdList.size(); i++) 
				{
					requestIdName += 
					"<a href='/workflow/request/ViewRequest.jsp?requestid="+((String)workFlowIdList.get(i))+"' target='_blank'>"
							+(requestComInfo.getRequestname((String)workFlowIdList.get(i)))+"</a>";
					requestIdName += (" ");
				}
			}
	    	
	    	result.put("requestIdName",requestIdName);
	    	List mettings=new ArrayList();
	    	
	    	if (null != meetingId && !"".equals(meetingId))
			{	
				List meetingIdList = Util.TokenizerString(meetingId, ",");
				for (int i = 0; i < meetingIdList.size(); i++) 
				{
					Map meeting =new HashMap();
					meeting.put("meetingId",meetingId);
					meeting.put("meetingName",meetingComInfo.getMeetingInfoname((String)meetingIdList.get(i)));
					mettings.add(meeting);
				}
			}
	    	result.put("meetingIdName",mettings);
	    	out.clearBuffer();
	    	out.print(JSONObject.fromObject(result).toString());
		}else{
			out.clearBuffer();
			out.print("{}");
		}
	}
	else if("deleteCalendarItem".equals(method))
	{
		String id = request.getParameter("id");
				
		StringBuffer stringBuffer = new StringBuffer();
		//stringBuffer.append("SELECT 1 FROM workPlanShareDetail WHERE workId = ");
		//stringBuffer.append(id);
		//stringBuffer.append(" AND userId = ");
		//stringBuffer.append(userId);
		//stringBuffer.append(" AND userType = 1");
		//stringBuffer.append(" AND shareLevel > 1");
			
		//recordSet.executeSql(stringBuffer.toString());
		PoppupRemindInfoUtil.deletePoppupRemindInfo(Util.getIntValue(id),12);
		PoppupRemindInfoUtil.deletePoppupRemindInfo(Util.getIntValue(id),13);
		int sharelevel = WorkPlanShareUtil.getShareLevel(id,user);
		if(sharelevel==2)
		//\u5224\u65ad\u662f\u5426\u5bf9\u63d0\u4ea4\u7684\u6570\u636e\u6709\u7f16\u8f91\u6743\u9650
		{
		    workPlanHandler.delete(id);
			
			String logParams[] = new String[]
			{ id, workPlanLogMan.TP_DELETE, userId, request.getRemoteAddr() };
			workPlanLogMan.writeViewLog(logParams);
	
			workPlanExchange.workPlanDelete(Integer.parseInt(id));
			out.clearBuffer();
			out.print("{\"IsSuccess\":true}");
		}else{
			out.clearBuffer();
			out.print("{\"IsSuccess\":false}");
		}
	}
	else if("getCalendarShare".equals(method))
	//\u5f97\u5230\u5171\u4eab\u4fe1\u606f
	{	    
		Map item=new HashMap();
		List itemList=new ArrayList();
		Map result=new HashMap();
		result.put("data",itemList);
		String id = request.getParameter("id");
		
		boolean canEdit = false;
		String createrId = "";
		
		String[] creater = workPlanHandler.getCreater(id);		
		if (null != creater)
		{
		    createrId = creater[0];
		}		
		if (createrId.equals(userId))
		{
		    canEdit = true;
		}
		
						
		StringBuffer stringBuffer = new StringBuffer();
		stringBuffer.append("SELECT * FROM WorkPlanShare WHERE workPlanId = ");
		stringBuffer.append(id);

		recordSet.executeSql(stringBuffer.toString());
		
		if (canEdit){	result.put("canShare","true");
		}
		else{
			result.put("canShare","false");
		}
		
		while(recordSet.next())
		{
		    int shareType = recordSet.getInt("shareType");
		    int shareLevel = recordSet.getInt("shareLevel");
			item=new HashMap();
			itemList.add(item);
			item.put("shareId",new Integer(recordSet.getInt("id")));
			String shareContent="";
			if (1 == shareType)
			//\u4eba\u529b\u8d44\u6e90
		    {
		        String shareUserId = recordSet.getString("userId");
		        item.put("shareTypeName",SystemEnv.getHtmlLabelName(179,user.getLanguage()));
		        shareContent="";
		        List shareUserIdList = Util.TokenizerString(shareUserId, ",");
				for(int i = 0; i < shareUserIdList.size(); i++)
				{
					shareContent+=" ";
					shareContent+=(Util.toScreen(resourceComInfo.getResourcename((String)shareUserIdList.get(i)), user.getLanguage()));
				}
				shareContent+=(" / ");
				if (1 == shareLevel) 
				{
					shareContent+=(SystemEnv.getHtmlLabelName(367,user.getLanguage()));
				}
				else if (2 == shareLevel) 
				{

					shareContent+=(SystemEnv.getHtmlLabelName(93,user.getLanguage()));
				}
				item.put("shareContent",shareContent);
		    }
		    else if(2 == shareType)
			//\u90e8\u95e8
		    {			    
			    String shareDepartmentId = recordSet.getString("deptId");
			    item.put("shareTypeName",SystemEnv.getHtmlLabelName(124, user.getLanguage()));
		        shareContent="";
				List shareDepartmentIdList = Util.TokenizerString(shareDepartmentId, ",");
				for(int i = 0; i < shareDepartmentIdList.size(); i++)
				{
					shareContent+=(" ");
					shareContent+=(Util.toScreen(departmentComInfo.getDepartmentname((String)shareDepartmentIdList.get(i)), user.getLanguage()));
				}
				shareContent+=(" / ");
				shareContent+=(SystemEnv.getHtmlLabelName(683,user.getLanguage()));
				shareContent+=(" : ");
				shareContent+=(Util.toScreen(recordSet.getString("securityLevel"), user.getLanguage()));
				shareContent+=(" / ");
				if (1 == recordSet.getInt("shareLevel"))
				{
					shareContent+=(SystemEnv.getHtmlLabelName(367,user.getLanguage()));
				}
				else if (2 == recordSet.getInt("shareLevel"))
				{
					shareContent+=(SystemEnv.getHtmlLabelName(93,user.getLanguage()));
				}			    
				item.put("shareContent",shareContent);     		        
		    }
		    else if(3 == shareType)
			//\u89d2\u8272
		    {			    
		        String shareRoleId = recordSet.getString("roleId");
		       
		        item.put("shareTypeName",SystemEnv.getHtmlLabelName(122, user.getLanguage()));
		        shareContent="";
		        shareContent+=(Util.toScreen(rolesComInfo.getRolesname(shareRoleId), user.getLanguage()));
		        shareContent+=(" / ");			    
			    if (0 == recordSet.getInt("roleLevel")) 
				{
			    	shareContent+=(SystemEnv.getHtmlLabelName(124,user.getLanguage()));
				} 
				else if (1 == recordSet.getInt("roleLevel"))
				{
					shareContent+=(SystemEnv.getHtmlLabelName(141,user.getLanguage()));
				} 
				else if (2 == recordSet.getInt("roleLevel"))
				{
					shareContent+=(SystemEnv.getHtmlLabelName(140,user.getLanguage()));
				}
			    shareContent+=(" / ");
			    shareContent+=(SystemEnv.getHtmlLabelName(683,user.getLanguage()));
			    shareContent+=(" : ");
			    shareContent+=(Util.toScreen(recordSet.getString("securityLevel"),user.getLanguage()));
			    shareContent+=(" / ");			    
			    
				if (1 == recordSet.getInt("shareLevel"))
				{
					shareContent+=(SystemEnv.getHtmlLabelName(367,user.getLanguage()));
				}
				else if (2 == recordSet.getInt("shareLevel"))
				{
					shareContent+=(SystemEnv.getHtmlLabelName(93,user.getLanguage()));
				}			    
				item.put("shareContent",shareContent);     	        		        
		    }
		    else if(4 == shareType){
				//\u6240\u6709\u4eba
		        item.put("shareTypeName",SystemEnv.getHtmlLabelName(235, user.getLanguage())+SystemEnv.getHtmlLabelName(127, user.getLanguage()));
		        shareContent="";
		        shareContent+=(SystemEnv.getHtmlLabelName(683,user.getLanguage()));
			    shareContent+=(" : ");
			    shareContent+=(Util.toScreen(recordSet.getString("securityLevel"),user.getLanguage()));
			    shareContent+=(" / ");
			    if (1 == recordSet.getInt("shareLevel"))
				{
					shareContent+=(SystemEnv.getHtmlLabelName(367,user.getLanguage()));
				}
				else if (2 == recordSet.getInt("shareLevel"))
				{
					shareContent+=(SystemEnv.getHtmlLabelName(93,user.getLanguage()));
				}
			    item.put("shareContent",shareContent);     	 
		    }
		    else if(5 == shareType)
			//\u5206\u90e8
		    {
		        String shareSubCompanyId = recordSet.getString("subCompanyId");
		        item.put("shareTypeName",SystemEnv.getHtmlLabelName(141, user.getLanguage()));
		        shareContent="";
		        
			    shareContent+=("<shareContent>");
			    List shareSubCompanyIdList = Util.TokenizerString(shareSubCompanyId, ",");
				for(int i = 0; i < shareSubCompanyIdList.size(); i++)
				{
				    shareContent+=(" ");
				    shareContent+=(Util.toScreen(subCompanyComInfo.getSubCompanyname((String)shareSubCompanyIdList.get(i)),user.getLanguage()));
				}			
				shareContent+=(" / ");
				shareContent+=(SystemEnv.getHtmlLabelName(683,user.getLanguage()));
				shareContent+=(" : ");
				shareContent+=(Util.toScreen(recordSet.getString("securityLevel"),user.getLanguage()));
				shareContent+=(" / ");			    			    			    
			    if (1 == recordSet.getInt("shareLevel"))
				{
					shareContent+=(SystemEnv.getHtmlLabelName(367,user.getLanguage()));
				}
				else if (2 == recordSet.getInt("shareLevel"))
				{
					shareContent+=(SystemEnv.getHtmlLabelName(93,user.getLanguage()));
				}
				item.put("shareContent",shareContent);     	 
		    }
		}
		out.clearBuffer();
		out.print(JSONObject.fromObject(result).toString());
		
	}
	else if("addCalendarShare".equals(method))
	{				
		StringBuffer stringBuffer = new StringBuffer();
						
		String id = request.getParameter("id");
		
		stringBuffer.append("SELECT 1 FROM WorkPlan WHERE id = ");
		stringBuffer.append(id);
		stringBuffer.append(" AND createrId = ");
		stringBuffer.append(userId);
		stringBuffer.append(" AND createrType = ");
		stringBuffer.append(userType);
		recordSet1.executeSql(stringBuffer.toString());
		if(recordSet1.next())
		{
		    stringBuffer = new StringBuffer();
		    
			String shareType = Util.null2String(request.getParameter("shareType"));
			String shareId = Util.null2String(request.getParameter("shareId"));
			String roleLevel = Util.null2String(request.getParameter("roleLevel"));
			String secLevel = Util.null2String(request.getParameter("secLevel"));
			String shareLevel = Util.null2String(request.getParameter("shareLevel"));
		
			String userShareId = "0";
			String departmentShareId = "0";
			String roleShareId = "0";
			String allShare = "0";
			String subCompanyShareId = "0";
		
			if ("1".equals(shareType))
			{
			    userShareId = shareId;
			}
			else if ("2".equals(shareType))
			{
			    departmentShareId = shareId;
			}
			else if ("3".equals(shareType))
			{
			    roleShareId = shareId;
			}
			else if ("5".equals(shareType))
			{
			    subCompanyShareId = shareId;
			}
			else
			{
			    allShare = "1";
			}
		
			stringBuffer.append(id);
			stringBuffer.append(sep);
			stringBuffer.append(shareType);
			stringBuffer.append(sep);
			stringBuffer.append(userShareId);
			stringBuffer.append(sep);
			stringBuffer.append(subCompanyShareId);
			stringBuffer.append(sep);
			stringBuffer.append(departmentShareId);
			stringBuffer.append(sep);
			stringBuffer.append(roleShareId);
			stringBuffer.append(sep);
			stringBuffer.append(allShare);
			stringBuffer.append(sep);
			stringBuffer.append(roleLevel);
			stringBuffer.append(sep);
			stringBuffer.append(secLevel);
			stringBuffer.append(sep);
			stringBuffer.append(shareLevel);
		
			recordSet.executeProc("WorkPlanShare_Ins", stringBuffer.toString());
	       workPlanShare.setShareDetail(id);
	       workPlanExchange.exchangeAdd(Integer.parseInt(id), userId, userType);  //\u6807\u8bc6\u65e5\u7a0b\u5df2\u88ab\u7f16\u8f91
	       
	       //\u53d6\u4e3b\u952e



	       stringBuffer = new StringBuffer();
	       stringBuffer.append("SELECT max(id) AS id FROM WorkPlanShare");
	       recordSet.executeSql(stringBuffer.toString());       
	       if(recordSet.next())
	       {     
	    	   out.clearBuffer();
	           out.print("{\"shareId\":\""+recordSet.getInt("id")+"\"}");
	       }
		}
	}
	else if("deleteCalendarShare".equals(method))
	{				
		StringBuffer stringBuffer = new StringBuffer();
						
		String workPlanShareId = request.getParameter("id");
		
		stringBuffer.append("SELECT WorkPlan.id AS workPlanId FROM WorkPlan, WorkPlanShare");
		stringBuffer.append(" WHERE WorkPlan.id = WorkPlanShare.workPlanId");
		stringBuffer.append(" AND WorkPlanShare.id = ");
		stringBuffer.append(workPlanShareId);
		stringBuffer.append(" AND WorkPlan.createrId = ");
		stringBuffer.append(userId);
		stringBuffer.append(" AND WorkPlan.createrType = ");
		stringBuffer.append(userType);

		recordSet1.executeSql(stringBuffer.toString());
		if(recordSet1.next())
		{
		    String workPlanId = recordSet1.getString("workPlanId");
		    stringBuffer = new StringBuffer();
			stringBuffer.append("DELETE FROM WorkPlanShare WHERE id = ");
			stringBuffer.append(workPlanShareId);
			
			recordSet.executeSql(stringBuffer.toString());
			
			workPlanShare.setShareDetail(workPlanId);
			
			workPlanExchange.exchangeAdd(Integer.parseInt(workPlanId), userId, userType);  //\u6807\u8bc6\u65e5\u7a0b\u5df2\u88ab\u7f16\u8f91
			out.clearBuffer();
			out.print("{\"IsSuccess\":true}");
		}else{
			out.clearBuffer();
			out.print("{\"IsSuccess\":false}");
		}
	}else if("getSubordinate".equals(method)){
		List userList=new ArrayList();
		String cuserId=Util.null2String(request.getParameter("userId"));
		rs.executeProc("HrmResource_SelectByManagerID", cuserId);
		
		while(rs.next()){
			Map cuser=new HashMap();
			cuser.put("id",rs.getString("id"));
			cuser.put("name",resourceComInfo.getResourcename(rs.getString("id")));
			userList.add(cuser);
		}
		out.clearBuffer();
		out.println(JSONArray.fromObject(userList).toString());
	}


      out.write(_jsp_string2, 0, _jsp_string2.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("workplan/calendar/data/WorkPlanViewOperation.jsp"), -6562971199336119651L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string0;
  private final static char []_jsp_string3;
  private final static char []_jsp_string1;
  private final static char []_jsp_string2;
  static {
    _jsp_string0 = "\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string3 = "\r\n\r\n\r\n".toCharArray();
    _jsp_string1 = "\r\n".toCharArray();
    _jsp_string2 = "\r\n\r\n".toCharArray();
  }
}
