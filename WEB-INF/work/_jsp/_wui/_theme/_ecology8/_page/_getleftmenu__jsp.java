/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._wui._theme._ecology8._page;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import java.util.*;
import weaver.systeminfo.menuconfig.MenuMaint;
import weaver.hrm.HrmUserVarify;
import weaver.hrm.User;
import weaver.general.*;

public class _getleftmenu__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;

  
  	public String grtlftMenu(List elements, User user) {
  
  		if (elements == null) {
  			return "<ul></ul>";
  		}
  
  		//\u5de6\u4fa7\u83dc\u5355HTML
  		StringBuffer sfcm = new StringBuffer();
  		//---------------------------
  		// \u83dc\u5355\u9879\u80cc\u666f\u56fe\u7247\u968f\u673a\u663e\u793a
  		// bgcnt   : \u5de6\u4fa7\u83dc\u5355\u80cc\u666f\u56fe\u7247\u4e2a\u6570
  		// bgindex : \u5de6\u4fa7\u83dc\u5355\u80cc\u666f\u56fe\u7247\u968f\u673a\u7528\u4e0b\u6807
  		// abgs    : \u5de6\u4fa7\u83dc\u5355\u80cc\u666f\u56fe\u7247\u6570\u7ec4
  		//---------------------------
  		int bgcnt = 4;
  		int bgindex = 4;
  
  		String[] sbgPostions = new String[] { "0 -28", "0 -84", "0 0", "0 -56" };
  
  		sfcm.append("<ul>");
  		for (int licnter = 0; licnter < elements.size(); licnter++) {
  			Map map = (Map) elements.get(licnter);
  
  			bgindex++;
  
  			sfcm.append(getChildMenu(map, sbgPostions[bgindex % 4]));
  
  			String extra = Util.null2String((String) map.get("extra"));
  
  			if (extra != null && !"".equals(extra)) {
  
  			} else {
  				List chilList = (List) map.get("child");
  
  				if (chilList != null && !chilList.isEmpty()) {
  					String shtm = grtlftMenu(chilList, user);
  					sfcm.append(shtm);
  				}
  			}
  
  			sfcm.append("</li>");
  		}
  		sfcm.append("</ul>");
  
  		return sfcm.toString();
  
  	}
  
  	public String getChildMenu(Object obj, String sbgPosition) {
  		StringBuffer sfcm = new StringBuffer();
  		
  		if (!(obj instanceof Map)) {
  			return sfcm.toString();	
  		}
  		
  		Map map = (Map) obj;
  
  		//sfcm.append("<li><div style='width:100%;'> ");
  		sfcm.append("<li><div> ");
  		sfcm.append("<a id="+map.get("id")+" class='lfMenuItem' href='");
  		if (map.get("url") == null || map.get("url").toString().equals("")
  				|| map.get("url").toString().equals("#")) {
  			sfcm.append("javascript:void(0);");
  		} else {
  			sfcm.append(((String) map.get("url")).replaceAll("&#38;", "&"));
  		}
          String menuname=map.get("name").toString();
  		//sfcm.append("' style='background:url(").append(abg).append(") no-repeat;' ");
  		sfcm.append("' _bgPosition='" + sbgPosition + "'");
  		sfcm.append(" target='" + map.get("target") + "' title='" + menuname + "'>");
  		sfcm.append("<div class='leftMenuItemLeft' style='background-position:" + sbgPosition + ";'></div>");
  		sfcm.append("<div class='leftMenuItemCenter' style=''><span class='e8text'>");
  		sfcm.append(menuname);
  		sfcm.append("</span><span style='display:none;' class='iconImage'>")
  				 	.append(map.get("icon")).append("</span>");
  		sfcm.append("<span class='e8_number' id='num_"+map.get("levelid").toString()+"'></span>");
  		sfcm.append("</div>");
  		sfcm.append("<div class='leftMenuItemRight' style=''></div><div style='width:4px;display:none;'></div></a></div>");
  
  
  		return sfcm.toString();
  	}
  	
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      
		
	response.setHeader("cache-control", "no-cache");
	response.setHeader("pragma", "no-cache");
	response.setHeader("expires", "Mon 1 Jan 1990 00:00:00 GMT");
	
	
	User user = HrmUserVarify.getUser(request, response);
	MenuMaint mm = new MenuMaint("left", 3, user.getUID(), user.getLanguage());
	List topMenus = mm.getAllMenus(user, 0);

	for (int i = 0; i < topMenus.size(); i++) {
		Map mky = (Map) topMenus.get(i);

		String levelId = (String) mky.get("levelid");
		List childMenus = (List) mky.get("child");
		String strmhtms = "";
		String id =  (String) mky.get("id");
		if (mky.get("extra") == null) {

			int level = Integer.parseInt(levelId);
			String linkName = "";
			String linkAddr = "";
			strmhtms = grtlftMenu(childMenus, user);
			if (!"".equals(linkName) && !"".equals(linkAddr)) {
				String tmpLi = "<li>";
				tmpLi += "<a id="+id+" class='lfMenuItem' href='";
				tmpLi += linkAddr;
				tmpLi += "' _bgPosition='0 -28'";
				tmpLi += " target=\"mainFrame\" >";
				tmpLi += "<div class=\"leftMenuItemLeft\" style=\"background-position:0 -28;\"></div>";
				tmpLi += "<div class=\"leftMenuItemCenter\"; style=\"\">";
				tmpLi += linkName;
				tmpLi += "</div>";
				tmpLi += "<div class=\"leftMenuItemRight\" style=\"\"></div>";
				
				tmpLi += "<div style='width:4px;'></div></a>";
				tmpLi += "</li>";

				strmhtms = strmhtms.substring(0, 4) + tmpLi
						+ strmhtms.substring(4);
			}
		}
		out.write("menuMap.put('" + levelId + "', \""
				+ strmhtms.replaceAll("\"", "####") + "\");");
	}

      out.write(_jsp_string1, 0, _jsp_string1.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("wui/theme/ecology8/page/getLeftMenu.jsp"), -3062066032539871721L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string0;
  private final static char []_jsp_string1;
  static {
    _jsp_string0 = "\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string1 = "\r\n\r\n".toCharArray();
  }
}
