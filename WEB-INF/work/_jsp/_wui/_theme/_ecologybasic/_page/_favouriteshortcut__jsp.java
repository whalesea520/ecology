/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._wui._theme._ecologybasic._page;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import java.util.*;
import weaver.hrm.*;
import weaver.general.*;
import weaver.systeminfo.*;

public class _favouriteshortcut__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=UTF-8");
    request.setCharacterEncoding("UTF-8");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      weaver.conn.RecordSet farecordSet;
      farecordSet = (weaver.conn.RecordSet) pageContext.getAttribute("farecordSet");
      if (farecordSet == null) {
        farecordSet = new weaver.conn.RecordSet();
        pageContext.setAttribute("farecordSet", farecordSet);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.conn.RecordSet ttSet;
      ttSet = (weaver.conn.RecordSet) pageContext.getAttribute("ttSet");
      if (ttSet == null) {
        ttSet = new weaver.conn.RecordSet();
        pageContext.setAttribute("ttSet", ttSet);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.favourite.SysFavouriteInfo sysFavouriteInfo;
      sysFavouriteInfo = (weaver.favourite.SysFavouriteInfo) pageContext.getAttribute("sysFavouriteInfo");
      if (sysFavouriteInfo == null) {
        sysFavouriteInfo = new weaver.favourite.SysFavouriteInfo();
        pageContext.setAttribute("sysFavouriteInfo", sysFavouriteInfo);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      weaver.systeminfo.template.UserTemplate UsrTemplate;
      UsrTemplate = (weaver.systeminfo.template.UserTemplate) pageContext.getAttribute("UsrTemplate");
      if (UsrTemplate == null) {
        UsrTemplate = new weaver.systeminfo.template.UserTemplate();
        pageContext.setAttribute("UsrTemplate", UsrTemplate);
      }
      out.write(_jsp_string1, 0, _jsp_string1.length);
      
Set favouriteKeys = null;
Map favouriteMap = null;
User user = HrmUserVarify.getUser (request , response) ;
int userid = user.getUID();
String uploadPath = "/TemplateFile/";

      out.write(_jsp_string2, 0, _jsp_string2.length);
      out.print((SystemEnv.getHtmlLabelName(2081,user.getLanguage()) ));
      out.write(_jsp_string3, 0, _jsp_string3.length);
      out.print((SystemEnv.getHtmlLabelName(22248,user.getLanguage())));
      out.write(_jsp_string4, 0, _jsp_string4.length);
      
	String tesql = "";
	tesql = "select top 20 a.* "
			+ " from sysfavourite a, sysfavourite_favourite b "
			+ " where a.resourceid =" + userid
			+ " and a.id = b.sysfavouriteid and b.favouriteid=-1 order by importlevel desc,adddate desc,a.id desc";
	
	String dbtype = farecordSet.getDBType();
	if(dbtype.equals("oracle"))
	{
				 tesql = " select *   from (SELECT *   FROM (SELECT A.*, ROWNUM RN  FROM (select a.id, rownum   from sysfavourite a  "
  + " left join sysfavourite_favourite b on a.id =   b.sysfavouriteid   where a.resourceid = "+userid
   + " and b.favouriteid = -1   order by a.importlevel desc,    a.adddate "
    + " desc,    a.id          desc) A   WHERE ROWNUM < 20)   WHERE RN >= 0) c   left join sysfavourite_favourite d on "
     + " c.id = d.sysfavouriteid left join sysfavourite e on c.id=e.id order by importlevel desc,adddate desc,c.id desc ";


	}
	
	farecordSet.execute(tesql);
	int favCount = 0;
	while (farecordSet.next())
	{
		String pagename = farecordSet.getString("Pagename");
		String url = farecordSet.getString("URL");
		String favouritetype = farecordSet.getString("favouritetype");
		favouritetype = sysFavouriteInfo.getFavouriteTypeImage(favouritetype);
		int length = pagename.length();
		//pagename = pagename.replaceAll("&nbsp;", "");
		if(length<=25)
		{
			int addspace = 25-length;
			for(int j=0;j<addspace;j++)
			{
				//pagename+="&nbsp;";
			}
			pagename = Util.toHtml5(pagename);
		}
		else
		{
			pagename = pagename.substring(0, 25);
			pagename = Util.toHtml5(pagename);
			pagename+="...";
		}

      out.write(_jsp_string5, 0, _jsp_string5.length);
      out.print((url));
      out.write(_jsp_string6, 0, _jsp_string6.length);
      out.print((favouritetype ));
      out.write(_jsp_string7, 0, _jsp_string7.length);
      out.print((pagename ));
      out.write(_jsp_string8, 0, _jsp_string8.length);
      
}

      out.write(_jsp_string1, 0, _jsp_string1.length);
      
	String ttsql = " select * from favourite where resourceid="+userid+" order by displayorder,adddate desc ";
	ttSet.executeSql(ttsql);
	
	while (ttSet.next())
	{
		String favouriteid = Util.null2String(ttSet.getString("id"));
		String favouritename = Util.null2String(ttSet.getString("favouritename"));
		int tlength = favouritename.length();
		favouritename = favouritename.replaceAll("&nbsp", "");
		if(tlength<=25)
		{
			int addspace = 25-tlength;
			for(int j=0;j<addspace;j++)
			{
				//favouritename+="&nbsp;";
			}
			favouritename = Util.toHtml5(favouritename);
		}
		else
		{
			favouritename = favouritename.substring(0, 25);
			favouritename = Util.toHtml5(favouritename);
			favouritename+="...";
		}

      out.write(_jsp_string9, 0, _jsp_string9.length);
      out.print((favouritename ));
      out.write(_jsp_string10, 0, _jsp_string10.length);
      
 				String tsql = "select b.* from sysfavourite_favourite a,sysfavourite b"
			+ " where a.favouriteid="
			+ favouriteid
			+ " and a.sysfavouriteid=b.id and a.resourceid=b.resourceid and a.resourceid="
			+ userid
			+ " order by importlevel desc,adddate desc,b.id desc";
		farecordSet.executeSql(tsql);
		if (farecordSet.first())
		{
			farecordSet.beforFirst();
			while (farecordSet.next())
			{
				String url = farecordSet.getString("url");
				String temppagename = farecordSet.getString("pagename");
				String pagename = farecordSet.getString("pagename");
				String favouritetype = farecordSet.getString("favouritetype");
				favouritetype = sysFavouriteInfo.getFavouriteTypeImage(favouritetype);
				int length = temppagename.length();
				temppagename = temppagename.replaceAll("&nbsp", "\uff06nbsp");
				if(length<=25)
				{
					int addspace = 25-length;
					for(int j=0;j<addspace;j++)
					{
						//temppagename+="&nbsp;";
					}
					temppagename = Util.toHtml5(temppagename);
				}
				else
				{
					temppagename = pagename.substring(0, 25);
					temppagename = Util.toHtml5(temppagename);
					temppagename+="...";
				}

      out.write(_jsp_string11, 0, _jsp_string11.length);
      out.print((url));
      out.write(_jsp_string6, 0, _jsp_string6.length);
      out.print((favouritetype ));
      out.write(_jsp_string7, 0, _jsp_string7.length);
      out.print((temppagename ));
      out.write(_jsp_string8, 0, _jsp_string8.length);
      
			}
		}
		else
		{
			String temppagename = SystemEnv.getHtmlLabelName(22249,user.getLanguage())+"";
		
      out.write(_jsp_string12, 0, _jsp_string12.length);
      out.print((temppagename ));
      out.write(_jsp_string13, 0, _jsp_string13.length);
      		
		}
		
      out.write(_jsp_string14, 0, _jsp_string14.length);
      
	}

      out.write(_jsp_string15, 0, _jsp_string15.length);
      out.print((SystemEnv.getHtmlLabelName(17499,user.getLanguage()) ));
      out.write(_jsp_string16, 0, _jsp_string16.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("wui/theme/ecologyBasic/page/FavouriteShortCut.jsp"), 3880426482403473638L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string7;
  private final static char []_jsp_string4;
  private final static char []_jsp_string3;
  private final static char []_jsp_string2;
  private final static char []_jsp_string15;
  private final static char []_jsp_string6;
  private final static char []_jsp_string16;
  private final static char []_jsp_string5;
  private final static char []_jsp_string0;
  private final static char []_jsp_string14;
  private final static char []_jsp_string8;
  private final static char []_jsp_string10;
  private final static char []_jsp_string9;
  private final static char []_jsp_string1;
  private final static char []_jsp_string12;
  private final static char []_jsp_string13;
  private final static char []_jsp_string11;
  static {
    _jsp_string7 = "\">&nbsp;".toCharArray();
    _jsp_string4 = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></li>\r\n  	".toCharArray();
    _jsp_string3 = "</a>\r\n  	<ul id=\"contentUl\">\r\n  		<li><a href=\"/favourite/ManageFavourite.jsp\" target=\"mainFrame\"><img alt=\"\" src=\"/images_face/ecologyFace_2/LeftMenuIcon/favs_wev8.gif\">&nbsp;".toCharArray();
    _jsp_string2 = "\r\n<link rel=\"stylesheet\" href=\"/wui/common/js/MenuMatic/css/MenuMatic_wev8.css\" type=\"text/css\" media=\"screen\" charset=UTF-8 />\r\n<script src=\"/wui/common/jquery/jquery_wev8.js\"></script>\r\n<script src=\"/wui/common/js/MenuMatic/js/mootools-yui-compressed_wev8.js\"></script>\r\n<script src=\"/wui/common/js/MenuMatic/js/MenuMatic_0.68.3-source_wev8.js\" type=\"text/javascript\"></script>\r\n\r\n <ul id=\"navFav\">\r\n <li id=\"favLi\"> \r\n	<a href=\"#\" >".toCharArray();
    _jsp_string15 = "\r\n	</ul>\r\n   </li>\r\n</ul>\r\n<li id=\"moreLi\" style='display:none'><a href=\"/favourite/ManageFavourite.jsp\" target=\"mainFrame\"><img alt=\"\" src=\"/images_face/ecologyFace_2/LeftMenuIcon/more_wev8.png\">&nbsp;".toCharArray();
    _jsp_string6 = "');\"><img alt=\"\" src=\"".toCharArray();
    _jsp_string16 = "</a></li>\r\n<style type=\"text/css\" media=\"all\">\r\n	a img\r\n	{ \r\n		border:none;\r\n	}\r\n</style>\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\njQuery(document).ready(function(){\r\n	var myMenu = new MenuMatic();\r\n})\r\n\r\n</SCRIPT>\r\n\r\n".toCharArray();
    _jsp_string5 = "\r\n	\r\n	<li><a href=\"javascript:void(0)\" onclick=\"openFullWindowForLong('".toCharArray();
    _jsp_string0 = "\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string14 = "\r\n 			</ul>\r\n 		</li>\r\n".toCharArray();
    _jsp_string8 = "</a></li>\r\n".toCharArray();
    _jsp_string10 = "</a>\r\n 			<ul>\r\n 			".toCharArray();
    _jsp_string9 = "\r\n 		<li>\r\n 			<a href=\"#\"><img alt=\"\" src=\"/images/folder.small_wev8.png\">&nbsp;".toCharArray();
    _jsp_string1 = "\r\n".toCharArray();
    _jsp_string12 = "\r\n	\r\n			  <li><a href=\"#\">".toCharArray();
    _jsp_string13 = "</a></li>\r\n		".toCharArray();
    _jsp_string11 = "\r\n\r\n				 <li><a href=\"javascript:void(0)\" onclick=\"openFullWindowForLong('".toCharArray();
  }
}
