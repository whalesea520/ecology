/*
 * JSP generated by Resin-3.1.8 (built Mon, 17 Nov 2008 12:15:21 PST)
 */

package _jsp._mobile._plugin._plus._browser;
import javax.servlet.*;
import javax.servlet.jsp.*;
import javax.servlet.http.*;
import java.util.*;
import weaver.hrm.*;
import weaver.systeminfo.*;
import weaver.general.StaticObj;
import weaver.general.Util;
import weaver.hrm.settings.RemindSettings;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import weaver.general.*;
import weaver.hrm.company.DepartmentComInfo;
import weaver.hrm.company.SubCompanyComInfo;
import weaver.hrm.job.JobTitlesComInfo;
import weaver.hrm.resource.ResourceComInfo;
import net.sf.json.JSONArray;
import net.sf.json.JSONObject;
import weaver.hrm.company.CompanyComInfo;
import weaver.wxinterface.WxInterfaceInit;
import weaver.wxinterface.WxModuleInit;
import weaver.wxinterface.FormatMultiLang;
import weaver.file.Prop;

public class _hrmbrowser__jsp extends com.caucho.jsp.JavaPage
{
  private static final java.util.HashMap<String,java.lang.reflect.Method> _jsp_functionMap = new java.util.HashMap<String,java.lang.reflect.Method>();
  private boolean _caucho_isDead;
  
  public void
  _jspService(javax.servlet.http.HttpServletRequest request,
              javax.servlet.http.HttpServletResponse response)
    throws java.io.IOException, javax.servlet.ServletException
  {
    javax.servlet.http.HttpSession session = request.getSession(true);
    com.caucho.server.webapp.WebApp _jsp_application = _caucho_getApplication();
    javax.servlet.ServletContext application = _jsp_application;
    com.caucho.jsp.PageContextImpl pageContext = _jsp_application.getJspApplicationContext().allocatePageContext(this, _jsp_application, request, response, null, session, 8192, true, false);
    javax.servlet.jsp.PageContext _jsp_parentContext = pageContext;
    javax.servlet.jsp.JspWriter out = pageContext.getOut();
    final javax.el.ELContext _jsp_env = pageContext.getELContext();
    javax.servlet.ServletConfig config = getServletConfig();
    javax.servlet.Servlet page = this;
    response.setContentType("text/html; charset=GBK");
    request.setCharacterEncoding("GBK");
    try {
      out.write(_jsp_string0, 0, _jsp_string0.length);
      
	
	response.setHeader("cache-control", "no-cache");
	response.setHeader("pragma", "no-cache");
	response.setHeader("expires", "Mon 1 Jan 1990 00:00:00 GMT");
	

	User user = HrmUserVarify.getUser (request , response) ;
	if(user == null)  return ;
	Log logger= LogFactory.getLog(this.getClass());
	String isIE = (String)session.getAttribute("browser_isie");

      out.write(_jsp_string1, 0, _jsp_string1.length);
      
	if(user.getLanguage()==8){
		request.getRequestDispatcher("/mobile/plugin/plus/browser/hrmBrowser_en.jsp?"+request.getQueryString()).forward(request, response);
		return;
	}
	//\u4f1a\u8bae\u65e5\u7a0b\u7b49\u9009\u4eba\u9875\u9762\u5f3a\u5236\u4f7f\u7528UTF-8\u683c\u5f0f\u7f16\u7801 zhw 20160426\u589e\u52a0
	int ifutf8 = Util.getIntValue(request.getParameter("ifutf8"),0);
	//\u5224\u65ad\u7f16\u7801
	if(WxInterfaceInit.isIsutf8()){
		response.setContentType("text/html;charset=UTF-8");
	}
	boolean isNoHeader = Util.null2String((String)request.getParameter("noHeader")).equals("1");	//\u662f\u5426\u4e0d\u5305\u542b\u5934\u90e8
	String fieldId = Util.null2String((String)request.getParameter("fieldId"));	//\u5b57\u6bb5id
	String fieldSpanId = Util.null2String((String)request.getParameter("fieldSpanId"));	//\u5b57\u6bb5\u663e\u793a\u533a\u57dfid
	String selectedIds = Util.null2String((String)request.getParameter("selectedIds"));	//\u9009\u4e2d\u7684id\uff0c\u9017\u53f7\u5206\u9694\uff0c\u5982\uff1a1,2,3
	String browserType = Util.null2String((String)request.getParameter("browserType"));	//1.\u591a\u9009  2.\u5355\u9009
	if("".equals(browserType)) browserType = "1";
	String showType = Util.null2String((String)request.getParameter("showType"));	//1.\u6240\u6709\u4eba \uff0c2.\u7ec4\u7ec7\u67b6\u6784\uff0c3\uff0c\u5e38\u7528\u7ec4 4\u6700\u8fd1\u8054\u7cfb\u4eba,5\u540c\u90e8\u95e8
	if("".equals(showType)) {
		if(WxModuleInit.ifLastContract){
			showType = "4";
		}else{
			showType = "1";
		}
	}
	String showTypeName = "\u6240\u6709\u4eba";
	String showTypeClassName = "hrm";
	if(showType.equals("1")){
		showTypeName = "\u6240\u6709\u4eba";
		showTypeClassName = "hrm";
	}else if(showType.equals("2")){
		showTypeName = "\u7ec4\u7ec7\u67b6\u6784";
		showTypeClassName = "org";
	}else if(showType.equals("3")){
		showTypeName = "\u5e38\u7528\u7ec4";
		showTypeClassName = "group";
	}else if(showType.equals("4")){
		showTypeName = "\u5e38\u7528\u4eba";
		showTypeClassName = "lasthrm";
	}else if(showType.equals("5")){
		showTypeName = "\u540c\u90e8\u95e8";
		showTypeClassName = "dept";
	}
	
	JSONArray selectedArr = new JSONArray();
	if(!selectedIds.trim().equals("")){
		ResourceComInfo resourceComInfo = new ResourceComInfo();
		DepartmentComInfo departmentComInfo = new DepartmentComInfo();
		SubCompanyComInfo subCompanyComInfo = new SubCompanyComInfo();
		JobTitlesComInfo jobTitlesComInfo = new JobTitlesComInfo();
		
		String[] selectedIdArr = selectedIds.split(",");
		for(String selectedId : selectedIdArr){
			if(!selectedId.trim().equals("")){
				
				String lastname = resourceComInfo.getLastname(selectedId);	//\u59d3\u540d
				String subCompanyID = resourceComInfo.getSubCompanyID(selectedId);	//\u5206\u90e8id
				String subCompanyName = subCompanyComInfo.getSubCompanyname(subCompanyID);	//\u5206\u90e8\u540d\u79f0
				
				String departmentID = resourceComInfo.getDepartmentID(selectedId);	//\u90e8\u95e8id
				String departmentName = departmentComInfo.getDepartmentname(departmentID);	//\u90e8\u95e8\u540d\u79f0
				
				String jobTitle = resourceComInfo.getJobTitle(selectedId);	//\u5c97\u4f4did
				String jobTitlesName = jobTitlesComInfo.getJobTitlesname(jobTitle);	//\u5c97\u4f4d\u540d\u79f0
				
				JSONObject selectedObj = new JSONObject();
				selectedObj.put("id", selectedId);	//id
				selectedObj.put("lastname", FormatMultiLang.formatByUserid(lastname,user.getUID()+""));	//\u59d3\u540d
				selectedObj.put("subCompanyName", FormatMultiLang.formatByUserid(subCompanyName,user.getUID()+""));	//\u5206\u90e8\u540d\u79f0
				selectedObj.put("departmentName", FormatMultiLang.formatByUserid(departmentName,user.getUID()+""));	//\u90e8\u95e8\u540d\u79f0
				selectedObj.put("jobTitlesName", FormatMultiLang.formatByUserid(jobTitlesName,user.getUID()+""));	//\u5c97\u4f4d\u540d\u79f0
				selectedArr.add(selectedObj);
			}
		}
	}
	
	CompanyComInfo companyComInfo = new CompanyComInfo();
	String companyname = FormatMultiLang.formatByUserid(companyComInfo.getCompanyname("1"),user.getUID()+"");	//\u516c\u53f8\u540d\u79f0
	
	//\u91d1\u6d77\u73af\u5883\u6280\u672f\u4e8c\u6b21\u5f00\u53d1 \u5c4f\u853d\u7ec4\u7ec7\u7ed3\u6784\u9009\u62e9 zhw 20161222
	int ifShowDept = Util.getIntValue(Prop.getPropValue("wx_hrmbrowser","ifshowdept"),1);//1\u663e\u793a 0\u4e0d\u663e\u793a
	//B\u7ad9 \u53ea\u663e\u793a\u6240\u6709\u4eba
	int ifOnlyShowAllUser = Util.getIntValue(Prop.getPropValue("wx_hrmbrowser","ifOnlyShowAllUser"),0);//0\u663e\u793a\u5168\u90e8 1\u53ea\u663e\u793a\u6240\u6709\u4eba
	int ifBsite = Util.getIntValue(Prop.getPropValue("wx_hrmbrowser","ifBsite"),0);//\u662f\u5426\u662fB\u7ad9\u5ba2\u6237

      out.write(_jsp_string2, 0, _jsp_string2.length);
      out.print((browserType));
      out.write(_jsp_string3, 0, _jsp_string3.length);
      out.print((selectedArr));
      out.write(_jsp_string4, 0, _jsp_string4.length);
      out.print((fieldId));
      out.write(_jsp_string5, 0, _jsp_string5.length);
      out.print((fieldSpanId));
      out.write(_jsp_string6, 0, _jsp_string6.length);
      out.print((ifOnlyShowAllUser));
      out.write(_jsp_string7, 0, _jsp_string7.length);
      out.print((ifBsite));
      out.write(_jsp_string8, 0, _jsp_string8.length);
      out.print((showTypeName));
      out.write(_jsp_string9, 0, _jsp_string9.length);
      if(WxModuleInit.ifLastContract){
      out.write(_jsp_string10, 0, _jsp_string10.length);
      } 
      out.write(_jsp_string11, 0, _jsp_string11.length);
       if(isNoHeader){ 
      out.write(_jsp_string12, 0, _jsp_string12.length);
       } 
      out.write(_jsp_string13, 0, _jsp_string13.length);
       if(!isNoHeader){ 
      out.write(_jsp_string14, 0, _jsp_string14.length);
      out.print((showTypeName));
      out.write(_jsp_string15, 0, _jsp_string15.length);
       } 
      out.write(_jsp_string16, 0, _jsp_string16.length);
      out.print((showTypeClassName));
      out.write(_jsp_string17, 0, _jsp_string17.length);
      if(WxModuleInit.ifLastContract){ 
      out.write(_jsp_string18, 0, _jsp_string18.length);
      } 
      out.write(_jsp_string19, 0, _jsp_string19.length);
      out.print((companyname));
      out.write(_jsp_string20, 0, _jsp_string20.length);
      out.print((showTypeClassName));
      out.write(_jsp_string21, 0, _jsp_string21.length);
      out.print((showTypeName));
      out.write(_jsp_string22, 0, _jsp_string22.length);
      if(WxModuleInit.ifLastContract){ 
      out.write(_jsp_string23, 0, _jsp_string23.length);
      } 
      out.write(_jsp_string24, 0, _jsp_string24.length);
      if(ifShowDept==1){ 
      out.write(_jsp_string25, 0, _jsp_string25.length);
      } 
      out.write(_jsp_string26, 0, _jsp_string26.length);
    } catch (java.lang.Throwable _jsp_e) {
      pageContext.handlePageException(_jsp_e);
    } finally {
      _jsp_application.getJspApplicationContext().freePageContext(pageContext);
    }
  }

  private java.util.ArrayList _caucho_depends = new java.util.ArrayList();

  public java.util.ArrayList _caucho_getDependList()
  {
    return _caucho_depends;
  }

  public void _caucho_addDepend(com.caucho.vfs.PersistentDependency depend)
  {
    super._caucho_addDepend(depend);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  public boolean _caucho_isModified()
  {
    if (_caucho_isDead)
      return true;
    if (com.caucho.server.util.CauchoSystem.getVersionId() != 1886798272571451039L)
      return true;
    for (int i = _caucho_depends.size() - 1; i >= 0; i--) {
      com.caucho.vfs.Dependency depend;
      depend = (com.caucho.vfs.Dependency) _caucho_depends.get(i);
      if (depend.isModified())
        return true;
    }
    return false;
  }

  public long _caucho_lastModified()
  {
    return 0;
  }

  public java.util.HashMap<String,java.lang.reflect.Method> _caucho_getFunctionMap()
  {
    return _jsp_functionMap;
  }

  public void init(ServletConfig config)
    throws ServletException
  {
    com.caucho.server.webapp.WebApp webApp
      = (com.caucho.server.webapp.WebApp) config.getServletContext();
    super.init(config);
    com.caucho.jsp.TaglibManager manager = webApp.getJspApplicationContext().getTaglibManager();
    com.caucho.jsp.PageContextImpl pageContext = new com.caucho.jsp.PageContextImpl(webApp, this);
  }

  public void destroy()
  {
      _caucho_isDead = true;
      super.destroy();
  }

  public void init(com.caucho.vfs.Path appDir)
    throws javax.servlet.ServletException
  {
    com.caucho.vfs.Path resinHome = com.caucho.server.util.CauchoSystem.getResinHome();
    com.caucho.vfs.MergePath mergePath = new com.caucho.vfs.MergePath();
    mergePath.addMergePath(appDir);
    mergePath.addMergePath(resinHome);
    com.caucho.loader.DynamicClassLoader loader;
    loader = (com.caucho.loader.DynamicClassLoader) getClass().getClassLoader();
    String resourcePath = loader.getResourcePathSpecificFirst();
    mergePath.addClassPath(resourcePath);
    com.caucho.vfs.Depend depend;
    depend = new com.caucho.vfs.Depend(appDir.lookup("mobile/plugin/plus/browser/hrmBrowser.jsp"), -13996439190190318L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
    depend = new com.caucho.vfs.Depend(appDir.lookup("page/maint/common/initNoCache.jsp"), 3270256153856711871L, false);
    com.caucho.jsp.JavaPage.addDepend(_caucho_depends, depend);
  }

  private final static char []_jsp_string18;
  private final static char []_jsp_string19;
  private final static char []_jsp_string14;
  private final static char []_jsp_string12;
  private final static char []_jsp_string20;
  private final static char []_jsp_string2;
  private final static char []_jsp_string22;
  private final static char []_jsp_string26;
  private final static char []_jsp_string10;
  private final static char []_jsp_string25;
  private final static char []_jsp_string24;
  private final static char []_jsp_string11;
  private final static char []_jsp_string7;
  private final static char []_jsp_string21;
  private final static char []_jsp_string8;
  private final static char []_jsp_string23;
  private final static char []_jsp_string0;
  private final static char []_jsp_string5;
  private final static char []_jsp_string15;
  private final static char []_jsp_string6;
  private final static char []_jsp_string1;
  private final static char []_jsp_string3;
  private final static char []_jsp_string4;
  private final static char []_jsp_string13;
  private final static char []_jsp_string9;
  private final static char []_jsp_string17;
  private final static char []_jsp_string16;
  static {
    _jsp_string18 = "\r\n				<div id=\"list-lasthrm-container\" class=\"data-container lasthrm-container\">\r\n					<div id=\"list-lasthrm-content\" class=\"hrmitem\">\r\n						<div class=\"group-wrap\"></div>\r\n					</div>\r\n				</div>\r\n				".toCharArray();
    _jsp_string19 = "\r\n				<div id=\"list-group-container\" class=\"data-container group-container\">\r\n					<div id=\"list-group-content\" class=\"hrmitem\">\r\n						<div class=\"group-wrap\" id=\"group_group_wrap\"></div>\r\n					</div>\r\n				</div>\r\n				\r\n				<div id=\"tree-org-container\" class=\"data-container org-container\">\r\n					<ul class=\"tree-page root-tree-page\">\r\n						<li>\r\n							<div class=\"one-tree-data company-data closed\" data-id=\"1\" data-type=\"1\" data-haschild=\"1\">".toCharArray();
    _jsp_string14 = "\r\n	<div id=\"page-title\">\r\n		<div id=\"nav-header\">\r\n			<div class=\"header-left\"></div>\r\n			<div class=\"header-center\">".toCharArray();
    _jsp_string12 = "\r\n<style type=\"text/css\">\r\n#page-center{\r\n	top: 0px;\r\n}\r\n</style>\r\n".toCharArray();
    _jsp_string20 = "</div>\r\n						</li>\r\n					</ul>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		\r\n		<div id=\"center-footer\">\r\n			<div id=\"choosedResult\">\r\n				\u5df2\u9009(<span id=\"selectedNum\">0</span>)\r\n			</div>\r\n			\r\n			<div id=\"okResult\">\r\n				\u786e&nbsp;\u5b9a\r\n			</div>\r\n		</div>\r\n		\r\n		<div id=\"page-control\" class=\"".toCharArray();
    _jsp_string2 = "\r\n<html>\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0\">\r\n<meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\r\n<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\">\r\n\r\n<script type=\"text/javascript\">\r\nvar _browserType = \"".toCharArray();
    _jsp_string22 = "\r\n			</div>\r\n		</div>\r\n		".toCharArray();
    _jsp_string26 = "\r\n		<div id=\"control-group\" class=\"control-part\">\r\n			<div class=\"icon\"></div>\r\n			<div class=\"text\">\u5e38\u7528\u7ec4</div>\r\n		</div>\r\n		\r\n		<div id=\"page-mask\">\r\n			\r\n		</div>\r\n		\r\n		<div id=\"selected-result-page\">\r\n			<div id=\"result-center\">\r\n				<div id=\"result-center-inner\">\r\n					\r\n					<div id=\"result-hrm-container\">\r\n						<div id=\"result-hrm-srarch\">\r\n							<div class=\"srarch-inner\">\r\n								<div class=\"search-holder\"></div>\r\n								<input type=\"search\" id=\"result-search-key\" />\r\n							</div>\r\n						</div>\r\n						\r\n						<div id=\"result-hrm-content\">\r\n							<div id=\"result-data\">\r\n							</div>\r\n						</div>\r\n					</div>\r\n				\r\n				</div>\r\n			</div>\r\n			<div id=\"result-footer\">\r\n				<div id=\"backResult\">\r\n					\u8fd4&nbsp;\u56de\r\n				</div>\r\n				<div id=\"clearResult\">\r\n					\u6e05&nbsp;\u7a7a\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n</body>\r\n</html>".toCharArray();
    _jsp_string10 = "\r\n	//\u521d\u59cb\u5316\u5e38\u7528\u8054\u7cfb\u4eba\r\n	initLastHrm();\r\n	".toCharArray();
    _jsp_string25 = "\r\n		<div id=\"control-org\" class=\"control-part\">\r\n			<div class=\"icon\"></div>\r\n			<div class=\"text\">\u7ec4\u7ec7\u67b6\u6784</div>\r\n		</div>\r\n		".toCharArray();
    _jsp_string24 = "\r\n		<div id=\"control-dept\" class=\"control-part\">\r\n			<div class=\"icon\"></div>\r\n			<div class=\"text\">\u540c\u90e8\u95e8</div>\r\n		</div>\r\n		<div id=\"control-hrm\" class=\"control-part\">\r\n			<div class=\"icon\"></div>\r\n			<div class=\"text\">\u6240\u6709\u4eba</div>\r\n		</div>\r\n		".toCharArray();
    _jsp_string11 = "\r\n	//\u521d\u59cb\u5316\u540c\u90e8\u95e8\r\n	initDept();\r\n	\r\n	initSearch();\r\n	\r\n	initPageControl();\r\n	\r\n	initHeader();\r\n	\r\n	searchListData();\r\n	\r\n	initGroupData();\r\n	\r\n	$(\"#list-loadMore\").click(function(){\r\n		var $this = $(this);\r\n		$this.addClass(\"click\");\r\n		setTimeout(function(){\r\n			$this.removeClass(\"click\");\r\n			searchListDataMore();\r\n		},300);\r\n	});\r\n	\r\n	var $rootTreePage = $(\"#tree-org-container .root-tree-page\");\r\n	bindTreeEvt($rootTreePage);\r\n	var $rootTreeData = $rootTreePage.children(\"li\").children(\".one-tree-data\");\r\n	$rootTreeData.trigger(\"click\");\r\n	\r\n	$(\"#result-hrm-content\").click(function(e){\r\n		$(\"li.beDelete\", this).removeClass(\"beDelete\");\r\n	});	\r\n	$(\"#clearResult\").click(function(e){\r\n		//\u5220\u9664\u6570\u636e\r\n		clearSelectedArr();\r\n		//\u5237\u65b0\u5e95\u90e8\u9009\u4e2d\u4e2a\u6570\r\n		refreshSelectedNum();\r\n		//\u53d6\u6d88\u9875\u9762\u6570\u636e\u7684\u9009\u4e2d\u72b6\u6001\r\n		deCheckedAllOnPage();\r\n		\r\n		//\u9875\u9762\u4e0a\u5220\u9664\r\n		var $oneData = $(\"#result-data .one-data\");\r\n		$oneData.addClass(\"deleted\");\r\n		setTimeout(function(){\r\n			$oneData.remove();\r\n		},500);\r\n	});\r\n	\r\n	initSelectedResultSearch();\r\n});\r\n\r\nvar prevSearchKey = \"\";\r\nfunction initSearch(){\r\n	var $searchKey = $(\"#search-key\");\r\n	var $srarchInner = $(\"#list-hrm-srarch .srarch-inner\");\r\n	$(\".search-holder\", $srarchInner).click(function(){\r\n		searchListData();\r\n	});\r\n	/*\r\n	$searchKey.blur(function(){\r\n		if(this.value == \"\"){\r\n			$srarchInner.removeClass(\"searching\");\r\n		}\r\n	}); \r\n	\r\n	$searchKey.bind(\"input\", function(){\r\n		var currSearchKey = this.value;\r\n		if(currSearchKey != prevSearchKey){\r\n			prevSearchKey = currSearchKey;\r\n			searchListData();\r\n		}\r\n		\r\n	});*/\r\n}\r\n\r\nfunction clearSearch(){\r\n	var $searchKey = $(\"#search-key\");\r\n	var v = $searchKey.val();\r\n	if(v != \"\"){\r\n		$searchKey.val(\"\");\r\n		$searchKey.trigger(\"blur\");\r\n		$searchKey.trigger(\"input\");\r\n	}\r\n	\r\n}\r\n\r\nfunction initGroupData(){\r\n	var url = \"/mobile/plugin/plus/browser/hrmBrowserAction.jsp?action=getGroupData\";\r\n	$.get(url,null, function(responseText){\r\n		var data;\r\n		if($.isPlainObject(responseText)){\r\n			data = responseText;\r\n		}else{\r\n			data = $.parseJSON(responseText);\r\n		}\r\n		var status = data[\"status\"];\r\n		if(status == \"1\"){\r\n			var datas = data[\"datas\"];\r\n			var temp = \"\";\r\n			if(datas.length>0){\r\n				for(var i = 0; i < datas.length; i++){\r\n					var data = datas[i];\r\n					var id = data[\"id\"];\r\n					var name = data[\"name\"];\r\n					temp+=\"<div class='group'><div class='group-title2 closed' groupid='\"+id+\"'>\"+name+\"</div></div>\";\r\n				}\r\n			}else{\r\n				temp=\"<div style='width:100%;height:30px;line-height:30px;font-weight: bold;text-align:center;color:#999;margin-top:10px;'>\u6682\u65e0\u76f8\u5173\u5e38\u7528\u7ec4\u6570\u636e</div>\";\r\n			}\r\n			$(\"#group_group_wrap\").html(temp);\r\n			bindGroupEvt();\r\n		}else{\r\n			var errMsg = data[\"errMsg\"];\r\n			$(\"#list-group-content > .group-wrap\").append(\"\u52a0\u8f7d\u6570\u636e\u65f6\u51fa\u73b0\u9519\u8bef\uff1a\" + errMsg);\r\n		}\r\n	});\r\n}\r\n\r\nfunction bindGroupEvt(){\r\n	$(\".group-title2\", $(\"#group_group_wrap\")).click(function(){\r\n		var ul = $(this).parent().find(\".group-data\");\r\n		if($(this).hasClass(\"closed\")){\r\n			$(this).removeClass(\"closed\");\r\n			$(this).addClass(\"opened\");\r\n			if(ul.length>0){\r\n				ul.show();\r\n			}else{\r\n				var obj = $(this);\r\n				var groupid = $(this).attr(\"groupid\");\r\n				var url = \"/mobile/plugin/plus/browser/hrmBrowserAction.jsp?action=getGroupMembers\";\r\n				$.get(url,{\"groupid\":groupid}, function(responseText){\r\n					var data;\r\n					if($.isPlainObject(responseText)){\r\n						data = responseText;\r\n					}else{\r\n						data = $.parseJSON(responseText);\r\n					}\r\n					var status = data[\"status\"];\r\n					if(status == \"1\"){\r\n						var datas = data[\"datas\"];\r\n						var $ul = $(\"<ul class=\\\"group-data muti\\\"></ul>\");\r\n						for(var i = 0; i < datas.length; i++){\r\n							var data = datas[i];\r\n							var id = data[\"id\"];	//\u4eba\u5458id\r\n							var lastname = data[\"lastname\"];	//\u59d3\u540d\r\n							var departmentName = data[\"departmentName\"];	//\u90e8\u95e8\u540d\u79f0\r\n							var jobTitlesName = data[\"jobTitlesName\"];	//\u5c97\u4f4d\u540d\u79f0\r\n							var subCompanyName = data[\"subCompanyName\"]	//\u5206\u90e8\u540d\u79f0\r\n							var messagerurl = data[\"messagerurl\"]	//\u5934\u50cf\r\n							var checkedStr = (indexOfSelectedArr(id) == -1) ? \"\" : \"checked=\\\"checked\\\"\";\r\n							var $li =$(\"<li class=\\\"one-data\\\"></li>\");\r\n							$li.append(\"<input type=\\\"checkbox\\\" class=\\\"valueHolder\\\" name=\\\"checkbox_hrm\\\" hrmId=\\\"\"+id+\"\\\" value=\\\"\"+id+\"\\\" \"+checkedStr+\"/>\"+\r\n											\"<div class=\\\"data-inner\\\">\"+\r\n												\"<div class=\\\"data-avatar\\\">\"+\r\n													\"<div>\"+(messagerurl!=\"\"?\"<img src=\\\"\"+messagerurl+\"\\\" style=\\\"width:100%;height:100%;\\\" />\":\"\")+\"</div>\"+\r\n												\"</div>\"+\r\n												\"<div class=\\\"data-part1\\\">\"+\r\n													\"<div class=\\\"data-lastname\\\">\"+lastname+\"</div>\"+\r\n													\"<div class=\\\"data-subCompany\\\">\"+subCompanyName+\"</div>\"+\r\n												\"</div>\"+\r\n												\"<div class=\\\"data-part2\\\">\"+\r\n													\"<div class=\\\"data-jobTitle\\\">\"+jobTitlesName+\"</div>\"+\r\n													\"<div class=\\\"data-department\\\">\"+departmentName+\"</div>\"+\r\n												\"</div>\"+\r\n											\"</div>\");\r\n							$ul.append($li);\r\n							$(\".valueHolder\", $li).attr(\"hrm_data\", JSON.stringify(data));\r\n							$li.cssCheckBox();\r\n						}\r\n						obj.after($ul);\r\n					}else{\r\n						var errMsg = data[\"errMsg\"];\r\n						obj.append(\"\u52a0\u8f7d\u6570\u636e\u65f6\u51fa\u73b0\u9519\u8bef\uff1a\" + errMsg);\r\n					}\r\n				});\r\n			}\r\n		}else{\r\n			$(this).removeClass(\"opened\");\r\n			$(this).addClass(\"closed\");\r\n			if(ul.length>0){\r\n				ul.hide();\r\n			}\r\n		}\r\n	});\r\n}\r\n\r\nvar currPgNo = 1;\r\nvar pageSize = 50;\r\nvar pageCount = 0;\r\n\r\nfunction doSearch(){\r\n	$(\"#list-loadMore\").hide();\r\n	$(\"#list-loading\").show();\r\n	var url = \"/mobile/plugin/plus/browser/hrmBrowserAction.jsp?action=getListData&pageNo=\"+currPgNo;\r\n	var $searchKey = $(\"#search-key\");\r\n	var searchKey = encodeURIComponent($searchKey.val());\r\n	//var searchKey = $searchKey.val();\r\n	$.get(url, {\"searchKey\":searchKey, \"pageSize\":pageSize,\"showSubUser\":_showSubUser,\"issubcompany\":_issubcompany,\"deptids\":_deptids,\"towernodeid\":_towernodeid,\"toweroperatetype\":_toweroperatetype}, \r\n			function(responseText){\r\n		$(\"#list-loading\").hide();\r\n		var data;\r\n		if($.isPlainObject(responseText)){\r\n			data = responseText;\r\n		}else{\r\n			data = $.parseJSON(responseText);\r\n		}\r\n		var status = data[\"status\"];\r\n		if(status == \"1\"){\r\n			var totalRecordCount = data[\"totalSize\"];\r\n			var datas = data[\"datas\"];\r\n			fillListDatasToPage(datas,0);\r\n			pageCount = (totalRecordCount % pageSize) == 0 ? parseInt(totalRecordCount / pageSize) : (parseInt(totalRecordCount / pageSize) + 1);\r\n			if(currPgNo >= pageCount){\r\n				$(\"#list-loadMore\").hide();\r\n			}else{\r\n				$(\"#list-loadMore\").show();\r\n			}\r\n		}else{\r\n			var errMsg = data[\"errMsg\"];\r\n			$(\"#list-hrm-content > .group-wrap\").append(\"\u52a0\u8f7d\u6570\u636e\u65f6\u51fa\u73b0\u9519\u8bef\uff1a\" + errMsg);\r\n		}\r\n	});\r\n}\r\n\r\n\r\nfunction initLastHrm(){\r\n	var url = \"/mobile/plugin/plus/browser/hrmBrowserAction.jsp\";\r\n	$.get(url,{\"action\":\"getLastHrmData\"}, function(responseText){\r\n		$(\"#list-loading\").hide();\r\n		var data;\r\n		if($.isPlainObject(responseText)){\r\n			data = responseText;\r\n		}else{\r\n			data = $.parseJSON(responseText);\r\n		}\r\n		var status = data[\"status\"];\r\n		if(status == \"1\"){\r\n			var datas = data[\"datas\"];\r\n			if(datas.length>0){\r\n				fillListDatasToPage(datas,1);\r\n			}else{\r\n				$(\"#list-lasthrm-content > .group-wrap\").append(\"<div style='width:100%;height:30px;line-height:30px;font-weight: bold;text-align:center;color:#999;margin-top:10px;'>\u6682\u65e0\u76f8\u5173\u5e38\u7528\u4eba\u6570\u636e</div>\");\r\n				$(\"#control-hrm\").click();\r\n			}\r\n		}else{\r\n			var errMsg = data[\"errMsg\"];\r\n			$(\"#list-lasthrm-content > .group-wrap\").append(\"\u52a0\u8f7d\u6570\u636e\u65f6\u51fa\u73b0\u9519\u8bef\uff1a\" + errMsg);\r\n		}\r\n	});\r\n}\r\n\r\nfunction initDept(){\r\n	var url = \"/mobile/plugin/plus/browser/hrmBrowserAction.jsp\";\r\n	$.get(url,{\"action\":\"getDeptData\"}, function(responseText){\r\n		$(\"#list-loading\").hide();\r\n		var data;\r\n		if($.isPlainObject(responseText)){\r\n			data = responseText;\r\n		}else{\r\n			data = $.parseJSON(responseText);\r\n		}\r\n		var status = data[\"status\"];\r\n		if(status == \"1\"){\r\n			var datas = data[\"datas\"];\r\n			fillListDatasToPage(datas,2);\r\n		}else{\r\n			var errMsg = data[\"errMsg\"];\r\n			$(\"#list-dept-content > .group-wrap\").append(\"\u52a0\u8f7d\u6570\u636e\u65f6\u51fa\u73b0\u9519\u8bef\uff1a\" + errMsg);\r\n		}\r\n	});\r\n}\r\n\r\nfunction searchListData(){\r\n	$(\"#list-hrm-content > .group-wrap\").find(\"*\").remove();\r\n	currPgNo = 1;\r\n	doSearch();\r\n}\r\n\r\nfunction searchListDataMore(){\r\n	currPgNo++;\r\n	doSearch();\r\n}\r\n\r\nfunction fillListDatasToPage(datas,type){\r\n	for(var i = 0; i < datas.length; i++){\r\n		var data = datas[i];\r\n		var id = data[\"id\"];	//\u4eba\u5458id\r\n		var lastname = data[\"lastname\"];	//\u59d3\u540d\r\n		//var lastname_py = data[\"lastname_py\"];	//\u62fc\u97f3\r\n		var departmentName = data[\"departmentName\"];	//\u90e8\u95e8\u540d\u79f0\r\n		var jobTitlesName = data[\"jobTitlesName\"];	//\u5c97\u4f4d\u540d\u79f0\r\n		var subCompanyName = data[\"subCompanyName\"]	//\u5206\u90e8\u540d\u79f0\r\n		var messagerurl = data[\"messagerurl\"]	//\u5934\u50cf\r\n		var field27 = data[\"field27\"]	//\u5934\u50cf\r\n		\r\n		var $group = $(\"#list-hrm-content > .group-wrap > .group\");\r\n		if(type==1){\r\n			$group = $(\"#list-lasthrm-content > .group-wrap > .group\");\r\n		}else if(type==2){\r\n			$group = $(\"#list-dept-content > .group-wrap > .group\");\r\n		}\r\n		if($group.length == 0){\r\n			$group = $(\"<div class=\\\"group\\\"></div>\");\r\n			//$group.append(\"<div class=\\\"group-title\\\">\"+lastname_py+\"</div>\");\r\n			$group.append(\"<ul class=\\\"group-data muti\\\"></ul>\");\r\n			if(type==1){\r\n				$(\"#list-lasthrm-content > .group-wrap\").append($group);\r\n			}else if(type==2){\r\n				$(\"#list-dept-content > .group-wrap\").append($group);\r\n			}else{\r\n				$(\"#list-hrm-content > .group-wrap\").append($group);\r\n			}\r\n		}\r\n		\r\n		var $groupData = $group.children(\".group-data\");\r\n		\r\n		var checkedStr = (indexOfSelectedArr(id) == -1) ? \"\" : \"checked=\\\"checked\\\"\";\r\n		var $oneData = $(\"<li class=\\\"one-data\\\"></li>\");\r\n		if(_ifBsite==1){\r\n			$oneData.append(\"<input type=\\\"checkbox\\\" class=\\\"valueHolder\\\" name=\\\"checkbox_hrm\\\" hrmId=\\\"\"+id+\"\\\" value=\\\"\"+id+\"\\\" \"+checkedStr+\"/>\"+\r\n					\"<div class=\\\"data-inner\\\" style='height:55px;padding-left:43px;'>\"+\r\n						\"<div class=\\\"data-avatar\\\">\"+\r\n							\"<div>\"+(messagerurl!=\"\"?\"<img src=\\\"\"+messagerurl+\"\\\" style=\\\"width:100%;height:100%;\\\" />\":\"\")+\"</div>\"+\r\n						\"</div>\"+\r\n						\"<div class=\\\"data-part1\\\" style='width:100%;'>\"+\r\n							\"<div class=\\\"data-lastname\\\" style='height:55px;line-height:55px;margin-top:0;'>\"+lastname+\"(\"+field27+\")</div>\"+\r\n						\"</div>\"+\r\n					\"</div>\");\r\n		}else{\r\n			$oneData.append(\"<input type=\\\"checkbox\\\" class=\\\"valueHolder\\\" name=\\\"checkbox_hrm\\\" hrmId=\\\"\"+id+\"\\\" value=\\\"\"+id+\"\\\" \"+checkedStr+\"/>\"+\r\n					\"<div class=\\\"data-inner\\\">\"+\r\n						\"<div class=\\\"data-avatar\\\">\"+\r\n							\"<div>\"+(messagerurl!=\"\"?\"<img src=\\\"\"+messagerurl+\"\\\" style=\\\"width:100%;height:100%;\\\" />\":\"\")+\"</div>\"+\r\n						\"</div>\"+\r\n						\"<div class=\\\"data-part1\\\">\"+\r\n							\"<div class=\\\"data-lastname\\\">\"+lastname+\"</div>\"+\r\n							\"<div class=\\\"data-subCompany\\\">\"+subCompanyName+\"</div>\"+\r\n						\"</div>\"+\r\n						\"<div class=\\\"data-part2\\\">\"+\r\n							\"<div class=\\\"data-jobTitle\\\">\"+jobTitlesName+\"</div>\"+\r\n							\"<div class=\\\"data-department\\\">\"+departmentName+\"</div>\"+\r\n						\"</div>\"+\r\n					\"</div>\");\r\n		}\r\n		$groupData.append($oneData);\r\n		\r\n		$(\".valueHolder\", $oneData).attr(\"hrm_data\", JSON.stringify(data));\r\n		\r\n		$oneData.cssCheckBox();\r\n	}\r\n}\r\n\r\nfunction initPageControl(){\r\n	var $page = $(\"#page-center\");\r\n	var $centerContent = $(\"#center-content\");\r\n	var $pageControl = $(\"#page-control\");\r\n	\r\n	$(\"#page-control\").click(function(){\r\n		if(_showSubUser!=\"1\"){\r\n			$page.toggleClass(\"control-open\");\r\n		}\r\n	});\r\n	\r\n	$(\"#page-mask\").click(function(){\r\n		$page.removeClass(\"control-open\");\r\n	});\r\n	\r\n	$(\"#control-dept\").click(function(){\r\n		$page.removeClass(\"control-open\");\r\n		if(!$pageControl.hasClass(\"dept\")){\r\n			$pageControl[0].className = \"dept\";\r\n			showTypeName = \"\u540c\u90e8\u95e8\";\r\n			$(\".control-text\", $pageControl).html(showTypeName);\r\n			changeHeaderTitle();\r\n		}\r\n		\r\n		if(!$centerContent.hasClass(\"dept\")){\r\n			$centerContent[0].className = \"dept\";\r\n		}\r\n	});\r\n	\r\n	$(\"#control-hrm\").click(function(){\r\n		$page.removeClass(\"control-open\");\r\n		if(!$pageControl.hasClass(\"hrm\")){\r\n			$pageControl[0].className = \"hrm\";\r\n			showTypeName = \"\u6240\u6709\u4eba\";\r\n			$(\".control-text\", $pageControl).html(showTypeName);\r\n			changeHeaderTitle();\r\n		}\r\n		\r\n		if(!$centerContent.hasClass(\"hrm\")){\r\n			$centerContent[0].className = \"hrm\";\r\n		}\r\n	});\r\n	\r\n	$(\"#control-lasthrm\").click(function(){\r\n		$page.removeClass(\"control-open\");\r\n		if(!$pageControl.hasClass(\"lasthrm\")){\r\n			$pageControl[0].className = \"lasthrm\";\r\n			showTypeName = \"\u5e38\u7528\u4eba\";\r\n			$(\".control-text\", $pageControl).html(showTypeName);\r\n			changeHeaderTitle();\r\n		}\r\n		\r\n		if(!$centerContent.hasClass(\"lasthrm\")){\r\n			$centerContent[0].className = \"lasthrm\";\r\n		}\r\n	});\r\n	\r\n	$(\"#control-org\").click(function(){\r\n		$page.removeClass(\"control-open\");\r\n		if(!$pageControl.hasClass(\"org\")){\r\n			$pageControl[0].className = \"org\";\r\n			showTypeName = \"\u7ec4\u7ec7\u67b6\u6784\";\r\n			$(\".control-text\", $pageControl).html(showTypeName);\r\n			changeHeaderTitle();\r\n		}\r\n		\r\n		if(!$centerContent.hasClass(\"org\")){\r\n			$centerContent[0].className = \"org\";\r\n		}\r\n	});\r\n	\r\n	$(\"#control-group\").click(function(){\r\n		$page.removeClass(\"control-open\");\r\n		if(!$pageControl.hasClass(\"group\")){\r\n			$pageControl[0].className = \"group\";\r\n			showTypeName = \"\u5e38\u7528\u7ec4\";\r\n			$(\".control-text\", $pageControl).html(showTypeName);\r\n			changeHeaderTitle();\r\n		}\r\n		\r\n		if(!$centerContent.hasClass(\"group\")){\r\n			$centerContent[0].className = \"group\";\r\n		}\r\n	});\r\n	\r\n	$(\"#choosedResult\").click(function(){\r\n		resetSelectedResultSearch();\r\n		buildSelectedResultPage();\r\n		initSelectedResultPageEvt();\r\n		$page.addClass(\"selected-result-open\");\r\n	});\r\n}\r\n\r\nfunction changeHeaderTitle(){\r\n	$(\"#nav-header .header-center\").html(showTypeName);\r\n	try{\r\n		if(typeof(top.changeMiddlePageName) == \"function\"){\r\n			top.changeMiddlePageName();\r\n		}\r\n	}catch(e){\r\n		\r\n	}\r\n}\r\nfunction refreshSelectedNum(){\r\n	$(\"#selectedNum\").html(_selected_arr.length);\r\n}\r\n\r\nfunction indexOfSelectedArr(id){\r\n	var index = -1;\r\n	for(var i = 0; i < _selected_arr.length; i++){\r\n		var selectedData = _selected_arr[i];\r\n		if(selectedData[\"id\"] == id){\r\n			index = i;\r\n			break;\r\n		}\r\n	}\r\n	return index;\r\n}\r\n\r\nfunction addInSelectedArr(data){\r\n	if(indexOfSelectedArr(data.id) == -1){\r\n		_selected_arr.push(data);\r\n	}\r\n}\r\n\r\nfunction removeFromSelectedArr(data){\r\n	removeFromSelectedArrById(data.id);\r\n}\r\n\r\nfunction removeFromSelectedArrById(id){\r\n	var index = indexOfSelectedArr(id);\r\n	if(index != -1){\r\n		_selected_arr.splice(index, 1);\r\n	}	\r\n}\r\n\r\nfunction clearSelectedArr(){\r\n	_selected_arr = [];\r\n}\r\n\r\nfunction updateSelectedArrSort(){\r\n	var _new_selected_arr = new Array();\r\n	$(\"#result-data li.one-data\").each(function(){\r\n		var hrmId = $(this).attr(\"hrmId\");\r\n		var index = indexOfSelectedArr(hrmId);\r\n		if(index != -1){\r\n			var data = _selected_arr[index];\r\n			_new_selected_arr.push(data);\r\n		}\r\n	});\r\n	\r\n	if(_new_selected_arr.length == _selected_arr.length){\r\n		_selected_arr = _new_selected_arr;\r\n	}\r\n}\r\n\r\nfunction checkedOnPage(id){\r\n	var $valueHolder = $(\".valueHolder[hrmId='\"+id+\"']\");\r\n	$valueHolder.attr(\"checked\", \"checked\");\r\n	$valueHolder.parent().addClass(\"checked\");\r\n}\r\n\r\nfunction deCheckedOnPage(id){\r\n	var $valueHolder = $(\".valueHolder[hrmId='\"+id+\"']\");\r\n	$valueHolder.removeAttr(\"checked\");\r\n	$valueHolder.parent().removeClass(\"checked\");\r\n}\r\n\r\nfunction deCheckedAllOnPage(){\r\n	var $valueHolder = $(\".valueHolder\");\r\n	$valueHolder.removeAttr(\"checked\");\r\n	$valueHolder.parent().removeClass(\"checked\");\r\n}\r\n\r\nfunction initHeader(){\r\n	$(\"#nav-header .header-left\").click(doLeftMenuConfig);\r\n	$(\"#nav-header .header-right\").click(doRightMenuConfig);\r\n	\r\n	$(\"#backResult\").click(doLeftMenuConfig);\r\n	$(\"#okResult\").click(doRightMenuConfig);\r\n}\r\nfunction buildSelectedResultPage(){\r\n	var $resultData = $(\"#result-data\");\r\n	$resultData.children(\"ul\").remove();\r\n	var $dataUL = $(\"<ul></ul>\");\r\n	$resultData.append($dataUL);\r\n	\r\n	for(var i = 0; i < _selected_arr.length; i++){\r\n		var selectedData = _selected_arr[i];\r\n		var id = selectedData[\"id\"];	//\u4eba\u5458id\r\n		var lastname = selectedData[\"lastname\"];	//\u59d3\u540d\r\n		var departmentName = selectedData[\"departmentName\"];	//\u90e8\u95e8\u540d\u79f0\r\n		var jobTitlesName = selectedData[\"jobTitlesName\"];	//\u5c97\u4f4d\u540d\u79f0\r\n		var subCompanyName = selectedData[\"subCompanyName\"]	//\u5206\u90e8\u540d\u79f0\r\n		\r\n		$dataUL.append(\"<li class=\\\"one-data\\\" hrmId=\\\"\"+id+\"\\\">\"+\r\n							\"<div class=\\\"data-inner\\\">\"+\r\n								\"<div class=\\\"data-delete\\\"></div>\"+\r\n								\"<div class=\\\"data-part1\\\">\"+\r\n									\"<div class=\\\"data-lastname\\\">\"+lastname+\"</div>\"+\r\n									\"<div class=\\\"data-subCompany\\\">\"+subCompanyName+\"</div>\"+\r\n								\"</div>\"+\r\n								\"<div class=\\\"data-part2\\\">\"+\r\n									\"<div class=\\\"data-jobTitle\\\">\"+jobTitlesName+\"</div>\"+\r\n									\"<div class=\\\"data-department\\\">\"+departmentName+\"</div>\"+\r\n								\"</div>\"+\r\n								\"<div class=\\\"data-move\\\"></div>\"+\r\n							\"</div>\"+\r\n							\r\n							\"<div class=\\\"delete-data\\\" hrmId=\\\"\"+id+\"\\\">\u5220\u9664</div>\"+\r\n						\"</li>\");\r\n	}\r\n}\r\nfunction initSelectedResultPageEvt(){\r\n	var $resultData = $(\"#result-data\");\r\n	\r\n	$(\".data-delete\", $resultData).click(function(e){\r\n		$(this).parent().parent().addClass(\"beDelete\");\r\n		e.stopPropagation();\r\n	});\r\n	$(\"li.one-data\", $resultData).click(function(e){\r\n		if($(this).hasClass(\"beDelete\")){\r\n			$(this).removeClass(\"beDelete\");\r\n			e.stopPropagation();\r\n		}\r\n	});	\r\n	$(\".delete-data\", $resultData).click(function(e){\r\n		//\u5220\u9664\u6570\u636e\r\n		var hrmId = $(this).attr(\"hrmId\");\r\n		removeFromSelectedArrById(hrmId);\r\n		//\u5237\u65b0\u5e95\u90e8\u9009\u4e2d\u4e2a\u6570\r\n		refreshSelectedNum();\r\n		//\u53d6\u6d88\u9875\u9762\u6570\u636e\u7684\u9009\u4e2d\u72b6\u6001\r\n		deCheckedOnPage(hrmId);\r\n		//\u9875\u9762\u4e0a\u5220\u9664\r\n		var $oneData = $(this).parent();\r\n		$oneData.addClass(\"deleted\");\r\n		setTimeout(function(){\r\n			$oneData.remove();\r\n		},500);\r\n		e.stopPropagation();\r\n	});\r\n	\r\n	new Sortable($(\"ul\", $resultData)[0], {\r\n		animation: 150,\r\n		handle: \".data-move\",\r\n		draggable: \".one-data\",\r\n		onUpdate: function (evt){\r\n			var item = evt.item;\r\n			updateSelectedArrSort();\r\n		}\r\n	});\r\n}\r\n\r\nvar prevSearchKey2 = \"\";\r\nfunction initSelectedResultSearch(){\r\n	var $searchKey = $(\"#result-search-key\");\r\n	var $srarchInner = $(\"#result-hrm-srarch .srarch-inner\");\r\n	$(\".search-holder\", $srarchInner).click(function(){\r\n		$srarchInner.addClass(\"searching\");\r\n		$searchKey[0].focus();\r\n	});\r\n	\r\n	$searchKey.blur(function(){\r\n		if(this.value == \"\"){\r\n			$srarchInner.removeClass(\"searching\");\r\n		}\r\n	});\r\n	\r\n	$searchKey.bind(\"input\", function(){\r\n		var currSearchKey = this.value;\r\n		if(currSearchKey != prevSearchKey2){\r\n			prevSearchKey2 = currSearchKey;\r\n			searchSelectedResult();\r\n		}\r\n	});\r\n}\r\n\r\nfunction searchSelectedResult(){\r\n	var $oneData = $(\"#result-data li.one-data\");\r\n	var searchKeyVal = $(\"#result-search-key\").val();\r\n	if(searchKeyVal == \"\"){\r\n		$oneData.show();\r\n	}else{\r\n		$oneData.each(function(){\r\n			var datalastname = $(\".data-lastname\", this).text();\r\n			if(datalastname.indexOf(searchKeyVal) != -1){\r\n				$(this).show();\r\n			}else{\r\n				$(this).hide();\r\n			}\r\n		});\r\n	}\r\n}\r\n\r\nfunction resetSelectedResultSearch(){\r\n	var $searchKey = $(\"#result-search-key\");\r\n	$searchKey.val(\"\");\r\n	$searchKey.trigger(\"blur\");\r\n}\r\n\r\nfunction bindTreeEvt($wrap){\r\n	$(\".one-tree-data[data-haschild='1']\", $wrap).click(function(){\r\n		var $oneTreeData = $(this);\r\n		var expanding = $oneTreeData.attr(\"expanding\");\r\n		if(expanding == \"1\"){\r\n			return;\r\n		}\r\n		$oneTreeData.attr(\"expanding\", \"1\");\r\n		\r\n		var $treePage = $oneTreeData.siblings(\".tree-page\");\r\n		\r\n		if($oneTreeData.hasClass(\"closed\")){\r\n			$oneTreeData.removeClass(\"closed\");\r\n			$oneTreeData.addClass(\"opened\");\r\n			\r\n			if($treePage.length > 0){\r\n				$treePage.show();\r\n				$oneTreeData.removeAttr(\"expanding\");\r\n			}else{\r\n				//\u4ece\u670d\u52a1\u7aef\u52a0\u8f7d\r\n				var $treeLoading = $(\"<div class=\\\"tree-loading\\\"></div>\");\r\n				$treeLoading.insertAfter($oneTreeData);\r\n				\r\n				var dataType = $oneTreeData.attr(\"data-type\");\r\n				var dataId = $oneTreeData.attr(\"data-id\");\r\n				\r\n				var url = \"/mobile/plugin/plus/browser/hrmBrowserAction.jsp?action=getTreeData&type=\"+dataType+\"&pid=\"+dataId;\r\n								\r\n				$.get(url, null, function(responseText){\r\n					$treeLoading.remove();\r\n					\r\n					var data;\r\n					if($.isPlainObject(responseText)){\r\n						data = responseText;\r\n					}else{\r\n						data = $.parseJSON(responseText);\r\n					}\r\n					var status = data[\"status\"];\r\n					if(status == \"1\"){\r\n						var datas = data[\"datas\"];\r\n						fillTreeDatasToPage(datas, $oneTreeData);\r\n					}else{\r\n						var errMsg = data[\"errMsg\"];\r\n						alert(\"\u52a0\u8f7d\u6570\u636e\u65f6\u51fa\u73b0\u9519\u8bef\uff1a\" + errMsg);\r\n						\r\n						$oneTreeData.removeClass(\"opened\");\r\n						$oneTreeData.addClass(\"closed\");\r\n					}\r\n					\r\n					$oneTreeData.removeAttr(\"expanding\");\r\n				});\r\n			}\r\n		}else if($oneTreeData.hasClass(\"opened\")){\r\n			$treePage.hide();\r\n			$oneTreeData.removeClass(\"opened\");\r\n			$oneTreeData.addClass(\"closed\");\r\n			$oneTreeData.removeAttr(\"expanding\");\r\n		}\r\n	});\r\n}\r\n\r\nfunction fillTreeDatasToPage(datas, $obj){\r\n	var $treePage = $(\"<ul class=\\\"tree-page\\\"></ul>\");\r\n	for(var i = 0; i < datas.length; i++){\r\n		var data = datas[i];\r\n		var id = data[\"id\"];	//id\r\n		var name = data[\"name\"];	//\u540d\u79f0\r\n		var type = data[\"type\"];	//\u7c7b\u578b\r\n		var messagerurl = data[\"messagerurl\"]	//\u5934\u50cf\r\n		\r\n		var $li;\r\n		if(type == \"4\"){	//\u4eba\u5458\r\n			$li = $(\"<li class=\\\"hrm\\\"></li>\");\r\n			var checkedStr = (indexOfSelectedArr(id) == -1) ? \"\" : \"checked=\\\"checked\\\"\";\r\n			$li.append(\"<input type=\\\"checkbox\\\" class=\\\"valueHolder\\\" name=\\\"checkbox_hrm\\\" hrmId=\\\"\"+id+\"\\\" value=\\\"\"+id+\"\\\" \"+checkedStr+\"/>\"+\r\n					   \"<div class=\\\"one-tree-data\\\">\"+\r\n							\"<div class=\\\"data-avatar\\\">\"+\r\n								\"<div>\"+(messagerurl!=\"\"?\"<img src=\\\"\"+messagerurl+\"\\\" style=\\\"width:100%;height:100%;\\\" />\":\"\")+\"</div>\"+\r\n							\"</div>\"+\r\n							\"<div class=\\\"data-name\\\">\"+\r\n								name+\r\n							\"</div>\"+\r\n						\"</div>\");\r\n			$treePage.append($li);\r\n			$(\".valueHolder\", $li).attr(\"hrm_data\", JSON.stringify(data));\r\n			$li.cssCheckBox();\r\n		}else{\r\n			var hasChild = data[\"hasChild\"];	//\u662f\u5426\u6709\u5b50\u8282\u70b9\r\n			var hasChildFlag = hasChild ? \"1\" : \"0\"; \r\n			var cssStr = hasChild ? \"closed\" : \"\";\r\n		\r\n			$li = $(\"<li></li>\");\r\n			$li.append(\"<div class=\\\"one-tree-data \"+cssStr+\"\\\" data-id=\\\"\"+id+\"\\\" data-type=\\\"\"+type+\"\\\" data-haschild=\\\"\"+hasChildFlag+\"\\\">\"+name+\"</div>\");\r\n			$treePage.append($li);\r\n		}\r\n		\r\n	}\r\n	$treePage.insertAfter($obj);\r\n	\r\n	bindTreeEvt($treePage);\r\n}\r\nfunction keyDown(e) {\r\n	var ev= window.event||e;\r\n	if (ev.keyCode == 13){\r\n		searchListData();\r\n	}\r\n}\r\n/***\u517c\u5bb9\u79fb\u52a8\u5efa\u6a21\u7684\u5934\u90e8***/\r\nfunction hasOperationConfig(){\r\n	return \"true,,false,true,/downloadpic.do?url=/mobile/plugin/plus/browser/images/ok.png?css={width:36px;height:36px;top:7px;}\";\r\n}\r\nfunction toDoMiddlePageName(){\r\n	return showTypeName;\r\n}\r\nfunction doLeftMenuConfig(){\r\n	var $pageCenter = $(\"#page-center\");\r\n	if($pageCenter.hasClass(\"selected-result-open\")){\r\n		$pageCenter.removeClass(\"selected-result-open\");	\r\n	}else{\r\n		//backpage\r\n		try{\r\n			var browserWin = parent._BrowserWindow;\r\n			if(browserWin){\r\n				//browserWin.onBrowserBack();\r\n				eval('browserWin.'+_callbackBack+'()');\r\n			}else{\r\n				//parent.onBrowserBack();\r\n				eval('parent.'+_callbackBack+'()');\r\n			}\r\n		}catch(e){\r\n			\r\n		}\r\n	}\r\n}\r\nfunction doRightMenuConfig(){\r\n	var idValue = \"\";\r\n	var nameValue = \"\";\r\n    for(var i = 0; i < _selected_arr.length; i++){\r\n		var selectedData = _selected_arr[i];\r\n		idValue += selectedData[\"id\"] + \",\";\r\n		nameValue += selectedData[\"lastname\"] + \",\";\r\n	}\r\n	if(idValue != \"\"){\r\n		idValue = idValue.substring(0, idValue.length-1);\r\n	}\r\n	if(nameValue != \"\"){\r\n		nameValue = nameValue.substring(0, nameValue.length-1);\r\n	}\r\n	var result = {\r\n		\"fieldId\" : _fieldId,\r\n		\"fieldSpanId\" : _fieldSpanId,\r\n		\"idValue\" : idValue,\r\n		\"nameValue\" : nameValue\r\n	};\r\n	try{\r\n		var browserWin = parent._BrowserWindow;\r\n		if(browserWin){\r\n			//browserWin.onBrowserOk(result);\r\n			eval('browserWin.'+_callbackOk+'(result)');\r\n		}else{\r\n			//parent.onBrowserOk(result);\r\n			eval('parent.'+_callbackOk+'(result)');\r\n		}\r\n	}catch(e){\r\n		\r\n	}\r\n	return \"1\";\r\n}\r\n/******/\r\n</script>\r\n".toCharArray();
    _jsp_string7 = "\";\r\nvar _ifBsite = \"".toCharArray();
    _jsp_string21 = "\">\r\n			<div class=\"control-icon\">\r\n			\r\n			</div>\r\n			<div class=\"control-text\">\r\n				".toCharArray();
    _jsp_string8 = "\";\r\n\r\nvar showTypeName = \"".toCharArray();
    _jsp_string23 = "\r\n		<style>\r\n			#control-lasthrm{\r\n				position:absolute;\r\n			    left: 0px;\r\n			    bottom: 0px;\r\n			    width: 66px;\r\n			    height: 66px;\r\n			    background: url(\"/mobile/plugin/plus/browser/images/p5.png\") no-repeat;\r\n			    background-size: 100% 100%;\r\n			    z-index: 101;\r\n			    transition:All 0.15s ease-in-out;\r\n				-webkit-transition:All 0.15s ease-in-out;\r\n			}\r\n			#control-lasthrm .icon{\r\n				background-image: url(\"/mobile/plugin/plus/browser/images/p5-4.png\");\r\n			}\r\n			.control-open #control-lasthrm{\r\n				transform:translate(100px,-100px);\r\n				-webkit-transform:translate(100px,-100px);\r\n			}\r\n			#page-control.lasthrm .control-icon{\r\n				background-image: url(\"/mobile/plugin/plus/browser/images/big4.png\");\r\n			}\r\n			#page-control.lasthrm .control-text{\r\n				padding-left:15px;\r\n			}\r\n		</style>\r\n		<div id=\"control-lasthrm\" class=\"control-part\">\r\n			<div class=\"icon\"></div>\r\n			<div class=\"text\">\r\n				\u5e38\u7528\u4eba\r\n			</div>\r\n		</div>\r\n		".toCharArray();
    _jsp_string0 = "<!DOCTYPE html>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string5 = "\";\r\nvar _fieldSpanId = \"".toCharArray();
    _jsp_string15 = "</div>\r\n			<div class=\"header-right\"></div>\r\n		</div>\r\n	</div>\r\n	".toCharArray();
    _jsp_string6 = "\";\r\nvar _ifOnlyShowAllUser = \"".toCharArray();
    _jsp_string1 = "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n".toCharArray();
    _jsp_string3 = "\";\r\n\r\nvar _selected_arr = ".toCharArray();
    _jsp_string4 = ";\r\nvar _fieldId = \"".toCharArray();
    _jsp_string13 = "\r\n</head>\r\n<body class=\"_emobile\">\r\n<div id=\"page\">\r\n	".toCharArray();
    _jsp_string9 = "\";\r\nvar _showSubUser = \"0\";//\u662f\u5426\u53ea\u663e\u793a\u4e0b\u5c5e 0\u5426 1\u662f\r\nvar _showDept = \"0\";//\u662f\u5426\u53ea\u663e\u793a\u540c\u90e8\u95e8\r\nvar _deptids = \"\";//\u53ea\u663e\u793a\u8fd9\u4e9b\u90e8\u95e8\u7684\u4eba\u5458\r\nvar _issubcompany = \"0\";//0\u663e\u793a\u5168\u90e8,1\u53ea\u663e\u793a\u672c\u5206\u90e8\u7684\r\nvar oldShowSubUser = _showSubUser;\r\nvar oldShowDept = _showDept;\r\nvar oldIssubcompany = _issubcompany;\r\n//20180212 zhw \u4e2d\u56fd\u94c1\u5854\u5ba2\u6237\u8f6c\u529e\u63a7\u5236\u9009\u4eba\u8303\u56f4\u5f00\u53d1\r\nvar _towernodeid = \"\";\r\nvar oldTowernodeid = \"\";\r\nvar _toweroperatetype = \"\";\r\nvar _isRunInEmobile = (top && typeof(top.isRunInEmobile) == \"function\") ? top.isRunInEmobile() : false;\r\nvar _callbackOk = \"onBrowserOk\";\r\nvar _callbackBack = \"onBrowserBack\";\r\n</script>\r\n<script type=\"text/javascript\" src=\"/mobile/plugin/plus/browser/js/zepto.min_wev8.js?2\"></script>\r\n<script type=\"text/javascript\" src=\"/mobile/plugin/plus/browser/js/fastclick.min_wev8.js?2\"></script>\r\n<script type=\"text/javascript\" src=\"/mobile/plugin/plus/browser/js/jquery.sortable.min.js?2\"></script>\r\n<link type=\"text/css\" rel=\"stylesheet\" href=\"/mobile/plugin/plus/browser/css/hrmBrowser_wev8.css?9\" />\r\n<script type=\"text/javascript\">\r\n$.fn.cssCheckBox = function () {\r\n	if(_browserType == \"2\"){	//\u5355\u9009\r\n		$(\".valueHolder\", $(this)).each(function () {\r\n			if (this.checked) {\r\n				$(this).parent().addClass(\"checked\");\r\n			}\r\n			\r\n			$(this).parent().unbind(\"click\");\r\n			$(this).parent().click(function(){\r\n				deCheckedAllOnPage();\r\n				\r\n				var $valueHolder = $(\".valueHolder\", this);\r\n				var hrm_data = $.parseJSON($valueHolder.attr(\"hrm_data\"));\r\n				var id = hrm_data[\"id\"];\r\n				\r\n				checkedOnPage(id);\r\n					\r\n				clearSelectedArr();\r\n				addInSelectedArr(hrm_data);\r\n				refreshSelectedNum();\r\n			});\r\n		});\r\n	}else{	//\u591a\u9009\r\n		$(\".valueHolder\", $(this)).each(function () {\r\n			if (this.checked) {\r\n				$(this).parent().addClass(\"checked\");\r\n			}\r\n			\r\n			$(this).parent().unbind(\"click\");\r\n			$(this).parent().click(function(){\r\n				var $valueHolder = $(\".valueHolder\", this);\r\n				\r\n				var hrm_data = $.parseJSON($valueHolder.attr(\"hrm_data\"));\r\n				var id = hrm_data[\"id\"];\r\n				if($(this).hasClass(\"checked\")){\r\n					deCheckedOnPage(id);\r\n					removeFromSelectedArr(hrm_data);\r\n			    }else{\r\n			    	checkedOnPage(id);\r\n					addInSelectedArr(hrm_data);\r\n			    }\r\n			    \r\n			    refreshSelectedNum();\r\n			});\r\n		});\r\n	}\r\n};\r\n\r\n\r\n\r\nfunction resetBrowser(obj){\r\n	_fieldId = obj[\"fieldId\"] || \"\";\r\n	_fieldSpanId = obj[\"fieldSpanId\"] || \"\";\r\n	_browserType = obj[\"browserType\"] || \"1\";\r\n	_showSubUser = obj[\"showSubUser\"] ||\"0\";\r\n	_showDept = obj[\"showDept\"] ||\"0\";\r\n	_deptids = obj[\"deptids\"] ||\"\";\r\n	_issubcompany = obj[\"issubcompany\"] ||\"0\";\r\n	_towernodeid = obj[\"towernodeid\"]||\"\";\r\n	_toweroperatetype = obj[\"toweroperatetype\"]||\"\";\r\n	_callbackOk = obj[\"callbackOk\"]||\"onBrowserOk\";\r\n	_callbackBack = obj[\"callbackBack\"]||\"onBrowserBack\";\r\n	var selectedIds = obj[\"selectedIds\"] || \"\";\r\n	if(_showSubUser!=oldShowSubUser){\r\n		oldShowSubUser = _showSubUser;\r\n		searchListData();\r\n	}\r\n	if(_issubcompany!=oldIssubcompany){\r\n		oldIssubcompany = _issubcompany;\r\n		searchListData();\r\n	}\r\n	if(_deptids!=\"\"){\r\n		searchListData();\r\n	}\r\n	if(_towernodeid!=\"\"||_towernodeid!=oldTowernodeid){\r\n		oldTowernodeid = _towernodeid;\r\n		searchListData();\r\n	}\r\n	//\u663e\u793a\u4e0b\u5c5e \u672c\u5206\u90e8 \u672c\u90e8\u95e8 \u6839\u636e\u90e8\u95e8ID\u67e5\u8be2\r\n	if(_showSubUser==1||_issubcompany==1||_showDept==1||_deptids!=\"\"||_ifOnlyShowAllUser==1||_towernodeid!=\"\"){\r\n		$(\"#page-control\").hide();\r\n		$(\"#control-lasthrm\").hide();\r\n		$(\"#control-hrm\").hide();\r\n		$(\"#control-dept\").hide();\r\n		$(\"#control-org\").hide();\r\n		$(\"#control-group\").hide();\r\n		if(_showSubUser==1||_issubcompany==1||_deptids!=\"\"||_ifOnlyShowAllUser==1||_towernodeid!=\"\"){\r\n			if(_showSubUser==1){\r\n				$(\"#nav-header .header-center\").html(\"\u6211\u7684\u4e0b\u5c5e\");\r\n			}else if(_issubcompany==1){\r\n				$(\"#nav-header .header-center\").html(\"\u672c\u5206\u90e8\");\r\n			}else if(_deptids!=\"\"||_ifOnlyShowAllUser==1||_towernodeid!=\"\"){\r\n				$(\"#nav-header .header-center\").html(\"\u6240\u6709\u4eba\");\r\n			}\r\n			if(!$(\"#center-content\").hasClass(\"hrm\")){\r\n				$(\"#center-content\")[0].className=\"hrm\";\r\n			}\r\n			if(!$(\"#page-control\").hasClass(\"hrm\")){\r\n				$(\"#page-control\")[0].className=\"hrm\";\r\n				if(_showSubUser==1||_deptids!=\"\"||_ifOnlyShowAllUser==1||_towernodeid!=\"\"){\r\n					$(\".control-text\",$(\"#page-control\")).html(\"\u6240\u6709\u4eba\");\r\n					showTypeName = \"\u6240\u6709\u4eba\";\r\n				}else{\r\n					$(\".control-text\",$(\"#page-control\")).html(\"\u672c\u5206\u90e8\");\r\n				}\r\n			}\r\n		}else{\r\n			$(\"#nav-header .header-center\").html(\"\u540c\u90e8\u95e8\");\r\n			if(!$(\"#center-content\").hasClass(\"dept\")){\r\n				$(\"#center-content\")[0].className=\"dept\";\r\n			}\r\n		}\r\n	}else{\r\n		$(\"#page-control\").show();\r\n		$(\"#control-lasthrm\").show();\r\n		$(\"#control-dept\").show();\r\n		$(\"#control-hrm\").show();\r\n		$(\"#control-org\").show();\r\n		$(\"#control-group\").show();\r\n		$(\"#nav-header .header-center\").html(showTypeName);\r\n	}\r\n	$(\"#list-hrm-content > .group-wrap\").hide();\r\n	setTimeout(function(){\r\n		$(\"#list-hrm-content > .group-wrap\").show();\r\n	}, 0);\r\n	\r\n	clearSelectedArr();	//\u6e05\u7a7a\u5df2\u9009\r\n	deCheckedAllOnPage();	//\u6e05\u7a7a\u9875\u9762\u5df2\u9009\r\n	refreshSelectedNum();	//\u5237\u65b0\u5df2\u9009\u4e2a\u6570\r\n	$(document.body).cssCheckBox();	//\u91cd\u65b0\u8fdb\u884c\u4e8b\u4ef6\u7ed1\u5b9a\r\n	$(\"#page-center\").removeClass(\"selected-result-open\");	//\u63a7\u5236\u4e0d\u8ba9\u7ed3\u679c\u9875\u9762\u663e\u793a\r\n	\r\n	//\u5f02\u6b65\u52a0\u8f7d\u5df2\u9009\r\n	if(selectedIds != \"\"){\r\n		var url = \"/mobile/plugin/plus/browser/hrmBrowserAction.jsp?action=getSelectedDatas&selectedIds=\" + selectedIds;\r\n		//window.prompt(\"\",url);\r\n		$.get(url, null, function(responseText){\r\n			var data;\r\n			if($.isPlainObject(responseText)){\r\n				data = responseText;\r\n			}else{\r\n				data = $.parseJSON(responseText);\r\n			}\r\n			var status = data[\"status\"];\r\n			if(status == \"1\"){\r\n				var datas = data[\"datas\"];\r\n				for(var i = 0; i < datas.length; i++){\r\n					var selectedData = datas[i];\r\n					checkedOnPage(selectedData.id);\r\n					addInSelectedArr(selectedData);\r\n				}\r\n				refreshSelectedNum();\r\n			}\r\n		});\r\n	}\r\n}\r\n	\r\n$(document).ready(function(){\r\n	FastClick.attach(document.body);\r\n	\r\n	if(_isRunInEmobile){\r\n		$(document.body).addClass(\"_emobile\");\r\n	}\r\n	\r\n	refreshSelectedNum();\r\n	\r\n	".toCharArray();
    _jsp_string17 = "\">\r\n			<div id=\"center-content-inner\">\r\n				<div id=\"list-dept-container\" class=\"data-container dept-container\">\r\n					<div id=\"list-dept-content\" class=\"hrmitem\">\r\n						<div class=\"group-wrap\"></div>\r\n					</div>\r\n				</div>\r\n				<div id=\"list-hrm-container\" class=\"data-container hrm-container\">\r\n					<div id=\"list-hrm-srarch\">\r\n						<div class=\"srarch-inner\">\r\n							<div class=\"search-holder\"></div>\r\n							<form action=\"javascript:searchListData();\">\r\n							<input type=\"search\" id=\"search-key\" placeholder=\"\u8f93\u5165\u59d3\u540d\u3001\u59d3\u540d\u7b80\u62fc\u3001\u624b\u673a\u53f7\u7801\u67e5\u627e\"/>\r\n							</form>\r\n						</div>\r\n					</div>\r\n					\r\n					<div id=\"list-hrm-content\">\r\n						<div class=\"group-wrap\">\r\n						</div>\r\n						<div id=\"list-loadMore\">\u52a0\u8f7d\u66f4\u591a</div>\r\n						<div id=\"list-loading\">\r\n						</div>\r\n					</div>\r\n				</div>\r\n				".toCharArray();
    _jsp_string16 = "\r\n	\r\n	<div id=\"page-center\">\r\n		\r\n		<div id=\"center-content\" class=\"".toCharArray();
  }
}
